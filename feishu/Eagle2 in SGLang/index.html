<!DOCTYPE html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="本文将从为什么需要 speculative decoding 开始讲起，通过几篇论文来讲述现在投机采样演进的路线，以 SGLang 中 Eagle2 的实现作为 example 进行解析，并结合约束解码进行异步优化进行部分结果对比。"><meta name=author content=tom-jerr><link href=https://tom-jerr.github.io/feishu/Eagle2%20in%20SGLang/ rel=canonical><link href=../PD%20Disaggregation%20in%20SGLang/ rel=prev><link href=../../notes/sglang/%E4%B8%80%E6%9D%A1%20Request%20%E5%9C%A8%20SGLang%20%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F/ rel=next><link rel=alternate type=application/rss+xml title="RSS feed" href=../../feed_rss_created.xml><link rel=alternate type=application/rss+xml title="RSS feed of updated content" href=../../feed_rss_updated.xml><link rel=icon href=../../img/rocket.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Speculative Decoding in SGLang(EAGLE2) - Want to be a MlSys wizard</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=JetBrains+Mono:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"JetBrains Mono";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../css/custom.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css><link rel=stylesheet href=https://gcore.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css><link rel=stylesheet href=../../css/card.css><link rel=stylesheet href=../../css/flink.css><link rel=stylesheet href=../../css/tasklist.css><link rel=stylesheet href=../../css/footer-stats.css><link rel=stylesheet href=../../css/ai-summary.css><link rel=stylesheet href=../../assets/document_dates/fonts/material-icons.css><link rel=stylesheet href=../../assets/document_dates/tippy/light.css><link rel=stylesheet href=../../assets/document_dates/tippy/material.css><link rel=stylesheet href=../../assets/document_dates/tippy/shift-away.css><link rel=stylesheet href=../../assets/document_dates/tippy/scale.css><link rel=stylesheet href=../../assets/document_dates/tippy/backdrop.css><link rel=stylesheet href=../../assets/document_dates/tippy/tippy.css><link rel=stylesheet href=../../assets/document_dates/core/core.css><link rel=stylesheet href=../../assets/document_dates/user.config.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-NKJWZM1JHX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-NKJWZM1JHX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-NKJWZM1JHX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><script src=../../assets/javascripts/glightbox.min.js></script><style id=glightbox-style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#speculative-decoding-in-sglangeagle2 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Want to be a MlSys wizard" class="md-header__button md-logo" aria-label="Want to be a MlSys wizard" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 21h18v-2H2M20 8h-2V5h2m0-2H4v10a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4v-3h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Want to be a MlSys wizard </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Speculative Decoding in SGLang(EAGLE2) </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=indigo aria-label="light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=teal aria-label="dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/tom-jerr/tom-jerr.github.io/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class=md-source__repository> tom-jerr's Site </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg> Home </a> </li> <li class=md-tabs__item> <a href=../../notes/ class=md-tabs__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 22a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-6v7L9.5 7.5 7 9V2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2z"></path></svg> Notes </a> </li> <li class=md-tabs__item> <a href=../../paperreadings/ class=md-tabs__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M384 512H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h304c26.5 0 48 21.5 48 48v288c0 20.9-13.4 38.7-32 45.3V448c17.7 0 32 14.3 32 32s-14.3 32-32 32zM96 384c-17.7 0-32 14.3-32 32s14.3 32 32 32h256v-64zm32-232c0 13.3 10.7 24 24 24h176c13.3 0 24-10.7 24-24s-10.7-24-24-24H152c-13.3 0-24 10.7-24 24m24 72c-13.3 0-24 10.7-24 24s10.7 24 24 24h176c13.3 0 24-10.7 24-24s-10.7-24-24-24z"></path></svg> PaperReading </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../blogs/ class=md-tabs__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M224 24c0-13.3 10.7-24 24-24 145.8 0 264 118.2 264 264 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-119.3-96.7-216-216-216-13.3 0-24-10.7-24-24M80 96c26.5 0 48 21.5 48 48v224c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48c-8.8 0-16-7.2-16-16v-64c0-8.8 7.2-16 16-16 79.5 0 144 64.5 144 144s-64.5 144-144 144S32 447.5 32 368V144c0-26.5 21.5-48 48-48m168 0c92.8 0 168 75.2 168 168 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-66.3-53.7-120-120-120-13.3 0-24-10.7-24-24s10.7-24 24-24"></path></svg> Blogs </a> </li> <li class=md-tabs__item> <a href=../../summary/ class=md-tabs__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6 1h2v2h8V1h2v2h1a2 2 0 0 1 2 2v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h1zM5 8v11h14V8zm2 2h10v2H7z"></path></svg> Summaries </a> </li> <li class=md-tabs__item> <a href=../../tags/ class=md-tabs__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5.5 7A1.5 1.5 0 0 1 4 5.5 1.5 1.5 0 0 1 5.5 4 1.5 1.5 0 0 1 7 5.5 1.5 1.5 0 0 1 5.5 7m15.91 4.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.11 0-2 .89-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59s1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.56-.23-1.06-.59-1.42"></path></svg> Tags </a> </li> <li class=md-tabs__item> <a href=../../links/ class=md-tabs__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.78 3.653a3.936 3.936 0 1 1 5.567 5.567l-3.627 3.627a3.936 3.936 0 0 1-5.88-.353.75.75 0 0 0-1.18.928 5.436 5.436 0 0 0 8.12.486l3.628-3.628a5.436 5.436 0 1 0-7.688-7.688l-3 3a.75.75 0 0 0 1.06 1.061z"></path><path d="M7.28 11.153a3.936 3.936 0 0 1 5.88.353.75.75 0 0 0 1.18-.928 5.436 5.436 0 0 0-8.12-.486L2.592 13.72a5.436 5.436 0 1 0 7.688 7.688l3-3a.75.75 0 1 0-1.06-1.06l-3 3a3.936 3.936 0 0 1-5.567-5.568z"></path></svg> Links </a> </li> <li class=md-tabs__item> <a href=../../about/ class=md-tabs__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512m-90.6-190.1c20.4 28 53.4 46.1 90.6 46.1s70.2-18.1 90.6-46.1c7.8-10.7 22.8-13.1 33.5-5.3s13.1 22.8 5.3 33.5C356.3 390 309.2 416 256 416s-100.3-26-129.4-65.9c-7.8-10.7-5.4-25.7 5.3-33.5s25.7-5.4 33.5 5.3M144 208a32 32 0 1 1 64 0 32 32 0 1 1-64 0m164 8c0 11-9 20-20 20s-20-9-20-20c0-33.1 26.9-60 60-60h16c33.1 0 60 26.9 60 60 0 11-9 20-20 20s-20-9-20-20-9-20-20-20h-16c-11 0-20 9-20 20"></path></svg> About </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Want to be a MlSys wizard" class="md-nav__button md-logo" aria-label="Want to be a MlSys wizard" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M2 21h18v-2H2M20 8h-2V5h2m0-2H4v10a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4v-3h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg> </a> Want to be a MlSys wizard </label> <div class=md-nav__source> <a href=https://github.com/tom-jerr/tom-jerr.github.io/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class=md-source__repository> tom-jerr's Site </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../../notes/ class="md-nav__link "> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 22a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-6v7L9.5 7.5 7 9V2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2z"></path></svg> <span class=md-ellipsis> Notes </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/python/Python%20%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> Python 中的装饰器 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/python/Python%20%E4%B8%AD%E7%9A%84%E5%B9%B6%E8%A1%8C/ class=md-nav__link> <span class=md-ellipsis> Python 中的并行 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/python/Asyncio/ class=md-nav__link> <span class=md-ellipsis> Asyncio 基础 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> tiny-llm </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> tiny-llm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/tiny-llm/Group%20Query%20Attention/ class=md-nav__link> <span class=md-ellipsis> Group Query Attention </span> </a> </li> <li class=md-nav__item> <a href=../../notes/tiny-llm/RMSNorm%20%26%20MLP/ class=md-nav__link> <span class=md-ellipsis> RMSNorm &amp; MLP </span> </a> </li> <li class=md-nav__item> <a href=../../notes/tiny-llm/Batching%20Inference%20%26%20KV%20Cache/ class=md-nav__link> <span class=md-ellipsis> Batch Inference &amp; KV Cache </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> Active SLAM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Active SLAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paperreadings/activeslam/vins%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> VINS 基础 </span> </a> </li> <li class=md-nav__item> <a href=../../paperreadings/activeslam/active%20slam/ class=md-nav__link> <span class=md-ellipsis> Active SLAM 概述 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> nebula </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> nebula </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../projects/nebula-vsearch/understanding/1.visitor%20pattern/ class=md-nav__link> <span class=md-ellipsis> Vistor Pattern in nebula </span> </a> </li> <li class=md-nav__item> <a href=../../projects/nebula-vsearch/understanding/2.memory%20management/ class=md-nav__link> <span class=md-ellipsis> Memory Management in nebula </span> </a> </li> <li class=md-nav__item> <a href=../../projects/nebula-vsearch/understanding/3.concurrent%20lru%20cache/ class=md-nav__link> <span class=md-ellipsis> Concurrent LRU Cache in nebula </span> </a> </li> <li class=md-nav__item> <a href=../../projects/nebula-vsearch/understanding/4.folly%20future%20promise/ class=md-nav__link> <span class=md-ellipsis> Folly Future Promise framework in nebula </span> </a> </li> <li class=md-nav__item> <a href=../../projects/nebula-vsearch/understanding/5.nGQL%20life/ class=md-nav__link> <span class=md-ellipsis> nGQL Life in Nebula </span> </a> </li> <li class=md-nav__item> <a href=../../projects/nebula-vsearch/understanding/6.raft-wal/ class=md-nav__link> <span class=md-ellipsis> Raft Wal in Nebula </span> </a> </li> <li class=md-nav__item> <a href=../../projects/nebula-vsearch/understanding/7.how%20to%20modify%20sql/ class=md-nav__link> <span class=md-ellipsis> How to Modify nGQL </span> </a> </li> <li class=md-nav__item> <a href="../../projects/nebula-vsearch/understandings/8.a kv life.md" class=md-nav__link> <span class=md-ellipsis> A Life of KV Pairs </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> CS61C </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> CS61C </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/CS61C/lecture2-Intro%20to%20C/ class=md-nav__link> <span class=md-ellipsis> 1 C Intro </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CS61C/lecture4_C%20Memory%20Endianness/ class=md-nav__link> <span class=md-ellipsis> 4 C Memory Endianness </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CS61C/lecture10_Combinational%20Logic/ class=md-nav__link> <span class=md-ellipsis> 10 Combinational Logic </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CS61C/lecture11_FSMs/ class=md-nav__link> <span class=md-ellipsis> 11 FSMs </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CS61C/lecture14_Datapath/ class=md-nav__link> <span class=md-ellipsis> 14 Datapath </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CS61C/lecture15_Data-LevelParallelism/ class=md-nav__link> <span class=md-ellipsis> 15 Data-Level Parallelism </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CS61C/lecture16_Thread-LevelParallelism/ class=md-nav__link> <span class=md-ellipsis> 16 Thread-Level Parallelism </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CS61C/lecture17_Process_LevelParallelism/ class=md-nav__link> <span class=md-ellipsis> 17 Process-Level Parallelism </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CS61C/lecture18_Caches/ class=md-nav__link> <span class=md-ellipsis> 18 Caches </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CS61C/lecture21_Virtual_Memory/ class=md-nav__link> <span class=md-ellipsis> 21 Virtual Memory </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> <span class=md-ellipsis> CSAPP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> CSAPP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/ class=md-nav__link> <span class=md-ellipsis> 5-优化程序性能 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 6-存储器层次结构 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CSAPP/7-%E9%93%BE%E6%8E%A5/ class=md-nav__link> <span class=md-ellipsis> 7-链接 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CSAPP/8-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/ class=md-nav__link> <span class=md-ellipsis> 8-异常控制流 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CSAPP/%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E6%89%A7%E8%A1%8C/ class=md-nav__link> <span class=md-ellipsis> 程序的结构和执行 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CSAPP/%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 在系统上运行程序 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_8> <label class=md-nav__link for=__nav_2_8 id=__nav_2_8_label tabindex=0> <span class=md-ellipsis> 6.s081 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_8_label aria-expanded=false> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> 6.s081 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/6.s081/1-OS%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 1 OS的隔离性 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/ class=md-nav__link> <span class=md-ellipsis> 2 虚拟内存实现 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/6.s081/3-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%92%8C%E9%99%B7%E5%85%A5/ class=md-nav__link> <span class=md-ellipsis> 3 系统调用和陷入 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/ class=md-nav__link> <span class=md-ellipsis> 4 缺页中断 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/ class=md-nav__link> <span class=md-ellipsis> 5 硬件中断 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/ class=md-nav__link> <span class=md-ellipsis> 6 多核和锁 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/6.s081/7-%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2/ class=md-nav__link> <span class=md-ellipsis> 7 进程切换 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/ class=md-nav__link> <span class=md-ellipsis> 8 睡眠和唤醒 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_9> <label class=md-nav__link for=__nav_2_9 id=__nav_2_9_label tabindex=0> <span class=md-ellipsis> C++ Primer </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_9_label aria-expanded=false> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> C++ Primer </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 2_变量和基本类型 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 3_字符串向量数组 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4_表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/5_%E8%AF%AD%E5%8F%A5/ class=md-nav__link> <span class=md-ellipsis> 5_语句 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 6_函数 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/7_%E7%B1%BB/ class=md-nav__link> <span class=md-ellipsis> 7_类 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/8_IO%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> 8_IO库 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 9_顺序容器 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 10_泛型算法 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 11_关联容器 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/ class=md-nav__link> <span class=md-ellipsis> 12_动态内存 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 13_拷贝控制 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/ class=md-nav__link> <span class=md-ellipsis> 14_重载运算和类型转换 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/15_%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/ class=md-nav__link> <span class=md-ellipsis> 15_面向对象程序设计 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/ class=md-nav__link> <span class=md-ellipsis> 并发与多线程编程 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/ class=md-nav__link> <span class=md-ellipsis> Makefile学习 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_10> <label class=md-nav__link for=__nav_2_10 id=__nav_2_10_label tabindex=0> <span class=md-ellipsis> C++ 新特性 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_10_label aria-expanded=false> <label class=md-nav__title for=__nav_2_10> <span class="md-nav__icon md-icon"></span> C++ 新特性 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/C%2B%2B/1-Container/ class=md-nav__link> <span class=md-ellipsis> 1-Container </span> </a> </li> <li class=md-nav__item> <a href=../../notes/C%2B%2B/2-Algorithm/ class=md-nav__link> <span class=md-ellipsis> 2-Algorithm </span> </a> </li> <li class=md-nav__item> <a href=../../notes/C%2B%2B/3-Iterator/ class=md-nav__link> <span class=md-ellipsis> 3-Iterator </span> </a> </li> <li class=md-nav__item> <a href=../../notes/C++/4-FileSystem.md class=md-nav__link> <span class=md-ellipsis> 4-FileSystem </span> </a> </li> <li class=md-nav__item> <a href=../../notes/C%2B%2B/5-View/ class=md-nav__link> <span class=md-ellipsis> 5-View </span> </a> </li> <li class=md-nav__item> <a href=../../notes/C%2B%2B/6-Span/ class=md-nav__link> <span class=md-ellipsis> 6-Span </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_11> <label class=md-nav__link for=__nav_2_11 id=__nav_2_11_label tabindex=0> <span class=md-ellipsis> C++ Concurrency in Action </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_11_label aria-expanded=false> <label class=md-nav__title for=__nav_2_11> <span class="md-nav__icon md-icon"></span> C++ Concurrency in Action </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/C%2B%2BConcurrency/1-thread/ class=md-nav__link> <span class=md-ellipsis> 1-Thread </span> </a> </li> <li class=md-nav__item> <a href=../../notes/C%2B%2BConcurrency/2-Memory%20Model/ class=md-nav__link> <span class=md-ellipsis> 2-Memory Model in C++ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_12> <label class=md-nav__link for=__nav_2_12 id=__nav_2_12_label tabindex=0> <span class=md-ellipsis> CMU15445 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_12_label aria-expanded=false> <label class=md-nav__title for=__nav_2_12> <span class="md-nav__icon md-icon"></span> CMU15445 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/CMU15445/3-Database%20Storage/ class=md-nav__link> <span class=md-ellipsis> 3-Database Storage </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/4-Database_Storage_II/ class=md-nav__link> <span class=md-ellipsis> 4-Database_Storage_II </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/5-Buffer%20Pool/ class=md-nav__link> <span class=md-ellipsis> 5-Buffer Pool </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/6-Hash%20Table/ class=md-nav__link> <span class=md-ellipsis> 6-Hash Table </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/7-B%2BTree/ class=md-nav__link> <span class=md-ellipsis> 7-B+Tree </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/8-Index%20Concurrency/ class=md-nav__link> <span class=md-ellipsis> 8-Index Concurrency </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/9-Sort%26Aggregation/ class=md-nav__link> <span class=md-ellipsis> 9-Sort&amp;Aggregation </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/10-Join%20Algorithm/ class=md-nav__link> <span class=md-ellipsis> 10-Join Algorithm </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/11-Query_Execution/ class=md-nav__link> <span class=md-ellipsis> 11-Query_Execution </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/12-Query_Plan%26Optimization/ class=md-nav__link> <span class=md-ellipsis> 12-Query_Plan&amp;Optimization </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/13-Concurrency_Control_Theory/ class=md-nav__link> <span class=md-ellipsis> 13-Concurrency_Control_Theory </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/14-Two_Phase_Lock/ class=md-nav__link> <span class=md-ellipsis> 14-Two_Phase_Lock </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/15-Timestamp_Ordering_Concurrency/ class=md-nav__link> <span class=md-ellipsis> 15-Timestamp_Ordering_Concurrency </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/16-Mult-Version_Concurrency/ class=md-nav__link> <span class=md-ellipsis> 16-Mult-Version_Concurrency </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/17-Database_Logging/ class=md-nav__link> <span class=md-ellipsis> 17-Database_Logging </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/18-Database_Recovery/ class=md-nav__link> <span class=md-ellipsis> 18-Database_Recovery </span> </a> </li> <li class=md-nav__item> <a href=../../notes/CMU15445/19-Introducd_to_distributed_database/ class=md-nav__link> <span class=md-ellipsis> 19-Introducd_to_distributed_database </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_13> <label class=md-nav__link for=__nav_2_13 id=__nav_2_13_label tabindex=0> <span class=md-ellipsis> 6.824 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_13_label aria-expanded=false> <label class=md-nav__title for=__nav_2_13> <span class="md-nav__icon md-icon"></span> 6.824 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/6.824/MapReduce/ class=md-nav__link> <span class=md-ellipsis> MapReduce 论文阅读 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_14> <label class=md-nav__link for=__nav_2_14 id=__nav_2_14_label tabindex=0> <span class=md-ellipsis> Linux Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_14_label aria-expanded=false> <label class=md-nav__title for=__nav_2_14> <span class="md-nav__icon md-icon"></span> Linux Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/linux%20tools/1-grep/ class=md-nav__link> <span class=md-ellipsis> grep </span> </a> </li> <li class=md-nav__item> <a href=../../notes/linux%20tools/2-sed/ class=md-nav__link> <span class=md-ellipsis> sed </span> </a> </li> <li class=md-nav__item> <a href=../../notes/linux%20tools/3-awk/ class=md-nav__link> <span class=md-ellipsis> awk </span> </a> </li> <li class=md-nav__item> <a href=../../notes/linux%20tools/4-find/ class=md-nav__link> <span class=md-ellipsis> find </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../paperreadings/ class="md-nav__link "> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M384 512H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h304c26.5 0 48 21.5 48 48v288c0 20.9-13.4 38.7-32 45.3V448c17.7 0 32 14.3 32 32s-14.3 32-32 32zM96 384c-17.7 0-32 14.3-32 32s14.3 32 32 32h256v-64zm32-232c0 13.3 10.7 24 24 24h176c13.3 0 24-10.7 24-24s-10.7-24-24-24H152c-13.3 0-24 10.7-24 24m24 72c-13.3 0-24 10.7-24 24s10.7 24 24 24h176c13.3 0 24-10.7 24-24s-10.7-24-24-24z"></path></svg> <span class=md-ellipsis> PaperReading </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> PaperReading </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Database Systems </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Database Systems </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paperreadings/db/storage/NoMMAP/ class=md-nav__link> <span class=md-ellipsis> Do not use MMAP in DBMS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> Vector Search </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Vector Search </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paperreadings/vector%20search/IQAN/ class=md-nav__link> <span class=md-ellipsis> IQAN </span> </a> </li> <li class=md-nav__item> <a href=../../paperreadings/vector%20search/MIRAGE-ANNS/ class=md-nav__link> <span class=md-ellipsis> MIRAGE-ANNS </span> </a> </li> <li class=md-nav__item> <a href=../../paperreadings/vector%20search/LSM-VEC/ class=md-nav__link> <span class=md-ellipsis> LSM-VEC </span> </a> </li> <li class=md-nav__item> <a href=../../paperreadings/vector%20search/PANNS/ class=md-nav__link> <span class=md-ellipsis> PANNS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> Active SLAM </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Active SLAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paperreadings/activeslam/PL-VINS/ class=md-nav__link> <span class=md-ellipsis> PL-VINS </span> </a> </li> <li class=md-nav__item> <a href=../../paperreadings/activeslam/3D%20Active%20Metric-Semantic%20SLAM/ class=md-nav__link> <span class=md-ellipsis> 3D Active Metric-Semantic SLAM </span> </a> </li> <li class=md-nav__item> <a href=../../paperreadings/activeslam/Exploration%20with%20Global%20Consistency%20%20Using%20Real-Time%20Re-integration%20and%20Active%20Loop%20Closure/ class=md-nav__link> <span class=md-ellipsis> Exploration with Global Consistency Using Real-Time Re-integration and Active Loop Closure </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <div class="md-nav__link md-nav__container"> <a href=../../blogs/ class="md-nav__link "> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M224 24c0-13.3 10.7-24 24-24 145.8 0 264 118.2 264 264 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-119.3-96.7-216-216-216-13.3 0-24-10.7-24-24M80 96c26.5 0 48 21.5 48 48v224c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48c-8.8 0-16-7.2-16-16v-64c0-8.8 7.2-16 16-16 79.5 0 144 64.5 144 144s-64.5 144-144 144S32 447.5 32 368V144c0-26.5 21.5-48 48-48m168 0c92.8 0 168 75.2 168 168 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-66.3-53.7-120-120-120-13.3 0-24-10.7-24-24s10.7-24 24-24"></path></svg> <span class=md-ellipsis> Blogs </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> SGLang 专题 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=true> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> SGLang 专题 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../PD%20Disaggregation%20in%20SGLang/ class=md-nav__link> <span class=md-ellipsis> PD Disaggregation in SGLang </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> EAGLE2 in SGLang </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> EAGLE2 in SGLang </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#speculative-decoding-motivation class=md-nav__link> <span class=md-ellipsis> Speculative Decoding Motivation </span> </a> </li> <li class=md-nav__item> <a href=#what-is-speculative-decodingoriginal class=md-nav__link> <span class=md-ellipsis> What is Speculative Decoding(Original) </span> </a> </li> <li class=md-nav__item> <a href=#some-limitations class=md-nav__link> <span class=md-ellipsis> Some Limitations </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 发展历程 </span> </a> <nav class=md-nav aria-label=发展历程> <ul class=md-nav__list> <li class=md-nav__item> <a href=#speculative-decoding-leviathan-et-al-2023-google class=md-nav__link> <span class=md-ellipsis> Speculative Decoding (Leviathan et al., 2023, Google) </span> </a> </li> <li class=md-nav__item> <a href=#medusano-need-for-a-separate-draft-model class=md-nav__link> <span class=md-ellipsis> Medusa(No need for a separate draft model) </span> </a> </li> <li class=md-nav__item> <a href=#lookahead-decoding class=md-nav__link> <span class=md-ellipsis> Lookahead Decoding </span> </a> </li> <li class=md-nav__item> <a href=#eagle-1-extrapolation-algorithm-for-greater-language-model-efficiency class=md-nav__link> <span class=md-ellipsis> EAGLE-1： Extrapolation Algorithm for Greater Language-model Efficiency </span> </a> <nav class=md-nav aria-label="EAGLE-1： Extrapolation Algorithm for Greater Language-model Efficiency"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#eagle-1-drafting class=md-nav__link> <span class=md-ellipsis> EAGLE-1 Drafting </span> </a> </li> <li class=md-nav__item> <a href=#eagle-1-verification class=md-nav__link> <span class=md-ellipsis> EAGLE-1 Verification </span> </a> </li> <li class=md-nav__item> <a href=#multi-round-speculative-sampling class=md-nav__link> <span class=md-ellipsis> Multi-round speculative sampling </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#eagle-2-context-aware-speculation class=md-nav__link> <span class=md-ellipsis> EAGLE-2: Context-Aware speculation </span> </a> <nav class=md-nav aria-label="EAGLE-2: Context-Aware speculation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#motivation class=md-nav__link> <span class=md-ellipsis> Motivation </span> </a> </li> <li class=md-nav__item> <a href=#eagle-2-dynamic-tree-construction class=md-nav__link> <span class=md-ellipsis> EAGLE-2 Dynamic Tree Construction </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#eagle-3-training-time-test-direct-token-prediction-multi-level-fusion class=md-nav__link> <span class=md-ellipsis> EAGLE-3: Training-time test + Direct Token Prediction + Multi-level fusion </span> </a> <nav class=md-nav aria-label="EAGLE-3: Training-time test + Direct Token Prediction + Multi-level fusion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#motivation_1 class=md-nav__link> <span class=md-ellipsis> Motivation </span> </a> </li> <li class=md-nav__item> <a href=#eagle-3-training-time-test class=md-nav__link> <span class=md-ellipsis> EAGLE-3: Training-time test </span> </a> </li> <li class=md-nav__item> <a href=#eagle-3-tree-attention-mask-during-training-of-the-draft-model class=md-nav__link> <span class=md-ellipsis> EAGLE-3: Tree Attention Mask during training of the draft model </span> </a> </li> <li class=md-nav__item> <a href=#eagle-3-multi-layer-feature-fusion class=md-nav__link> <span class=md-ellipsis> EAGLE-3: Multi-layer feature fusion </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#eagle2-in-sglang class=md-nav__link> <span class=md-ellipsis> Eagle2 in SGLang </span> </a> <nav class=md-nav aria-label="Eagle2 in SGLang"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 整体流程 </span> </a> </li> <li class=md-nav__item> <a href=#kv-cache class=md-nav__link> <span class=md-ellipsis> KV Cache 管理 </span> </a> <nav class=md-nav aria-label="KV Cache 管理"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 分配 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 释放 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rollback-lazy-processing class=md-nav__link> <span class=md-ellipsis> Rollback Lazy Processing </span> </a> <nav class=md-nav aria-label="Rollback Lazy Processing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 同步点 </span> </a> <nav class=md-nav aria-label=同步点> <ul class=md-nav__list> <li class=md-nav__item> <a href=#plan-stream-compute-stream class=md-nav__link> <span class=md-ellipsis> Plan stream 和 Compute stream 之间的同步 </span> </a> </li> <li class=md-nav__item> <a href=#cpu-plan-stream class=md-nav__link> <span class=md-ellipsis> CPU 与 Plan Stream 的同步 </span> </a> </li> <li class=md-nav__item> <a href=#cpu-compute-stream class=md-nav__link> <span class=md-ellipsis> CPU 与 Compute stream 的同步 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 同步的细节 </span> </a> <nav class=md-nav aria-label=同步的细节> <ul class=md-nav__list> <li class=md-nav__item> <a href=#late-binding class=md-nav__link> <span class=md-ellipsis> Late Binding </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#test-sglang-eagle-constrained-decoding class=md-nav__link> <span class=md-ellipsis> Test SGLang Eagle + Constrained Decoding </span> </a> <nav class=md-nav aria-label="Test SGLang Eagle + Constrained Decoding"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-sh class=md-nav__link> <span class=md-ellipsis> Test sh </span> </a> </li> <li class=md-nav__item> <a href=#result class=md-nav__link> <span class=md-ellipsis> Result </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#overlap-speculative-decoding-constrained-decoding class=md-nav__link> <span class=md-ellipsis> 优化 Overlap: speculative decoding + constrained decoding </span> </a> <nav class=md-nav aria-label="优化 Overlap: speculative decoding + constrained decoding"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview_1 class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#implementation class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> <li class=md-nav__item> <a href=#json-unit-test-result class=md-nav__link> <span class=md-ellipsis> JSON Unit Test Result </span> </a> </li> <li class=md-nav__item> <a href=#benchmark-resultbs-4 class=md-nav__link> <span class=md-ellipsis> Benchmark Result(bs = 4) </span> </a> <nav class=md-nav aria-label="Benchmark Result(bs = 4)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hiding-cpu-overhead class=md-nav__link> <span class=md-ellipsis> Hiding CPU Overhead </span> </a> </li> <li class=md-nav__item> <a href=#accept-length class=md-nav__link> <span class=md-ellipsis> Accept Length 提升 </span> </a> </li> <li class=md-nav__item> <a href=#ttft class=md-nav__link> <span class=md-ellipsis> 首字延迟 (TTFT) 微增 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#gsm8k class=md-nav__link> <span class=md-ellipsis> GSM8K </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> <span class=md-ellipsis> Reference </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../notes/sglang/%E4%B8%80%E6%9D%A1%20Request%20%E5%9C%A8%20SGLang%20%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F/ class=md-nav__link> <span class=md-ellipsis> 一条 Request 在 SGLang 的前世今生 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/sglang/SGLang%20Scheduler%20%E6%8A%80%E6%9C%AF%E5%8F%98%E8%BF%81/ class=md-nav__link> <span class=md-ellipsis> SGLang Schedular 技术变迁 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/sglang/RadixAttention%20%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E5%85%A8%E9%83%A8%E7%BB%86%E8%8A%82/ class=md-nav__link> <span class=md-ellipsis> RadixAttention 你需要知道的细节 </span> </a> </li> <li class=md-nav__item> <a href="../../notes/sgalng/SGLang 中的 TP + PP.md" class=md-nav__link> <span class=md-ellipsis> SGLang 中的 TP + PP 流程浅析(以 Qwen2 为例) </span> </a> </li> <li class=md-nav__item> <a href=../../notes/sglang/%E4%BB%8E%E4%BB%A3%E7%A0%81%E7%9C%8B%20SGLang%20%E7%9A%84%20KV%20Cache/ class=md-nav__link> <span class=md-ellipsis> 从代码看 SGLang 的 KV Cache </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> LLM Basic Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> LLM Basic Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/llm_inference/attention%26transformer/ class=md-nav__link> <span class=md-ellipsis> Attention &amp; Transformers </span> </a> </li> <li class=md-nav__item> <a href=../../notes/llm_inference/transformerbasedllm/ class=md-nav__link> <span class=md-ellipsis> Transformer-Based LLM Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../notes/llm_inference/Introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction for LLM Inference </span> </a> </li> <li class=md-nav__item> <a href=../../notes/llm_inference/parallelization/ class=md-nav__link> <span class=md-ellipsis> Parallelizatoin Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../notes/llm_inference/LLMparallelization/ class=md-nav__link> <span class=md-ellipsis> Parallelization in LLM Inference </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> LLM Serving </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> LLM Serving </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/posts/PageAttention/ class=md-nav__link> <span class=md-ellipsis> PageAttention </span> </a> </li> <li class=md-nav__item> <a href=../../blogs/posts/FlashAttention%20%E5%8E%9F%E7%90%86%20v1-v2/ class=md-nav__link> <span class=md-ellipsis> FlashAttention </span> </a> </li> <li class=md-nav__item> <a href=../../notes/sglang/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%20Batching/ class=md-nav__link> <span class=md-ellipsis> 大模型推理服务中的 Batching </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> CUDA </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> CUDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notes/cuda/%E4%BB%8EGEMM%E5%AE%9E%E8%B7%B5CUDA%E4%BC%98%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 从 GEMM 实践 CUDA 优化 </span> </a> </li> <li class=md-nav__item> <a href=../../notes/cuda/cudaopt/ class=md-nav__link> <span class=md-ellipsis> CUDA Optimization for LLM Inference </span> </a> </li> <li class=md-nav__item> <a href=../../notes/cuda/Vector%20Add%20Optimization%20Example/ class=md-nav__link> <span class=md-ellipsis> Vector Add Optimization Example </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../blogs/posts/%E4%B8%8A%E7%AF%87%EF%BC%9A%E5%88%9D%E8%AF%86%20Nebula%20Graph%20%E2%80%94%E2%80%94%20%E5%90%91%E9%87%8F%E7%B1%BB%E5%9E%8B%E6%94%AF%E6%8C%81/ class=md-nav__link> <span class=md-ellipsis> 上篇：初识 Nebula Graph —— 向量类型支持 </span> </a> </li> <li class=md-nav__item> <a href=../../blogs/posts/%E4%B8%AD%E7%AF%87%EF%BC%9AVector%20%E7%B1%BB%E5%9E%8B%E7%9A%84%20DDL%26DML%20%E9%80%82%E9%85%8D/ class=md-nav__link> <span class=md-ellipsis> 中篇：Vector 类型的 DDL &amp; DML 适配 </span> </a> </li> <li class=md-nav__item> <a href=../../blogs/posts/%E4%B8%8B%E7%AF%87%EF%BC%9A%E5%90%91%E9%87%8F%E7%B4%A2%E5%BC%95%E4%B8%8E%E7%9B%B8%E4%BC%BC%E5%BA%A6%E6%90%9C%E7%B4%A2%20%E2%80%94%E2%80%94%20Nebula%20Graph%20%E7%9A%84%20ANN%20%E5%AE%9E%E7%8E%B0%E4%B9%8B%E8%B7%AF/ class=md-nav__link> <span class=md-ellipsis> 下篇：向量索引与相似度搜索 —— Nebula Graph 的 ANN 实现之路 </span> </a> </li> <li class=md-nav__item> <a href=../../blogs/posts/C%2B%2B%E5%BC%82%E6%AD%A5%E6%96%B9%E6%A1%88/ class=md-nav__link> <span class=md-ellipsis> C++ 异步方案演进 </span> </a> </li> <li class=md-nav__item> <a href=../../blogs/posts/bustub%E9%80%9A%E5%85%B3%E6%8C%87%E5%8C%97/ class=md-nav__link> <span class=md-ellipsis> Bustub 通关指北 </span> </a> </li> <li class=md-nav__item> <a href=../../blogs/posts/Implement%20of%20Concurrent/ class=md-nav__link> <span class=md-ellipsis> 并发组件实现浅析 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../../summary/ class="md-nav__link "> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6 1h2v2h8V1h2v2h1a2 2 0 0 1 2 2v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h1zM5 8v11h14V8zm2 2h10v2H7z"></path></svg> <span class=md-ellipsis> Summaries </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Summaries </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../summary/%E7%A0%94%E7%A9%B6%E7%94%9F%E6%80%BB%E7%BB%93/%E7%A0%94%E4%B8%80%E4%B8%8A%E6%80%BB%E7%BB%93/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6 1h2v2h8V1h2v2h1a2 2 0 0 1 2 2v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h1zM5 8v11h14V8zm2 2h10v2H7z"></path></svg> <span class=md-ellipsis> 研一上总结 </span> </a> </li> <li class=md-nav__item> <a href=../../summary/%E7%A0%94%E7%A9%B6%E7%94%9F%E6%80%BB%E7%BB%93/%E7%A0%94%E4%B8%80%E4%B8%8B%E6%80%BB%E7%BB%93/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6 1h2v2h8V1h2v2h1a2 2 0 0 1 2 2v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h1zM5 8v11h14V8zm2 2h10v2H7z"></path></svg> <span class=md-ellipsis> 研一下总结 </span> </a> </li> <li class=md-nav__item> <a href=../../summary/%E7%A0%94%E7%A9%B6%E7%94%9F%E6%80%BB%E7%BB%93/%E7%A0%94%E4%BA%8C%E4%B8%8A%E6%80%BB%E7%BB%93/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6 1h2v2h8V1h2v2h1a2 2 0 0 1 2 2v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h1zM5 8v11h14V8zm2 2h10v2H7z"></path></svg> <span class=md-ellipsis> 研二上总结 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../tags/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5.5 7A1.5 1.5 0 0 1 4 5.5 1.5 1.5 0 0 1 5.5 4 1.5 1.5 0 0 1 7 5.5 1.5 1.5 0 0 1 5.5 7m15.91 4.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.11 0-2 .89-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59s1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.56-.23-1.06-.59-1.42"></path></svg> <span class=md-ellipsis> Tags </span> </a> </li> <li class=md-nav__item> <a href=../../links/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.78 3.653a3.936 3.936 0 1 1 5.567 5.567l-3.627 3.627a3.936 3.936 0 0 1-5.88-.353.75.75 0 0 0-1.18.928 5.436 5.436 0 0 0 8.12.486l3.628-3.628a5.436 5.436 0 1 0-7.688-7.688l-3 3a.75.75 0 0 0 1.06 1.061z"></path><path d="M7.28 11.153a3.936 3.936 0 0 1 5.88.353.75.75 0 0 0 1.18-.928 5.436 5.436 0 0 0-8.12-.486L2.592 13.72a5.436 5.436 0 1 0 7.688 7.688l3-3a.75.75 0 1 0-1.06-1.06l-3 3a3.936 3.936 0 0 1-5.567-5.568z"></path></svg> <span class=md-ellipsis> Links </span> </a> </li> <li class=md-nav__item> <a href=../../about/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512m-90.6-190.1c20.4 28 53.4 46.1 90.6 46.1s70.2-18.1 90.6-46.1c7.8-10.7 22.8-13.1 33.5-5.3s13.1 22.8 5.3 33.5C356.3 390 309.2 416 256 416s-100.3-26-129.4-65.9c-7.8-10.7-5.4-25.7 5.3-33.5s25.7-5.4 33.5 5.3M144 208a32 32 0 1 1 64 0 32 32 0 1 1-64 0m164 8c0 11-9 20-20 20s-20-9-20-20c0-33.1 26.9-60 60-60h16c33.1 0 60 26.9 60 60 0 11-9 20-20 20s-20-9-20-20-9-20-20-20h-16c-11 0-20 9-20 20"></path></svg> <span class=md-ellipsis> About </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#speculative-decoding-motivation class=md-nav__link> <span class=md-ellipsis> Speculative Decoding Motivation </span> </a> </li> <li class=md-nav__item> <a href=#what-is-speculative-decodingoriginal class=md-nav__link> <span class=md-ellipsis> What is Speculative Decoding(Original) </span> </a> </li> <li class=md-nav__item> <a href=#some-limitations class=md-nav__link> <span class=md-ellipsis> Some Limitations </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 发展历程 </span> </a> <nav class=md-nav aria-label=发展历程> <ul class=md-nav__list> <li class=md-nav__item> <a href=#speculative-decoding-leviathan-et-al-2023-google class=md-nav__link> <span class=md-ellipsis> Speculative Decoding (Leviathan et al., 2023, Google) </span> </a> </li> <li class=md-nav__item> <a href=#medusano-need-for-a-separate-draft-model class=md-nav__link> <span class=md-ellipsis> Medusa(No need for a separate draft model) </span> </a> </li> <li class=md-nav__item> <a href=#lookahead-decoding class=md-nav__link> <span class=md-ellipsis> Lookahead Decoding </span> </a> </li> <li class=md-nav__item> <a href=#eagle-1-extrapolation-algorithm-for-greater-language-model-efficiency class=md-nav__link> <span class=md-ellipsis> EAGLE-1： Extrapolation Algorithm for Greater Language-model Efficiency </span> </a> <nav class=md-nav aria-label="EAGLE-1： Extrapolation Algorithm for Greater Language-model Efficiency"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#eagle-1-drafting class=md-nav__link> <span class=md-ellipsis> EAGLE-1 Drafting </span> </a> </li> <li class=md-nav__item> <a href=#eagle-1-verification class=md-nav__link> <span class=md-ellipsis> EAGLE-1 Verification </span> </a> </li> <li class=md-nav__item> <a href=#multi-round-speculative-sampling class=md-nav__link> <span class=md-ellipsis> Multi-round speculative sampling </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#eagle-2-context-aware-speculation class=md-nav__link> <span class=md-ellipsis> EAGLE-2: Context-Aware speculation </span> </a> <nav class=md-nav aria-label="EAGLE-2: Context-Aware speculation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#motivation class=md-nav__link> <span class=md-ellipsis> Motivation </span> </a> </li> <li class=md-nav__item> <a href=#eagle-2-dynamic-tree-construction class=md-nav__link> <span class=md-ellipsis> EAGLE-2 Dynamic Tree Construction </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#eagle-3-training-time-test-direct-token-prediction-multi-level-fusion class=md-nav__link> <span class=md-ellipsis> EAGLE-3: Training-time test + Direct Token Prediction + Multi-level fusion </span> </a> <nav class=md-nav aria-label="EAGLE-3: Training-time test + Direct Token Prediction + Multi-level fusion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#motivation_1 class=md-nav__link> <span class=md-ellipsis> Motivation </span> </a> </li> <li class=md-nav__item> <a href=#eagle-3-training-time-test class=md-nav__link> <span class=md-ellipsis> EAGLE-3: Training-time test </span> </a> </li> <li class=md-nav__item> <a href=#eagle-3-tree-attention-mask-during-training-of-the-draft-model class=md-nav__link> <span class=md-ellipsis> EAGLE-3: Tree Attention Mask during training of the draft model </span> </a> </li> <li class=md-nav__item> <a href=#eagle-3-multi-layer-feature-fusion class=md-nav__link> <span class=md-ellipsis> EAGLE-3: Multi-layer feature fusion </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#eagle2-in-sglang class=md-nav__link> <span class=md-ellipsis> Eagle2 in SGLang </span> </a> <nav class=md-nav aria-label="Eagle2 in SGLang"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 整体流程 </span> </a> </li> <li class=md-nav__item> <a href=#kv-cache class=md-nav__link> <span class=md-ellipsis> KV Cache 管理 </span> </a> <nav class=md-nav aria-label="KV Cache 管理"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 分配 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 释放 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rollback-lazy-processing class=md-nav__link> <span class=md-ellipsis> Rollback Lazy Processing </span> </a> <nav class=md-nav aria-label="Rollback Lazy Processing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 同步点 </span> </a> <nav class=md-nav aria-label=同步点> <ul class=md-nav__list> <li class=md-nav__item> <a href=#plan-stream-compute-stream class=md-nav__link> <span class=md-ellipsis> Plan stream 和 Compute stream 之间的同步 </span> </a> </li> <li class=md-nav__item> <a href=#cpu-plan-stream class=md-nav__link> <span class=md-ellipsis> CPU 与 Plan Stream 的同步 </span> </a> </li> <li class=md-nav__item> <a href=#cpu-compute-stream class=md-nav__link> <span class=md-ellipsis> CPU 与 Compute stream 的同步 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 同步的细节 </span> </a> <nav class=md-nav aria-label=同步的细节> <ul class=md-nav__list> <li class=md-nav__item> <a href=#late-binding class=md-nav__link> <span class=md-ellipsis> Late Binding </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#test-sglang-eagle-constrained-decoding class=md-nav__link> <span class=md-ellipsis> Test SGLang Eagle + Constrained Decoding </span> </a> <nav class=md-nav aria-label="Test SGLang Eagle + Constrained Decoding"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-sh class=md-nav__link> <span class=md-ellipsis> Test sh </span> </a> </li> <li class=md-nav__item> <a href=#result class=md-nav__link> <span class=md-ellipsis> Result </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#overlap-speculative-decoding-constrained-decoding class=md-nav__link> <span class=md-ellipsis> 优化 Overlap: speculative decoding + constrained decoding </span> </a> <nav class=md-nav aria-label="优化 Overlap: speculative decoding + constrained decoding"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overview_1 class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#implementation class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> <li class=md-nav__item> <a href=#json-unit-test-result class=md-nav__link> <span class=md-ellipsis> JSON Unit Test Result </span> </a> </li> <li class=md-nav__item> <a href=#benchmark-resultbs-4 class=md-nav__link> <span class=md-ellipsis> Benchmark Result(bs = 4) </span> </a> <nav class=md-nav aria-label="Benchmark Result(bs = 4)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hiding-cpu-overhead class=md-nav__link> <span class=md-ellipsis> Hiding CPU Overhead </span> </a> </li> <li class=md-nav__item> <a href=#accept-length class=md-nav__link> <span class=md-ellipsis> Accept Length 提升 </span> </a> </li> <li class=md-nav__item> <a href=#ttft class=md-nav__link> <span class=md-ellipsis> 首字延迟 (TTFT) 微增 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#gsm8k class=md-nav__link> <span class=md-ellipsis> GSM8K </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> <span class=md-ellipsis> Reference </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../.. class=md-path__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-path__item> <a href=../../blogs/ class=md-path__link> <span class=md-ellipsis> Blogs </span> </a> </li> <li class=md-path__item> <a href=../PD%20Disaggregation%20in%20SGLang/ class=md-path__link> <span class=md-ellipsis> SGLang 专题 </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <div class="document-dates-plugin-wrapper document-dates-top"><div class=document-dates-plugin locale><div class=dd-left><span class=dd-item data-tippy-content data-tippy-raw=2026-01-12><span class=material-icons data-icon=doc_created></span><time datetime=2026-01-12T00:00:00>2026-01-12</time></span><span class=dd-item data-tippy-content data-tippy-raw=2026-01-12><span class=material-icons data-icon=doc_updated></span><time datetime=2026-01-12T14:56:33+00:00>2026-01-12</time></span></div><div class=dd-right><span class=material-icons data-icon=doc_author></span><div class=author-group><div class=avatar-wrapper data-name=zhiyiliu data-tippy-content data-tippy-raw='<a href="mailto:tomlzy213@gmail.com">zhiyiliu</a>'><span class=avatar-text></span><a class=glightbox data-type=image data-width=80% data-height=auto href data-desc-position=bottom><img class=avatar data-src data-email=tomlzy213@gmail.com></a></div></div></div></div></div> <div class=md-typeset> <div class=blogging-tags-grid> <a href=https://tom-jerr.github.io/tags#LLMInference class=blogging-tag><code>#LLMInference</code></a> </div> </div> <style>
    .md-typeset .blogging-tags-grid {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 5px;
    }

    .md-typeset .blogging-tag {
        color: var(--md-typeset-color);
        background-color: var(--md-typeset-code-color);
        white-space: nowrap;
        display: block;
    }

    .md-typeset .blogging-tag code {
        border-radius: 5px;
    }
</style> <h1 id=speculative-decoding-in-sglangeagle2>Speculative Decoding in SGLang(EAGLE2)<a class=headerlink href=#speculative-decoding-in-sglangeagle2 title="Permanent link">¶</a></h1> <div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;"> <p><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> 约 4812 个字 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"></path></svg></span> 438 行代码 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"></path></svg></span> 21 张图片 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> 预计阅读时间 30 分钟</p> </div> <p>在正式进入 SGLang 源码前，我们需要知道为什么我们需要 speculative decoding 以及什么是 speculative decoding。有了这些认识后，我们可以深入源码来了解 SGLang 是如何将 speculative decoding 与 scheduler 集成起来的</p> <p>这里先大概给一下 speculative decoding 的示意图</p> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/XtNobrb2EoAGDMxMx1LcRq5VnfT.png data-desc-position=bottom><img alt src=../static/XtNobrb2EoAGDMxMx1LcRq5VnfT.png></a></p> <h2 id=speculative-decoding-motivation><strong>Speculative Decoding Motivation</strong><a class=headerlink href=#speculative-decoding-motivation title="Permanent link">¶</a></h2> <p>基于以下观察，提出了 speculative decoding，利用空闲计算资源增加并行性</p> <ul> <li>Many easy tokens can be predicted with less computational overhead(using a smaller model)</li> <li>LLM 推理是高度 memory-bound 的，延迟主要在读取/写入模型参数而不是计算</li> </ul> <blockquote> <p>每次生成一个 token，都需要搬运所有模型权重从 HBM 到 cache 中</p> </blockquote> <p>我们需要保证 speculative decoding 生成多个 token 的成本要比 auto-regressive 生成 1 个 token 成本差不多，所以投机采样要想获得性能收益，核心要解决以下两个问题：</p> <blockquote> <p>在整个投机采样的流程中，假设轻量 LLM 生成 Draft Tokens 的开销为 <span class=arithmatex>\(p\)</span> ，原始 LLM 验证 &amp; Next Token 生成的开销近似为 1 ，那么<strong>投机采样在接受 Tokens 数大于 </strong><span class=arithmatex>\(1 + p\)</span><strong> 的情况下才有性能收益</strong>，并且随着接受的 Tokens 数增加而性能收益越大。</p> </blockquote> <ol> <li><strong>如何降低投机采样的 overhead？</strong></li> <li><strong>如何提升 Verify 阶段的接受率？</strong></li> </ol> <h2 id=what-is-speculative-decodingoriginal><strong>What is Speculative Decoding(Original)</strong><a class=headerlink href=#what-is-speculative-decodingoriginal title="Permanent link">¶</a></h2> <p>一般遵循以下流程：</p> <ul> <li>Draft: 生成 k 个 candidate tokens</li> <li>Verify:</li> <li>用 target model 并行 verify all candidate tokens</li> <li>对每个位置的分布计算概率</li> <li>Accept / Reject:</li> <li>接受所有 correct token</li> <li>在第一个被拒绝采样的位置，在<strong>调整后的分布</strong>中重新采样</li> </ul> <blockquote> <p>注意：我们对 draft 分布需要与 target 的分布相同</p> </blockquote> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/JeLcbcEP5oxItmx1rKacnhGGnne.png data-desc-position=bottom><img alt src=../static/JeLcbcEP5oxItmx1rKacnhGGnne.png></a></p> <hr> <h2 id=some-limitations>Some Limitations<a class=headerlink href=#some-limitations title="Permanent link">¶</a></h2> <p>我们需要让 Draft Model 的生成的目标分布与 Target Model 相同，这里有多种选择方式</p> <ul> <li>选取与 target model 同一 family 的较小的模型</li> <li>Distill 一个轻量模型，teacher 选取 target model，这会引入 training cost</li> <li>选取 ngram 模型，但是这个的接受率很低</li> </ul> <p>Draft model 和 target model 需要共享 vocabulary 或者使用相同的 tokenizer</p> <ul> <li><span class=arithmatex>\(p(x)\)</span> 和 <span class=arithmatex>\(q(x)\)</span> 必须定义在同一个样本空间上</li> </ul> <hr> <h2 id=_1><strong>发展历程</strong><a class=headerlink href=#_1 title="Permanent link">¶</a></h2> <h3 id=speculative-decoding-leviathan-et-al-2023-google><strong>Speculative Decoding (Leviathan et al., 2023, Google)</strong><a class=headerlink href=#speculative-decoding-leviathan-et-al-2023-google title="Permanent link">¶</a></h3> <p>📄 <em>Fast Inference from Transformers via Speculative Decoding</em></p> <ul> <li> <p>首次提出该方法，思路：</p> </li> <li> <p>用一个小模型（draft model）生成多个候选 token；</p> </li> <li>用大模型（target model）验证其中的一部分；</li> <li>若验证通过，则一次提交多个 token，减少大模型调用次数。</li> <li>用更高效的模型 <span class=arithmatex>\(M_q\)</span> 生成 <strong>γ </strong>个候选 token；</li> <li>然后使用目标模型 <span class=arithmatex>\(M_p\)</span> <strong>并行 Verify</strong> 这些候选样本及其在 <span class=arithmatex>\(M_q\)</span> 中的概率， 并<strong>接受</strong>所有能使分布与 <span class=arithmatex>\(M_p\)</span> 一致的候选；</li> </ul> <blockquote> <p><em>决定被接受的数量 n（用随机数进行拒绝采样）</em></p> </blockquote> <ul> <li>接受所有正确的采样</li> <li>对第一个被拒绝的候选，从一个<strong>调整后的分布</strong>中重新采样</li> </ul> <blockquote> <p>如果草稿模型 <span class=arithmatex>\(M_q\)</span> 在第 n+1 个 token 被拒绝，那么目标模型 <span class=arithmatex>\(M_p\)</span> 不能直接用自己的分布采样，而必须把已经被 <span class=arithmatex>\(M_q\)</span> 尝试但拒绝掉的概率质量 <span class=arithmatex>\(M_p\)</span> 中减掉，再重新归一化<br> </p> </blockquote> <ul> <li>如果所有候选都被接受，只接受 <strong>γ-1</strong> 个，然后再采样一个额外的 token</li> </ul> <blockquote> <p>修正的拒绝采样方案可以保持与 target 采样相同的目标分布<br> <a class=glightbox data-type=image data-width=80% data-height=auto href=../static/TtMJbQcBQoZLxAxbcoQcdKJUnBe.png data-desc-position=bottom><img alt src=../static/TtMJbQcBQoZLxAxbcoQcdKJUnBe.png></a></p> </blockquote> <ul> <li>Limitations</li> <li>使用 separate 的 draft model<ul> <li>Draft model 训练后效果比较好，引入了训练成本</li> <li>Draft model 和 target model 之间的 distribution shift</li> </ul> </li> <li>Memory overhead of second model</li> <li>每次迭代只有一个 draft sequence</li> <li><span class=arithmatex>\(\gamma\)</span>是固定的，简单的 token 会浪费资源，复杂的 token 需要更多的推测</li> </ul> <hr> <h3 id=medusano-need-for-a-separate-draft-model><strong>Medusa(No need for a separate draft model)</strong><a class=headerlink href=#medusano-need-for-a-separate-draft-model title="Permanent link">¶</a></h3> <p>📄 MEDUSA: Simple LLM Inference Acceleration Framework with Multiple Decoding Heads</p> <ul> <li>不是单独的小模型，而是 <strong>在大模型 decoder 的 last hidden states 上直接加多个预测头(1-2 layer mlp)</strong>；</li> <li> <p>每个 head 会为它负责的位置生成多个最可能的预测</p> </li> <li> <p>第 t 个 position 位置处，第 k 个 head 预测 t+k+1 个 token</p> </li> <li>这会增加一次 decoding step 的接受长度</li> <li>Verification can be computationally intensive for a large number of completions</li> </ul> <blockquote> <p>We need trade-off</p> <ul> <li>为了<strong>加速</strong>与<strong>计算代价</strong>之间取得平衡，引入了一种 <strong>树状结构的注意力机制（tree-structured attention）</strong>，可以<strong>并行处理多个候选序列，一次验证一整棵树</strong></li> </ul> </blockquote> <ul> <li>依据预测的 probs 构造了一个稀疏的 candidate tokens 树</li> <li><strong>Tree Mask</strong>：<strong>每个 token 只能看到来自同一条候选序列（continuation）的历史 token</strong>，不能访问其他候选的 token。</li> <li>按照树结构，正确分配 positional encoding</li> </ul> <blockquote> <p>同一深度的 token 用同一个 position id</p> <ul> <li><strong>会选择长度最长的前缀 candidate tokens</strong></li> </ul> </blockquote> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/SBtkb0kqConi4NxoTkHcNGs3nbb.png data-desc-position=bottom><img alt src=../static/SBtkb0kqConi4NxoTkHcNGs3nbb.png></a><br> <a class=glightbox data-type=image data-width=80% data-height=auto href=../static/IacXbP7UpoGGfoxTT0Mcw1qBnyh.png data-desc-position=bottom><img alt src=../static/IacXbP7UpoGGfoxTT0Mcw1qBnyh.png></a></p> <ul> <li>Limitations:</li> <li> <p>Position-Independent Prediction / Limited Information</p> <ul> <li>每个 Medusa head 预测位置 i+k，但它不知道位置<span class=arithmatex>\(i+1\dots i+k-1\)</span> 实际预测了什么</li> </ul> <blockquote> <p>与真实的自回归不同<br> </p> </blockquote> <ul> <li>Medusa head 只能看到最后一层的表示</li> <li>最后一层是为预测下一个 token 训练的，而不是第 2、3 个之后的 token</li> <li>无法利用中间层更丰富的表示</li> <li>Lower acceptance rates for later positions in the draft</li> <li>Speedup plateaus at ~3× even with more heads</li> </ul> </li> </ul> <hr> <h3 id=lookahead-decoding><strong>Lookahead Decoding</strong><a class=headerlink href=#lookahead-decoding title="Permanent link">¶</a></h3> <p>📄 Lookahead: An Inference Acceleration Framework for Large Language Model with Lossles</p> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/UF1Bb6GNQoa8VsxFiKucHlNan4e.png data-desc-position=bottom><img alt src=../static/UF1Bb6GNQoa8VsxFiKucHlNan4e.png></a></p> <ul> <li>层次化多分支草稿策略 (Hierarchical Multi-Branch Draft Strategy)：<em>利用共同的前缀标记将多个预测的草稿序列（分支）进行合并和压缩</em></li> <li> <p>基于 Trie 树的草稿检索和管理 (Trie-tree-based Retrieval and Management)</p> </li> <li> <p>Trie 树存储了<strong>输入提示 (Prompt)</strong> 和<strong>已生成响应 (Generated response)</strong> 中出现的 n-gram 标记序列（即分支）。</p> </li> <li>引入了 <strong>生成分支插入 (Generated branch Inserting)</strong> 机制，能够动态地 (on-the-fly) 将生成的重复序列放入 Trie 树中，从而利用输出中的重复模式进行加速。</li> <li>通过<strong>分支消除</strong>和<strong>节点修剪</strong>策略来保持 Trie 树的高效性，控制内存消耗。</li> </ul> <hr> <h3 id=eagle-1-extrapolation-algorithm-for-greater-language-model-efficiency><strong>EAGLE-1： Extrapolation Algorithm for Greater Language-model Efficiency</strong><a class=headerlink href=#eagle-1-extrapolation-algorithm-for-greater-language-model-efficiency title="Permanent link">¶</a></h3> <p>📄 EAGLE: Speculative Sampling Requires Rethinking Feature Uncertainty</p> <ul> <li>Train a lightweight plugin, called AutoRegression Head, in conjunction with the Original LLM's frozen embedding layer, to predict the next feature based on the current feature sequence form the second-top-layer of the Original model</li> <li>Decode using the frozen classification head of the Original LLM, which maps features to tokens</li> <li>Feed in tokens from one time step ahead<br> <a class=glightbox data-type=image data-width=80% data-height=auto href=../static/SGvZbgg5Ho8of8xOc3zcUEFlnOe.png data-desc-position=bottom><img alt src=../static/SGvZbgg5Ho8of8xOc3zcUEFlnOe.png></a></li> </ul> <h4 id=eagle-1-drafting>EAGLE-1 Drafting<a class=headerlink href=#eagle-1-drafting title="Permanent link">¶</a></h4> <p>EAGLE-1 解决了 Medusa 的不确定性，使用了 feature-level 进行预测</p> <ul> <li>Feature prediction with known context is much more accurate</li> <li>EAGLE integrates embeddings and generates the next feature</li> <li>When predicting <span class=arithmatex>\(f_j\)</span>, we already know <span class=arithmatex>\(f_{j-1}\)</span></li> </ul> <div class=arithmatex>\[ \begin{aligned} (f_n, t_n)&amp;\rightarrow f_{n+1} \\ f_{n+1} &amp;\rightarrow LM\_Head \rightarrow t_{n+1}\\ (f_{n+1}, t_{n+1}) &amp;\rightarrow f_{n+2} \end{aligned} \]</div> <h4 id=eagle-1-verification>EAGLE-1 Verification<a class=headerlink href=#eagle-1-verification title="Permanent link">¶</a></h4> <ul> <li>对每个 draft token position 生成 target probs p</li> <li> <p><strong>Tree Attention</strong>：直接 verify 整个 tree</p> </li> <li> <p>EAGLE 生成的树更稀疏、上下文更充分</p> </li> </ul> <blockquote> <p>每一步预测都知道前面 token 是什么，通过 feature 可以得到更多的信息<br> </p> </blockquote> <ul> <li>Medusa Head 2 predicting t+2 doesn’t know what t+1 will be</li> </ul> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/ESsIb5cwLo30xcx1fQScTQsknLd.png data-desc-position=bottom><img alt src=../static/ESsIb5cwLo30xcx1fQScTQsknLd.png></a><br> <a class=glightbox data-type=image data-width=80% data-height=auto href=../static/SxXrbrkuuoaXzjxMMvzcEB9Vnxf.png data-desc-position=bottom><img alt src=../static/SxXrbrkuuoaXzjxMMvzcEB9Vnxf.png></a></p> <h4 id=multi-round-speculative-sampling>Multi-round speculative sampling<a class=headerlink href=#multi-round-speculative-sampling title="Permanent link">¶</a></h4> <p>把同一位置的多个候选 token 按顺序做多轮 accept / reject；只有当所有候选都拒绝了，才从调整后的分布里真正采样一个 token。这样能 提升接受率 / 减少 fallback，同时仍然保持严格无偏（最终 token 仍服从目标分布 p）</p> <ul> <li><strong>依次尝试</strong> <span class=arithmatex>\(t_1,t_2,t_3\dots ,t_k\)</span></li> <li> <p>每次尝试失败，不是立刻从 adjusted distribution 采样，而是：</p> </li> <li> <p><strong>更新目标分布 p</strong>（扣掉本轮 proposal 那部分概率重新进行分布）</p> </li> <li>然后继续尝试下一个候选</li> <li>如果 k 个都失败了，才从最终剩下的 adjusted 分布采样一次</li> </ul> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/CPIYbPOrEofK1RxCLjAc1vRCnTd.png data-desc-position=bottom><img alt src=../static/CPIYbPOrEofK1RxCLjAc1vRCnTd.png></a></p> <hr> <h3 id=eagle-2-context-aware-speculation><strong>EAGLE-2: Context-Aware speculation</strong><a class=headerlink href=#eagle-2-context-aware-speculation title="Permanent link">¶</a></h3> <p>📄 EAGLE-2: Faster Inference of Language Models with Dynamic Draft Trees</p> <ul> <li>High confidence → high acceptance probability → expand the tree</li> <li>Low confidence → low acceptance probability → prune the tree</li> </ul> <p>Context-aware speculation:</p> <ul> <li>Easy context (code boilerplate): Deeper trees</li> <li>Hard context (creative writing): Shallower, wider trees</li> </ul> <h4 id=motivation>Motivation<a class=headerlink href=#motivation title="Permanent link">¶</a></h4> <ul> <li>接受率除了与 <strong>Token 所在位置相关以外（在树中所处的位置），还和上文相关（树中的祖宗节点）</strong>。</li> </ul> <blockquote> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/XjY6bHv81omhS1xPgw3cFAxznGc.png data-desc-position=bottom><img alt src=../static/XjY6bHv81omhS1xPgw3cFAxznGc.png></a><br> <em>P3、P4 和 P5、P6 虽然都是同一层的节点（即同一个 Step 的 Draft Tokens），但接收率上 P3、P4 普遍高于 P5、P6 节点，一个重要的原因是 P3、P4 的父节点为 P1，其概率高于 P5、P6 节点的父节点 P2。P3、P4 的概率甚至普遍高于 P2 这更加说明在生成 Draft 树的时候，采用静态 Draft 树并不是一个最优选择，更应该选择动态 Draft 树。</em></p> </blockquote> <ul> <li>原始 LLM 自回归生成的 Token 概率分布表示 Token 接收概率。Eagle 的 Draft 模型生成的 Draft Tokens 概率分布与 Token 接收率分布接近。下图展示了 Draft Tokens 生成概率和 Token 接收率的分布图，可以看出分布很接近，<strong>可以通过 Draft Tokens 生成概率预估 Token 的接收率。</strong><br> <a class=glightbox data-type=image data-width=80% data-height=auto href=../static/Q5SYb75o0oQ01pxLzJ3ck8Zbnjd.png data-desc-position=bottom><img alt src=../static/Q5SYb75o0oQ01pxLzJ3ck8Zbnjd.png></a></li> </ul> <h4 id=eagle-2-dynamic-tree-construction>EAGLE-2 Dynamic Tree Construction<a class=headerlink href=#eagle-2-dynamic-tree-construction title="Permanent link">¶</a></h4> <p>EAGLE-2 不修改 draft 模型的训练与推理方式，也不改变验证阶段。它的改进集中在两个方面：</p> <ol> <li>如何扩展草稿树；</li> <li>如何对草稿 token 进行重新排序</li> </ol> <ul> <li><strong>Expand 阶段</strong>：从当前层选择 <strong>全局接受概率（global acceptance probability）最高的前 k 个 token</strong> 进行扩展。</li> <li>一个 token 的<strong>全局接受概率</strong>是它从根节点到该节点路径上所有 token 的接受概率的乘积：<br> <span class=arithmatex>\(V_i = \prod_{t_j \in \text{Path(root, }t_i\text{)}} p_j \approx \prod c_j，\)</span> 其中<span class=arithmatex>\(c_j\)</span>是 draft 模型的置信度</li> <li><strong>ReRank 阶段</strong>：<strong>不会直接使用扩展阶段的结果，而是对所有草稿 token 重新排序</strong>，选出全局 top-m 的节点。</li> </ul> <blockquote> <p><em>Expand 的目标是加深草稿树。然而，由于接受率在 0–1 之间，越深的 token 其值越小。</em><strong>一些浅层未扩展节点可能比深层节点更有价值</strong><em>。</em><br> <strong>对于值相同的节点，优先选择浅层节点，始终保持父节点在子节点之前被选中。</strong> 这样可以保证 top-m 节点仍构成一棵连通树。<br> <a class=glightbox data-type=image data-width=80% data-height=auto href=../static/MY8GbmDMloCvYHxBR8ackqBEnMg.png data-desc-position=bottom><img alt src=../static/MY8GbmDMloCvYHxBR8ackqBEnMg.png></a></p> </blockquote> <ul> <li><strong>Tree Mask</strong>：把这些选中的 token <strong>拉平成一维序列</strong>，送入主模型进行验证阶段。为了与标准自回归解码保持一致，我们需要调整注意力掩码。不同分支的 token 不应互相可见，因此注意力掩码需根据树结构修改，使每个 token 仅能看到它的祖先节点。</li> </ul> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/YvJ0bRiPko1c35xB773cDJEjnuc.png data-desc-position=bottom><img alt src=../static/YvJ0bRiPko1c35xB773cDJEjnuc.png></a></p> <hr> <h3 id=eagle-3-training-time-test-direct-token-prediction-multi-level-fusion>EAGLE-3: Training-time test + Direct Token Prediction + Multi-level fusion<a class=headerlink href=#eagle-3-training-time-test-direct-token-prediction-multi-level-fusion title="Permanent link">¶</a></h3> <h4 id=motivation_1>Motivation<a class=headerlink href=#motivation_1 title="Permanent link">¶</a></h4> <ul> <li>Increasing training data for EAGLE-½ provides <strong>limited</strong> improvement</li> <li> <p><strong>EAGLE Training: Loss = L_fea + L_token</strong></p> </li> <li> <p>Feature prediction loss constrains the model</p> </li> <li>Model must output something close to target features</li> <li>This limits expressiveness!</li> <li> <p><strong>The Feature Prediction Constraint:</strong></p> </li> <li> <p>Forces draft model output to approximate target features</p> </li> <li>Limits the model's representational capacity</li> <li>Token prediction is the goal; feature prediction is an auxiliary objective</li> <li>If those outputs aren’t “feature-like,” the next step becomes out-of-distribution</li> </ul> <h4 id=eagle-3-training-time-test>EAGLE-3: Training-time test<a class=headerlink href=#eagle-3-training-time-test title="Permanent link">¶</a></h4> <p><strong>With L_fea (EAGLE-½)</strong></p> <ul> <li>Training step 2 still uses <strong>ground-truth features</strong> as context</li> <li>But at test time, step 2 uses <strong>predicted</strong> features</li> <li>L_fea partially masks this because predicted ≈ ground-truth<br> <strong>Without L_fea (failure mode)</strong></li> <li>Training never sees the model’s unconstrained predictions as inputs</li> <li>Test time does → out-of-distribution → compounding error<br> Core rule: <strong>if the model will consume its own predictions at test time, it should practice that during training</strong></li> <li>Train by simulating multiple draft steps <strong>using predicted states</strong>, not ground truth</li> <li>Important implementation detail: <strong>stop-gradient</strong> through the simulated rollout so training remains stable</li> </ul> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/CHSkbIARBo6KKRxvu2Kcf36jn0g.png data-desc-position=bottom><img alt src=../static/CHSkbIARBo6KKRxvu2Kcf36jn0g.png></a></p> <ul> <li>Removes the need for a strict “feature-likeness” constraint</li> <li>Model learns to be robust to its own imperfect intermediate states</li> <li>Capacity is spent on “what helps token accuracy under rollout,” not “match a specific feature target”</li> </ul> <h4 id=eagle-3-tree-attention-mask-during-training-of-the-draft-model>EAGLE-3: Tree Attention Mask during training of the draft model<a class=headerlink href=#eagle-3-tree-attention-mask-during-training-of-the-draft-model title="Permanent link">¶</a></h4> <ul> <li>虽然自回归推理在时间上是顺序的，但在训练时可以把多步 rollout 重构成一棵树，并用树状 attention mask 一次性并行计算，从而让模型在训练阶段就经历“使用自身预测作为上下文”的真实测试条件。<br> <a class=glightbox data-type=image data-width=80% data-height=auto href=../static/PHTwbskerob0S2xP7SFcSZDHngb.png data-desc-position=bottom><img alt src=../static/PHTwbskerob0S2xP7SFcSZDHngb.png></a></li> </ul> <h4 id=eagle-3-multi-layer-feature-fusion>EAGLE-3: Multi-layer feature fusion<a class=headerlink href=#eagle-3-multi-layer-feature-fusion title="Permanent link">¶</a></h4> <p>一旦不再强迫预测 feature 去像某一层的 ground-truth feature”（移除 <span class=arithmatex>\(L_{\text{fea}}\)</span>），模型就可以自由地利用不同层的表示：</p> <ul> <li>Top-layer features are "committed" to the immediate next token</li> <li>Lower layers contain richer, more general semantic information</li> <li>Predicting t+2 benefits from information not yet "collapsed" into next-token prediction</li> <li>Fusion captures multiple abstraction levels</li> </ul> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/SstFbSngvoTJwqxqwBOcGDp6n3b.png data-desc-position=bottom><img alt src=../static/SstFbSngvoTJwqxqwBOcGDp6n3b.png></a></p> <hr> <h2 id=eagle2-in-sglang><strong>Eagle2 in SGLang</strong><a class=headerlink href=#eagle2-in-sglang title="Permanent link">¶</a></h2> <h3 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">¶</a></h3> <ul> <li>Draft 的状态通过 batch.spec_info 来进行管理；不停地在 Scheduler 和 EAGLEWorkerV2 中流转</li> <li>将 draft 和 verify 数据准备工作单独开辟一个 GPU plan stream 进行，与 GPU compute stream 并行</li> <li>因为数据准备工作(<strong>KV Cache 等</strong>)会影响到后续这些过程计算的正确性，所以在启动 GPU compute kernel 前需要等待 plan kernel 执行完成</li> </ul> <p><strong>同步点</strong><a href=#%E5%90%8C%E6%AD%A5%E7%82%B9>见下文</a><strong>：</strong></p> <ol> <li>Verify 与 Draft Extend 之间的同步</li> <li>Draft 与 Verify 之间的同步</li> <li>Verify 与 Sampling 之间的同步</li> </ol> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/WiM4bkw4Ko06PLxMGJgcyYAhnKb.png data-desc-position=bottom><img alt src=../static/WiM4bkw4Ko06PLxMGJgcyYAhnKb.png></a></p> <h3 id=_2>整体流程<a class=headerlink href=#_2 title="Permanent link">¶</a></h3> <p>Prefill 阶段生成 batch 与不开启 spec 并无不同；通过 self.future_map.resolve_future() 和 self.future_map.store_to_map() 实现异步的结果存取</p> <p><code>run_batch()</code> 会先调用 EAGLEWorkerV2::forward_batch_generation()</p> <ul> <li>target_worker(TpWorker) 执行 <code>forward_batch_generation</code>，采样出第一个 token</li> </ul> <blockquote> <p>Eagle 需要这个 token 对应的 hidden states 进行 draft 的推理</p> </blockquote> <ul> <li>draft_worker(EAGLEWorkerV2) 执行 <code>_draft_extend_for_prefill</code></li> <li>将 target model 生成的 token 也加入到 batch.input_ids 里面</li> <li> <p>构造 EagleDraftInput，EAGLE v2 的 decode 阶段会基于 <code>verified_id</code> 作为树的根节点，再生成 topk 分支并构建 tree mask、positions 等<br> </p><div class="language-shell highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a><a href=#__codelineno-0-1><span class=linenos data-linenos="1 "></span></a><span class=w>  </span>EagleDraftInput<span class=o>(</span><span class=w>            </span>_<span class=w>  </span>_
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><a href=#__codelineno-0-2><span class=linenos data-linenos="2 "></span></a><span class=w>  </span><span class=nv>_hidden_states_</span><span class=w>  </span><span class=o>=</span>_<span class=w>  </span>target_hidden_states_<span class=w>  </span>,
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3></a><a href=#__codelineno-0-3><span class=linenos data-linenos="3 "></span></a><span class=w>  </span>_<span class=w>  </span><span class=nv>verified_id_</span><span class=w>  </span><span class=o>=</span>_<span class=w>  </span>next_token_ids_<span class=w>  </span>,
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4></a><a href=#__codelineno-0-4><span class=linenos data-linenos="4 "></span></a><span class=w>  </span>_<span class=w>  </span><span class=nv>new_seq_lens_</span><span class=w>  </span><span class=o>=</span>_<span class=w>  </span>batch_<span class=w>  </span>.seq_lens,
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5></a><a href=#__codelineno-0-5><span class=linenos data-linenos="5 "></span></a><span class=w>  </span><span class=c1># draft mode is same with decode mode, only 1 num token per batch</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><a href=#__codelineno-0-6><span class=linenos data-linenos="6 "></span></a><span class=w>  </span>_<span class=w>  </span><span class=nv>num_tokens_per_batch_</span><span class=w>  </span><span class=o>=</span><span class=m>1</span>,
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><a href=#__codelineno-0-7><span class=linenos data-linenos="7 "></span></a><span class=w>  </span>_<span class=w>  </span><span class=nv>num_tokens_for_logprob_per_batch_</span><span class=w>  </span><span class=o>=</span><span class=m>1</span>,
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><a href=#__codelineno-0-8><span class=linenos data-linenos="8 "></span></a><span class=w>  </span><span class=o>)</span>
</span></code></pre></div><p></p> <ul> <li>调用 draft model 的 forward_extend() 并进行采样，得到 topk 的 token index &amp; prob 以及 hidden states</li> </ul> </li> <li> <p>在 decode 阶段，draft worker 先调用 draft()，再调用 verify()，最后 _draft_extend_for_decode()</p> <ul> <li>draft(): 按 <code>speculative_num_steps</code> 多步扩展一棵 top-k 树，记录每个节点 token/score/parent，最后从整棵树里挑一批最高分节点作为 <code>draft_tokens</code>，并返回树结构信息给 <code>build_tree_kernel_efficient</code>，构造出 EageleVerifyInput<br> <div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1></a><a href=#__codelineno-1-1><span class=linenos data-linenos=" 1 "></span></a><span class=n>EagleVerifyInput</span><span class=p>(</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2></a><a href=#__codelineno-1-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=n>_draft_token_</span><span class=o>=</span><span class=n>draft_tokens</span><span class=p>,</span> <span class=c1># draft 阶段挑选出来、准备让 target 一次验证的 **候选 token 集合**</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3></a><a href=#__codelineno-1-3><span class=linenos data-linenos=" 3 "></span></a>    <span class=n>_custom_mask_</span><span class=o>=</span><span class=n>tree_mask</span><span class=p>,</span> <span class=c1># 每个候选节点能看到哪些 token</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4></a><a href=#__codelineno-1-4><span class=linenos data-linenos=" 4 "></span></a>    <span class=n>_positions_</span><span class=o>=</span><span class=n>position</span><span class=p>,</span> <span class=c1># 每个候选节点对应的 **position id**</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5></a><a href=#__codelineno-1-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=n>_retrive_index_</span><span class=o>=</span><span class=n>retrive_index</span><span class=p>,</span> <span class=c1># verify batch 中第 i 行，对应 draft 树里的哪个节点</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6></a><a href=#__codelineno-1-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=n>_retrive_next_token_</span><span class=o>=</span><span class=n>retrive_next_token</span><span class=p>,</span> <span class=c1># 如果某个节点被接受，下一个应该跳到哪个节点</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7></a><a href=#__codelineno-1-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=n>_retrive_next_sibling_</span><span class=o>=</span><span class=n>retrive_next_sibling</span><span class=p>,</span> <span class=c1># 如果当前节点没被接受，下一个备选兄弟节点是谁</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8></a><a href=#__codelineno-1-8><span class=linenos data-linenos=" 8 "></span></a>    <span class=n>_retrive_cum_len_</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9></a><a href=#__codelineno-1-9><span class=linenos data-linenos=" 9 "></span></a>    <span class=n>_spec_steps_</span><span class=o>=</span><span class=n>_self_</span><span class=o>.</span><span class=n>speculative_num_steps</span><span class=p>,</span> <span class=c1># draft 扩展的最大深度（树的高度）</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10></a><a href=#__codelineno-1-10><span class=linenos data-linenos="10 "></span></a>    <span class=n>_topk_</span><span class=o>=</span><span class=n>_self_</span><span class=o>.</span><span class=n>topk</span><span class=p>,</span> <span class=c1># draft 阶段每个节点的分支数</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11></a><a href=#__codelineno-1-11><span class=linenos data-linenos="11 "></span></a>    <span class=n>_draft_token_num_</span><span class=o>=</span><span class=n>_self_</span><span class=o>.</span><span class=n>speculative_num_draft_tokens</span><span class=p>,</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12></a><a href=#__codelineno-1-12><span class=linenos data-linenos="12 "></span></a>    <span class=n>_capture_hidden_mode_</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13></a><a href=#__codelineno-1-13><span class=linenos data-linenos="13 "></span></a>    <span class=n>_seq_lens_sum_</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14></a><a href=#__codelineno-1-14><span class=linenos data-linenos="14 "></span></a>    <span class=n>_seq_lens_cpu_</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15></a><a href=#__codelineno-1-15><span class=linenos data-linenos="15 "></span></a><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li>verify(): verify 一次 forward，<strong>最多验证 spec_steps 个未来 token + 当前 token</strong><ul> <li>把 verify 所需的 <strong>tree 索引和 token(verify_input)</strong> 从 GPU 拷到 CPU，准备更新 vocab mask</li> <li>Target model 执行 <code>forward_batch_generation()</code>，实际上直接跳过了 sample</li> <li>对 draft 树做 DFS 构造 vocab mask，并把 batch.sampling_info.vocab_mask 置空（<code>None</code>）</li> <li>对 draft input 做 sample，同时考虑 target 的概率分布和 draft 的 token<ul> <li>如果 draft token 被拒绝，会根据 target 的概率分布重新采样一个新的 token 作为修正</li> </ul> </li> </ul> </li> <li>_draft_extend_for_decode():<ul> <li>计算的 <code>select_index</code>，只保留最后一个 Token 的预测结果。</li> <li>计算出的 <code>topk_p</code>（概率）、<code>topk_index</code>（Token ID）和 hidden_states 被填入<code>next_draft_input</code>。这个对象会被传递给下一个循环的 <code>draft()</code> 函数，作为生成新的 Token 树的<strong>root</strong></li> </ul> </li> </ul> <h3 id=kv-cache>KV Cache 管理<a class=headerlink href=#kv-cache title="Permanent link">¶</a></h3> <p>Draft Model 和 Target Model 都有自己独立的 KV Cache</p> <ul> <li><strong>Draft Cache</strong>: 在 prepare_for_v2_draft 中计算写入的 KV Cache 位置。Draft 模型用它来生成树</li> <li><strong>Target Cache</strong>: 在 prepare_for_v2_verify 中计算写入的 KV Cache 位置。Target 模型用它来验证树</li> </ul> <h4 id=_3>分配<a class=headerlink href=#_3 title="Permanent link">¶</a></h4> <p>在 prepare_for_decode() 处进行</p> <ul> <li>Target 通过 alloc_for_decode() 分配物理 KV Cache</li> <li>Draft 等待上一轮 sample 结束后，同步当前 batch 的 seq_len，利用这个 seq_len 分配下一轮需要的物理 KV Cache</li> </ul> <blockquote> <p>分配了 2 * ALLOC_LEN，确保 current step 和 next step 所有的数据都可以装下</p> </blockquote> <h4 id=_4>释放<a class=headerlink href=#_4 title="Permanent link">¶</a></h4> <blockquote> <p>commited_len 是实际 KV Cache 使用的长度<br> allocated_len 是分配的 KV Cache 的长度</p> </blockquote> <p>在 scheduler 调度中，调用 process_batch_result_decode 进行处理，req 结束后</p> <ul> <li>处理已提交的 token，将"有用"的 token 放入 radix cache；其他直接释放</li> <li>Eagle v2 需要释放过度分配的 kv cache</li> </ul> <blockquote> <p>在 EAGLE v2 中，<code>allocated_len</code> 通常比 <code>committed_len</code> 大很多（包含 Draft 预测的但未被接受的 Token，以及为了 Overlap 预分配的空间）<br> </p> </blockquote> <h2 id=rollback-lazy-processing>Rollback Lazy Processing<a class=headerlink href=#rollback-lazy-processing title="Permanent link">¶</a></h2> <p>Rollback（回退）并不是真的释放显存，而是<strong>移动指针</strong>。</p> <ul> <li><strong>物理层（不处理）：</strong> 当 Target Model 验证发现 Draft 预测的 5 个 Token 只对了 2 个时，剩下的 3 个无效 Token 产生的 KV Cache 依然留在显存的物理 Block 中。我们不会立即触发类似 <code>free()</code> 的操作，因为这太慢了。</li> <li><strong>逻辑层（即时回退）：</strong> <code>committed_len</code> 会立即更新为验证通过的长度。下一轮推理时，新的 KV Cache 会直接<strong>覆盖（Overwrite）</strong> 掉那些之前预测失败留下的脏数据。</li> <li><strong>请求结束：</strong> 只有当整个请求结束，进入 <code>process_batch_result_decode</code> 时，Radix Cache 才会根据 <code>committed_len</code> 将真正有效的路径存入缓存池，而 <code>allocated_len</code> 多占用的那部分物理 Block 会被统一回收。</li> </ul> <h3 id=_5>同步点<a class=headerlink href=#_5 title="Permanent link">¶</a></h3> <p>事实上除了上面提到的 CPU 与 GPU compute stream 的同步，这里还有一个 GPU plan stream</p> <h4 id=plan-stream-compute-stream><strong>Plan stream 和 Compute stream 之间的同步</strong><a class=headerlink href=#plan-stream-compute-stream title="Permanent link">¶</a></h4> <ul> <li>因为 plan stream 中一般都是为后续计算做准备的，compute stream 需要同步等待 plan stream 操作完成</li> </ul> <h4 id=cpu-plan-stream>CPU 与 Plan Stream 的同步<a class=headerlink href=#cpu-plan-stream title="Permanent link">¶</a></h4> <ul> <li>由 CPU 侧的调度逻辑保证，自然同步</li> </ul> <h4 id=cpu-compute-stream>CPU 与 Compute stream 的同步<a class=headerlink href=#cpu-compute-stream title="Permanent link">¶</a></h4> <ul> <li>Draft Extend N-1 与下一轮调度由 CPU 调度逻辑保证同步</li> <li>Write future map 和 Read future map 由 copy_to_cpu() 保证同步</li> <li> <p>Verify 与 Draft Extend 之间的同步</p> </li> <li> <p>Draft Extend 填充 KV cache 依赖于 verify 的 accept length 和 predict 结果，所以需要同步</p> </li> </ul> <blockquote> <p><strong>事实上由于我们前面的 target verify 与 cpu 的 launch target sampling 有同步点，所以这里自然保证同步</strong></p> <ul> <li>Draft 与 Verify 之间的同步</li> </ul> </blockquote> <ul> <li>CPU 进行 verify plan 的时候，GPU 的 draft 可能还没计算完成，所以在 launch verify kernel 前同步更新下 verify buffer</li> <li>我们为了生成 vocab mask，需要 verify input，需要拷贝 GPU 上的数据，这里用的 .cpu() 实际上是一次同步</li> </ul> <blockquote> <p><strong>这里应该用异步拷贝</strong></p> <ul> <li>Verify 与 Sampling 之间的同步</li> </ul> </blockquote> <ul> <li>Cpu 上根据得到的 verify input 进行 vocab mask generate，这里需要将 cpu 的 vocab mask 拷贝到 GPU 上</li> </ul> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/WFRhbVkv8oZpkoxam7Nc2FFwnob.png data-desc-position=bottom><img alt src=../static/WFRhbVkv8oZpkoxam7Nc2FFwnob.png></a></p> <h3 id=_6>同步的细节<a class=headerlink href=#_6 title="Permanent link">¶</a></h3> <h4 id=late-binding>Late Binding<a class=headerlink href=#late-binding title="Permanent link">¶</a></h4> <p>为了让 <strong>Plan(prepare data for compute)</strong> 可以不依赖 GPU compute stream，代码允许 Plan 阶段使用<strong>不完整的数据</strong>。</p> <ul> <li>Plan 阶段先分配好 Buffer，或者复用 CUDA Graph 的静态 Buffer。</li> <li>Draft 阶段算完后，直接调用 update_verify_buffers_to_fill_after_draft，利用 CUDA Kernel 高速把 Draft 生成的 Mask/Pos <strong>直接写入</strong> 到 Plan 阶段预留的显存地址中。</li> </ul> <h2 id=test-sglang-eagle-constrained-decoding>Test SGLang Eagle + Constrained Decoding<a class=headerlink href=#test-sglang-eagle-constrained-decoding title="Permanent link">¶</a></h2> <h3 id=test-sh>Test sh<a class=headerlink href=#test-sh title="Permanent link">¶</a></h3> <div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a><a href=#__codelineno-2-1><span class=linenos data-linenos=" 1 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2></a><a href=#__codelineno-2-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>time</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3></a><a href=#__codelineno-2-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>threading</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4></a><a href=#__codelineno-2-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5></a><a href=#__codelineno-2-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6></a><a href=#__codelineno-2-6><span class=linenos data-linenos=" 6 "></span></a><span class=c1># 参数设置</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7></a><a href=#__codelineno-2-7><span class=linenos data-linenos=" 7 "></span></a><span class=n>X</span> <span class=o>=</span> <span class=mi>10</span> <span class=c1># 总请求数</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8></a><a href=#__codelineno-2-8><span class=linenos data-linenos=" 8 "></span></a><span class=n>T</span> <span class=o>=</span> <span class=mi>1</span>  <span class=c1># 总时长（秒）</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9></a><a href=#__codelineno-2-9><span class=linenos data-linenos=" 9 "></span></a><span class=n>output_file</span> <span class=o>=</span> <span class=s2>"output.json"</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10></a><a href=#__codelineno-2-10><span class=linenos data-linenos="10 "></span></a>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11></a><a href=#__codelineno-2-11><span class=linenos data-linenos="11 "></span></a><span class=n>url</span> <span class=o>=</span> <span class=s2>"http://localhost:30000/v1/chat/completions"</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12></a><a href=#__codelineno-2-12><span class=linenos data-linenos="12 "></span></a><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>"Content-Type"</span><span class=p>:</span> <span class=s2>"application/json"</span><span class=p>}</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13></a><a href=#__codelineno-2-13><span class=linenos data-linenos="13 "></span></a><span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14></a><a href=#__codelineno-2-14><span class=linenos data-linenos="14 "></span></a>    <span class=s2>"model"</span><span class=p>:</span> <span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15></a><a href=#__codelineno-2-15><span class=linenos data-linenos="15 "></span></a>    <span class=s2>"messages"</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16></a><a href=#__codelineno-2-16><span class=linenos data-linenos="16 "></span></a>        <span class=p>{</span><span class=s2>"content"</span><span class=p>:</span> <span class=s2>"Your task is to extract the name of the person from the following text."</span><span class=p>,</span> <span class=s2>"role"</span><span class=p>:</span> <span class=s2>"system"</span><span class=p>},</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17></a><a href=#__codelineno-2-17><span class=linenos data-linenos="17 "></span></a>        <span class=p>{</span><span class=s2>"content"</span><span class=p>:</span> <span class=s2>"I'm John Doe. Please write a detailed biography of John Doe, including his background, education, career, achievements, and any interesting stories or anecdotes. Make the biography as long and comprehensive as possible, and ensure the output is in valid JSON format as required by the schema. Add at least 10 different sections, and elaborate on each section with rich details and plausible events. If you need to invent information, make it realistic and consistent. This is a test. "</span> <span class=o>*</span> <span class=mi>20</span><span class=p>,</span> <span class=s2>"role"</span><span class=p>:</span> <span class=s2>"user"</span><span class=p>}</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18></a><a href=#__codelineno-2-18><span class=linenos data-linenos="18 "></span></a>    <span class=p>],</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19></a><a href=#__codelineno-2-19><span class=linenos data-linenos="19 "></span></a>    <span class=s2>"response_format"</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20></a><a href=#__codelineno-2-20><span class=linenos data-linenos="20 "></span></a>        <span class=s2>"json_schema"</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21></a><a href=#__codelineno-2-21><span class=linenos data-linenos="21 "></span></a>            <span class=s2>"name"</span><span class=p>:</span> <span class=s2>"extract_name"</span><span class=p>,</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22></a><a href=#__codelineno-2-22><span class=linenos data-linenos="22 "></span></a>            <span class=s2>"schema"</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23></a><a href=#__codelineno-2-23><span class=linenos data-linenos="23 "></span></a>                <span class=s2>"properties"</span><span class=p>:</span> <span class=p>{</span><span class=s2>"name"</span><span class=p>:</span> <span class=p>{</span><span class=s2>"type"</span><span class=p>:</span> <span class=s2>"string"</span><span class=p>}},</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24></a><a href=#__codelineno-2-24><span class=linenos data-linenos="24 "></span></a>                <span class=s2>"required"</span><span class=p>:</span> <span class=p>[</span><span class=s2>"name"</span><span class=p>],</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25></a><a href=#__codelineno-2-25><span class=linenos data-linenos="25 "></span></a>                <span class=s2>"title"</span><span class=p>:</span> <span class=s2>"ExtractName"</span><span class=p>,</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26></a><a href=#__codelineno-2-26><span class=linenos data-linenos="26 "></span></a>                <span class=s2>"type"</span><span class=p>:</span> <span class=s2>"object"</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27></a><a href=#__codelineno-2-27><span class=linenos data-linenos="27 "></span></a>            <span class=p>}</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28></a><a href=#__codelineno-2-28><span class=linenos data-linenos="28 "></span></a>        <span class=p>},</span>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29></a><a href=#__codelineno-2-29><span class=linenos data-linenos="29 "></span></a>        <span class=s2>"type"</span><span class=p>:</span> <span class=s2>"json_schema"</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30></a><a href=#__codelineno-2-30><span class=linenos data-linenos="30 "></span></a>    <span class=p>},</span>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31></a><a href=#__codelineno-2-31><span class=linenos data-linenos="31 "></span></a>    <span class=s2>"max_tokens"</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32></a><a href=#__codelineno-2-32><span class=linenos data-linenos="32 "></span></a>    <span class=s2>"stream"</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33></a><a href=#__codelineno-2-33><span class=linenos data-linenos="33 "></span></a>    <span class=s2>"temperature"</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34></a><a href=#__codelineno-2-34><span class=linenos data-linenos="34 "></span></a>    <span class=s2>"top_k"</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35></a><a href=#__codelineno-2-35><span class=linenos data-linenos="35 "></span></a>    <span class=s2>"top_p"</span><span class=p>:</span> <span class=mf>1.0</span><span class=p>,</span>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36></a><a href=#__codelineno-2-36><span class=linenos data-linenos="36 "></span></a>    <span class=s2>"repetition_penalty"</span><span class=p>:</span> <span class=mf>1.0</span>
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37></a><a href=#__codelineno-2-37><span class=linenos data-linenos="37 "></span></a><span class=p>}</span>
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38></a><a href=#__codelineno-2-38><span class=linenos data-linenos="38 "></span></a>
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39></a><a href=#__codelineno-2-39><span class=linenos data-linenos="39 "></span></a><span class=n>interval</span> <span class=o>=</span> <span class=n>T</span> <span class=o>/</span> <span class=n>X</span>
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40></a><a href=#__codelineno-2-40><span class=linenos data-linenos="40 "></span></a><span class=n>results</span> <span class=o>=</span> <span class=p>[</span><span class=kc>None</span><span class=p>]</span> <span class=o>*</span> <span class=n>X</span>
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41></a><a href=#__codelineno-2-41><span class=linenos data-linenos="41 "></span></a>
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42></a><a href=#__codelineno-2-42><span class=linenos data-linenos="42 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>send_request</span><span class=p>(</span><span class=n>_i_</span><span class=p>):</span>
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43></a><a href=#__codelineno-2-43><span class=linenos data-linenos="43 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44></a><a href=#__codelineno-2-44><span class=linenos data-linenos="44 "></span></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>_headers_</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>_data_</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>payload</span><span class=p>))</span>
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45></a><a href=#__codelineno-2-45><span class=linenos data-linenos="45 "></span></a>        <span class=n>results</span><span class=p>[</span><span class=n>_i_</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span>
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46></a><a href=#__codelineno-2-46><span class=linenos data-linenos="46 "></span></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47></a><a href=#__codelineno-2-47><span class=linenos data-linenos="47 "></span></a>        <span class=n>results</span><span class=p>[</span><span class=n>_i_</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48></a><a href=#__codelineno-2-48><span class=linenos data-linenos="48 "></span></a>
</span><span id=__span-2-49><a id=__codelineno-2-49 name=__codelineno-2-49></a><a href=#__codelineno-2-49><span class=linenos data-linenos="49 "></span></a><span class=n>threads</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-50><a id=__codelineno-2-50 name=__codelineno-2-50></a><a href=#__codelineno-2-50><span class=linenos data-linenos="50 "></span></a><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>X</span><span class=p>):</span>
</span><span id=__span-2-51><a id=__codelineno-2-51 name=__codelineno-2-51></a><a href=#__codelineno-2-51><span class=linenos data-linenos="51 "></span></a>    <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Timer</span><span class=p>(</span><span class=n>interval</span> <span class=o>*</span> <span class=n>i</span><span class=p>,</span> <span class=n>send_request</span><span class=p>,</span> <span class=n>_args_</span><span class=o>=</span><span class=p>(</span><span class=n>i</span><span class=p>,))</span>
</span><span id=__span-2-52><a id=__codelineno-2-52 name=__codelineno-2-52></a><a href=#__codelineno-2-52><span class=linenos data-linenos="52 "></span></a>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-2-53><a id=__codelineno-2-53 name=__codelineno-2-53></a><a href=#__codelineno-2-53><span class=linenos data-linenos="53 "></span></a>    <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span><span id=__span-2-54><a id=__codelineno-2-54 name=__codelineno-2-54></a><a href=#__codelineno-2-54><span class=linenos data-linenos="54 "></span></a>
</span><span id=__span-2-55><a id=__codelineno-2-55 name=__codelineno-2-55></a><a href=#__codelineno-2-55><span class=linenos data-linenos="55 "></span></a><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>threads</span><span class=p>:</span>
</span><span id=__span-2-56><a id=__codelineno-2-56 name=__codelineno-2-56></a><a href=#__codelineno-2-56><span class=linenos data-linenos="56 "></span></a>    <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span><span id=__span-2-57><a id=__codelineno-2-57 name=__codelineno-2-57></a><a href=#__codelineno-2-57><span class=linenos data-linenos="57 "></span></a>
</span><span id=__span-2-58><a id=__codelineno-2-58 name=__codelineno-2-58></a><a href=#__codelineno-2-58><span class=linenos data-linenos="58 "></span></a><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>output_file</span><span class=p>,</span> <span class=s2>"w"</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-2-59><a id=__codelineno-2-59 name=__codelineno-2-59></a><a href=#__codelineno-2-59><span class=linenos data-linenos="59 "></span></a>    <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span><span id=__span-2-60><a id=__codelineno-2-60 name=__codelineno-2-60></a><a href=#__codelineno-2-60><span class=linenos data-linenos="60 "></span></a>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=s2>"</span><span class=se>\n</span><span class=s2>"</span><span class=p>)</span>
</span></code></pre></div> <h3 id=result>Result<a class=headerlink href=#result title="Permanent link">¶</a></h3> <div class="language-json highlight"><span class=filename>JSON</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a><a href=#__codelineno-3-1><span class=linenos data-linenos="  1 "></span></a><span class=p>[</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a><a href=#__codelineno-3-2><span class=linenos data-linenos="  2 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a><a href=#__codelineno-3-3><span class=linenos data-linenos="  3 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"814769f7ecfc4077a542b7a8621b4ed8"</span><span class=p>,</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a><a href=#__codelineno-3-4><span class=linenos data-linenos="  4 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a><a href=#__codelineno-3-5><span class=linenos data-linenos="  5 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405499</span><span class=p>,</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a><a href=#__codelineno-3-6><span class=linenos data-linenos="  6 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a><a href=#__codelineno-3-7><span class=linenos data-linenos="  7 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a><a href=#__codelineno-3-8><span class=linenos data-linenos="  8 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9></a><a href=#__codelineno-3-9><span class=linenos data-linenos="  9 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10></a><a href=#__codelineno-3-10><span class=linenos data-linenos=" 10 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11></a><a href=#__codelineno-3-11><span class=linenos data-linenos=" 11 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12></a><a href=#__codelineno-3-12><span class=linenos data-linenos=" 12 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\": \"John Doe\"\n}"</span><span class=p>,</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13></a><a href=#__codelineno-3-13><span class=linenos data-linenos=" 13 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14></a><a href=#__codelineno-3-14><span class=linenos data-linenos=" 14 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15></a><a href=#__codelineno-3-15><span class=linenos data-linenos=" 15 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16></a><a href=#__codelineno-3-16><span class=linenos data-linenos=" 16 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17></a><a href=#__codelineno-3-17><span class=linenos data-linenos=" 17 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"stop"</span><span class=p>,</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18></a><a href=#__codelineno-3-18><span class=linenos data-linenos=" 18 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=mi>2</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19></a><a href=#__codelineno-3-19><span class=linenos data-linenos=" 19 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20></a><a href=#__codelineno-3-20><span class=linenos data-linenos=" 20 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21></a><a href=#__codelineno-3-21><span class=linenos data-linenos=" 21 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22></a><a href=#__codelineno-3-22><span class=linenos data-linenos=" 22 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23></a><a href=#__codelineno-3-23><span class=linenos data-linenos=" 23 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2209</span><span class=p>,</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24></a><a href=#__codelineno-3-24><span class=linenos data-linenos=" 24 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>13</span><span class=p>,</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25></a><a href=#__codelineno-3-25><span class=linenos data-linenos=" 25 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26></a><a href=#__codelineno-3-26><span class=linenos data-linenos=" 26 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27></a><a href=#__codelineno-3-27><span class=linenos data-linenos=" 27 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28></a><a href=#__codelineno-3-28><span class=linenos data-linenos=" 28 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29></a><a href=#__codelineno-3-29><span class=linenos data-linenos=" 29 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30></a><a href=#__codelineno-3-30><span class=linenos data-linenos=" 30 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31></a><a href=#__codelineno-3-31><span class=linenos data-linenos=" 31 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32></a><a href=#__codelineno-3-32><span class=linenos data-linenos=" 32 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33></a><a href=#__codelineno-3-33><span class=linenos data-linenos=" 33 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"bd37e0e219904597a0fb4f3c78764902"</span><span class=p>,</span>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34></a><a href=#__codelineno-3-34><span class=linenos data-linenos=" 34 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35></a><a href=#__codelineno-3-35><span class=linenos data-linenos=" 35 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405499</span><span class=p>,</span>
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36></a><a href=#__codelineno-3-36><span class=linenos data-linenos=" 36 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37></a><a href=#__codelineno-3-37><span class=linenos data-linenos=" 37 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38></a><a href=#__codelineno-3-38><span class=linenos data-linenos=" 38 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39></a><a href=#__codelineno-3-39><span class=linenos data-linenos=" 39 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40></a><a href=#__codelineno-3-40><span class=linenos data-linenos=" 40 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41></a><a href=#__codelineno-3-41><span class=linenos data-linenos=" 41 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42></a><a href=#__codelineno-3-42><span class=linenos data-linenos=" 42 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\"\n\n\n\n\n\n\n\n\n\n\n\n"</span><span class=p>,</span>
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43></a><a href=#__codelineno-3-43><span class=linenos data-linenos=" 43 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44></a><a href=#__codelineno-3-44><span class=linenos data-linenos=" 44 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45></a><a href=#__codelineno-3-45><span class=linenos data-linenos=" 45 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-46><a id=__codelineno-3-46 name=__codelineno-3-46></a><a href=#__codelineno-3-46><span class=linenos data-linenos=" 46 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-47><a id=__codelineno-3-47 name=__codelineno-3-47></a><a href=#__codelineno-3-47><span class=linenos data-linenos=" 47 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"abort"</span><span class=p>,</span>
</span><span id=__span-3-48><a id=__codelineno-3-48 name=__codelineno-3-48></a><a href=#__codelineno-3-48><span class=linenos data-linenos=" 48 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-49><a id=__codelineno-3-49 name=__codelineno-3-49></a><a href=#__codelineno-3-49><span class=linenos data-linenos=" 49 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-50><a id=__codelineno-3-50 name=__codelineno-3-50></a><a href=#__codelineno-3-50><span class=linenos data-linenos=" 50 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-51><a id=__codelineno-3-51 name=__codelineno-3-51></a><a href=#__codelineno-3-51><span class=linenos data-linenos=" 51 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-52><a id=__codelineno-3-52 name=__codelineno-3-52></a><a href=#__codelineno-3-52><span class=linenos data-linenos=" 52 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-53><a id=__codelineno-3-53 name=__codelineno-3-53></a><a href=#__codelineno-3-53><span class=linenos data-linenos=" 53 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2216</span><span class=p>,</span>
</span><span id=__span-3-54><a id=__codelineno-3-54 name=__codelineno-3-54></a><a href=#__codelineno-3-54><span class=linenos data-linenos=" 54 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=p>,</span>
</span><span id=__span-3-55><a id=__codelineno-3-55 name=__codelineno-3-55></a><a href=#__codelineno-3-55><span class=linenos data-linenos=" 55 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-56><a id=__codelineno-3-56 name=__codelineno-3-56></a><a href=#__codelineno-3-56><span class=linenos data-linenos=" 56 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-57><a id=__codelineno-3-57 name=__codelineno-3-57></a><a href=#__codelineno-3-57><span class=linenos data-linenos=" 57 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-58><a id=__codelineno-3-58 name=__codelineno-3-58></a><a href=#__codelineno-3-58><span class=linenos data-linenos=" 58 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-59><a id=__codelineno-3-59 name=__codelineno-3-59></a><a href=#__codelineno-3-59><span class=linenos data-linenos=" 59 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-60><a id=__codelineno-3-60 name=__codelineno-3-60></a><a href=#__codelineno-3-60><span class=linenos data-linenos=" 60 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-61><a id=__codelineno-3-61 name=__codelineno-3-61></a><a href=#__codelineno-3-61><span class=linenos data-linenos=" 61 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-62><a id=__codelineno-3-62 name=__codelineno-3-62></a><a href=#__codelineno-3-62><span class=linenos data-linenos=" 62 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-63><a id=__codelineno-3-63 name=__codelineno-3-63></a><a href=#__codelineno-3-63><span class=linenos data-linenos=" 63 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"c420563cc2a849a281c5ca86ffca4ec9"</span><span class=p>,</span>
</span><span id=__span-3-64><a id=__codelineno-3-64 name=__codelineno-3-64></a><a href=#__codelineno-3-64><span class=linenos data-linenos=" 64 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-65><a id=__codelineno-3-65 name=__codelineno-3-65></a><a href=#__codelineno-3-65><span class=linenos data-linenos=" 65 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405504</span><span class=p>,</span>
</span><span id=__span-3-66><a id=__codelineno-3-66 name=__codelineno-3-66></a><a href=#__codelineno-3-66><span class=linenos data-linenos=" 66 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-67><a id=__codelineno-3-67 name=__codelineno-3-67></a><a href=#__codelineno-3-67><span class=linenos data-linenos=" 67 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-68><a id=__codelineno-3-68 name=__codelineno-3-68></a><a href=#__codelineno-3-68><span class=linenos data-linenos=" 68 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-69><a id=__codelineno-3-69 name=__codelineno-3-69></a><a href=#__codelineno-3-69><span class=linenos data-linenos=" 69 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-70><a id=__codelineno-3-70 name=__codelineno-3-70></a><a href=#__codelineno-3-70><span class=linenos data-linenos=" 70 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-71><a id=__codelineno-3-71 name=__codelineno-3-71></a><a href=#__codelineno-3-71><span class=linenos data-linenos=" 71 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-72><a id=__codelineno-3-72 name=__codelineno-3-72></a><a href=#__codelineno-3-72><span class=linenos data-linenos=" 72 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\"\n\n...(truncated for brevity, lots of newlines)...\n"</span><span class=p>,</span>
</span><span id=__span-3-73><a id=__codelineno-3-73 name=__codelineno-3-73></a><a href=#__codelineno-3-73><span class=linenos data-linenos=" 73 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-74><a id=__codelineno-3-74 name=__codelineno-3-74></a><a href=#__codelineno-3-74><span class=linenos data-linenos=" 74 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-75><a id=__codelineno-3-75 name=__codelineno-3-75></a><a href=#__codelineno-3-75><span class=linenos data-linenos=" 75 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-76><a id=__codelineno-3-76 name=__codelineno-3-76></a><a href=#__codelineno-3-76><span class=linenos data-linenos=" 76 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-77><a id=__codelineno-3-77 name=__codelineno-3-77></a><a href=#__codelineno-3-77><span class=linenos data-linenos=" 77 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"length"</span><span class=p>,</span>
</span><span id=__span-3-78><a id=__codelineno-3-78 name=__codelineno-3-78></a><a href=#__codelineno-3-78><span class=linenos data-linenos=" 78 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-79><a id=__codelineno-3-79 name=__codelineno-3-79></a><a href=#__codelineno-3-79><span class=linenos data-linenos=" 79 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-80><a id=__codelineno-3-80 name=__codelineno-3-80></a><a href=#__codelineno-3-80><span class=linenos data-linenos=" 80 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-81><a id=__codelineno-3-81 name=__codelineno-3-81></a><a href=#__codelineno-3-81><span class=linenos data-linenos=" 81 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-82><a id=__codelineno-3-82 name=__codelineno-3-82></a><a href=#__codelineno-3-82><span class=linenos data-linenos=" 82 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-83><a id=__codelineno-3-83 name=__codelineno-3-83></a><a href=#__codelineno-3-83><span class=linenos data-linenos=" 83 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>3196</span><span class=p>,</span>
</span><span id=__span-3-84><a id=__codelineno-3-84 name=__codelineno-3-84></a><a href=#__codelineno-3-84><span class=linenos data-linenos=" 84 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>1000</span><span class=p>,</span>
</span><span id=__span-3-85><a id=__codelineno-3-85 name=__codelineno-3-85></a><a href=#__codelineno-3-85><span class=linenos data-linenos=" 85 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-86><a id=__codelineno-3-86 name=__codelineno-3-86></a><a href=#__codelineno-3-86><span class=linenos data-linenos=" 86 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-87><a id=__codelineno-3-87 name=__codelineno-3-87></a><a href=#__codelineno-3-87><span class=linenos data-linenos=" 87 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-88><a id=__codelineno-3-88 name=__codelineno-3-88></a><a href=#__codelineno-3-88><span class=linenos data-linenos=" 88 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-89><a id=__codelineno-3-89 name=__codelineno-3-89></a><a href=#__codelineno-3-89><span class=linenos data-linenos=" 89 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-90><a id=__codelineno-3-90 name=__codelineno-3-90></a><a href=#__codelineno-3-90><span class=linenos data-linenos=" 90 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-91><a id=__codelineno-3-91 name=__codelineno-3-91></a><a href=#__codelineno-3-91><span class=linenos data-linenos=" 91 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-92><a id=__codelineno-3-92 name=__codelineno-3-92></a><a href=#__codelineno-3-92><span class=linenos data-linenos=" 92 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-93><a id=__codelineno-3-93 name=__codelineno-3-93></a><a href=#__codelineno-3-93><span class=linenos data-linenos=" 93 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"e9f0bbd4575e48db8b4497a9dd1a2ec2"</span><span class=p>,</span>
</span><span id=__span-3-94><a id=__codelineno-3-94 name=__codelineno-3-94></a><a href=#__codelineno-3-94><span class=linenos data-linenos=" 94 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-95><a id=__codelineno-3-95 name=__codelineno-3-95></a><a href=#__codelineno-3-95><span class=linenos data-linenos=" 95 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405499</span><span class=p>,</span>
</span><span id=__span-3-96><a id=__codelineno-3-96 name=__codelineno-3-96></a><a href=#__codelineno-3-96><span class=linenos data-linenos=" 96 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-97><a id=__codelineno-3-97 name=__codelineno-3-97></a><a href=#__codelineno-3-97><span class=linenos data-linenos=" 97 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-98><a id=__codelineno-3-98 name=__codelineno-3-98></a><a href=#__codelineno-3-98><span class=linenos data-linenos=" 98 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-99><a id=__codelineno-3-99 name=__codelineno-3-99></a><a href=#__codelineno-3-99><span class=linenos data-linenos=" 99 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-100><a id=__codelineno-3-100 name=__codelineno-3-100></a><a href=#__codelineno-3-100><span class=linenos data-linenos="100 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-101><a id=__codelineno-3-101 name=__codelineno-3-101></a><a href=#__codelineno-3-101><span class=linenos data-linenos="101 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-102><a id=__codelineno-3-102 name=__codelineno-3-102></a><a href=#__codelineno-3-102><span class=linenos data-linenos="102 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\":\n\": John :\"\n\n\n"</span><span class=p>,</span>
</span><span id=__span-3-103><a id=__codelineno-3-103 name=__codelineno-3-103></a><a href=#__codelineno-3-103><span class=linenos data-linenos="103 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-104><a id=__codelineno-3-104 name=__codelineno-3-104></a><a href=#__codelineno-3-104><span class=linenos data-linenos="104 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-105><a id=__codelineno-3-105 name=__codelineno-3-105></a><a href=#__codelineno-3-105><span class=linenos data-linenos="105 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-106><a id=__codelineno-3-106 name=__codelineno-3-106></a><a href=#__codelineno-3-106><span class=linenos data-linenos="106 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-107><a id=__codelineno-3-107 name=__codelineno-3-107></a><a href=#__codelineno-3-107><span class=linenos data-linenos="107 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"abort"</span><span class=p>,</span>
</span><span id=__span-3-108><a id=__codelineno-3-108 name=__codelineno-3-108></a><a href=#__codelineno-3-108><span class=linenos data-linenos="108 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-109><a id=__codelineno-3-109 name=__codelineno-3-109></a><a href=#__codelineno-3-109><span class=linenos data-linenos="109 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-110><a id=__codelineno-3-110 name=__codelineno-3-110></a><a href=#__codelineno-3-110><span class=linenos data-linenos="110 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-111><a id=__codelineno-3-111 name=__codelineno-3-111></a><a href=#__codelineno-3-111><span class=linenos data-linenos="111 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-112><a id=__codelineno-3-112 name=__codelineno-3-112></a><a href=#__codelineno-3-112><span class=linenos data-linenos="112 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-113><a id=__codelineno-3-113 name=__codelineno-3-113></a><a href=#__codelineno-3-113><span class=linenos data-linenos="113 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2210</span><span class=p>,</span>
</span><span id=__span-3-114><a id=__codelineno-3-114 name=__codelineno-3-114></a><a href=#__codelineno-3-114><span class=linenos data-linenos="114 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>14</span><span class=p>,</span>
</span><span id=__span-3-115><a id=__codelineno-3-115 name=__codelineno-3-115></a><a href=#__codelineno-3-115><span class=linenos data-linenos="115 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-116><a id=__codelineno-3-116 name=__codelineno-3-116></a><a href=#__codelineno-3-116><span class=linenos data-linenos="116 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-117><a id=__codelineno-3-117 name=__codelineno-3-117></a><a href=#__codelineno-3-117><span class=linenos data-linenos="117 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-118><a id=__codelineno-3-118 name=__codelineno-3-118></a><a href=#__codelineno-3-118><span class=linenos data-linenos="118 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-119><a id=__codelineno-3-119 name=__codelineno-3-119></a><a href=#__codelineno-3-119><span class=linenos data-linenos="119 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-120><a id=__codelineno-3-120 name=__codelineno-3-120></a><a href=#__codelineno-3-120><span class=linenos data-linenos="120 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-121><a id=__codelineno-3-121 name=__codelineno-3-121></a><a href=#__codelineno-3-121><span class=linenos data-linenos="121 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-122><a id=__codelineno-3-122 name=__codelineno-3-122></a><a href=#__codelineno-3-122><span class=linenos data-linenos="122 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-123><a id=__codelineno-3-123 name=__codelineno-3-123></a><a href=#__codelineno-3-123><span class=linenos data-linenos="123 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"296d8dd652474e3287efed9cb0bc9ef1"</span><span class=p>,</span>
</span><span id=__span-3-124><a id=__codelineno-3-124 name=__codelineno-3-124></a><a href=#__codelineno-3-124><span class=linenos data-linenos="124 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-125><a id=__codelineno-3-125 name=__codelineno-3-125></a><a href=#__codelineno-3-125><span class=linenos data-linenos="125 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405499</span><span class=p>,</span>
</span><span id=__span-3-126><a id=__codelineno-3-126 name=__codelineno-3-126></a><a href=#__codelineno-3-126><span class=linenos data-linenos="126 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-127><a id=__codelineno-3-127 name=__codelineno-3-127></a><a href=#__codelineno-3-127><span class=linenos data-linenos="127 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-128><a id=__codelineno-3-128 name=__codelineno-3-128></a><a href=#__codelineno-3-128><span class=linenos data-linenos="128 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-129><a id=__codelineno-3-129 name=__codelineno-3-129></a><a href=#__codelineno-3-129><span class=linenos data-linenos="129 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-130><a id=__codelineno-3-130 name=__codelineno-3-130></a><a href=#__codelineno-3-130><span class=linenos data-linenos="130 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-131><a id=__codelineno-3-131 name=__codelineno-3-131></a><a href=#__codelineno-3-131><span class=linenos data-linenos="131 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-132><a id=__codelineno-3-132 name=__codelineno-3-132></a><a href=#__codelineno-3-132><span class=linenos data-linenos="132 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\"\n\n\n\n\n\n\n\n\n\n\n\n"</span><span class=p>,</span>
</span><span id=__span-3-133><a id=__codelineno-3-133 name=__codelineno-3-133></a><a href=#__codelineno-3-133><span class=linenos data-linenos="133 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-134><a id=__codelineno-3-134 name=__codelineno-3-134></a><a href=#__codelineno-3-134><span class=linenos data-linenos="134 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-135><a id=__codelineno-3-135 name=__codelineno-3-135></a><a href=#__codelineno-3-135><span class=linenos data-linenos="135 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-136><a id=__codelineno-3-136 name=__codelineno-3-136></a><a href=#__codelineno-3-136><span class=linenos data-linenos="136 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-137><a id=__codelineno-3-137 name=__codelineno-3-137></a><a href=#__codelineno-3-137><span class=linenos data-linenos="137 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"abort"</span><span class=p>,</span>
</span><span id=__span-3-138><a id=__codelineno-3-138 name=__codelineno-3-138></a><a href=#__codelineno-3-138><span class=linenos data-linenos="138 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-139><a id=__codelineno-3-139 name=__codelineno-3-139></a><a href=#__codelineno-3-139><span class=linenos data-linenos="139 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-140><a id=__codelineno-3-140 name=__codelineno-3-140></a><a href=#__codelineno-3-140><span class=linenos data-linenos="140 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-141><a id=__codelineno-3-141 name=__codelineno-3-141></a><a href=#__codelineno-3-141><span class=linenos data-linenos="141 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-142><a id=__codelineno-3-142 name=__codelineno-3-142></a><a href=#__codelineno-3-142><span class=linenos data-linenos="142 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-143><a id=__codelineno-3-143 name=__codelineno-3-143></a><a href=#__codelineno-3-143><span class=linenos data-linenos="143 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2216</span><span class=p>,</span>
</span><span id=__span-3-144><a id=__codelineno-3-144 name=__codelineno-3-144></a><a href=#__codelineno-3-144><span class=linenos data-linenos="144 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=p>,</span>
</span><span id=__span-3-145><a id=__codelineno-3-145 name=__codelineno-3-145></a><a href=#__codelineno-3-145><span class=linenos data-linenos="145 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-146><a id=__codelineno-3-146 name=__codelineno-3-146></a><a href=#__codelineno-3-146><span class=linenos data-linenos="146 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-147><a id=__codelineno-3-147 name=__codelineno-3-147></a><a href=#__codelineno-3-147><span class=linenos data-linenos="147 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-148><a id=__codelineno-3-148 name=__codelineno-3-148></a><a href=#__codelineno-3-148><span class=linenos data-linenos="148 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-149><a id=__codelineno-3-149 name=__codelineno-3-149></a><a href=#__codelineno-3-149><span class=linenos data-linenos="149 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-150><a id=__codelineno-3-150 name=__codelineno-3-150></a><a href=#__codelineno-3-150><span class=linenos data-linenos="150 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-151><a id=__codelineno-3-151 name=__codelineno-3-151></a><a href=#__codelineno-3-151><span class=linenos data-linenos="151 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-152><a id=__codelineno-3-152 name=__codelineno-3-152></a><a href=#__codelineno-3-152><span class=linenos data-linenos="152 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-153><a id=__codelineno-3-153 name=__codelineno-3-153></a><a href=#__codelineno-3-153><span class=linenos data-linenos="153 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"efec7d1f247d4a9a9de10679e31186f0"</span><span class=p>,</span>
</span><span id=__span-3-154><a id=__codelineno-3-154 name=__codelineno-3-154></a><a href=#__codelineno-3-154><span class=linenos data-linenos="154 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-155><a id=__codelineno-3-155 name=__codelineno-3-155></a><a href=#__codelineno-3-155><span class=linenos data-linenos="155 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405499</span><span class=p>,</span>
</span><span id=__span-3-156><a id=__codelineno-3-156 name=__codelineno-3-156></a><a href=#__codelineno-3-156><span class=linenos data-linenos="156 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-157><a id=__codelineno-3-157 name=__codelineno-3-157></a><a href=#__codelineno-3-157><span class=linenos data-linenos="157 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-158><a id=__codelineno-3-158 name=__codelineno-3-158></a><a href=#__codelineno-3-158><span class=linenos data-linenos="158 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-159><a id=__codelineno-3-159 name=__codelineno-3-159></a><a href=#__codelineno-3-159><span class=linenos data-linenos="159 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-160><a id=__codelineno-3-160 name=__codelineno-3-160></a><a href=#__codelineno-3-160><span class=linenos data-linenos="160 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-161><a id=__codelineno-3-161 name=__codelineno-3-161></a><a href=#__codelineno-3-161><span class=linenos data-linenos="161 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-162><a id=__codelineno-3-162 name=__codelineno-3-162></a><a href=#__codelineno-3-162><span class=linenos data-linenos="162 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n"</span><span class=p>,</span>
</span><span id=__span-3-163><a id=__codelineno-3-163 name=__codelineno-3-163></a><a href=#__codelineno-3-163><span class=linenos data-linenos="163 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-164><a id=__codelineno-3-164 name=__codelineno-3-164></a><a href=#__codelineno-3-164><span class=linenos data-linenos="164 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-165><a id=__codelineno-3-165 name=__codelineno-3-165></a><a href=#__codelineno-3-165><span class=linenos data-linenos="165 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-166><a id=__codelineno-3-166 name=__codelineno-3-166></a><a href=#__codelineno-3-166><span class=linenos data-linenos="166 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-167><a id=__codelineno-3-167 name=__codelineno-3-167></a><a href=#__codelineno-3-167><span class=linenos data-linenos="167 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"abort"</span><span class=p>,</span>
</span><span id=__span-3-168><a id=__codelineno-3-168 name=__codelineno-3-168></a><a href=#__codelineno-3-168><span class=linenos data-linenos="168 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-169><a id=__codelineno-3-169 name=__codelineno-3-169></a><a href=#__codelineno-3-169><span class=linenos data-linenos="169 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-170><a id=__codelineno-3-170 name=__codelineno-3-170></a><a href=#__codelineno-3-170><span class=linenos data-linenos="170 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-171><a id=__codelineno-3-171 name=__codelineno-3-171></a><a href=#__codelineno-3-171><span class=linenos data-linenos="171 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-172><a id=__codelineno-3-172 name=__codelineno-3-172></a><a href=#__codelineno-3-172><span class=linenos data-linenos="172 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-173><a id=__codelineno-3-173 name=__codelineno-3-173></a><a href=#__codelineno-3-173><span class=linenos data-linenos="173 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2218</span><span class=p>,</span>
</span><span id=__span-3-174><a id=__codelineno-3-174 name=__codelineno-3-174></a><a href=#__codelineno-3-174><span class=linenos data-linenos="174 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>22</span><span class=p>,</span>
</span><span id=__span-3-175><a id=__codelineno-3-175 name=__codelineno-3-175></a><a href=#__codelineno-3-175><span class=linenos data-linenos="175 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-176><a id=__codelineno-3-176 name=__codelineno-3-176></a><a href=#__codelineno-3-176><span class=linenos data-linenos="176 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-177><a id=__codelineno-3-177 name=__codelineno-3-177></a><a href=#__codelineno-3-177><span class=linenos data-linenos="177 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-178><a id=__codelineno-3-178 name=__codelineno-3-178></a><a href=#__codelineno-3-178><span class=linenos data-linenos="178 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-179><a id=__codelineno-3-179 name=__codelineno-3-179></a><a href=#__codelineno-3-179><span class=linenos data-linenos="179 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-180><a id=__codelineno-3-180 name=__codelineno-3-180></a><a href=#__codelineno-3-180><span class=linenos data-linenos="180 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-181><a id=__codelineno-3-181 name=__codelineno-3-181></a><a href=#__codelineno-3-181><span class=linenos data-linenos="181 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-182><a id=__codelineno-3-182 name=__codelineno-3-182></a><a href=#__codelineno-3-182><span class=linenos data-linenos="182 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-183><a id=__codelineno-3-183 name=__codelineno-3-183></a><a href=#__codelineno-3-183><span class=linenos data-linenos="183 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"a482c6020a1941e993831b896f7f84df"</span><span class=p>,</span>
</span><span id=__span-3-184><a id=__codelineno-3-184 name=__codelineno-3-184></a><a href=#__codelineno-3-184><span class=linenos data-linenos="184 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-185><a id=__codelineno-3-185 name=__codelineno-3-185></a><a href=#__codelineno-3-185><span class=linenos data-linenos="185 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405499</span><span class=p>,</span>
</span><span id=__span-3-186><a id=__codelineno-3-186 name=__codelineno-3-186></a><a href=#__codelineno-3-186><span class=linenos data-linenos="186 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-187><a id=__codelineno-3-187 name=__codelineno-3-187></a><a href=#__codelineno-3-187><span class=linenos data-linenos="187 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-188><a id=__codelineno-3-188 name=__codelineno-3-188></a><a href=#__codelineno-3-188><span class=linenos data-linenos="188 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-189><a id=__codelineno-3-189 name=__codelineno-3-189></a><a href=#__codelineno-3-189><span class=linenos data-linenos="189 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-190><a id=__codelineno-3-190 name=__codelineno-3-190></a><a href=#__codelineno-3-190><span class=linenos data-linenos="190 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-191><a id=__codelineno-3-191 name=__codelineno-3-191></a><a href=#__codelineno-3-191><span class=linenos data-linenos="191 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-192><a id=__codelineno-3-192 name=__codelineno-3-192></a><a href=#__codelineno-3-192><span class=linenos data-linenos="192 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\":\n\": John :\"\n\n\n"</span><span class=p>,</span>
</span><span id=__span-3-193><a id=__codelineno-3-193 name=__codelineno-3-193></a><a href=#__codelineno-3-193><span class=linenos data-linenos="193 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-194><a id=__codelineno-3-194 name=__codelineno-3-194></a><a href=#__codelineno-3-194><span class=linenos data-linenos="194 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-195><a id=__codelineno-3-195 name=__codelineno-3-195></a><a href=#__codelineno-3-195><span class=linenos data-linenos="195 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-196><a id=__codelineno-3-196 name=__codelineno-3-196></a><a href=#__codelineno-3-196><span class=linenos data-linenos="196 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-197><a id=__codelineno-3-197 name=__codelineno-3-197></a><a href=#__codelineno-3-197><span class=linenos data-linenos="197 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"abort"</span><span class=p>,</span>
</span><span id=__span-3-198><a id=__codelineno-3-198 name=__codelineno-3-198></a><a href=#__codelineno-3-198><span class=linenos data-linenos="198 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-199><a id=__codelineno-3-199 name=__codelineno-3-199></a><a href=#__codelineno-3-199><span class=linenos data-linenos="199 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-200><a id=__codelineno-3-200 name=__codelineno-3-200></a><a href=#__codelineno-3-200><span class=linenos data-linenos="200 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-201><a id=__codelineno-3-201 name=__codelineno-3-201></a><a href=#__codelineno-3-201><span class=linenos data-linenos="201 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-202><a id=__codelineno-3-202 name=__codelineno-3-202></a><a href=#__codelineno-3-202><span class=linenos data-linenos="202 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-203><a id=__codelineno-3-203 name=__codelineno-3-203></a><a href=#__codelineno-3-203><span class=linenos data-linenos="203 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2210</span><span class=p>,</span>
</span><span id=__span-3-204><a id=__codelineno-3-204 name=__codelineno-3-204></a><a href=#__codelineno-3-204><span class=linenos data-linenos="204 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>14</span><span class=p>,</span>
</span><span id=__span-3-205><a id=__codelineno-3-205 name=__codelineno-3-205></a><a href=#__codelineno-3-205><span class=linenos data-linenos="205 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-206><a id=__codelineno-3-206 name=__codelineno-3-206></a><a href=#__codelineno-3-206><span class=linenos data-linenos="206 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-207><a id=__codelineno-3-207 name=__codelineno-3-207></a><a href=#__codelineno-3-207><span class=linenos data-linenos="207 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-208><a id=__codelineno-3-208 name=__codelineno-3-208></a><a href=#__codelineno-3-208><span class=linenos data-linenos="208 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-209><a id=__codelineno-3-209 name=__codelineno-3-209></a><a href=#__codelineno-3-209><span class=linenos data-linenos="209 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-210><a id=__codelineno-3-210 name=__codelineno-3-210></a><a href=#__codelineno-3-210><span class=linenos data-linenos="210 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-211><a id=__codelineno-3-211 name=__codelineno-3-211></a><a href=#__codelineno-3-211><span class=linenos data-linenos="211 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-212><a id=__codelineno-3-212 name=__codelineno-3-212></a><a href=#__codelineno-3-212><span class=linenos data-linenos="212 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-213><a id=__codelineno-3-213 name=__codelineno-3-213></a><a href=#__codelineno-3-213><span class=linenos data-linenos="213 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"8f8e886e238c4c00960563d666ea9fa2"</span><span class=p>,</span>
</span><span id=__span-3-214><a id=__codelineno-3-214 name=__codelineno-3-214></a><a href=#__codelineno-3-214><span class=linenos data-linenos="214 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-215><a id=__codelineno-3-215 name=__codelineno-3-215></a><a href=#__codelineno-3-215><span class=linenos data-linenos="215 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405499</span><span class=p>,</span>
</span><span id=__span-3-216><a id=__codelineno-3-216 name=__codelineno-3-216></a><a href=#__codelineno-3-216><span class=linenos data-linenos="216 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-217><a id=__codelineno-3-217 name=__codelineno-3-217></a><a href=#__codelineno-3-217><span class=linenos data-linenos="217 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-218><a id=__codelineno-3-218 name=__codelineno-3-218></a><a href=#__codelineno-3-218><span class=linenos data-linenos="218 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-219><a id=__codelineno-3-219 name=__codelineno-3-219></a><a href=#__codelineno-3-219><span class=linenos data-linenos="219 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-220><a id=__codelineno-3-220 name=__codelineno-3-220></a><a href=#__codelineno-3-220><span class=linenos data-linenos="220 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-221><a id=__codelineno-3-221 name=__codelineno-3-221></a><a href=#__codelineno-3-221><span class=linenos data-linenos="221 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-222><a id=__codelineno-3-222 name=__codelineno-3-222></a><a href=#__codelineno-3-222><span class=linenos data-linenos="222 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\"\n\n\n\n\n\n\n\n\n\n\n\n"</span><span class=p>,</span>
</span><span id=__span-3-223><a id=__codelineno-3-223 name=__codelineno-3-223></a><a href=#__codelineno-3-223><span class=linenos data-linenos="223 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-224><a id=__codelineno-3-224 name=__codelineno-3-224></a><a href=#__codelineno-3-224><span class=linenos data-linenos="224 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-225><a id=__codelineno-3-225 name=__codelineno-3-225></a><a href=#__codelineno-3-225><span class=linenos data-linenos="225 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-226><a id=__codelineno-3-226 name=__codelineno-3-226></a><a href=#__codelineno-3-226><span class=linenos data-linenos="226 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-227><a id=__codelineno-3-227 name=__codelineno-3-227></a><a href=#__codelineno-3-227><span class=linenos data-linenos="227 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"abort"</span><span class=p>,</span>
</span><span id=__span-3-228><a id=__codelineno-3-228 name=__codelineno-3-228></a><a href=#__codelineno-3-228><span class=linenos data-linenos="228 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-229><a id=__codelineno-3-229 name=__codelineno-3-229></a><a href=#__codelineno-3-229><span class=linenos data-linenos="229 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-230><a id=__codelineno-3-230 name=__codelineno-3-230></a><a href=#__codelineno-3-230><span class=linenos data-linenos="230 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-231><a id=__codelineno-3-231 name=__codelineno-3-231></a><a href=#__codelineno-3-231><span class=linenos data-linenos="231 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-232><a id=__codelineno-3-232 name=__codelineno-3-232></a><a href=#__codelineno-3-232><span class=linenos data-linenos="232 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-233><a id=__codelineno-3-233 name=__codelineno-3-233></a><a href=#__codelineno-3-233><span class=linenos data-linenos="233 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2216</span><span class=p>,</span>
</span><span id=__span-3-234><a id=__codelineno-3-234 name=__codelineno-3-234></a><a href=#__codelineno-3-234><span class=linenos data-linenos="234 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=p>,</span>
</span><span id=__span-3-235><a id=__codelineno-3-235 name=__codelineno-3-235></a><a href=#__codelineno-3-235><span class=linenos data-linenos="235 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-236><a id=__codelineno-3-236 name=__codelineno-3-236></a><a href=#__codelineno-3-236><span class=linenos data-linenos="236 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-237><a id=__codelineno-3-237 name=__codelineno-3-237></a><a href=#__codelineno-3-237><span class=linenos data-linenos="237 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-238><a id=__codelineno-3-238 name=__codelineno-3-238></a><a href=#__codelineno-3-238><span class=linenos data-linenos="238 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-239><a id=__codelineno-3-239 name=__codelineno-3-239></a><a href=#__codelineno-3-239><span class=linenos data-linenos="239 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-240><a id=__codelineno-3-240 name=__codelineno-3-240></a><a href=#__codelineno-3-240><span class=linenos data-linenos="240 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-241><a id=__codelineno-3-241 name=__codelineno-3-241></a><a href=#__codelineno-3-241><span class=linenos data-linenos="241 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-242><a id=__codelineno-3-242 name=__codelineno-3-242></a><a href=#__codelineno-3-242><span class=linenos data-linenos="242 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-243><a id=__codelineno-3-243 name=__codelineno-3-243></a><a href=#__codelineno-3-243><span class=linenos data-linenos="243 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"41ae0850c66b4728a9550d1b0f0da787"</span><span class=p>,</span>
</span><span id=__span-3-244><a id=__codelineno-3-244 name=__codelineno-3-244></a><a href=#__codelineno-3-244><span class=linenos data-linenos="244 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-245><a id=__codelineno-3-245 name=__codelineno-3-245></a><a href=#__codelineno-3-245><span class=linenos data-linenos="245 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405499</span><span class=p>,</span>
</span><span id=__span-3-246><a id=__codelineno-3-246 name=__codelineno-3-246></a><a href=#__codelineno-3-246><span class=linenos data-linenos="246 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-247><a id=__codelineno-3-247 name=__codelineno-3-247></a><a href=#__codelineno-3-247><span class=linenos data-linenos="247 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-248><a id=__codelineno-3-248 name=__codelineno-3-248></a><a href=#__codelineno-3-248><span class=linenos data-linenos="248 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-249><a id=__codelineno-3-249 name=__codelineno-3-249></a><a href=#__codelineno-3-249><span class=linenos data-linenos="249 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-250><a id=__codelineno-3-250 name=__codelineno-3-250></a><a href=#__codelineno-3-250><span class=linenos data-linenos="250 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-251><a id=__codelineno-3-251 name=__codelineno-3-251></a><a href=#__codelineno-3-251><span class=linenos data-linenos="251 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-252><a id=__codelineno-3-252 name=__codelineno-3-252></a><a href=#__codelineno-3-252><span class=linenos data-linenos="252 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"</span><span class=p>,</span>
</span><span id=__span-3-253><a id=__codelineno-3-253 name=__codelineno-3-253></a><a href=#__codelineno-3-253><span class=linenos data-linenos="253 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-254><a id=__codelineno-3-254 name=__codelineno-3-254></a><a href=#__codelineno-3-254><span class=linenos data-linenos="254 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-255><a id=__codelineno-3-255 name=__codelineno-3-255></a><a href=#__codelineno-3-255><span class=linenos data-linenos="255 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-256><a id=__codelineno-3-256 name=__codelineno-3-256></a><a href=#__codelineno-3-256><span class=linenos data-linenos="256 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-257><a id=__codelineno-3-257 name=__codelineno-3-257></a><a href=#__codelineno-3-257><span class=linenos data-linenos="257 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"abort"</span><span class=p>,</span>
</span><span id=__span-3-258><a id=__codelineno-3-258 name=__codelineno-3-258></a><a href=#__codelineno-3-258><span class=linenos data-linenos="258 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-259><a id=__codelineno-3-259 name=__codelineno-3-259></a><a href=#__codelineno-3-259><span class=linenos data-linenos="259 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-260><a id=__codelineno-3-260 name=__codelineno-3-260></a><a href=#__codelineno-3-260><span class=linenos data-linenos="260 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-261><a id=__codelineno-3-261 name=__codelineno-3-261></a><a href=#__codelineno-3-261><span class=linenos data-linenos="261 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-262><a id=__codelineno-3-262 name=__codelineno-3-262></a><a href=#__codelineno-3-262><span class=linenos data-linenos="262 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-263><a id=__codelineno-3-263 name=__codelineno-3-263></a><a href=#__codelineno-3-263><span class=linenos data-linenos="263 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2221</span><span class=p>,</span>
</span><span id=__span-3-264><a id=__codelineno-3-264 name=__codelineno-3-264></a><a href=#__codelineno-3-264><span class=linenos data-linenos="264 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>25</span><span class=p>,</span>
</span><span id=__span-3-265><a id=__codelineno-3-265 name=__codelineno-3-265></a><a href=#__codelineno-3-265><span class=linenos data-linenos="265 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-266><a id=__codelineno-3-266 name=__codelineno-3-266></a><a href=#__codelineno-3-266><span class=linenos data-linenos="266 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-267><a id=__codelineno-3-267 name=__codelineno-3-267></a><a href=#__codelineno-3-267><span class=linenos data-linenos="267 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-268><a id=__codelineno-3-268 name=__codelineno-3-268></a><a href=#__codelineno-3-268><span class=linenos data-linenos="268 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-269><a id=__codelineno-3-269 name=__codelineno-3-269></a><a href=#__codelineno-3-269><span class=linenos data-linenos="269 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-270><a id=__codelineno-3-270 name=__codelineno-3-270></a><a href=#__codelineno-3-270><span class=linenos data-linenos="270 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-271><a id=__codelineno-3-271 name=__codelineno-3-271></a><a href=#__codelineno-3-271><span class=linenos data-linenos="271 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-3-272><a id=__codelineno-3-272 name=__codelineno-3-272></a><a href=#__codelineno-3-272><span class=linenos data-linenos="272 "></span></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-3-273><a id=__codelineno-3-273 name=__codelineno-3-273></a><a href=#__codelineno-3-273><span class=linenos data-linenos="273 "></span></a><span class=w>    </span><span class=nt>"id"</span><span class=p>:</span><span class=w> </span><span class=s2>"9c3719b8e1304d3d8ba4bc754596a7b6"</span><span class=p>,</span>
</span><span id=__span-3-274><a id=__codelineno-3-274 name=__codelineno-3-274></a><a href=#__codelineno-3-274><span class=linenos data-linenos="274 "></span></a><span class=w>    </span><span class=nt>"object"</span><span class=p>:</span><span class=w> </span><span class=s2>"chat.completion"</span><span class=p>,</span>
</span><span id=__span-3-275><a id=__codelineno-3-275 name=__codelineno-3-275></a><a href=#__codelineno-3-275><span class=linenos data-linenos="275 "></span></a><span class=w>    </span><span class=nt>"created"</span><span class=p>:</span><span class=w> </span><span class=mi>1766405499</span><span class=p>,</span>
</span><span id=__span-3-276><a id=__codelineno-3-276 name=__codelineno-3-276></a><a href=#__codelineno-3-276><span class=linenos data-linenos="276 "></span></a><span class=w>    </span><span class=nt>"model"</span><span class=p>:</span><span class=w> </span><span class=s2>"meta-llama/Llama-2-7b-chat-hf"</span><span class=p>,</span>
</span><span id=__span-3-277><a id=__codelineno-3-277 name=__codelineno-3-277></a><a href=#__codelineno-3-277><span class=linenos data-linenos="277 "></span></a><span class=w>    </span><span class=nt>"choices"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-278><a id=__codelineno-3-278 name=__codelineno-3-278></a><a href=#__codelineno-3-278><span class=linenos data-linenos="278 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-3-279><a id=__codelineno-3-279 name=__codelineno-3-279></a><a href=#__codelineno-3-279><span class=linenos data-linenos="279 "></span></a><span class=w>        </span><span class=nt>"index"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-3-280><a id=__codelineno-3-280 name=__codelineno-3-280></a><a href=#__codelineno-3-280><span class=linenos data-linenos="280 "></span></a><span class=w>        </span><span class=nt>"message"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-281><a id=__codelineno-3-281 name=__codelineno-3-281></a><a href=#__codelineno-3-281><span class=linenos data-linenos="281 "></span></a><span class=w>          </span><span class=nt>"role"</span><span class=p>:</span><span class=w> </span><span class=s2>"assistant"</span><span class=p>,</span>
</span><span id=__span-3-282><a id=__codelineno-3-282 name=__codelineno-3-282></a><a href=#__codelineno-3-282><span class=linenos data-linenos="282 "></span></a><span class=w>          </span><span class=nt>"content"</span><span class=p>:</span><span class=w> </span><span class=s2>"{\n\"name\": \"John Doe\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"</span><span class=p>,</span>
</span><span id=__span-3-283><a id=__codelineno-3-283 name=__codelineno-3-283></a><a href=#__codelineno-3-283><span class=linenos data-linenos="283 "></span></a><span class=w>          </span><span class=nt>"reasoning_content"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-284><a id=__codelineno-3-284 name=__codelineno-3-284></a><a href=#__codelineno-3-284><span class=linenos data-linenos="284 "></span></a><span class=w>          </span><span class=nt>"tool_calls"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-285><a id=__codelineno-3-285 name=__codelineno-3-285></a><a href=#__codelineno-3-285><span class=linenos data-linenos="285 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-3-286><a id=__codelineno-3-286 name=__codelineno-3-286></a><a href=#__codelineno-3-286><span class=linenos data-linenos="286 "></span></a><span class=w>        </span><span class=nt>"logprobs"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-287><a id=__codelineno-3-287 name=__codelineno-3-287></a><a href=#__codelineno-3-287><span class=linenos data-linenos="287 "></span></a><span class=w>        </span><span class=nt>"finish_reason"</span><span class=p>:</span><span class=w> </span><span class=s2>"abort"</span><span class=p>,</span>
</span><span id=__span-3-288><a id=__codelineno-3-288 name=__codelineno-3-288></a><a href=#__codelineno-3-288><span class=linenos data-linenos="288 "></span></a><span class=w>        </span><span class=nt>"matched_stop"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-3-289><a id=__codelineno-3-289 name=__codelineno-3-289></a><a href=#__codelineno-3-289><span class=linenos data-linenos="289 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-3-290><a id=__codelineno-3-290 name=__codelineno-3-290></a><a href=#__codelineno-3-290><span class=linenos data-linenos="290 "></span></a><span class=w>    </span><span class=p>],</span>
</span><span id=__span-3-291><a id=__codelineno-3-291 name=__codelineno-3-291></a><a href=#__codelineno-3-291><span class=linenos data-linenos="291 "></span></a><span class=w>    </span><span class=nt>"usage"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-292><a id=__codelineno-3-292 name=__codelineno-3-292></a><a href=#__codelineno-3-292><span class=linenos data-linenos="292 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2196</span><span class=p>,</span>
</span><span id=__span-3-293><a id=__codelineno-3-293 name=__codelineno-3-293></a><a href=#__codelineno-3-293><span class=linenos data-linenos="293 "></span></a><span class=w>      </span><span class=nt>"total_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>2223</span><span class=p>,</span>
</span><span id=__span-3-294><a id=__codelineno-3-294 name=__codelineno-3-294></a><a href=#__codelineno-3-294><span class=linenos data-linenos="294 "></span></a><span class=w>      </span><span class=nt>"completion_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>27</span><span class=p>,</span>
</span><span id=__span-3-295><a id=__codelineno-3-295 name=__codelineno-3-295></a><a href=#__codelineno-3-295><span class=linenos data-linenos="295 "></span></a><span class=w>      </span><span class=nt>"prompt_tokens_details"</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
</span><span id=__span-3-296><a id=__codelineno-3-296 name=__codelineno-3-296></a><a href=#__codelineno-3-296><span class=linenos data-linenos="296 "></span></a><span class=w>      </span><span class=nt>"reasoning_tokens"</span><span class=p>:</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-3-297><a id=__codelineno-3-297 name=__codelineno-3-297></a><a href=#__codelineno-3-297><span class=linenos data-linenos="297 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-3-298><a id=__codelineno-3-298 name=__codelineno-3-298></a><a href=#__codelineno-3-298><span class=linenos data-linenos="298 "></span></a><span class=w>    </span><span class=nt>"metadata"</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-299><a id=__codelineno-3-299 name=__codelineno-3-299></a><a href=#__codelineno-3-299><span class=linenos data-linenos="299 "></span></a><span class=w>      </span><span class=nt>"weight_version"</span><span class=p>:</span><span class=w> </span><span class=s2>"default"</span>
</span><span id=__span-3-300><a id=__codelineno-3-300 name=__codelineno-3-300></a><a href=#__codelineno-3-300><span class=linenos data-linenos="300 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-301><a id=__codelineno-3-301 name=__codelineno-3-301></a><a href=#__codelineno-3-301><span class=linenos data-linenos="301 "></span></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-3-302><a id=__codelineno-3-302 name=__codelineno-3-302></a><a href=#__codelineno-3-302><span class=linenos data-linenos="302 "></span></a><span class=p>]</span>
</span></code></pre></div> <ul> <li>并发量变大时，比如 1s 内发送 10 个请求，基本上大量请求会在进行 grammar accept_token() 时直接 abort，造成最后的结果出现问题</li> <li> <p>在处理 prefill 生成的结果，准备推进 json grammar 的时候，accept_token() 发现 next_token_id 是 INVALID 的，直接将该请求 abort</p> <div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a><a href=#__codelineno-4-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>process_batch_result_prefill</span><span class=p>(</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a><a href=#__codelineno-4-2><span class=linenos data-linenos=" 2 "></span></a><span class=n>_self_</span><span class=p>:</span> <span class=n>Scheduler</span><span class=p>,</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a><a href=#__codelineno-4-3><span class=linenos data-linenos=" 3 "></span></a><span class=n>_batch_</span><span class=p>:</span> <span class=n>ScheduleBatch</span><span class=p>,</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4></a><a href=#__codelineno-4-4><span class=linenos data-linenos=" 4 "></span></a><span class=n>_result_</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>GenerationBatchResult</span><span class=p>,</span> <span class=n>EmbeddingBatchResult</span><span class=p>],</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5></a><a href=#__codelineno-4-5><span class=linenos data-linenos=" 5 "></span></a><span class=p>):</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6></a><a href=#__codelineno-4-6><span class=linenos data-linenos=" 6 "></span></a><span class=o>...</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7></a><a href=#__codelineno-4-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>if</span> <span class=n>req</span><span class=o>.</span><span class=n>grammar</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8></a><a href=#__codelineno-4-8><span class=linenos data-linenos=" 8 "></span></a><span class=c1># FIXME: this try-except block is for handling unexpected xgrammar issue.</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9></a><a href=#__codelineno-4-9><span class=linenos data-linenos=" 9 "></span></a><span class=k>try</span><span class=p>:</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10></a><a href=#__codelineno-4-10><span class=linenos data-linenos="10 "></span></a><span class=n>req</span><span class=o>.</span><span class=n>grammar</span><span class=o>.</span><span class=n>accept_token</span><span class=p>(</span><span class=n>next_token_id</span><span class=p>)</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11></a><a href=#__codelineno-4-11><span class=linenos data-linenos="11 "></span></a><span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12></a><a href=#__codelineno-4-12><span class=linenos data-linenos="12 "></span></a><span class=c1># Grammar accept_token can raise ValueError if the token is not in the grammar.</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13></a><a href=#__codelineno-4-13><span class=linenos data-linenos="13 "></span></a><span class=c1># This can happen if the grammar is not set correctly or the token is invalid.</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14></a><a href=#__codelineno-4-14><span class=linenos data-linenos="14 "></span></a><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15></a><a href=#__codelineno-4-15><span class=linenos data-linenos="15 "></span></a><span class=sa>f</span><span class=s2>"Grammar accept_token failed for req </span><span class=si>{</span><span class=n>req</span><span class=o>.</span><span class=n>rid</span><span class=si>}</span><span class=s2> with token </span><span class=si>{</span><span class=n>next_token_id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16></a><a href=#__codelineno-4-16><span class=linenos data-linenos="16 "></span></a><span class=p>)</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17></a><a href=#__codelineno-4-17><span class=linenos data-linenos="17 "></span></a><span class=n>_self_</span><span class=o>.</span><span class=n>abort_request</span><span class=p>(</span><span class=n>AbortReq</span><span class=p>(</span><span class=n>_rid_</span><span class=o>=</span><span class=n>req</span><span class=o>.</span><span class=n>rid</span><span class=p>))</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18></a><a href=#__codelineno-4-18><span class=linenos data-linenos="18 "></span></a><span class=n>req</span><span class=o>.</span><span class=n>grammar</span><span class=o>.</span><span class=n>finished</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=n>finished</span><span class=p>()</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19></a><a href=#__codelineno-4-19><span class=linenos data-linenos="19 "></span></a><span class=o>...</span>
</span></code></pre></div> </li> </ul> <h2 id=overlap-speculative-decoding-constrained-decoding>优化 Overlap: speculative decoding + constrained decoding<a class=headerlink href=#overlap-speculative-decoding-constrained-decoding title="Permanent link">¶</a></h2> <h3 id=overview_1>Overview<a class=headerlink href=#overview_1 title="Permanent link">¶</a></h3> <p>优化后的调度逻辑如下图所示：</p> <ul> <li> <p>我们将 GPU 到 CPU 的 verify input 拷贝使用异步拷贝</p> </li> <li> <p>之前的 constraint decoding + speculative decoding 是没有进行调度侧的 overlap 的；这里我们在 GPU 进行 target verify 的同时，处理 last batch 的 accept tokens</p> </li> <li> <p>Target sample 依赖 cpu 生成的 vocab mask，这里使用 .to(device) 进行同步</p> </li> </ul> <p><a class=glightbox data-type=image data-width=80% data-height=auto href=../static/Si4pbiIAqoOIbJxhwedcdsxNnHf.png data-desc-position=bottom><img alt src=../static/Si4pbiIAqoOIbJxhwedcdsxNnHf.png></a></p> <h3 id=implementation>Implementation<a class=headerlink href=#implementation title="Permanent link">¶</a></h3> <ul> <li> <p>ScheduleBatch 中维护一个 (request, accepted_token_ids) 的 list，存放 last batch 还未经过 grammar 处理的 accept_tokens</p> </li> <li> <p>event_loop_overlap 中 current batch 中携带 last batch 的 accept_tokens</p> </li> </ul> <div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1></a><a href=#__codelineno-5-1><span class=linenos data-linenos="1 "></span></a><span class=n>last_batch</span><span class=p>,</span> <span class=n>last_result</span> <span class=o>=</span> <span class=n>_self_</span><span class=o>.</span><span class=n>result_queue</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2></a><a href=#__codelineno-5-2><span class=linenos data-linenos="2 "></span></a><span class=c1># here batch is copied, so has_grammar need also as a param</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3></a><a href=#__codelineno-5-3><span class=linenos data-linenos="3 "></span></a><span class=k>if</span> <span class=n>last_batch</span><span class=o>.</span><span class=n>has_grammar</span><span class=p>:</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4></a><a href=#__codelineno-5-4><span class=linenos data-linenos="4 "></span></a>    <span class=n>batch</span><span class=o>.</span><span class=n>last_batch_accept_tokens</span> <span class=o>=</span> <span class=p>(</span><span class=n>last_batch</span><span class=p>,</span> <span class=n>last_result</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5></a><a href=#__codelineno-5-5><span class=linenos data-linenos="5 "></span></a>    <span class=c1># Mark that grammar accept will be processed in the next batch's verify</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6></a><a href=#__codelineno-5-6><span class=linenos data-linenos="6 "></span></a>    <span class=n>last_result</span><span class=o>.</span><span class=n>grammar_accept_processed</span> <span class=o>=</span> <span class=kc>True</span>
</span></code></pre></div> <ul> <li>Verify()</li> <li>GPU 到 CPU 的 verify input 的拷贝用异步拷贝</li> <li>GPU 进行 Target Verify 的同时，CPU 对上一轮的 grammar accept token 进行处理</li> <li>CPU 等待 verify input 拷贝完成后生成本轮的 vocab mask，然后同步到 GPU 上准备进行 Target Sample</li> </ul> <h3 id=json-unit-test-result>JSON Unit Test Result<a class=headerlink href=#json-unit-test-result title="Permanent link">¶</a></h3> <div class="language-shell highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1></a><a href=#__codelineno-6-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># no overlap</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2></a><a href=#__codelineno-6-2><span class=linenos data-linenos=" 2 "></span></a><span class=o>[</span><span class=m>2025</span>-12-23<span class=w> </span><span class=m>13</span>:20:02<span class=o>]</span><span class=w> </span>Test:<span class=w> </span>test_json_generate<span class=w> </span><span class=p>|</span><span class=w> </span>Duration:<span class=w> </span><span class=m>0</span>.8557s<span class=w> </span><span class=p>|</span><span class=w> </span>Status:<span class=w> </span>PASSED
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3></a><a href=#__codelineno-6-3><span class=linenos data-linenos=" 3 "></span></a><span class=o>[</span><span class=m>2025</span>-12-23<span class=w> </span><span class=m>13</span>:20:03<span class=o>]</span><span class=w> </span>Test:<span class=w> </span>test_json_openai<span class=w> </span><span class=p>|</span><span class=w> </span>Duration:<span class=w> </span><span class=m>0</span>.4455s<span class=w> </span><span class=p>|</span><span class=w> </span>Status:<span class=w> </span>PASSED
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4></a><a href=#__codelineno-6-4><span class=linenos data-linenos=" 4 "></span></a><span class=o>[</span><span class=m>2025</span>-12-23<span class=w> </span><span class=m>13</span>:20:04<span class=o>]</span><span class=w> </span>Test:<span class=w> </span>test_mix_json_and_other<span class=w> </span><span class=p>|</span><span class=w> </span>Duration:<span class=w> </span><span class=m>0</span>.6386s<span class=w> </span><span class=p>|</span><span class=w> </span>Status:<span class=w> </span>PASSED
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5></a><a href=#__codelineno-6-5><span class=linenos data-linenos=" 5 "></span></a>D
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6></a><a href=#__codelineno-6-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7></a><a href=#__codelineno-6-7><span class=linenos data-linenos=" 7 "></span></a><span class=c1># overlap with double sync mask</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8></a><a href=#__codelineno-6-8><span class=linenos data-linenos=" 8 "></span></a><span class=o>[</span><span class=m>2025</span>-12-23<span class=w> </span><span class=m>13</span>:20:47<span class=o>]</span><span class=w> </span>Test:<span class=w> </span>test_json_generate<span class=w> </span><span class=p>|</span><span class=w> </span>Duration:<span class=w> </span><span class=m>0</span>.7296s<span class=w> </span><span class=p>|</span><span class=w> </span>Status:<span class=w> </span>PASSED
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9></a><a href=#__codelineno-6-9><span class=linenos data-linenos=" 9 "></span></a><span class=o>[</span><span class=m>2025</span>-12-23<span class=w> </span><span class=m>13</span>:20:47<span class=o>]</span><span class=w> </span>Test:<span class=w> </span>test_json_openai<span class=w> </span><span class=p>|</span><span class=w> </span>Duration:<span class=w> </span><span class=m>0</span>.2549s<span class=w> </span><span class=p>|</span><span class=w> </span>Status:<span class=w> </span>PASSED
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10></a><a href=#__codelineno-6-10><span class=linenos data-linenos="10 "></span></a><span class=o>[</span><span class=m>2025</span>-12-23<span class=w> </span><span class=m>13</span>:20:48<span class=o>]</span><span class=w> </span>Test:<span class=w> </span>test_mix_json_and_other<span class=w> </span><span class=p>|</span><span class=w> </span>Duration:<span class=w> </span><span class=m>0</span>.5623s<span class=w> </span><span class=p>|</span><span class=w> </span>Status:<span class=w> </span>PASSED
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11></a><a href=#__codelineno-6-11><span class=linenos data-linenos="11 "></span></a>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12></a><a href=#__codelineno-6-12><span class=linenos data-linenos="12 "></span></a><span class=c1># overlap with once sync mask</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13></a><a href=#__codelineno-6-13><span class=linenos data-linenos="13 "></span></a><span class=o>[</span><span class=m>2025</span>-12-23<span class=w> </span><span class=m>14</span>:18:26<span class=o>]</span><span class=w> </span>Test:<span class=w> </span>test_json_generate<span class=w> </span><span class=p>|</span><span class=w> </span>Duration:<span class=w> </span><span class=m>0</span>.6687s<span class=w> </span><span class=p>|</span><span class=w> </span>Status:<span class=w> </span>PASSED
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14></a><a href=#__codelineno-6-14><span class=linenos data-linenos="14 "></span></a><span class=o>[</span><span class=m>2025</span>-12-23<span class=w> </span><span class=m>14</span>:18:27<span class=o>]</span><span class=w> </span>Test:<span class=w> </span>test_json_openai<span class=w> </span><span class=p>|</span><span class=w> </span>Duration:<span class=w> </span><span class=m>0</span>.3861s<span class=w> </span><span class=p>|</span><span class=w> </span>Status:<span class=w> </span>PASSED
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15></a><a href=#__codelineno-6-15><span class=linenos data-linenos="15 "></span></a><span class=o>[</span><span class=m>2025</span>-12-23<span class=w> </span><span class=m>14</span>:18:27<span class=o>]</span><span class=w> </span>Test:<span class=w> </span>test_mix_json_and_other<span class=w> </span><span class=p>|</span><span class=w> </span>Duration:<span class=w> </span><span class=m>0</span>.5468s<span class=w> </span><span class=p>|</span><span class=w> </span>Status:<span class=w> </span>PASSED
</span></code></pre></div> <h3 id=benchmark-resultbs-4>Benchmark Result(bs = 4)<a class=headerlink href=#benchmark-resultbs-4 title="Permanent link">¶</a></h3> <h4 id=hiding-cpu-overhead>Hiding CPU Overhead<a class=headerlink href=#hiding-cpu-overhead title="Permanent link">¶</a></h4> <ul> <li>TPOT (Time Per Output Token) 从 <strong>4.07ms 降低到了 3.22ms</strong>，降幅超过 20%。</li> </ul> <h4 id=accept-length>Accept Length 提升<a class=headerlink href=#accept-length title="Permanent link">¶</a></h4> <ul> <li>Accept Length 从 <strong>2.59 提升到了 2.9</strong>。</li> <li>很神奇，正常不应该有 accept length 增长这么多的情况，因为使用相同的模型</li> </ul> <h4 id=ttft>首字延迟 (TTFT) 微增<a class=headerlink href=#ttft title="Permanent link">¶</a></h4> <ul> <li>TTFT 从 <strong>21ms 增加到了 27ms</strong>。</li> <li>Overlap 流水线通常需要更复杂的初始化过程（例如预分配更复杂的 Cuda Event、建立 Pending Info 结构、预热流水线状态）。</li> <li>第一轮 Draft/Verify 往往无法享受到 overlap 的红利（因为没有上一轮），反而承担了额外的调度逻辑开销。</li> </ul> <h3 id=gsm8k>GSM8K<a class=headerlink href=#gsm8k title="Permanent link">¶</a></h3> <div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1></a><a href=#__codelineno-7-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># No overlap</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2></a><a href=#__codelineno-7-2><span class=linenos data-linenos=" 2 "></span></a><span class="l l-Scalar l-Scalar-Plain">python3 benchmark/gsm8k/bench_sglang.py --num-shots 8 --num-questions 1319 --parallel 1319</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3></a><a href=#__codelineno-7-3><span class=linenos data-linenos=" 3 "></span></a><span class="l l-Scalar l-Scalar-Plain">Accuracy</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.232</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4></a><a href=#__codelineno-7-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>Invalid</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.003</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5></a><a href=#__codelineno-7-5><span class=linenos data-linenos=" 5 "></span></a><span class=nt>Latency</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">44.037 s</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6></a><a href=#__codelineno-7-6><span class=linenos data-linenos=" 6 "></span></a><span class=nt>Output throughput</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3763.649 token/s</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7></a><a href=#__codelineno-7-7><span class=linenos data-linenos=" 7 "></span></a>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8></a><a href=#__codelineno-7-8><span class=linenos data-linenos=" 8 "></span></a><span class=c1># Overlap</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9></a><a href=#__codelineno-7-9><span class=linenos data-linenos=" 9 "></span></a><span class="l l-Scalar l-Scalar-Plain">python3 benchmark/gsm8k/bench_sglang.py --num-shots 8 --num-questions 1319 --parallel 1319</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10></a><a href=#__codelineno-7-10><span class=linenos data-linenos="10 "></span></a><span class=nt>Accuracy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.230</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11></a><a href=#__codelineno-7-11><span class=linenos data-linenos="11 "></span></a><span class=nt>Invalid</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.003</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12></a><a href=#__codelineno-7-12><span class=linenos data-linenos="12 "></span></a><span class=nt>Latency</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">36.554 s</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13></a><a href=#__codelineno-7-13><span class=linenos data-linenos="13 "></span></a><span class=nt>Output throughput</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4559.657 token/s</span>
</span></code></pre></div> <h2 id=reference><strong>Reference</strong><a class=headerlink href=#reference title="Permanent link">¶</a></h2> <p>[1]. <a href=https://arxiv.org/pdf/2405.00263>Clover: Regressive Lightweight Speculative Decoding with Sequential Knowledge</a></p> <p>[2]. <a href=https://arxiv.org/abs/2211.17192>Fast Inference from Transformers via Speculative Decoding</a></p> <p>[3]. <a href=https://arxiv.org/pdf/2312.12728>Lookahead: An Inference Acceleration Framework for Large Language Model with Lossless Generation Accuracy</a></p> <p>[4]. <a href=https://arxiv.org/abs/2401.10774>Medusa: Simple LLM Inference Acceleration Framework with Multiple Decoding Heads</a></p> <p>[5]. <a href=https://arxiv.org/abs/2401.15077>EAGLE: Speculative Sampling Requires Rethinking Feature Uncertainty</a></p> <p>[6]. <a href=https://arxiv.org/abs/2406.16858>EAGLE-2: Faster Inference of Language Models with Dynamic Draft Trees</a></p> <p>[7]. <a href=https://arxiv.org/abs/2503.01840>EAGLE-3: Scaling up Inference Acceleration of Large Language Models via Training-Time Test</a></p> <p>[8]. <a href="https://docs.google.com/presentation/d/1iD0ud3Otd1VbB4Q-G7_UQDFgRfVrIEQr3XDyKkcy-xc/edit?slide=id.p#slide=id.p">Speculative Decoding Slides</a></p> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Support Me! </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="Support Me!" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M96 400c-17.7 0-32 14.3-32 32v48c0 17.7 14.3 32 32 32h224c17.7 0 32-14.3 32-32v-48c0-17.7-14.3-32-32-32zm-22.8-48h64.6l-79.5-88.3c-6.6-7.4-10.3-16.9-10.3-26.8V204c0-16.1 11.9-29.5 27.4-31.7 11.8-1.7 20.6-11.8 20.6-23.8V72c0-13.3 10.7-24 24-24 7.2 0 13.6 3.1 18 8.1 4.6 5.2 11.1 8.1 18 8.1s13.4-3 18-8.1c4.4-5 10.8-8.1 18-8.1 8.5 0 15.9 4.4 20.2 11.1 6.9 10.7 20.9 14.2 32 8 3.5-1.9 7.4-3.1 11.8-3.1 10.6 0 19.7 6.9 22.8 16.6 3.8 11.7 15.9 18.7 28 16 1.7-.4 3.4-.6 5.2-.6 13.3 0 24 10.7 24 24v92.2c0 14.4-3.5 28.5-10.2 41.2L273.6 352h54.3l40.3-76.2c10.4-19.6 15.8-41.5 15.8-63.6V120c0-38.4-30.1-69.8-68.1-71.9C303 28.8 281 16 256 16c-5.7 0-11.2.7-16.5 1.9C226.8 6.8 210.2 0 192 0c-13.1 0-25.4 3.5-36 9.6C145.4 3.5 133.1 0 120 0 80.2 0 48 32.2 48 72v58.7C19.7 143 0 171.2 0 204v32.9c0 21.7 8 42.7 22.6 58.9z"></path></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> <center> 难道说……你愿意给我买一瓶快乐水吗！🫣 </center> <center> How about...buy me a coffee？😋 </center> <img src=/img/wechat.png width=200px> </div> </div> </div> </fieldset> </form> <!-- Insert generated snippet here --> <script src=https://giscus.app/client.js data-repo=tom-jerr/tom-jerr.github.io data-repo-id=R_kgDONZrjcA data-category=Announcements data-category-id=DIC_kwDONZrjcM4Ck-PT data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async>
    </script> <!-- Synchronize Giscus theme with palette --> <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

        // Instruct Giscus to set theme
        giscus.setAttribute("data-theme", theme)
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function () {
        var ref = document.querySelector("[data-md-component=palette]")
        ref.addEventListener("change", function () {
            var palette = __md_get("__palette")
            if (palette && typeof palette.color === "object") {
                var theme = palette.color.scheme === "slate"
                    ? "transparent_dark"
                    : "light"

                // Instruct Giscus to change theme
                var frame = document.querySelector(".giscus-frame")
                frame.contentWindow.postMessage(
                    {giscus: {setConfig: {theme}}},
                    "https://giscus.app"
                )
            }
        })
    })
</script> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <!-- Application footer --> <footer class=md-footer> <!-- Link to previous and/or next page --> <!-- Website statistics --> <div class=md-footer-stats> <div class="md-footer-stats__inner md-grid"> <div class=md-footer-stats__content> <span class=md-footer-stats__item> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24" width=16 height=16 style="vertical-align: middle; margin-right: 4px;"> <path fill=currentColor d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"></path> </svg> <span>运行时间: <span id=web-time>加载中...</span></span> </span> </div> </div> </div> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright © 2025 - Present <a href=https://github.com/tom-jerr/ target=_blank rel=noopener>tom-jerr</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <!-- Social links --> <div class=md-social> <a href=https://github.com/tom-jerr/ target=_blank rel=noopener title=GitHub class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </a> <a href=/img/qq.png target=_blank rel=noopener title=QQ class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M434.1 420.4c-11.5 1.4-44.9-52.7-44.9-52.7 0 31.3-16.1 72.2-51 101.8 16.8 5.2 54.8 19.2 45.8 34.4-7.3 12.3-125.5 7.9-159.6 4-34.1 3.8-152.3 8.3-159.6-4-9-15.2 28.9-29.2 45.8-34.4-34.9-29.5-51.1-70.4-51.1-101.8 0 0-33.3 54.1-44.9 52.7-5.4-.6-12.4-29.6 9.3-99.7 10.3-33 22-60.5 40.1-105.8C60.9 98 109.2-.1 224.3-.1 338-.1 387.5 96 384.6 214.9c18.1 45.2 29.9 72.9 40.1 105.8 21.8 70.1 14.7 99.1 9.3 99.7z"></path></svg> </a> <a href=/img/wechat.png target=_blank rel=noopener title=微信 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6"></path></svg> </a> <a href=https://x.com/tom_jerry_jack target=_blank rel=noopener title=X class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"></path></svg> </a> <a href=https://www.zhihu.com/people/chen-wen-de-jian-ke target=_blank rel=noopener title=Zhihu class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M170.5 148.1v217.5h23.4l7.7 26.4 42-26.4h49.5V148.1H170.4zM268.3 342h-27.9l-27.9 17.5-5.1-17.5h-11.9V171.7h72.8zm-118.5-94.3H97.5c1.7-27.1 2.2-51.6 2.2-73.5h51.2s2-22.6-8.6-22.3H53.8c3.5-13.1 7.9-26.7 13.1-40.7 0 0-24.1 0-32.3 21.6-3.4 8.9-13.2 43.1-30.7 78.1 5.9-.6 25.4-1.2 36.8-22.2 2.1-5.9 2.5-6.7 5.1-14.5h28.9c0 10.5-1.2 66.9-1.7 73.4H20.7c-11.7 0-15.6 23.6-15.6 23.6h65.6c-4.4 49.9-28 91.9-70.8 125.1 20.5 5.9 40.9-.9 51-9.9 0 0 23-20.9 35.6-69.3l54 64.9s7.9-26.9-1.2-40c-7.6-8.9-28.1-33.1-36.8-41.8L87.9 312c4.4-14 7-27.6 7.9-40.7h61.6s-.1-23.6-7.6-23.6m412-1.6c20.8-25.6 45-58.6 45-58.6s-18.6-14.8-27.4-4.1c-6 8.2-36.8 48.2-36.8 48.2l19.2 14.4zm-150-59.1c-9-8.2-25.9 2.1-25.9 2.1s39.5 55 41.1 57.4l19.5-13.7s-25.7-37.6-34.7-45.9zM640 258.4c-19.8 0-130.9.9-131.1.9v-101q7.2 0 22.8-1.2c40.9-2.4 70.1-4 87.8-4.8 0 0 12.2-27.2-.6-33.4-3.1-1.2-23.2 4.6-23.2 4.6s-165.2 16.5-232.4 18c1.6 8.8 7.6 17.1 15.8 19.6 13.3 3.5 22.7 1.7 49.2.9 24.8-1.6 43.7-2.4 56.5-2.4v99.8H351.3s2.8 22.3 25.5 22.9h107.9v70.9c0 14-11.2 22-24.5 21.1-14.1.1-26.1-1.1-41.7-1.8 2 4 6.3 14.4 19.3 21.8 9.9 4.8 16.2 6.6 26 6.6 29.6 0 45.7-17.3 44.9-45.3v-73.3h122.4c9.7 0 8.7-23.8 8.7-23.8z"></path></svg> </a> <a href=mailto:2584074296@qq.com target=_blank rel=noopener title="send email to me!" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9l-112.4 94.3c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8z"></path></svg> </a> </div> </div> </div> </footer> <!-- Website running time counter script --> <script>
  function updateWebTime() {
    var startDate = new Date("2025/05/04 20:00:00");
    var now = new Date();
    var diff = now.getTime() - startDate.getTime();
    
    var days = Math.floor(diff / (1000 * 60 * 60 * 24));
    var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    
    var timeStr = days + " 天 " + hours + " 小时 " + minutes + " 分钟";
    
    var webTimeElement = document.getElementById("web-time");
    if (webTimeElement) {
      webTimeElement.textContent = timeStr;
    }
    
    setTimeout(updateWebTime, 60000); // 每分钟更新一次
  }
  
  // 页面加载完成后启动计时器
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", updateWebTime);
  } else {
    updateWebTime();
  }
  

</script> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "header.autohide", "navigation.tracking", "navigation.tabs", "navigation.top", "navigation.path", "navigation.indexes", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../js/mathjax.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script> <script src=../../assets/document_dates/tippy/popper.min.js></script> <script src=../../assets/document_dates/tippy/tippy.umd.min.js></script> <script src=../../assets/document_dates/core/md5.min.js></script> <script src=../../assets/document_dates/core/default.config.js></script> <script src=../../assets/document_dates/user.config.js></script> <script src=../../assets/document_dates/core/utils.js></script> <script src=../../assets/document_dates/core/core.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>