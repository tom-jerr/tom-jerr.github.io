{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"Welcome to tom-jerr's Site! \ud83c\udf89  <p>  My frineds! /  About Me /   Academic Page /  Statistics </p> <li>Website Operating Time: </li> <li>Total Visitors:  people</li> <li>Total Visits:  times</li>"},{"location":"academy/","title":"Zhiyi Liu(\u5218\u82b7\u6ea2)","text":""},{"location":"academy/#zhiyi-liu","title":"Zhiyi Liu(\u5218\u82b7\u6ea2)","text":"<p> Work Email: lzy [underline] CS [underline] LN [at] 163 [dot] com</p> <p> Personal Email: 2823324228 [at] qq [dot] com</p> <p> CV: Click Here</p> <p> </p>"},{"location":"academy/#bio","title":"Bio","text":"<p>I am a first-year master student majoring in Computer Architecture in University of Electronic Science and Technology of China(UESTC). Currently, I am a member at NDSL. You could find my previous experience here. In addition, I am interested in Database, Distributed System and Vector Database.</p> <p>I am actively contributing to the open-source community, particularly in projects related to distributed databases and Vector Database. If there are any opportunities to participate in the development of these kinds of open-source projects, please feel free to contact me !!! \ud83e\udd70\ud83e\udd70\ud83e\udd70</p>"},{"location":"academy/#work-interest","title":"Work Interest","text":"<ul> <li> <p>Distributed Database: I focus on Distributed Database. Last year, I and my partners have won the 11<sup>th</sup> in 2024 OceanBase Database Competition. Now I am working for a simple distributed vector database or olap with vectorized query engine, if you have any idea, welcome to contact with me.</p> </li> <li> <p>Vector Database: I also foceus on vector database and Graph RAG on this field. Now I am working for adding the ability of vector search on a graph database. I want to do some optimization on vector search with hnsw, if you have any idea about hnsw, welcome to contact with me.</p> </li> </ul>"},{"location":"academy/#news","title":"News","text":"2024 <p>[12/2024]  Our Team won the 11<sup>th</sup> in 2024 OceanBase Database Competition(10/1212)</p> <p>[11/2024]  Our Team won the First Prize in the Preliminary in 2024 OceanBase Database Competition(In Sichuan Privince)</p>"},{"location":"academy/#education","title":"Education","text":""},{"location":"academy/#school-of-computer-science-and-engineering-university-of-electronic-science-and-technology-of-china","title":"School of Computer Science and Engineering, University of Electronic Science and Technology of China","text":"<p>Sept. 2024 -- Present</p> <p></p>"},{"location":"academy/#school-of-computer-science-and-engineering-university-of-electronic-science-and-technology-of-china_1","title":"School of Computer Science and Engineering, University of Electronic Science and Technology of China","text":"<p>Sept. 2020 -- June 2024</p>"},{"location":"academy/#experience","title":"Experience","text":"<p>Coming soon...</p>"},{"location":"academy/#course-labs","title":"Course Labs","text":"<p> RealyServer</p> <p>A relay server based on epoll.</p> <p> BPlus Tree</p> <p>A simple BPlus Tree implement in C++, using latch crabbing protocol.</p> <p> 6.S081</p> <p>A class about operator system, build a simple os of RISC-V by C.</p> <p> CS144</p> <p>A class about network, build a simple TCP protocol by C++.</p> <p> CMU15-213</p> <p>Some labs from CSAPP.</p> <p> miniTCMalloc</p> <p>A simple implement of Google tcmalloc by C++.</p>"},{"location":"academy/#projects","title":"Projects","text":"<p>Bustub</p> <p>A single-node database that supports basic SQL operations.</p> <p>TinyKV</p> <p>A highly available, scalable, and distributed transaction-supported KV database.</p> <p> iouring with muduo </p> <p>Offered the ability of random reading and writing files by muduo.</p>"},{"location":"academy/#honors","title":"Honors","text":"<ul> <li>First Prize in the Preliminary in 2024 OceanBase Database Competition, 2024</li> <li>11<sup>th</sup> in 2024 OceanBase Database Competition, 2024</li> </ul>"},{"location":"about/","title":"About","text":""},{"location":"about/#about","title":"About \ud83e\udd73","text":"<p> \u7ea6 496 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p> \u4e2d\u6587English <p>\u4f60\u597d\uff01\u6211\u662f \u5218\u82b7\u6ea2\uff0c\u7535\u5b50\u79d1\u6280\u5927\u5b66 24 \u7ea7\u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u6280\u672f\u7684\u7814\u7a76\u751f\u3002\u5f88\u9ad8\u5174\u80fd\u5728\u4e92\u8054\u7f51\u4e0a\u4e0e\u4f60\u76f8\u9047\ud83e\udd70\u3002</p> <p>\u6211\u5bf9\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u3001\u5411\u91cf\u6570\u636e\u5e93\u7b49\u9886\u57df\u5f88\u6709\u70ed\u60c5\uff0c\u4e5f\u559c\u6b22\u5206\u4eab\u81ea\u5df1\u7684\u5b66\u4e60\u7ecf\u9a8c\u548c\u601d\u8003\ud83e\udd13\u3002\u5982\u679c\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u770b\u770b\u6211\u7684notes\uff0c\u4e5f\u8bb8\u4f1a\u627e\u5230\u4e00\u4e9b\u5bf9\u4f60\u6709\u5e2e\u52a9\u7684\u5185\u5bb9\u3002</p> <p>\u60f3\u4e86\u89e3\u6211\u7684\u7ecf\u5386\uff1f\u53ef\u4ee5\u67e5\u770b\u6211\u7684\u4e3b\u9875\ud83c\udf93\u3002</p> <p>\u6211\u559c\u6b22\u8ba4\u8bc6\u65b0\u670b\u53cb\uff0c\u901a\u5e38\u901a\u8fc7\u5fae\u4fe1\u548c QQ \u4e0e\u5927\u5bb6\u4fdd\u6301\u8054\u7cfb\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u70b9\u51fb\u4e0b\u65b9\u7684\u56fe\u6807\uff0c\u626b\u4e00\u626b\u4e8c\u7ef4\u7801\u627e\u5230\u6211\uff0c\u968f\u65f6\u6b22\u8fce\u6dfb\u52a0\u597d\u53cb\uff01\u867d\u7136\u6211\u4e5f\u4f7f\u7528 X\uff08\u539f Twitter\uff09\uff0c\u4f46\u76ee\u524d\u4e3b\u8981\u4ee5\u9605\u8bfb\u4e3a\u4e3b\uff0c\u5f88\u5c11\u53d1\u5e03\u5185\u5bb9\ud83d\udc40\u3002</p> <p>\u5982\u679c\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u6216\u8005\u60f3\u548c\u6211\u4ea4\u6d41\uff0c\u6b22\u8fce\u53d1\u90ae\u4ef6\uff0c\u6211\u4f1a\u5c3d\u5feb\u56de\u590d\ud83d\ude0e\u3002</p> <p>\u5982\u679c\u4f60\u4e5f\u5728\u6210\u90fd\uff0c\u6b22\u8fce\u8054\u7cfb\u6211\u3002\u6211\u4eec\u53ef\u4ee5\u4e00\u8d77\u804a\u5929\u3001\u5b66\u4e60\uff0c\u6216\u8005\u4ea4\u6d41\u5171\u540c\u7684\u5174\u8da3\u7231\u597d\ud83d\udc7b\u3002</p> <p>GitHub \u6216\u8005\u77e5\u4e4e\u70b9\u4e2a\u5173\u6ce8\u8c22\u8c22\u55b5\ud83d\ude3a\uff0cGitHub \u6216\u8005\u77e5\u4e4e\u70b9\u4e2a\u5173\u6ce8\u8c22\u8c22\u55b5\ud83d\ude3a</p> <p>\u6211\u5e73\u65f6\u559c\u6b22\u542c\u97f3\u4e50\u3001\u6253\u7bee\u7403\u4ee5\u53ca\u9605\u8bfb\uff0c\u4e5f\u4f1a\u5728\u535a\u5ba2\u4e2d\u8bb0\u5f55\u4e00\u4e9b\u76f8\u5173\u5185\u5bb9\uff0c\u5206\u4eab\u4e2a\u4eba\u611f\u53d7\u270d\u3002</p> <p>Hi! I\u2019m tom-jerr, an graduated student majoring in Computer Science and Technology at UESTC (Class of 2024). It\u2019s a pleasure to meet you here\ud83e\udd70.</p> <p>I am passionate about distributed database and vector database, and I enjoy sharing my learning experiences and insights\ud83e\udd13. You can check out my notes (both in Chinese) for useful resources.</p> <p>For more details, please visit my page \ud83c\udf93.</p> <p>I enjoy meeting new people and usually connect through WeChat and QQ. You can find my QR codes by clicking corresponding icon below\u2014feel free to add me! I also use X (formerly Twitter), though I mainly browse and rarely post\ud83d\udc40.</p> <p>If you have any questions or want to chat, feel free to send me an email or leave a comment below. I\u2019ll get back to you as soon as I can\ud83d\ude0e.</p> <p>If you\u2019re in Chengdu, feel free to reach out. We can chat, learn together, or share our interests\ud83d\udc7b.</p> <p>In my spare time, I enjoy listening to music, watching anime, and reading. Occasionally, I write about these hobbies on my blog to share my thoughts\u270d.</p>"},{"location":"blogs/","title":"index","text":""},{"location":"blogs/#blogs","title":"Blogs \u270d","text":"<p>Abstract</p> <p>\u4e2a\u4eba\u535a\u5ba2\uff0c\u4e3b\u8981\u8bb0\u5f55</p> Text Only<pre><code>- \u5728 Database \u548cDistributed System \u76f8\u5173\u65b9\u9762\u7684\u5b66\u4e60\uff1b\n- \u4e00\u4e9b\u611f\u5174\u8da3\u8bba\u6587\u7684\u9605\u8bfb\u3002\uff1b\n- \u4e00\u4e9b\u6742\u8c08\u3002\n\n\u4e00\u4e9b\u6bd4\u8f83\u6210\u4f53\u7cfb\u7684\u7b14\u8bb0\u4f1a\u8bb0\u5f55\u5728 [Notes](../notes/index.md) \u4e2d\u3002\n\n\u672c\u90e8\u5206\u5185\u5bb9\uff08\u9664\u7279\u522b\u58f0\u660e\u5916\uff09\u91c7\u7528 [**\u7f72\u540d-\u975e\u5546\u4e1a\u6027\u4f7f\u7528-\u4fdd\u6301\u4e00\u81f4 4.0 \u56fd\u9645 (CC BY-NC-SA 4.0)**](https://creativecommons.org/licenses/by-nc-sa/4.0/) \u8bb8\u53ef\u534f\u8bae\u8fdb\u884c\u8bb8\u53ef\u3002\n</code></pre>"},{"location":"blogs/#archives","title":"Archives","text":"<p>\u5982\u679c\u5bfb\u627e\u4e0d\u65b9\u4fbf\u7684\u8bdd\uff0c\u4e0d\u59a8\u8bd5\u8bd5\u641c\u7d22\u6216\u8005\u524d\u5f80 Tags \u9875\u9762</p> <p>{{ blog_content }}</p>"},{"location":"blogs/posts/CS144/CS144/","title":"CS144-TCP\u534f\u8bae\u7b80\u5355\u5b9e\u73b0","text":"<code>#C</code> <code>#S</code> <code>#1</code> <code>#4</code> <code>#4</code>"},{"location":"blogs/posts/CS144/CS144/#minnow","title":"Minnow","text":"<p> \u7ea6 1301 \u4e2a\u5b57  862 \u884c\u4ee3\u7801  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 17 \u5206\u949f</p> <ul> <li>\u521d\u59cb\u7684<code>TCPSocket</code>\u662f\u5728Linux TCP/IP\u6808\u4e0a\u5c01\u88c5\u7684\u4e00\u4e2a\u7c7b</li> <li><code>lab4</code>\u5f00\u59cb\u81ea\u5df1\u6784\u5efa<code>TCPPeer</code>\u5bf9\u7aef\u8fdb\u884c\u6570\u636e\u4f20\u8f93\uff0c\u76f4\u63a5\u4f7f\u7528\u7f51\u5361\u4e0a\u7684IP\u6570\u636e\u5305\u8fdb\u884cTCP\u5305\u7684\u6784\u5efa</li> <li><code>lab5</code>\u5b9e\u73b0\u7b80\u6613ARP\u534f\u8bae\uff0c\u53ef\u4ee5\u8f6c\u6362IP\u5730\u5740\u548cMAC\u5730\u5740NetworkInterface</li> <li><code>lab6</code>\u5b9e\u73b0\u4e86\u6700\u957f\u524d\u7f00\u5339\u914d\u7684\u94fe\u8def\u5c42\u9009\u8def\u7b97\u6cd5IP route</li> <li><code>lab7</code>\u5b9e\u73b0\u4e86\u4e00\u4e2a\u4f7f\u7528IProute\u3001NetworkInterface\u7684\u7aef\u5230\u7aef\u7684TCP\u62a5\u6587\u4f20\u8f93</li> </ul>"},{"location":"blogs/posts/CS144/CS144/#_1","title":"\u6570\u636e\u683c\u5f0f","text":""},{"location":"blogs/posts/CS144/CS144/#ip","title":"IP\u5305","text":"<ul> <li> <p>IPv4\u6570\u636e\u5305\u6784\u5efa\uff1a\u4e0d\u652f\u6301IP\u9009\u9879</p> C++<pre><code>// IPv4 Internet datagram header (note: IP options are not supported)\nstruct IPv4Header\n{\n  static constexpr size_t LENGTH = 20;        // IPv4 header length, not including options\n  static constexpr uint8_t DEFAULT_TTL = 128; // A reasonable default TTL value\n  static constexpr uint8_t PROTO_TCP = 6;     // Protocol number for TCP\n\n  static constexpr uint64_t serialized_length() { return LENGTH; }\n\n  /*\n   *   0                   1                   2                   3\n   *   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   *  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   *  |Version|  IHL  |Type of Service|          Total Length         |\n   *  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   *  |         Identification        |Flags|      Fragment Offset    |\n   *  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   *  |  Time to Live |    Protocol   |         Header Checksum       |\n   *  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   *  |                       Source Address                          |\n   *  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   *  |                    Destination Address                        |\n   *  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   *  |                    Options                    |    Padding    |\n   *  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   */\n\n  // IPv4 Header fields\n  uint8_t ver = 4;           // IP version\n  uint8_t hlen = LENGTH / 4; // header length (multiples of 32 bits)\n  uint8_t tos = 0;           // type of service\n  uint16_t len = 0;          // total length of packet\n  uint16_t id = 0;           // identification number\n  bool df = true;            // don't fragment flag\n  bool mf = false;           // more fragments flag\n  uint16_t offset = 0;       // fragment offset field\n  uint8_t ttl = DEFAULT_TTL; // time to live field\n  uint8_t proto = PROTO_TCP; // protocol field\n  uint16_t cksum = 0;        // checksum field\n  uint32_t src = 0;          // src address\n  uint32_t dst = 0;          // dst address\n\n  // Length of the payload\n  uint16_t payload_length() const;\n\n  // Pseudo-header's contribution to the TCP checksum\n  uint32_t pseudo_checksum() const;\n\n  // Set checksum to correct value\n  void compute_checksum();\n\n  // Return a string containing a header in human-readable format\n  std::string to_string() const;\n\n  void parse( Parser&amp; parser );\n  void serialize( Serializer&amp; serializer ) const;\n};\n</code></pre> </li> </ul>"},{"location":"blogs/posts/CS144/CS144/#tcp","title":"TCP\u62a5\u6587","text":"<ul> <li>TCPMessage\u5305\u542bTCPSenderMessage\u548cTCPReceiverMessage</li> </ul> C++<pre><code>struct TCPMessage\n{\n  TCPSenderMessage sender {};\n  TCPReceiverMessage receiver {};\n};\n\nstruct TCPSenderMessage\n{\n  Wrap32 seqno { 0 };\n\n  bool SYN {};\n  std::string payload {};\n  bool FIN {};\n\n  bool RST {};\n\n  // How many sequence numbers does this segment use?\n  size_t sequence_length() const { return SYN + payload.size() + FIN; }\n};\n\nstruct TCPReceiverMessage\n{\n  std::optional&lt;Wrap32&gt; ackno {};\n  uint16_t window_size {};\n  bool RST {};\n};\n</code></pre> <ul> <li> <p>\u5728IP\u4e0a\u6784\u5efa\u81ea\u5df1\u7684TCP\u62a5\u6587\uff1b\u5c06IP\u6570\u636e\u5305\u901a\u8fc7TUN\u8bbe\u5907\u4e0e\u7f51\u7edc\u4e0a\u5176\u4ed6TCP\u8fdb\u884c\u901a\u4fe1</p> C++<pre><code>class TCPOverIPv4Adapter : public FdAdapterBase\n{\npublic:\nstd::optional&lt;TCPMessage&gt; unwrap_tcp_in_ip( const InternetDatagram&amp; ip_dgram );\n\nInternetDatagram wrap_tcp_in_ip( const TCPMessage&amp; msg );\n};\n\noptional&lt;TCPMessage&gt; TCPOverIPv4Adapter::unwrap_tcp_in_ip( const InternetDatagram&amp; ip_dgram )\n{\n// is the IPv4 datagram for us?\n// Note: it's valid to bind to address \"0\" (INADDR_ANY) and reply from actual address contacted\nif ( not listening() and ( ip_dgram.header.dst != config().source.ipv4_numeric() ) ) {\n  return {};\n}\n\n// is the IPv4 datagram from our peer?\nif ( not listening() and ( ip_dgram.header.src != config().destination.ipv4_numeric() ) ) {\n  return {};\n}\n\n// does the IPv4 datagram claim that its payload is a TCP segment?\nif ( ip_dgram.header.proto != IPv4Header::PROTO_TCP ) {\n  return {};\n}\n\n// is the payload a valid TCP segment?\nTCPSegment tcp_seg;\nif ( not parse( tcp_seg, ip_dgram.payload, ip_dgram.header.pseudo_checksum() ) ) {\n  return {};\n}\n\n// is the TCP segment for us?\nif ( tcp_seg.udinfo.dst_port != config().source.port() ) {\n  return {};\n}\n\n// should we target this source addr/port (and use its destination addr as our source) in reply?\nif ( listening() ) {\n  if ( tcp_seg.message.sender.SYN and not tcp_seg.message.sender.RST ) {\n    config_mutable().source = Address { inet_ntoa( { htobe32( ip_dgram.header.dst ) } ), config().source.port() };\n    config_mutable().destination\n      = Address { inet_ntoa( { htobe32( ip_dgram.header.src ) } ), tcp_seg.udinfo.src_port };\n    set_listening( false );\n  } else {\n    return {};\n  }\n}\n\n// is the TCP segment from our peer?\nif ( tcp_seg.udinfo.src_port != config().destination.port() ) {\n  return {};\n}\n\nreturn tcp_seg.message;\n}\n\n//! Takes a TCP segment, sets port numbers as necessary, and wraps it in an IPv4 datagram\n//! \\param[in] seg is the TCP segment to convert\nInternetDatagram TCPOverIPv4Adapter::wrap_tcp_in_ip( const TCPMessage&amp; msg )\n{\n  TCPSegment seg { .message = msg };\n  // set the port numbers in the TCP segment\n  seg.udinfo.src_port = config().source.port();\n  seg.udinfo.dst_port = config().destination.port();\n\n  // create an Internet Datagram and set its addresses and length\n  InternetDatagram ip_dgram;\n  ip_dgram.header.src = config().source.ipv4_numeric();\n  ip_dgram.header.dst = config().destination.ipv4_numeric();\n  ip_dgram.header.len = ip_dgram.header.hlen * 4 + 20 /* tcp header len */ + seg.message.sender.payload.size();\n\n  // set payload, calculating TCP checksum using information from IP header\n  seg.compute_checksum( ip_dgram.header.pseudo_checksum() );\n  ip_dgram.header.compute_checksum();\n  ip_dgram.payload = serialize( seg );\n\n  return ip_dgram;\n}\n</code></pre> </li> </ul>"},{"location":"blogs/posts/CS144/CS144/#fd","title":"FD\u64cd\u4f5c","text":"<ul> <li>\u5bf9FD\u7684\u64cd\u4f5c\u6bd4\u5982write\u548cread\uff0c\u90fd\u662f\u5bf9\u7cfb\u7edf\u8c03\u7528\u7684\u5c01\u88c5</li> </ul>"},{"location":"blogs/posts/CS144/CS144/#tcp_1","title":"TCP\u5de5\u4f5c\u6d41\u7a0b","text":"<ul> <li>\u4e8b\u4ef6\u9a71\u52a8\u6a21\u5f0f\u8fdb\u884cTCP\u7684\u76d1\u542c\uff0c\u8c03\u7528poll\u7cfb\u7edf\u8c03\u7528\u63a5\u6536\u6d88\u606f\uff1b\u8bbe\u7f6e\u56de\u8c03\uff0c\u5c06\u7f51\u7edc\u4e0a\u7684IP\u6570\u636e\u5305\u4f20\u9012\u5230\u6211\u4eec\u8bbe\u8ba1\u7684TCP\u4e0a</li> <li>TCPPeer\u6784\u5efa\u6d4b\u8bd5\u7a0b\u5e8f\uff0c\u540c\u6837\u4f7f\u7528\u4e8b\u4ef6\u9a71\u52a8\uff0c\u53ea\u662f\u56de\u8c03\u7565\u6709\u4e0d\u540c</li> </ul>"},{"location":"blogs/posts/CS144/CS144/#tcp_2","title":"\u521d\u59cb\u5316TCP","text":"<ul> <li>\u8bbe\u7f6epoll\u9700\u8981\u76d1\u542c\u7684\u4e8b\u4ef6   1. \u6536\u5230\u6570\u636e\u5305\uff0c\u5c06TCP\u62a5\u6587\u4f20\u9012\u7ed9TCPPeer\u63a5\u6536   2. \u8bfb\u53d6<code>pipe</code>\u7684\u5b57\u8282\u4f20\u9012\u7ed9TCPPeer\uff1a\u7528\u6237\u5728\u547d\u4ee4\u884c\u8f93\u5165\u5b57\u7b26\u4e32\u4f7f\u7528TCPSender\u53d1\u9001\u5230\u5bf9\u7aef   3. \u4ece<code>Reassembler</code>\u4e2d\u8bfb\u53d6\u5b57\u8282\u5199\u5165<code>LocalStreamSocket</code>\uff1a\u7528\u6237\u4ecereassembler\u4e2d\u8bfb\u53d6\u5b57\u7b26\u4e32\uff0c\u5199\u5165unix\u57df\u5957\u63a5\u5b57</li> </ul> C++<pre><code>template&lt;TCPDatagramAdapter AdaptT&gt;\nvoid TCPMinnowSocket&lt;AdaptT&gt;::_initialize_TCP( const TCPConfig&amp; config )\n{\n  _tcp.emplace( config );\n\n  // Set up the event loop\n\n  // There are three events to handle:\n  //\n  // 1) Incoming datagram received (needs to be given to TCPPeer::receive method)\n  //\n  // 2) Outbound bytes received from local application via a write()\n  //    call (needs to be read from the local stream socket and\n  //    given to TCPPeer)\n  //\n  // 3) Incoming bytes reassembled by the Reassembler\n  //    (needs to be read from the inbound_stream and written\n  //    to the local stream socket back to the application)\n\n  // rule 1: read from filtered packet stream and dump into TCPConnection\n  _eventloop.add_rule(\n    \"receive TCP segment from the network\",\n    _datagram_adapter.fd(),\n    Direction::In,\n    [&amp;] {\n      if ( auto seg = _datagram_adapter.read() ) {\n        _tcp-&gt;receive( std::move( seg.value() ), [&amp;]( auto x ) { _datagram_adapter.write( x ); } );\n      }\n\n      // debugging output:\n      if ( _thread_data.eof() and _tcp.value().sender().sequence_numbers_in_flight() == 0 and not _fully_acked ) {\n        std::cerr &lt;&lt; \"DEBUG: minnow outbound stream to \" &lt;&lt; _datagram_adapter.config().destination.to_string()\n                  &lt;&lt; \" has been fully acknowledged.\\n\";\n        _fully_acked = true;\n      }\n    },\n    [&amp;] { return _tcp-&gt;active(); } );\n\n  // rule 2: read from pipe into outbound buffer\n  _eventloop.add_rule(\n    \"push bytes to TCPPeer\",\n    _thread_data,\n    Direction::In,\n    [&amp;] {\n      std::string data;\n      data.resize( _tcp-&gt;outbound_writer().available_capacity() );\n      _thread_data.read( data );\n      _tcp-&gt;outbound_writer().push( move( data ) );\n\n      if ( _thread_data.eof() ) {\n        _tcp-&gt;outbound_writer().close();\n        _outbound_shutdown = true;\n\n        // debugging output:\n        std::cerr &lt;&lt; \"DEBUG: minnow outbound stream to \" &lt;&lt; _datagram_adapter.config().destination.to_string()\n                  &lt;&lt; \" finished (\" &lt;&lt; _tcp.value().sender().sequence_numbers_in_flight() &lt;&lt; \" seqno\"\n                  &lt;&lt; ( _tcp.value().sender().sequence_numbers_in_flight() == 1 ? \"\" : \"s\" )\n                  &lt;&lt; \" still in flight).\\n\";\n      }\n\n      _tcp-&gt;push( [&amp;]( auto x ) { _datagram_adapter.write( x ); } );\n    },\n    [&amp;] {\n      return ( _tcp-&gt;active() ) and ( not _outbound_shutdown )\n             and ( _tcp-&gt;outbound_writer().available_capacity() &gt; 0 );\n    },\n    [&amp;] {\n      _tcp-&gt;outbound_writer().close();\n      _outbound_shutdown = true;\n    },\n    [&amp;] {\n      std::cerr &lt;&lt; \"DEBUG: minnow outbound stream had error.\\n\";\n      _tcp-&gt;outbound_writer().set_error();\n    } );\n\n  // rule 3: read from inbound buffer into pipe\n  _eventloop.add_rule(\n    \"read bytes from inbound stream\",\n    _thread_data,\n    Direction::Out,\n    [&amp;] {\n      Reader&amp; inbound = _tcp-&gt;inbound_reader();\n      // Write from the inbound_stream into\n      // the pipe, handling the possibility of a partial\n      // write (i.e., only pop what was actually written).\n      if ( inbound.bytes_buffered() ) {\n        const std::string_view buffer = inbound.peek();\n        const auto bytes_written = _thread_data.write( buffer );\n        inbound.pop( bytes_written );\n      }\n\n      if ( inbound.is_finished() or inbound.has_error() ) {\n        _thread_data.shutdown( SHUT_WR );\n        _inbound_shutdown = true;\n\n        // debugging output:\n        std::cerr &lt;&lt; \"DEBUG: minnow inbound stream from \" &lt;&lt; _datagram_adapter.config().destination.to_string()\n                  &lt;&lt; \" finished \" &lt;&lt; ( inbound.has_error() ? \"uncleanly.\\n\" : \"cleanly.\\n\" );\n      }\n    },\n    [&amp;] {\n      return _tcp-&gt;inbound_reader().bytes_buffered()\n             or ( ( _tcp-&gt;inbound_reader().is_finished() or _tcp-&gt;inbound_reader().has_error() )\n                  and not _inbound_shutdown );\n    },\n    [&amp;] {},\n    [&amp;] {\n      std::cerr &lt;&lt; \"DEBUG: minnow inbound stream had error.\\n\";\n      _tcp-&gt;inbound_reader().set_error();\n    } );\n}\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#connect","title":"connect","text":"<ul> <li> <p><code>connect</code>\u4e8b\u4ef6\u662f\u5411TCP\u5bf9\u7aef\u5199\u6570\u636e(SYN\u5305)</p> C++<pre><code>template&lt;TCPDatagramAdapter AdaptT&gt;\nvoid TCPMinnowSocket&lt;AdaptT&gt;::connect( const TCPConfig&amp; c_tcp, const FdAdapterConfig&amp; c_ad )\n{\n  if ( _tcp ) {\n    throw std::runtime_error( \"connect() with TCPConnection already initialized\" );\n  }\n\n  _initialize_TCP( c_tcp );\n\n  _datagram_adapter.config_mut() = c_ad;\n\n  std::cerr &lt;&lt; \"DEBUG: minnow connecting to \" &lt;&lt; c_ad.destination.to_string() &lt;&lt; \"...\\n\";\n\n  if ( not _tcp.has_value() ) {\n    throw std::runtime_error( \"TCPPeer not successfully initialized\" );\n  }\n\n  _tcp-&gt;push( [&amp;]( auto x ) { _datagram_adapter.write( x ); } );\n\n  if ( _tcp-&gt;sender().sequence_numbers_in_flight() != 1 ) {\n    throw std::runtime_error( \"After TCPConnection::connect(), expected sequence_numbers_in_flight() == 1\" );\n  }\n\n  _tcp_loop( [&amp;] { return _tcp-&gt;sender().sequence_numbers_in_flight() == 1; } );\n  if ( _tcp-&gt;inbound_reader().has_error() ) {\n    std::cerr &lt;&lt; \"DEBUG: minnow error on connecting to \" &lt;&lt; c_ad.destination.to_string() &lt;&lt; \".\\n\";\n  } else {\n    std::cerr &lt;&lt; \"DEBUG: minnow successfully connected to \" &lt;&lt; c_ad.destination.to_string() &lt;&lt; \".\\n\";\n  }\n\n  _tcp_thread = std::thread( &amp;TCPMinnowSocket::_tcp_main, this );\n}\n</code></pre> </li> <li> <p>\u4e00\u76f4\u5faa\u73af\uff0c\u771f\u6b63\u7ed3\u675f\u7684\u51fd\u6570\u5728<code>_tcp_loop</code></p> </li> <li> <p><code>_tcp_loop</code>\u7ed3\u675f\u5728poll\u7b49\u5f85\u4e8b\u4ef6\u7ed3\u675f</p> </li> <li> <p>\u51fa\u9519</p> </li> <li>TCP\u8fde\u63a5\u7684fd\u5173\u95ed</li> </ul> C++<pre><code>template&lt;TCPDatagramAdapter AdaptT&gt;\nvoid TCPMinnowSocket&lt;AdaptT&gt;::_tcp_main()\n{\n  try {\n    if ( not _tcp.has_value() ) {\n      throw std::runtime_error( \"no TCP\" );\n    }\n    _tcp_loop( [] { return true; } );\n    shutdown( SHUT_RDWR );\n    if ( not _tcp.value().active() ) {\n      std::cerr &lt;&lt; \"DEBUG: minnow TCP connection finished \"\n                &lt;&lt; ( _tcp-&gt;inbound_reader().has_error() ? \"uncleanly.\\n\" : \"cleanly.\\n\" );\n    }\n    _tcp.reset();\n  } catch ( const std::exception&amp; e ) {\n    std::cerr &lt;&lt; \"Exception in TCPConnection runner thread: \" &lt;&lt; e.what() &lt;&lt; \"\\n\";\n    throw e;\n  }\n}\n\n//! \\param[in] condition is a function returning true if loop should continue\ntemplate&lt;TCPDatagramAdapter AdaptT&gt;\nvoid TCPMinnowSocket&lt;AdaptT&gt;::_tcp_loop( const std::function&lt;bool()&gt;&amp; condition )\n{\n  auto base_time = timestamp_ms();\n  while ( condition() ) {\n    auto ret = _eventloop.wait_next_event( TCP_TICK_MS );\n    if ( ret == EventLoop::Result::Exit or _abort ) {\n      break;\n    }\n\n    if ( not _tcp.has_value() ) {\n      throw std::runtime_error( \"_tcp_loop entered before TCPPeer initialized\" );\n    }\n\n    if ( _tcp.value().active() ) {\n      const auto next_time = timestamp_ms();\n      _tcp.value().tick( next_time - base_time, [&amp;]( auto x ) { _datagram_adapter.write( x ); } );\n      _datagram_adapter.tick( next_time - base_time );\n      base_time = next_time;\n    }\n  }\n}\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#listen_and_accept","title":"listen_and_accept","text":"<ul> <li><code>listen_and_accept</code>\u76d1\u542c\u5bf9\u7aef\u662f\u5426\u56de\u590dack</li> </ul> C++<pre><code>template&lt;TCPDatagramAdapter AdaptT&gt;\nvoid TCPMinnowSocket&lt;AdaptT&gt;::listen_and_accept( const TCPConfig&amp; c_tcp, const FdAdapterConfig&amp; c_ad )\n{\n  if ( _tcp ) {\n    throw std::runtime_error( \"listen_and_accept() with TCPConnection already initialized\" );\n  }\n\n  _initialize_TCP( c_tcp );\n\n  _datagram_adapter.config_mut() = c_ad;\n  _datagram_adapter.set_listening( true );\n\n  std::cerr &lt;&lt; \"DEBUG: minnow listening for incoming connection...\\n\";\n  _tcp_loop( [&amp;] { return ( not _tcp-&gt;has_ackno() ) or ( _tcp-&gt;sender().sequence_numbers_in_flight() ); } );\n  std::cerr &lt;&lt; \"DEBUG: minnow new connection from \" &lt;&lt; _datagram_adapter.config().destination.to_string() &lt;&lt; \".\\n\";\n\n  _tcp_thread = std::thread( &amp;TCPMinnowSocket::_tcp_main, this );\n}\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#_2","title":"\u6267\u884c\u4e3b\u51fd\u6570","text":""},{"location":"blogs/posts/CS144/CS144/#tcppeer","title":"TCPPeer","text":"<ul> <li>\u63a5\u6536TCPMessage\uff0c\u7136\u540e\u5411\u5bf9\u7aef\u53d1\u9001\u6d88\u606f</li> </ul> C++<pre><code>class TCPPeer\n{\n  auto make_send( const auto&amp; transmit )\n  {\n    return [&amp;]( const TCPSenderMessage&amp; x ) { send( x, transmit ); };\n  }\n\npublic:\n  void receive( TCPMessage msg, const TransmitFunction&amp; transmit )\n  {\n    if ( not active() ) {\n      return;\n    }\n\n    // Record time in case this peer has to linger after streams finish.\n    time_of_last_receipt_ = cumulative_time_;\n\n    // If SenderMessage occupies a sequence number, make sure to reply.\n    need_send_ |= ( msg.sender.sequence_length() &gt; 0 );\n\n    // If SenderMessage is a \"keep-alive\" (with intentionally invalid seqno), make sure to reply.\n    // (N.B. orthodox TCP rules require a reply on any unacceptable segment.)\n    const auto our_ackno = receiver_.send().ackno;\n    need_send_ |= ( our_ackno.has_value() and msg.sender.seqno + 1 == our_ackno.value() );\n\n    // Did the inbound stream finish before the outbound stream? If so, no need to linger after streams finish.\n    if ( receiver_.writer().is_closed() and not sender_.reader().is_finished() ) {\n      linger_after_streams_finish_ = false;\n    }\n\n    // Give incoming TCPSenderMessage to receiver.\n    receiver_.receive( std::move( msg.sender ) );\n\n    // Give incoming TCPReceiverMessage to sender.\n    sender_.receive( msg.receiver );\n\n    // Send reply if needed.\n    if ( need_send_ ) {\n      send( sender_.make_empty_message(), transmit );\n    }\n  }\n\n\nprivate:\n  void send( const TCPSenderMessage&amp; sender_message, const TransmitFunction&amp; transmit )\n  {\n    TCPMessage msg { sender_message, receiver_.send() };\n    transmit( std::move( msg ) );\n    need_send_ = false;\n  }\n};\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#_3","title":"\u6d4b\u8bd5\u7aef","text":"<ul> <li> <p><code>bidirectional_stream_copy</code>\u89e6\u53d1rule1\u548crule2\uff1b\u89e6\u53d1<code>_initialize_TCP</code>\u7684read pipe into outbound buffer\uff1b\u7136\u540e\u53d1\u9001\u7ed9\u5bf9\u7aef\u6570\u636e\u62a5</p> </li> <li> <p>\u89e6\u53d1<code>_initialize_TCP</code>\u7684<code>receive TCP segment from network</code>\uff0c\u8fdb\u884c\u6d88\u606f\u7684\u6536\u53d1</p> </li> <li> <p>rule1: read from stdin into outbound byte stream</p> </li> <li> <p>rule2: read from outbound byte stream into socket</p> </li> <li> <p>rule3: read from socket into inbound byte stream</p> </li> <li> <p>rule4: read from inbound byte stream into stdout</p> </li> </ul> C++<pre><code>void bidirectional_stream_copy( Socket&amp; socket, string_view peer_name )\n{\n  constexpr size_t buffer_size = 1048576;\n\n  EventLoop _eventloop {};\n  FileDescriptor _input { STDIN_FILENO };\n  FileDescriptor _output { STDOUT_FILENO };\n  ByteStream _outbound { buffer_size };\n  ByteStream _inbound { buffer_size };\n  bool _outbound_shutdown { false };\n  bool _inbound_shutdown { false };\n\n  socket.set_blocking( false );\n  _input.set_blocking( false );\n  _output.set_blocking( false );\n\n  // rule 1: read from stdin into outbound byte stream\n  _eventloop.add_rule(\n    \"read from stdin into outbound byte stream\",\n    _input,\n    Direction::In,\n    [&amp;] {\n      string data;\n      data.resize( _outbound.writer().available_capacity() );\n      _input.read( data );\n      _outbound.writer().push( move( data ) );\n      if ( _input.eof() ) {\n        _outbound.writer().close();\n      }\n    },\n    [&amp;] {\n      return !_outbound.has_error() and !_inbound.has_error() and ( _outbound.writer().available_capacity() &gt; 0 )\n             and !_outbound.writer().is_closed();\n    },\n    [&amp;] { _outbound.writer().close(); },\n    [&amp;] {\n      cerr &lt;&lt; \"DEBUG: Outbound stream had error from source.\\n\";\n      _outbound.set_error();\n      _inbound.set_error();\n    } );\n\n  // rule 2: read from outbound byte stream into socket\n  _eventloop.add_rule(\n    \"read from outbound byte stream into socket\",\n    socket,\n    Direction::Out,\n    [&amp;] {\n      if ( _outbound.reader().bytes_buffered() ) {\n        _outbound.reader().pop( socket.write( _outbound.reader().peek() ) );\n      }\n      if ( _outbound.reader().is_finished() ) {\n        socket.shutdown( SHUT_WR );\n        _outbound_shutdown = true;\n        cerr &lt;&lt; \"DEBUG: Outbound stream to \" &lt;&lt; peer_name &lt;&lt; \" finished.\\n\";\n      }\n    },\n    [&amp;] {\n      return _outbound.reader().bytes_buffered() or ( _outbound.reader().is_finished() and not _outbound_shutdown );\n    },\n    [&amp;] { _outbound.writer().close(); },\n    [&amp;] {\n      cerr &lt;&lt; \"DEBUG: Outbound stream had error from destination.\\n\";\n      _outbound.set_error();\n      _inbound.set_error();\n    } );\n\n  // rule 3: read from socket into inbound byte stream\n  _eventloop.add_rule(\n    \"read from socket into inbound byte stream\",\n    socket,\n    Direction::In,\n    [&amp;] {\n      string data;\n      data.resize( _inbound.writer().available_capacity() );\n      socket.read( data );\n      _inbound.writer().push( move( data ) );\n      if ( socket.eof() ) {\n        _inbound.writer().close();\n      }\n    },\n    [&amp;] {\n      return !_inbound.has_error() and !_outbound.has_error() and ( _inbound.writer().available_capacity() &gt; 0 )\n             and !_inbound.writer().is_closed();\n    },\n    [&amp;] { _inbound.writer().close(); },\n    [&amp;] {\n      cerr &lt;&lt; \"DEBUG: Inbound stream had error from source.\\n\";\n      _outbound.set_error();\n      _inbound.set_error();\n    } );\n\n  // rule 4: read from inbound byte stream into stdout\n  _eventloop.add_rule(\n    \"read from inbound byte stream into stdout\",\n    _output,\n    Direction::Out,\n    [&amp;] {\n      if ( _inbound.reader().bytes_buffered() ) {\n        _inbound.reader().pop( _output.write( _inbound.reader().peek() ) );\n      }\n      if ( _inbound.reader().is_finished() ) {\n        _output.close();\n        _inbound_shutdown = true;\n        cerr &lt;&lt; \"DEBUG: Inbound stream from \" &lt;&lt; peer_name &lt;&lt; \" finished\"\n             &lt;&lt; ( _inbound.has_error() ? \" uncleanly.\\n\" : \".\\n\" );\n      }\n    },\n    [&amp;] {\n      return _inbound.reader().bytes_buffered() or ( _inbound.reader().is_finished() and not _inbound_shutdown );\n    },\n    [&amp;] { _inbound.writer().close(); },\n    [&amp;] {\n      cerr &lt;&lt; \"DEBUG: Inbound stream had error from destination.\\n\";\n      _outbound.set_error();\n      _inbound.set_error();\n    } );\n\n  // loop until completion\n  while ( true ) {\n    if ( EventLoop::Result::Exit == _eventloop.wait_next_event( -1 ) ) {\n      return;\n    }\n  }\n}\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#ip_1","title":"IP\u5305\u53d1\u9001\u63a5\u6536\u7684\u8bbe\u5907\u652f\u6301","text":"<ul> <li> <p>\u6784\u5efa\u53ef\u4ee5\u901a\u4fe1\u7684TCP\uff0c\u6cdb\u578bAdapt\u9700\u8981\u6ee1\u8db3write\u548cread\u7684\u7ea6\u675f\uff1bCS144TCPSocket\u6ce8\u518c\u4e86\u4e00\u4e2aTUN\uff08\u7f51\u7edc\u96a7\u9053\uff09\u8bbe\u5907\u6765\u53d1\u9001\u548c\u63a5\u6536IP\u6570\u636e\u5305\u3002</p> </li> <li> <p>write\u5c06\u6211\u4eec\u6784\u9020\u7684TCP\u5305\u5e8f\u5217\u5316\u540e\u5199\u5165TUN\u8bbe\u5907</p> </li> <li>read\u8bfb\u53d6IP\u5305\u5934\uff0c\u83b7\u53d6TCP\u62a5\u5934\u548c\u62a5\u6587(<code>unwrap_tcp_in_ip</code>)</li> </ul> C++<pre><code>template&lt;class T&gt;\nconcept TCPDatagramAdapter = requires( T a, TCPMessage seg ) {\n  {\n    a.write( seg )\n  } -&gt; std::same_as&lt;void&gt;;\n\n  {\n    a.read()\n  } -&gt; std::same_as&lt;std::optional&lt;TCPMessage&gt;&gt;;\n};\n\n//! \\brief A FD adapter for IPv4 datagrams read from and written to a TUN device\nclass TCPOverIPv4OverTunFdAdapter : public TCPOverIPv4Adapter\n{\nprivate:\n  TunFD _tun;\n\npublic:\n  //! Construct from a TunFD\n  explicit TCPOverIPv4OverTunFdAdapter( TunFD&amp;&amp; tun ) : _tun( std::move( tun ) ) {}\n\n  //! Attempts to read and parse an IPv4 datagram containing a TCP segment related to the current connection\n  std::optional&lt;TCPMessage&gt; read();\n\n  //! Creates an IPv4 datagram from a TCP segment and writes it to the TUN device\n  void write( const TCPMessage&amp; seg ) { _tun.write( serialize( wrap_tcp_in_ip( seg ) ) ); }\n\n  //! Access the underlying TUN device\n  explicit operator TunFD&amp;() { return _tun; }\n\n  //! Access the underlying TUN device\n  explicit operator const TunFD&amp;() const { return _tun; }\n\n  //! Access underlying file descriptor\n  FileDescriptor&amp; fd() { return _tun; }\n};\n\noptional&lt;TCPMessage&gt; TCPOverIPv4OverTunFdAdapter::read()\n{\n  vector&lt;string&gt; strs( 2 );\n  strs.front().resize( IPv4Header::LENGTH );\n  _tun.read( strs );\n\n  InternetDatagram ip_dgram;\n  const vector&lt;string&gt; buffers = { strs.at( 0 ), strs.at( 1 ) };\n  if ( parse( ip_dgram, buffers ) ) {\n    return unwrap_tcp_in_ip( ip_dgram );\n  }\n  return {};\n}\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#tcp_3","title":"TCP\u5b9e\u73b0","text":"<ul> <li>\u4e00\u4e2aTCP\u7684\u5bf9\u7b49\u7aef\u9700\u8981\u5b9e\u73b0\u7684\u6838\u5fc3\u6570\u636e\u7ed3\u6784\u548c\u529f\u80fd\u5982\u4e0b</li> </ul> C++<pre><code>class TCPPeer\n{\n\npublic:\n  explicit TCPPeer( const TCPConfig&amp; cfg ) : cfg_( cfg ) {}\n\n  Writer&amp; outbound_writer() { return sender_.writer(); }\n  Reader&amp; inbound_reader() { return receiver_.reader(); }\n\n  /* Passthrough methods */\n  void push( const TransmitFunction&amp; transmit ) { sender_.push( make_send( transmit ) ); }\n\n  void receive( TCPMessage msg, const TransmitFunction&amp; transmit );\n\n  // Testing interface\n  const TCPReceiver&amp; receiver() const { return receiver_; }\n  const TCPSender&amp; sender() const { return sender_; }\n\nprivate:\n  TCPConfig cfg_;\n  TCPSender sender_ { ByteStream { cfg_.send_capacity }, cfg_.isn, cfg_.rt_timeout };\n  TCPReceiver receiver_ { Reassembler { ByteStream { cfg_.recv_capacity } } };\n\n  void send( const TCPSenderMessage&amp; sender_message, const TransmitFunction&amp; transmit );\n};\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#_4","title":"\u91cd\u8981\u6570\u636e\u7ed3\u6784","text":""},{"location":"blogs/posts/CS144/CS144/#byte_stream","title":"Byte_Stream","text":"<ul> <li>\u5b9e\u73b0\u5b57\u7b26\u4e32\u7684\u5148\u8fdb\u5148\u51fa\uff1b<code>Writer</code>\u5199\u5165\u5b57\u7b26\u4e32\uff0c<code>Reader</code>\u8bfb\u51fa\u4efb\u610f\u957f\u5ea6\u7684\u5b57\u7b26</li> <li>\u4e3a\u4e86\u6027\u80fd\uff0c\u4f7f\u7528<code>std::queue&lt;std::string&gt;</code>\uff0c\u8bb0\u5f55\u5f39\u51fa\u5b57\u7b26\u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u7d22\u5f15\u5b9e\u73b0<code>peek()</code></li> </ul> C++<pre><code>void Writer::push( string data )\n{\n  // Your code here.\n  size_t datalen = data.size();\n  size_t write_avail = Writer::available_capacity();\n\n  if ( Writer::is_closed() || write_avail == 0 || data.empty() ) {\n    return;\n  }\n  if ( datalen &gt; write_avail ) {\n    data.resize( write_avail );\n  }\n  pushed_ += data.size();\n  buffered_ += data.size();\n  data_.emplace( std::move( data ) );\n}\n\nstring_view Reader::peek() const\n{\n  // Your code here.\n  return data_.empty() ? string_view {} : string_view { data_.front() }.substr( read_index_ );\n}\n\nvoid Reader::pop( uint64_t len )\n{\n  // Your code here.\n  buffered_ -= len;\n  poped_ += len;\n  while ( len != 0U ) {\n    uint64_t size = data_.front().size() - read_index_;\n    if ( len &lt; size ) {\n      read_index_ += len;\n      break;\n    }\n    // \u9700\u8981\u5411\u524d\u79fb\u52a8\u4e00\u4e2astring\n    data_.pop();\n    read_index_ = 0;\n    len -= size;\n  }\n}\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#reassembler","title":"Reassembler","text":"<ul> <li>\u5c06\u4e71\u5e8f\u63a5\u6536\u7684\u5b57\u7b26\u4e32\u53d8\u4e3a\u6709\u5e8f\u5b57\u8282\u6d41\uff0c\u4f7f\u7528<code>map</code>\u8fdb\u884c\u4e71\u5e8f\u5b57\u7b26\u4e32\u7684\u5b58\u50a8\uff1b\u91cd\u70b9\u5728\u4e8e\u5904\u7406\u91cd\u53e0\u5b57\u4e32</li> </ul>"},{"location":"blogs/posts/CS144/CS144/#_5","title":"\u91cd\u53e0\u5b57\u4e32\u7684\u5904\u7406","text":"<ul> <li>\u627e\u5230\u7b2c\u4e00\u4e2a\u5c0f\u4e8e\u7b49\u4e8e<code>pos</code>\u7684\u8fed\u4ee3\u5668\uff0c\u5982\u679cmap\u4e2d\u542b\u6709\u7684\u5b57\u7b26\u4e32\u4e0e\u8981\u63d2\u5165\u7684\u5b57\u7b26\u4e32\u4ea7\u751f\u91cd\u53e0\uff0c\u79fb\u9664\u542b\u6709\u7684\u5b57\u7b26\u4e32\u91cd\u53e0\u90e8\u5206\uff0c\u589e\u52a0\u4e00\u4e2a\u91cd\u53e0\u90e8\u5206\u7684\u8fed\u4ee3\u5668\u8fdb\u884c\u540e\u7eed\u5220\u9664\u64cd\u4f5c</li> <li>\u5148\u627e\u63d2\u5165\u4e0e\u5b57\u7b26\u4e32\u672b\u5c3e\u91cd\u53e0\u7684\u8fed\u4ee3\u5668\uff0c\u9632\u6b62\u5931\u6548</li> <li>\u518d\u627e\u4e0e<code>first_index</code>\u91cd\u53e0\u7684\u8fed\u4ee3\u5668</li> <li> <p>\u79fb\u9664[<code>lower</code>, <code>upper</code>)\u7684\u8fed\u4ee3\u5668\uff0c\u63d2\u5165\u65b0\u7684\u5b57\u7b26\u4e32</p> <p><sub>~</sub>c++ auto Reassembler::split( uint64_t pos ) noexcept {   auto it { buffer_.lower_bound( pos ) };   if ( it != buffer_.end() and it-&gt;first == pos ) { return it;   }   if ( it == buffer_.begin() ) { // if buffer_.empty() then begin() == end() return it;   }   if ( const auto pit { prev( it ) }; pit-&gt;first + size( pit-&gt;second ) &gt; pos ) { // \u6784\u5efa\u91cd\u53e0\u90e8\u5206\u8fed\u4ee3\u5668 const auto res = buffer_.emplace_hint( it, pos, pit-&gt;second.substr( pos - pit-&gt;first ) ); pit-&gt;second.resize( pos - pit-&gt;first ); return res;   }   return it; }; // \u5bf9[lower, upper)\u7684\u8fed\u4ee3\u5668\u8fdb\u884c\u89c6\u56fe\u8f6c\u6362\uff0c\u7136\u540e\u66f4\u65b0reassemble\u7684\u5927\u5c0f ranges::for_each( ranges::subrange( lower, upper ) | views::values, &amp; { reassemble_len_ -= str.size(); } ); reassemble_len_ += size(data); buffer_.emplace_hint(buffer_.erase(lower, upper), first_index, move(data));</p> </li> </ul> C++<pre><code>void Reassembler::insert( uint64_t first_index, string data, bool is_last_substring )\n{\n  // Your code here.\n  const auto try_close = [&amp;]() noexcept -&gt; void {\n    if ( end_idx_.has_value() &amp;&amp; end_idx_.value() == next_unassem_idx_ ) {\n      output_.writer().close();\n    }\n  };\n\n  if ( data.empty() ) {\n    if ( !end_idx_.has_value() &amp;&amp; is_last_substring ) {\n      end_idx_.emplace( first_index );\n    }\n    return try_close();\n  }\n\n  if ( writer().is_closed() || writer().available_capacity() == 0 ) {\n    return;\n  }\n\n  uint64_t unassembled_index { next_unassem_idx_ };\n  uint64_t unacceptable_index { unassembled_index + writer().available_capacity() };\n  // \u5c06\u4e0d\u518d[unassembled_index, unacceptable_index)\u7684\u5b57\u7b26\u4e32\u8fdb\u884c\u5904\u7406\n  if ( first_index + size( data ) &lt;= unassembled_index || first_index &gt;= unacceptable_index ) {\n    return; // Out of ranger\n  }\n  if ( first_index + size( data ) &gt; unacceptable_index ) { // Remove unacceptable bytes\n    data.resize( unacceptable_index - first_index );\n    is_last_substring = false;\n  }\n  if ( first_index &lt; unassembled_index ) { // Remove poped/buffered bytes\n    data.erase( 0, unassembled_index - first_index );\n    first_index = unassembled_index;\n  }\n\n  if ( !end_idx_.has_value() and is_last_substring ) {\n    end_idx_.emplace( first_index + size( data ) );\n  }\n\n  // \u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u5206\u5272\n  // TODO: \u53ef\u4ee5\u5bf9\u5b57\u7b26\u4e32\u79fb\u9664\u8fdb\u884c\u4f18\u5316\n  auto upper { split( first_index + size( data ) ) };\n  auto lower { split( first_index ) };\n  // \u5bf9[lower, upper)\u7684\u8fed\u4ee3\u5668\u8fdb\u884c\u89c6\u56fe\u8f6c\u6362\uff0c\u7136\u540e\u66f4\u65b0reassemble\u7684\u5927\u5c0f\n  ranges::for_each( ranges::subrange( lower, upper ) | views::values,\n                    [&amp;]( const auto&amp; str ) { reassemble_len_ -= str.size(); } );\n  reassemble_len_ += size( data );\n  buffer_.emplace_hint( buffer_.erase( lower, upper ), first_index, move( data ) );\n\n  // \u5411writer\u4e2d\u5199\u5165\u5df2\u7ecf\u6392\u597d\u5e8f\u7684\u62a5\u6587\n  while ( !buffer_.empty() ) {\n    auto&amp;&amp; [index, packet] { *buffer_.begin() };\n    if ( index != next_unassem_idx_ ) {\n      break;\n    }\n\n    reassemble_len_ -= size( packet );\n    next_unassem_idx_ += size( packet );\n    output_.writer().push( move( packet ) );\n    buffer_.erase( buffer_.begin() );\n  }\n  return try_close();\n}\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#tcpreceiver","title":"TCPReceiver","text":"<ul> <li>64bit\u8f6c32bit ------- 32bit\u8f6c64bit\uff1a\u8981\u6c42\u6700\u8fd1\u4e14\u4e0d\u6ea2\u51fa</li> </ul> C++<pre><code>Wrap32 Wrap32::wrap( uint64_t n, Wrap32 zero_point )\n{\n  // Your code here.\n  return zero_point + static_cast&lt;uint32_t&gt;( n );\n}\n\nuint64_t Wrap32::unwrap( Wrap32 zero_point, uint64_t checkpoint ) const\n{\n  // Your code here.\n  const uint64_t n_low32 { this-&gt;raw_value_ - zero_point.raw_value_ };\n  const uint64_t c_low32 { checkpoint &amp; MASK_LOW_32 };\n  const uint64_t res { ( checkpoint &amp; MASK_HIGH_32 ) | n_low32 };\n  if ( res &gt;= BASE and n_low32 &gt; c_low32 and ( n_low32 - c_low32 ) &gt; ( BASE / 2 ) ) {\n    return res - BASE;\n  }\n  if ( res &lt; MASK_HIGH_32 and c_low32 &gt; n_low32 and ( c_low32 - n_low32 ) &gt; ( BASE / 2 ) ) {\n    return res + BASE;\n  }\n  return res;\n}\n</code></pre> <ul> <li><code>receive</code>\u65b9\u6cd5\u5c06\u5e8f\u5217\u53f7\u8f6c\u6362\u4e3a<code>payload</code>\u7d22\u5f15\uff1b<code>send</code>\u65b9\u6cd5\u8fd4\u56de\u786e\u8ba4\u7684ACK</li> </ul> C++<pre><code>void TCPReceiver::receive( TCPSenderMessage message )\n{\n  // Your code here.\n  if ( writer().has_error() )\n    return;\n  if ( message.RST ) {\n    reader().set_error();\n    return;\n  }\n  if ( !zero_point_.has_value() ) {\n    if ( !message.SYN ) {\n      return;\n    }\n    zero_point_.emplace( message.seqno );\n  }\n  const uint64_t checkpoint { writer().bytes_pushed() + 1 /* SYN */ }; // abs_seqno for expecting payload\n  const uint64_t absolute_seqno { message.seqno.unwrap( zero_point_.value(), checkpoint ) };\n  const uint64_t stream_index { absolute_seqno + static_cast&lt;uint64_t&gt;( message.SYN ) - 1 /* SYN */ };\n  reassembler_.insert( stream_index, move( message.payload ), message.FIN );\n}\n\nTCPReceiverMessage TCPReceiver::send() const\n{\n  // Your code here.\n  const uint16_t window_size { writer().available_capacity() &gt; UINT16_MAX\n                                 ? static_cast&lt;uint16_t&gt;( UINT16_MAX )\n                                 : static_cast&lt;uint16_t&gt;( writer().available_capacity() ) };\n  if ( zero_point_.has_value() ) {\n    const uint64_t ack_for_seqno { writer().bytes_pushed() + 1 + static_cast&lt;uint64_t&gt;( writer().is_closed() ) };\n    return { Wrap32::wrap( ack_for_seqno, zero_point_.value() ), window_size, writer().has_error() };\n  }\n  return { nullopt, window_size, writer().has_error() };\n}\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#tcpsender","title":"TCPSender","text":""},{"location":"blogs/posts/CS144/CS144/#timer","title":"Timer\u5b9e\u73b0","text":"<ul> <li>\u63a7\u5236\u542f\u52a8\u3001\u5173\u95ed\u3001\u91cd\u88c5 <code>RTO</code>\u3001\u91cd\u7f6e\u5b9a\u65f6\u5668\uff1b</li> <li>\u4f7f\u7528<code>tick</code>\u63a5\u53e3\u5b8c\u6210\u8ba1\u65f6\uff1b</li> <li>\u6309\u9700\u4f7f\u5f97 <code>RTO</code>\u7ffb\u500d\u3002</li> </ul> C++<pre><code>class Timer\n{\npublic:\n  explicit Timer( uint64_t initial_RTO_ms ) : RTO_ms_( initial_RTO_ms ) {}\n  [[nodiscard]] constexpr bool is_active() noexcept { return is_active_; }\n  [[nodiscard]] constexpr bool is_expired() noexcept { return is_active_ &amp;&amp; running_time_ &gt;= RTO_ms_; }\n  constexpr void reset() noexcept { running_time_ = 0; }\n  constexpr void exponential_back() noexcept { RTO_ms_ *= 2; }\n  constexpr void reload( uint64_t initail_RTO_ms ) noexcept\n  {\n    RTO_ms_ = initail_RTO_ms;\n    reset();\n  }\n  constexpr void start() noexcept\n  {\n    is_active_ = true;\n    reset();\n  }\n  constexpr void stop() noexcept\n  {\n    is_active_ = false;\n    reset();\n  }\n  constexpr Timer&amp; tick( uint64_t ticks ) noexcept\n  {\n    running_time_ += is_active_ ? ticks : 0;\n    return *this;\n  }\n\nprivate:\n  uint64_t RTO_ms_;\n  bool is_active_ {};\n  uint64_t running_time_ {};\n};\n</code></pre>"},{"location":"blogs/posts/CS144/CS144/#_6","title":"\u65b9\u6cd5\u5b9e\u73b0","text":"<ul> <li><code>push</code>\u5c3d\u53ef\u80fd\u5728\u4e00\u4e2a\u7a97\u53e3\u5c06<code>reader</code>\u7f13\u5b58\u672a\u53d1\u9001\u7684\u6570\u636e\u53d1\u9001\uff1b<code>receive</code>\u786e\u8ba4\u5f53\u524d\u8ddf\u8e2a\u7684\u6d88\u606fack\u5747\u5c0f\u4e8e\u4f20\u6765\u7684ack\uff0c\u4e0d\u518d\u8ddf\u8e2a\u6d88\u606f\uff1b<code>tick</code>\u5b9e\u73b0\u6307\u6570\u56de\u9000\u8d85\u65f6\u548c\u91cd\u4f20</li> </ul> C++<pre><code>void TCPSender::push( const TransmitFunction&amp; transmit )\n{\n  // Your code here.\n  // \u5c3d\u53ef\u80fd\u591a\u7684\u5728\u4e00\u4e2a\u7a97\u53e3\u53d1\u9001\u6570\u636e\n  while ( ( window_size_ == 0 ? 1 : window_size_ ) &gt; total_outstanding_ ) {\n    if ( FIN_sent_ )\n      break;\n    auto message { make_empty_message() };\n    // \u6807\u8bb0\u521d\u59cb\u53d1\u9001\u7684SYN\u5305\n    if ( !SYN_sent_ ) {\n      message.SYN = true;\n      SYN_sent_ = true;\n    }\n    // window_size\u7a7a\u4f59\u5bb9\u91cf(\u5305\u542b\u8be5\u6761\u4fe1\u606f\u7684\u957f\u5ea6)\n    const uint64_t remaining { ( window_size_ == 0 ? 1 : window_size_ ) - total_outstanding_ };\n    // \u8fd8\u80fd\u589e\u52a0payload\u7684\u957f\u5ea6\n    const size_t payload_len { min( TCPConfig::MAX_PAYLOAD_SIZE, remaining - message.sequence_length() ) };\n    auto&amp;&amp; payload { message.payload };\n    while ( reader().bytes_buffered() != 0U &amp;&amp; payload.size() &lt; payload_len ) {\n      string_view view { reader().peek() };\n      // \u5982\u679c\u5f53\u524dview\u957f\u5ea6\u5c0f\u4e8epayload_len\uff0c\u9700\u8981\u518d\u6b21\u8bfb\u53d6\uff0c\u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528\u5faa\u73af\n      view = view.substr( 0, payload_len - payload.size() );\n      payload += view;\n      input_.reader().pop( view.size() );\n    }\n    // \u4f55\u65f6\u589e\u52a0FIN\u6807\u8bb0\n    if ( !FIN_sent_ &amp;&amp; remaining &gt; message.sequence_length() &amp;&amp; reader().is_finished() ) {\n      message.FIN = true;\n      FIN_sent_ = true;\n    }\n\n    if ( message.sequence_length() == 0 )\n      break;\n\n    // \u4f20\u8f93message\n    transmit( message );\n    if ( !timer_.is_active() ) {\n      timer_.start();\n    }\n    next_seqno_ += message.sequence_length();\n    total_outstanding_ += message.sequence_length();\n    track_messages_.push( message );\n  }\n}\n\nvoid TCPSender::receive( const TCPReceiverMessage&amp; msg )\n{\n  // Your code here.\n  // \u9519\u8bef\u5904\u7406\n  if ( input_.has_error() )\n    return;\n  if ( msg.RST ) {\n    input_.set_error();\n    return;\n  }\n\n  window_size_ = msg.window_size;\n  if ( !msg.ackno.has_value() )\n    return;\n  const uint64_t recv_ack_seqno { msg.ackno-&gt;unwrap( isn_, next_seqno_ ) }; // \u63a5\u6536\u5230\u7684ack\u5e8f\u5217\u53f7\n  if ( recv_ack_seqno &gt; next_seqno_ )\n    return; // \u8d85\u8fc7\u671f\u5f85\u5e8f\u5217\u53f7\u7684\u5305\u76f4\u63a5\u4e22\u5f03\n  bool acked { false };\n  // \u4ece\u961f\u5217\u4e2d\u5220\u9664\u5df2\u7ecf\u786e\u8ba4\u7684\u5305\n  while ( !track_messages_.empty() ) {\n    const auto&amp; message { track_messages_.front() };\n    if ( ack_seqno_ + message.sequence_length() &gt; recv_ack_seqno )\n      break; // \u6ca1\u6709\u5b8c\u5168\u88ab\u786e\u8ba4\u7684\u5305\u4e22\u5f03\n    acked = true;\n    ack_seqno_ += message.sequence_length();\n    total_outstanding_ -= message.sequence_length();\n    track_messages_.pop();\n  }\n  // \u6536\u5230ack\u5305\u540e\uff0c\u91cd\u7f6eRTO\n  if ( acked ) {\n    total_retransmit_ = 0;\n    timer_.reload( initial_RTO_ms_ );\n    track_messages_.empty() ? timer_.stop() : timer_.start();\n  }\n}\n\nvoid TCPSender::tick( uint64_t ms_since_last_tick, const TransmitFunction&amp; transmit )\n{\n  // Your code here.\n  // \u53d1\u9001\u7684\u5305\u8d85\u65f6\n  if ( timer_.tick( ms_since_last_tick ).is_expired() ) {\n    if ( track_messages_.empty() )\n      return;\n    transmit( track_messages_.front() );\n    if ( window_size_ != 0 ) {\n      total_retransmit_ += 1;\n      timer_.exponential_back();\n    }\n    timer_.reset();\n  }\n}\n</code></pre>"},{"location":"links/","title":"Links","text":""},{"location":"links/#links","title":"Links \ud83e\udd70","text":"<p>Abstract</p> <p>My friends!</p> <p>\u5728\u4e0b\u65b9\u7559\u8a00\u7533\u8bf7\u52a0\u5165\u6211\u7684\u53cb\u94fe\uff0c\u6309\u5982\u4e0b\u683c\u5f0f\u63d0\u4f9b\u4fe1\u606f\uff1a</p> <ul><li>\u540d\u79f0\uff1atom-jerr's Site</li><li>\u7b80\u4ecb\uff1atomjerr </li><li>\u94fe\u63a5\uff1ahttps://tom-jerr.github.io/</li><li>\u56fe\u7247\uff1aLink of your avatar</li></ul>"},{"location":"notes/","title":"index","text":""},{"location":"notes/#notes","title":"Notes \ud83d\udcda","text":"<p>Abstract</p> <p>\u4e00\u4e9b\u6bd4\u8f83\u6210\u4f53\u7cfb\u7684\u7b14\u8bb0\u90fd\u505a\u5728\u8fd9\u91cc\uff0c\u65b9\u4fbf\u67e5\u9605\u3002</p> <p>\u672c\u90e8\u5206\u5185\u5bb9\uff08\u9664\u7279\u522b\u58f0\u660e\u5916\uff09\u91c7\u7528 \u7f72\u540d-\u975e\u5546\u4e1a\u6027\u4f7f\u7528-\u4fdd\u6301\u4e00\u81f4 4.0 \u56fd\u9645 (CC BY-NC-SA 4.0) \u8bb8\u53ef\u534f\u8bae\u8fdb\u884c\u8bb8\u53ef\u3002</p>"},{"location":"notes/6.824/MapReduce/","title":"MapReduce","text":"<code>#Distributed System</code>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#implement-with-c-personal","title":"Implement with C++ personal","text":"<p> \u7ea6 1065 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>PROJECT(not test carefully)</p>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#_1","title":"\u5e94\u7528\u7684\u57fa\u7840\u67b6\u6784","text":"<ul> <li>Storage</li> <li>Communication (Network)</li> <li>Compute</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#mapreduce","title":"MapReduce \u7f16\u7a0b\u6a21\u578b","text":"<ul> <li>Map: <code>map (k1,v1) \u2192 list(k2,v2)</code></li> <li>input: file or other input pair</li> <li>output: a set of intermediate key/value pairs</li> <li>Reduce: <code>reduce (k2,list(v2)) \u2192 list(v2)</code></li> <li>input: an intermediate key, a set of values for that key</li> <li>output: a possibly smaller set of values</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#mapreduce_1","title":"MapReduce \u5de5\u4f5c\u65b9\u5f0f","text":"","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#_2","title":"\u672f\u8bed","text":"<p>Job\u3002\u6574\u4e2a MapReduce \u8ba1\u7b97\u79f0\u4e3a Job\u3002</p> <ul> <li>\u5bf9\u4e8e\u4e00\u4e2a\u5b8c\u6574\u7684 MapReduce Job\uff0c\u5b83\u7531\u4e00\u4e9b Map Task \u548c\u4e00\u4e9b Reduce Task \u7ec4\u6210   Task\u3002\u6bcf\u4e00\u6b21 MapReduce \u8c03\u7528\u79f0\u4e3a Task\u3002   Shuffle\u3002MapReduce \u4e2d\u4ece\u4e00\u79cd\u5f62\u5f0f\u6570\u636e\u5230\u53e6\u4e00\u79cd\u6570\u636e\u5f62\u5f0f\u7684\u8f6c\u6362</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#_3","title":"\u6d41\u7a0b","text":"<ol> <li> <p>MapReduce \u542f\u52a8\u65f6\uff0c\u4f1a\u67e5\u627e Map \u51fd\u6570\u3002\u4e4b\u540e\uff0cMapReduce \u6846\u67b6\u4f1a\u4e3a\u6bcf\u4e2a\u8f93\u5165\u6587\u4ef6\u8fd0\u884c Map \u51fd\u6570\u3002\u8fd9\u91cc\u53ef\u4ee5\u5e76\u884c\u8fd0\u884c\u591a\u4e2a\u53ea\u5173\u6ce8\u8f93\u5165\u548c\u8f93\u51fa\u7684 Map \u51fd\u6570\u3002</p> </li> <li> <p>\u6240\u6709\u7684\u8f93\u5165\u6587\u4ef6\u90fd\u8fd0\u884c\u4e86 Map \u51fd\u6570\uff0c\u5e76\u5f97\u5230\u4e86\u8bba\u6587\u4e2d\u79f0\u4e4b\u4e3a\u4e2d\u95f4\u8f93\u51fa\uff08intermediate output\uff09\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a Map \u51fd\u6570\u8f93\u51fa\u7684 key-value \u5bf9\u3002\u6b64\u65f6\u8fd9\u4e9b kv \u5bf9\u5728\u5185\u5b58 Buffer \u4e2d\u3002</p> </li> <li>Buffered KV pairs \u4f1a\u901a\u8fc7\u5206\u533a\u51fd\u6570\u5b9a\u671f\u5237\u5199\u5230\u672c\u5730\u78c1\u76d8\u4e0a\uff0c\u672c\u5730\u78c1\u76d8\u4f1a\u6309\u7167 partitioning function \u8fdb\u884c\u903b\u8f91\u5206\u533a\u5206\u6210 R \u4e2a\u533a\u57df\uff0ckv paris \u5728\u78c1\u76d8\u4e2d\u7684\u4f4d\u7f6e\u544a\u77e5\u7ed9 master\uff0c\u540e\u7eed reduce worker \u9700\u8981\u77e5\u9053 kv pairs \u7684\u4f4d\u7f6e\u3002</li> <li>reduce worker \u4f7f\u7528 RPC \u83b7\u53d6\u67d0\u4e2a\u533a\u57df\u7684 kv pairs\uff0c\u5f53 reduce \u83b7\u53d6\u5230\u6240\u6709 map worker \u7684\u67d0\u4e2a\u5206\u533a\u7684 kv pair \u540e\uff0c\u6309\u7167 key \u6765\u6392\u5e8f\uff0c\u5982\u679c\u6392\u5e8f\u65e0\u6cd5\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\uff0c\u4f7f\u7528\u5916\u90e8\u6392\u5e8f\u6765\u5b9e\u73b0\u3002</li> <li>reduce worker \u5bf9\u4e8e\u6bcf\u4e2a\u552f\u4e00\u7684 key\uff0c\u5c06 key \u548c\u5bf9\u5e94\u7684\u4e00\u7cfb\u5217 values \u4f20\u9012\u7ed9\u7528\u6237\u5b9a\u4e49\u7684 reduce \u51fd\u6570</li> <li>\u5f53\u6240\u6709 map \u4efb\u52a1\u548c reduce \u4efb\u52a1\u90fd\u5b8c\u6210\u540e\uff0cmaster \u4f1a\u5524\u9192\u7528\u6237\u8fdb\u7a0b\u3002</li> </ol>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#_4","title":"\u6545\u969c\u5904\u7406","text":"","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#worker-failure","title":"Worker Failure","text":"<ul> <li>master \u7528\u5468\u671f\u6027\u5fc3\u8df3\u76d1\u542c worker \u662f\u5426\u5931\u6548\u3002</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#task-not-completed","title":"task not completed","text":"<ul> <li>\u5982\u679c task \u6ca1\u5b8c\u6210\uff0cworker \u5931\u6548\uff0c\u5c06 task \u6807\u8bb0\u4e3a idle\uff0c\u4ea4\u7ed9 master \u91cd\u65b0\u6765\u8c03\u5ea6\u7ed9\u5176\u4ed6\u53ef\u7528\u7684 worker</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#task-completed","title":"task completed","text":"<ul> <li>\u5df2\u7ecf\u5b8c\u6210\u7684 map task\uff0cworker failed \u9700\u8981\u91cd\u65b0\u6267\u884c\uff0c\u56e0\u4e3a\u4e2d\u95f4\u8f93\u51fa\u5728\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\uff1b\u800c\u5b8c\u6210\u7684 reduce task \u4e0d\u9700\u8981\uff0creduce task \u7684\u8f93\u51fa\u5728 global file system \u4e2d\u3002</li> <li>\u4e00\u65e6\u4e00\u4e2a map task \u7684 worker \u5207\u6362\uff0cmaster \u4f1a\u901a\u77e5\u8fd9\u4e2a\u6d88\u606f\u7ed9 reduce worker\u3002</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#master-failure","title":"Master Failure","text":"<ul> <li>\u56e0\u6b64\uff0c\u5982\u679c\u4e3b\u8282\u70b9\u5931\u8d25\uff0c\u6211\u4eec\u5f53\u524d\u7684\u5b9e\u65bd\u5c06\u4e2d\u6b62 MAPREDUCE \u8ba1\u7b97\u3002\u5ba2\u6237\u53ef\u4ee5\u68c0\u67e5\u6b64\u6761\u4ef6\u5e76\u6839\u636e\u9700\u8981\u91cd\u8bd5 MapReduce \u64cd\u4f5c\u3002</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#other-failure","title":"Other Failure","text":"","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#map","title":"\u5982\u679c\u534f\u8c03\u5668\u7ed9\u4e24\u4e2a\u5de5\u4f5c\u8282\u70b9\u5206\u914d\u76f8\u540c\u7684 Map() \u4efb\u52a1\u600e\u4e48\u529e?","text":"<ul> <li>Master \u5c06\u53ea\u5411 Reduce \u5de5\u4f5c\u8282\u70b9\u62a5\u544a\u5176\u4e2d\u4e00\u4e2a\u3002 <p>map task \u5b8c\u6210\u4efb\u52a1\u4f1a\u5728\u6d88\u606f\u4e2d\u5305\u542b\u4e2d\u95f4\u8f93\u51fa\u7684 R \u4e2a\u4e34\u65f6\u6587\u4ef6\u7684\u540d\u79f0\u3002\u5982\u679c\u4e3b master \u6536\u5230\u5df2\u7ecf\u5b8c\u6210\u7684 map task \u7684\u5b8c\u6210\u6d88\u606f\uff0c\u5219\u5ffd\u7565\u8be5\u6d88\u606f\u3002</p> </li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#reduce","title":"\u5982\u679c\u534f\u8c03\u5668\u7ed9\u4e24\u4e2a\u5de5\u4f5c\u8282\u70b9\u5206\u914d\u76f8\u540c\u7684 Reduce() \u4efb\u52a1\u600e\u4e48\u529e?","text":"<ul> <li>Reduce worker \u90fd\u4f1a\u5c1d\u8bd5\u5728 GFS \u4e0a\u5199\u5165\u540c\u4e00\u4e2a\u8f93\u51fa\u6587\u4ef6\uff01\u539f\u5b50 GFS \u91cd\u547d\u540d\u53ef\u4ee5\u9632\u6b62\u6df7\u5408\uff1b\u53ea\u6709\u4e00\u4e2a\u5b8c\u6574\u7684\u6587\u4ef6\u5c06\u53ef\u89c1\u3002 <p>reduce task \u5b8c\u6210\u540e\u4f1a\u5c06\u4e34\u65f6\u8f93\u51fa\u6587\u4ef6\u91cd\u547d\u540d\u4e3a\u6700\u7ec8\u8f93\u51fa\u6587\u4ef6\uff0c\u4f9d\u9760\u57fa\u7840\u6587\u4ef6\u7cfb\u7edf\u63d0\u4f9b\u7684\u539f\u5b50\u91cd\u547d\u540d\u64cd\u4f5c\u6765\u786e\u4fdd\u6700\u7ec8\u6587\u4ef6\u7cfb\u7edf\u72b6\u6001\u4ec5\u5305\u542b\u4e00\u4e2a\u7531\u51cf\u5c11\u4efb\u52a1\u6267\u884c\u4ea7\u751f\u7684\u6570\u636e</p> </li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#_5","title":"\u5982\u679c\u5355\u4e2a\u5de5\u4f5c\u8282\u70b9\u975e\u5e38\u6162\u2014\u2014\u4e00\u4e2a\u201c\u843d\u540e\u8005\u201d\uff1f","text":"<ul> <li>Master \u5907\u4efd\u6267\u884c\u5269\u4f59\u7684\u8fc7\u7a0b\u4e2d\u4efb\u52a1\u3002\u6bcf\u5f53 Master \u6267\u884c\u6216\u5907\u4efd\u6267\u884c\u5b8c\u6210\u65f6\uff0c\u4efb\u52a1\u88ab\u6807\u8bb0\u4e3a\u5b8c\u6210\u3002</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#_6","title":"\u74f6\u9888","text":"<ul> <li>\u7f51\u7edc\u5e26\u5bbd\u662f\u74f6\u9888\uff0c\u901a\u8fc7 GFS \u5c06\u8f93\u5165\u6587\u4ef6\u5b58\u50a8\u5728\u672c\u5730\u78c1\u76d8\u4e2d</li> <li>MapReduce Master \u8003\u8651\u4e86\u8f93\u5165\u6587\u4ef6\u7684\u4f4d\u7f6e\u4fe1\u606f\uff0c\u5e76\u8bd5\u56fe\u5728\u5305\u542b\u76f8\u5e94\u8f93\u5165\u6570\u636e\u590d\u5236\u7684\u8ba1\u7b97\u673a\u4e0a\u5b89\u6392 MAP \u4efb\u52a1\u3002</li> <li>\u6570\u636e\u4ec5\u4ec5\u5728 Reduce task \u65f6\u4ece map \u78c1\u76d8\u901a\u8fc7\u7f51\u7edc\u62f7\u8d1d\u5230 reduce worker \u7684\u673a\u5668\u4e2d\u3002</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.824/MapReduce/#_7","title":"\u8d1f\u8f7d\u5747\u8861","text":"<ul> <li>\u4efb\u52a1\u6bd4\u5de5\u4f5c\u673a\u5668\u591a\u5f97\u591a\u3002\u534f\u8c03\u5668\u5c06\u65b0\u4efb\u52a1\u5206\u914d\u7ed9\u5b8c\u6210\u5148\u524d\u4efb\u52a1\u7684\u5de5\u4f5c\u5668\u3002\u56e0\u6b64\uff0c\u8f83\u5feb\u7684\u670d\u52a1\u5668\u6267\u884c\u7684\u4efb\u52a1\u6bd4\u6162\u7684\u670d\u52a1\u5668\u591a\u3002\u5e76\u4e14\u6162\u7684\u670d\u52a1\u5668\u5206\u914d\u7684\u5de5\u4f5c\u91cf\u8f83\u5c11\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u5bf9\u63a5\u603b\u65f6\u95f4\u7684\u5f71\u54cd\u3002</li> </ul>","tags":["Distributed System"]},{"location":"notes/6.s081/1-OS%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7/","title":"1-OS\u7684\u9694\u79bb\u6027","text":"<code>#Operator System</code>","tags":["Operator System"]},{"location":"notes/6.s081/1-OS%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7/#os","title":"OS \u7684\u9694\u79bb\u6027","text":"<p> \u7ea6 457 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p> <ul> <li>\u9700\u8981\u4e0d\u540c\u7684\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u6709\u5f3a\u9694\u79bb\u6027</li> <li>\u9700\u8981 OS \u4e0e\u5e94\u7528\u7a0b\u5e8f\u95f4\u4e5f\u6709\u5f3a\u9694\u79bb\u6027</li> </ul> <p>OS \u9694\u79bb\u4fdd\u8bc1 multiplexing \u548c\u5185\u5b58\u9694\u79bb</p> <ul> <li>multiplexing\uff08CPU \u5728\u591a\u8fdb\u7a0b\u540c\u5206\u65f6\u590d\u7528\uff09\uff1a\u4e0d\u8bba\u5e94\u7528\u7a0b\u5e8f\u5728\u6267\u884c\u4ec0\u4e48\u64cd\u4f5c\uff0cmultiplexing \u90fd\u4f1a\u8feb\u4f7f\u5e94\u7528\u7a0b\u5e8f\u65f6\u4e0d\u65f6\u7684\u91ca\u653e CPU\uff0c\u8fd9\u6837\u5176\u4ed6\u7684\u5e94\u7528\u7a0b\u5e8f\u624d\u80fd\u8fd0\u884c\u3002</li> <li>\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u7684\u5185\u5b58\u662f\u9694\u79bb\u7684\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u4e0d\u4f1a\u76f8\u4e92\u8986\u76d6</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/1-OS%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7/#_1","title":"\u786c\u4ef6\u652f\u6301\u5f3a\u9694\u79bb","text":"<ul> <li>uer/kernel mode</li> <li>\u5728\u5904\u7406\u5668\u91cc\u9762\u6709\u4e00\u4e2a flag\u3002\u5728\u5904\u7406\u5668\u7684\u4e00\u4e2a bit\uff0c\u5f53\u5b83\u4e3a 1 \u7684\u65f6\u5019\u662f user mode\uff0c\u5f53\u5b83\u4e3a 0 \u65f6\u662f kernel mode\u3002\u5f53\u5904\u7406\u5668\u5728\u89e3\u6790\u6307\u4ee4\u65f6\uff0c\u5982\u679c\u6307\u4ee4\u662f\u7279\u6b8a\u6743\u9650\u6307\u4ee4\uff0c\u5e76\u4e14\u8be5 bit \u88ab\u8bbe\u7f6e\u4e3a 1</li> <li>virtual memory</li> <li>\u5904\u7406\u5668\u5305\u542b\u4e86 page table\uff0c\u800c page table \u5c06\u865a\u62df\u5185\u5b58\u5730\u5740\u4e0e\u7269\u7406\u5185\u5b58\u5730\u5740\u505a\u4e86\u5bf9\u5e94</li> <li>\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u53ea\u80fd\u8bbf\u95ee\u51fa\u73b0\u5728\u81ea\u5df1 page table \u4e2d\u7684\u7269\u7406\u5185\u5b58</li> <li>\u5185\u6838\uff1aTrusted Computing Base (TCB)</li> <li>\u5b8f\u5185\u6838\uff1a\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\u670d\u52a1\u90fd\u5728 kernel mode</li> <li>\u5fae\u5185\u6838\uff1a\u5c06\u5927\u90e8\u5206\u7684\u64cd\u4f5c\u7cfb\u7edf\u8fd0\u884c\u5728\u5185\u6838\u4e4b\u5916\uff1b\u4f7f\u7528 IPC \u8fdb\u884c\u901a\u4fe1<ul> <li>\u5728 user/kernel mode \u53cd\u590d\u8df3\u8f6c\u5e26\u6765\u7684\u6027\u80fd\u635f\u8017\u3002</li> <li>\u5728\u4e00\u4e2a\u7c7b\u4f3c\u5b8f\u5185\u6838\u7684\u7d27\u8026\u5408\u7cfb\u7edf\uff0c\u5404\u4e2a\u7ec4\u6210\u90e8\u5206\uff0c\u4f8b\u5982\u6587\u4ef6\u7cfb\u7edf\u548c\u865a\u62df\u5185\u5b58\u7cfb\u7edf\uff0c\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u5171\u4eab page cache\u3002\u800c\u5728\u5fae\u5185\u6838\u4e2d\uff0c\u6bcf\u4e2a\u90e8\u5206\u4e4b\u95f4\u90fd\u5f88\u597d\u7684\u9694\u79bb\u5f00\u4e86\uff0c\u8fd9\u79cd\u5171\u4eab\u66f4\u96be\u5b9e\u73b0\u3002\u8fdb\u800c\u5bfc\u81f4\u66f4\u96be\u5728\u5fae\u5185\u6838\u4e2d\u5f97\u5230\u66f4\u9ad8\u7684\u6027\u80fd\u3002</li> </ul> </li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/1-OS%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7/#os_1","title":"OS \u7684\u9632\u5fa1\u6027","text":"<ul> <li>\u5fc5\u987b\u5177\u5907\u9632\u5fa1\u6027\u62b5\u5fa1\u6076\u610f\u7a0b\u5e8f\u7684\u653b\u51fb</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/","title":"2-\u865a\u62df\u5185\u5b58\u7684\u5b9e\u73b0","text":"<code>#Operator System</code>","tags":["Operator System"]},{"location":"notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/#_1","title":"\u865a\u62df\u5185\u5b58\u5b9e\u73b0","text":"<p> \u7ea6 972 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p>","tags":["Operator System"]},{"location":"notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/#_2","title":"\u9875\u8868","text":"<ul> <li>\u786c\u4ef6\u901a\u8fc7\u5904\u7406\u5668\u548c MMU\uff08Memory Management Unit\uff09\u5b9e\u73b0</li> <li>\u4efb\u4f55\u4e00\u6761\u5730\u5740\u5e94\u8be5\u8ba4\u4e3a\u662f\u865a\u62df\u5185\u5b58\u5730\u5740\uff1b\u8be5\u5730\u5740\u4f1a\u8f6c\u5230 MMU\uff0cMMU \u7ffb\u8bd1\u4e3a\u7269\u7406\u5730\u5740\uff0c\u4ece\u7269\u7406\u5730\u5740\u52a0\u8f7d</li> <li> <p>MMU \u53ea\u662f\u53bb\u67e5\u770b page table\uff0cpage table \u5b58\u5728\u4e8e\u5185\u5b58\u4e2d</p> </li> <li> <p>\u865a\u62df\u5185\u5b58\u5730\u5740\u53ea\u4f7f\u7528\u4e86\u4f4e 39bit\uff1b\u4f4e 12bit \u4f5c\u4e3a\u9875\u5185\u5730\u5740\u504f\u79fb\uff08offset\uff09\uff0c\u9ad8 27bit \u662f\u7d22\u5f15\u9875\u7684 index\uff0c\u5b9e\u9645\u4e0a\u662f\u7531 3 \u4e2a 9bit \u7684\u6570\u5b57\u7ec4\u6210\uff08L2\uff0cL1\uff0cL0\uff09\u3002\u524d 9 \u4e2a bit \u88ab\u7528\u6765\u7d22\u5f15\u6700\u9ad8\u7ea7\u7684 page directory\uff08\u6ce8\uff1a\u901a\u5e38 page directory \u662f\u7528\u6765\u7d22\u5f15 page table \u6216\u8005\u5176\u4ed6 page directory \u7269\u7406\u5730\u5740\u7684\u8868\u5355</p> </li> <li>\u7528 44bit \u7684 PPN\uff0c\u518d\u52a0\u4e0a 12bit \u7684 0\uff0c\u8fd9\u6837\u5c31\u5f97\u5230\u4e86\u4e0b\u4e00\u7ea7 page directory \u7684 56bit \u7269\u7406\u5730\u5740\u3002\u8fd9\u91cc\u8981\u6c42\u6bcf\u4e2a page directory \u90fd\u4e0e\u7269\u7406 page \u5bf9\u9f50</li> </ul> <p></p> <ul> <li>3 \u7ea7\u9875\u8868\u7531\u786c\u4ef6\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5 3 \u7ea7 page table \u7684\u67e5\u627e\u90fd\u53d1\u751f\u5728\u786c\u4ef6\u4e2d\u3002MMU \u662f\u786c\u4ef6\u7684\u4e00\u90e8\u5206\u800c\u4e0d\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\u3002</li> <li>\u5728 XV6 \u4e2d\uff0c\u6709\u4e00\u4e2a\u51fd\u6570\u4e5f\u5b9e\u73b0\u4e86 page table \u7684\u67e5\u627e\uff0c\u56e0\u4e3a\u65f6\u4e0d\u65f6\u7684 XV6 \u4e5f\u9700\u8981\u5b8c\u6210\u786c\u4ef6\u7684\u5de5\u4f5c\uff0c\u6240\u4ee5 XV6 \u6709\u8fd9\u4e2a\u53eb\u505a walk \u7684\u51fd\u6570\uff0c\u5b83\u5728\u8f6f\u4ef6\u4e2d\u5b9e\u73b0\u4e86 MMU \u786c\u4ef6\u76f8\u540c\u7684\u529f\u80fd\u3002</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/#pte","title":"PTE \u7ed3\u6784","text":"<ul> <li>\u7b2c\u4e00\u4e2a\u6807\u5fd7\u4f4d\u662f Valid\u3002\u5982\u679c Valid bit \u4f4d\u4e3a 1\uff0c\u90a3\u4e48\u8868\u660e\u8fd9\u662f\u4e00\u6761\u5408\u6cd5\u7684 PTE\uff0c\u4f60\u53ef\u4ee5\u7528\u5b83\u6765\u505a\u5730\u5740\u7ffb\u8bd1\u3002\u5bf9\u4e8e\u521a\u521a\u4e3e\u5f97\u90a3\u4e2a\u5c0f\u4f8b\u5b50\uff08\u5e94\u7528\u7a0b\u5e8f\u53ea\u7528\u4e86 1 \u4e2a page \u7684\u4f8b\u5b50\uff09\uff0c\u6211\u4eec\u53ea\u4f7f\u7528\u4e86 3 \u4e2a page directory\uff0c\u6bcf\u4e2a page directory \u4e2d\u53ea\u6709\u7b2c 0 \u4e2a PTE \u88ab\u4f7f\u7528\u4e86\uff0c\u6240\u4ee5\u53ea\u6709\u7b2c 0 \u4e2a PTE \u7684 Valid bit \u4f4d\u4f1a\u88ab\u8bbe\u7f6e\u6210 1\uff0c\u5176\u4ed6\u7684 511 \u4e2a PTE \u7684 Valid bit \u4e3a 0\u3002\u8fd9\u4e2a\u6807\u5fd7\u4f4d\u544a\u8bc9 MMU\uff0c\u4f60\u4e0d\u80fd\u4f7f\u7528\u8fd9\u6761 PTE\uff0c\u56e0\u4e3a\u8fd9\u6761 PTE \u5e76\u4e0d\u5305\u542b\u6709\u7528\u7684\u4fe1\u606f\u3002</li> <li>\u4e0b\u4e24\u4e2a\u6807\u5fd7\u4f4d\u5206\u522b\u662f Readable \u548c Writable\u3002\u8868\u660e\u4f60\u662f\u5426\u53ef\u4ee5\u8bfb/\u5199\u8fd9\u4e2a page\u3002</li> <li>Executable \u8868\u660e\u4f60\u53ef\u4ee5\u4ece\u8fd9\u4e2a page \u6267\u884c\u6307\u4ee4\u3002</li> <li>User \u8868\u660e\u8fd9\u4e2a page \u53ef\u4ee5\u88ab\u8fd0\u884c\u5728\u7528\u6237\u7a7a\u95f4\u7684\u8fdb\u7a0b\u8bbf\u95ee</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/#tlb","title":"TLB","text":"<ul> <li> <p>\u6bcf\u4e2a\u6838\u6709\u81ea\u5df1\u7684 MMU \u548c TLB</p> </li> <li> <p>\u5982\u679c\u5207\u6362 page table\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u544a\u8bc9\u5904\u7406\u5668\u5f53\u524d\u6b63\u5728\u5207\u6362 page table\uff0c\u5904\u7406\u5668\u4f1a\u6e05\u7a7a TLB\u3002\u56e0\u4e3a\u672c\u8d28\u4e0a\u6765\u8bf4\uff0c\u5982\u679c\u4f60\u5207\u6362\u4e86 page table\uff0cTLB \u4e2d\u7684\u7f13\u5b58\u5c06\u4e0d\u518d\u6709\u7528\uff0c\u5b83\u4eec\u9700\u8981\u88ab\u6e05\u7a7a\uff0c\u5426\u5219\u5730\u5740\u7ffb\u8bd1\u53ef\u80fd\u4f1a\u51fa\u9519\u3002</p> </li> <li>\u5728 RISC-V \u4e2d\uff0c\u6e05\u7a7a TLB \u7684\u6307\u4ee4\u662f sfence_vma</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/#_3","title":"\u865a\u62df\u5730\u5740\u6620\u5c04","text":"","tags":["Operator System"]},{"location":"notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/#_4","title":"\u6620\u5c04\u8fc7\u7a0b","text":"<p>CPU \u5c06\u865a\u62df\u5730\u5740\u4f20\u5165 MMU\uff0cMMU \u6839\u636e SATP \u4e2d\u7684\u503c\u5224\u65ad\u662f\u5426\u8fdb\u884c\u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58\u7684\u6620\u5c04</p> <ul> <li>SATP=0\uff0c\u865a\u62df\u5730\u5740\u5c31\u662f\u7269\u7406\u5730\u5740</li> <li>SATP \u4e3a\u9875\u8868\u7684\u6839\u5730\u5740\uff0c\u8fdb\u884c\u7269\u7406\u9875\u7684\u7d22\u5f15</li> </ul> <p></p>","tags":["Operator System"]},{"location":"notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/#_5","title":"\u5185\u6838","text":"<ul> <li>free memory \u6765\u5b58\u653e\u7528\u6237\u8fdb\u7a0b\u7684 page table\uff0ctext \u548c data\u3002\u5982\u679c\u6211\u4eec\u8fd0\u884c\u4e86\u975e\u5e38\u591a\u7684\u7528\u6237\u8fdb\u7a0b\uff0c\u67d0\u4e2a\u65f6\u95f4\u70b9\u6211\u4eec\u4f1a\u8017\u5c3d\u8fd9\u6bb5\u5185\u5b58\uff0c\u8fd9\u4e2a\u65f6\u5019 fork \u6216\u8005 exec \u4f1a\u8fd4\u56de\u9519\u8bef\u3002</li> <li> <p>\u5de6\u4fa7\u4f4e\u4e8e PHYSTOP \u7684\u865a\u62df\u5730\u5740\uff0c\u4e0e\u53f3\u4fa7\u4f7f\u7528\u7684\u7269\u7406\u5730\u5740\u662f\u4e00\u6837\u7684\u3002</p> </li> <li> <p>kernel stack \u4e4b\u4e0b\u6709\u4e00\u4e2a\u672a\u88ab\u6620\u5c04\u7684 Guard page\uff0c\u8fd9\u4e2a Guard page \u5bf9\u5e94\u7684 PTE \u7684 Valid \u6807\u5fd7\u4f4d\u6ca1\u6709\u8bbe\u7f6e\uff0c\u8fd9\u6837\uff0c\u5982\u679c kernel stack \u8017\u5c3d\u4e86\uff0c\u5b83\u4f1a\u6ea2\u51fa\u5230 Guard page\uff0c\u4f46\u662f\u56e0\u4e3a Guard page \u7684 PTE \u4e2d Valid \u6807\u5fd7\u4f4d\u672a\u8bbe\u7f6e\uff0c\u4f1a\u5bfc\u81f4\u7acb\u5373\u89e6\u53d1 page fault\uff1bGuard page \u4e0d\u4f1a\u6620\u5c04\u5230\u4efb\u4f55\u7269\u7406\u5185\u5b58\uff0c\u5b83\u53ea\u662f\u5360\u636e\u4e86\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u4e00\u6bb5\u9760\u540e\u7684\u5730\u5740\u3002</p> </li> <li>kernel stack \u88ab\u6620\u5c04\u4e86\u4e24\u6b21\uff0c\u5728\u9760\u540e\u7684\u865a\u62df\u5730\u5740\u6620\u5c04\u4e86\u4e00\u6b21\uff0c\u5728 PHYSTOP \u4e0b\u7684 Kernel data \u4e2d\u53c8\u6620\u5c04\u4e86\u4e00\u6b21\uff0c\u4f46\u662f\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\u7528\u7684\u662f\u4e0a\u9762\u7684\u90e8\u5206\uff0c\u56e0\u4e3a\u6709 Guard page \u4f1a\u66f4\u52a0\u5b89\u5168\u3002</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/#_6","title":"\u7528\u6237","text":"","tags":["Operator System"]},{"location":"notes/6.s081/3-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%92%8C%E9%99%B7%E5%85%A5/","title":"3-\u7cfb\u7edf\u8c03\u7528\u548c\u9677\u5165","text":"<code>#Operator System</code>","tags":["Operator System"]},{"location":"notes/6.s081/3-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%92%8C%E9%99%B7%E5%85%A5/#system-calls-and-trap","title":"System calls and Trap","text":"<p> \u7ea6 1393 \u4e2a\u5b57  5 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <ul> <li>\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u5207\u6362\uff08trap\uff09</li> <li>\u7a0b\u5e8f\u6267\u884c\u7cfb\u7edf\u8c03\u7528\uff08System call\uff09</li> <li>\u7a0b\u5e8f\u51fa\u73b0\u4e86\u7c7b\u4f3c page fault\u3001\u9664 0 \u7b49\u5f02\u5e38\uff08\u8f6f\u4ef6\u4e2d\u65ad\uff09</li> <li>\u786c\u4ef6\u4e2d\u65ad\uff08IO \u8bbe\u5907\uff09</li> <li>RISC-V \u5bc4\u5b58\u5668</li> <li>32 \u4e2a\u901a\u7528\u5bc4\u5b58\u5668</li> <li>PC\uff08\u7a0b\u5e8f\u8ba1\u6570\u5668\uff09</li> <li>Mode\uff08\u8868\u660e\u4f4d\u4e8e\u4f55\u79cd\u72b6\u6001 user or supervisor\uff09</li> <li>SATP\uff08\u6307\u5411\u9875\u8868\u7684\u7269\u7406\u5730\u5740\uff09</li> <li>SEPC\uff08\u6307\u5411 trap \u6307\u4ee4\u7684\u8d77\u59cb\u5730\u5740\uff09</li> <li>STVEC \uff08\u4e5f\u5c31\u662f\u5904\u7406 trap \u7684\u5185\u6838\u6307\u4ee4\u5730\u5740\uff09</li> <li>SSRATCH\uff08\u4ea4\u6362\u9875\u8868\u548c a0 \u5730\u5740\uff09</li> <li>\u5185\u6838\u6001\u6743\u9650</li> <li>\u8bfb\u5199\u63a7\u5236\u5bc4\u5b58\u5668\uff1aSATP\u3001STVEC\u3001SEPC</li> <li>\u5b83\u53ef\u4ee5\u4f7f\u7528 PTE_U \u6807\u5fd7\u4f4d\u4e3a 0 \u7684 PTE</li> <li>supervisor mode \u4e2d\u7684\u4ee3\u7801\u5e76\u4e0d\u80fd\u8bfb\u5199\u4efb\u610f\u7269\u7406\u5730\u5740\uff0c\u901a\u8fc7 page table \u8bbf\u95ee\u5185\u5b58</li> <li>\u7528\u6237\u6001\u8df3\u5165\u5185\u6838\u6001\u524d</li> <li>\u4fdd\u5b58\u7528\u6237\u6001 32 \u4e2a\u5bc4\u5b58\u5668</li> <li>\u4fdd\u5b58 PC</li> <li>\u6539\u53d8 Mode \u4e3a Supervisor</li> <li>\u6539\u53d8 SATP \u5bc4\u5b58\u5668\u6307\u5411\u5185\u6838\u9875\u8868</li> <li>\u5c06\u5806\u6808\u5bc4\u5b58\u5668\u6307\u5411\u5185\u6838\u7684\u5730\u5740</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/3-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%92%8C%E9%99%B7%E5%85%A5/#trap","title":"Trap \u6267\u884c\u6d41\u7a0b","text":"<ul> <li> <p>\u5728\u4ece\u7528\u6237\u7a7a\u95f4\u8fdb\u5165\u5230\u5185\u6838\u7a7a\u95f4\u4e4b\u524d\uff0c\u5185\u6838\u4f1a\u8bbe\u7f6e\u597d STVEC \u5bc4\u5b58\u5668\u6307\u5411 trampoline page</p> </li> <li> <p>ecall\uff08CPU \u6307\u4ee4\uff09\u5207\u6362\u5230 Supervisor mode</p> </li> <li> <p>\u6b64\u65f6\u5e76\u672a\u5207\u6362 page table\uff0c\u4ecd\u7136\u662f\u7528\u6237\u9875\u8868\uff0c\u4ee3\u7801\u6b63\u5728 trampoline page \u7684\u6700\u5f00\u59cb</p> </li> <li>\u4fdd\u5b58 PC \u5230 SEPC \u5bc4\u5b58\u5668</li> <li>ecall \u4f1a\u8df3\u8f6c\u5230 STVEC \u5bc4\u5b58\u5668\u6307\u5411\u7684\u6307\u4ee4</li> </ul> <p>RISC-V \u79c9\u6301\u4e86\u8fd9\u6837\u4e00\u4e2a\u89c2\u70b9\uff1aecall \u53ea\u5b8c\u6210\u5c3d\u91cf\u5c11\u5fc5\u987b\u8981\u5b8c\u6210\u7684\u5de5\u4f5c\uff0c\u5176\u4ed6\u7684\u5de5\u4f5c\u90fd\u4ea4\u7ed9\u8f6f\u4ef6\u5b8c\u6210\u3002\u8fd9\u91cc\u7684\u539f\u56e0\u662f\uff0cRISC-V \u8bbe\u8ba1\u8005\u60f3\u8981\u4e3a\u8f6f\u4ef6\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u7a0b\u5e8f\u5458\u63d0\u4f9b\u6700\u5927\u7684\u7075\u6d3b\u6027\uff0c\u8fd9\u6837\u4ed6\u4eec\u5c31\u80fd\u6309\u7167\u4ed6\u4eec\u60f3\u8981\u7684\u65b9\u5f0f\u5f00\u53d1\u64cd\u4f5c\u7cfb\u7edf</p> <ul> <li> <p>uservec\uff1a\u6c47\u7f16\u8bed\u8a00\u4ee3\u7801\uff0ctrampoline.s \u6587\u4ef6\u7684\u4e00\u90e8\u5206</p> </li> <li> <p>\u5185\u6838\u4f1a\u5c06 trapframe page \u7684\u5730\u5740\u4fdd\u5b58 SSCRATCH \u5bc4\u5b58\u5668</p> <p>\u7528\u6237\u6620\u5c04\u4e86 trapframe page\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684 trapframe page\uff1b\u7528\u8be5\u7ed3\u6784\u4fdd\u5b58 32 \u4e2a\u7528\u6237\u5bc4\u5b58\u5668</p> <p>\u5728\u5185\u6838\u524d\u4e00\u6b21\u5207\u6362\u56de\u7528\u6237\u7a7a\u95f4\u65f6\uff0c\u5185\u6838\u4f1a\u6267\u884c set sscratch \u6307\u4ee4\uff0c\u5c06\u8fd9\u4e2a\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u8bbe\u7f6e\u4e3a 0x3fffffe000\uff0c\u4e5f\u5c31\u662f trapframe page \u7684\u865a\u62df\u5730\u5740</p> <p>\u5728\u8fd4\u56de\u7528\u6237\u7a7a\u95f4\u524d\uff0c\u8bbe\u7f6e a0 \u4e3a trapframe page \u7684\u865a\u62df\u5730\u5740\uff0c\u540c\u65f6\u5207\u6362\u9875\u8868\u4e3a\u7528\u6237\u9875\u8868</p> C<pre><code>uint64 fn = TRAMPOLINE + (userret - trampoline);\n((void(*)(uint64,uint64))fn)(TRAPFRAME, satp);\n</code></pre> </li> <li> <p>\u5207\u6362\u5230\u5185\u6838\u9875\u8868\uff1b\u56e0\u4e3a\u4e8c\u8005\u6620\u5c04\u7684\u7269\u7406\u5730\u5740\u76f8\u540c\uff0c\u5207\u6362\u540e\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u800c\u4e0d\u5d29\u6e83</p> <p>trampoline page \u5728 user page table \u4e2d\u7684\u6620\u5c04\u4e0e kernel page table \u4e2d\u7684\u6620\u5c04\u662f\u5b8c\u5168\u4e00\u6837\u7684\u3002\u8fd9\u4e24\u4e2a page table \u4e2d\u5176\u4ed6\u6240\u6709\u7684\u6620\u5c04\u90fd\u662f\u4e0d\u540c\u7684\uff0c\u53ea\u6709 trampoline page \u7684\u6620\u5c04\u662f\u4e00\u6837\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u5207\u6362 page table \u65f6\uff0c\u5bfb\u5740\u7684\u7ed3\u679c\u4e0d\u4f1a\u6539\u53d8\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5728\u540c\u4e00\u4e2a\u4ee3\u7801\u5e8f\u5217\u4e2d\u6267\u884c\u7a0b\u5e8f\u800c\u4e0d\u5d29\u6e83</p> </li> <li> <p>\u8df3\u5165 usertrap \u51fd\u6570</p> </li> <li> <p>usertrap</p> </li> <li> <p>\u5148\u5c06 STVEC \u6307\u5411\u4e86 kernelvec \u53d8\u91cf\uff0c\u8fd9\u662f\u5185\u6838\u7a7a\u95f4 trap \u5904\u7406\u4ee3\u7801\u7684\u4f4d\u7f6e</p> <p>\u6211\u4eec\u9700\u8981\u77e5\u9053\u5f53\u524d\u8fd0\u884c\u7684\u662f\u4ec0\u4e48\u8fdb\u7a0b\uff0c\u6211\u4eec\u901a\u8fc7\u8c03\u7528 myproc \u51fd\u6570\u6765\u505a\u5230\u8fd9\u4e00\u70b9\u3002myproc \u51fd\u6570\u5b9e\u9645\u4e0a\u4f1a\u67e5\u627e\u4e00\u4e2a\u6839\u636e\u5f53\u524d CPU \u6838\u7684\u7f16\u53f7\u7d22\u5f15\u7684\u6570\u7ec4\uff0cCPU \u6838\u7684\u7f16\u53f7\u662f hartid\uff0c\u5982\u679c\u4f60\u8fd8\u8bb0\u5f97\uff0c\u6211\u4eec\u4e4b\u524d\u5728 uservec \u51fd\u6570\u4e2d\u5c06\u5b83\u5b58\u5728\u4e86 tp \u5bc4\u5b58\u5668\u3002\u8fd9\u662f myproc \u51fd\u6570\u627e\u51fa\u5f53\u524d\u8fd0\u884c\u8fdb\u7a0b\u7684\u65b9\u6cd5\u3002</p> </li> <li> <p>\u5f53\u7a0b\u5e8f\u8fd8\u5728\u5185\u6838\u4e2d\u6267\u884c\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5e76\u8fdb\u5165\u5230\u90a3\u4e2a\u7a0b\u5e8f\u7684\u7528\u6237\u7a7a\u95f4\uff0c\u7136\u540e\u90a3\u4e2a\u8fdb\u7a0b\u53ef\u80fd\u518d\u8c03\u7528\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u8fdb\u800c\u5bfc\u81f4 SEPC \u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u88ab\u8986\u76d6\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u4fdd\u5b58\u5f53\u524d\u8fdb\u7a0b\u7684 SEPC \u5bc4\u5b58\u5668\u5230\u4e00\u4e2a\u4e0e\u8be5\u8fdb\u7a0b\u5173\u8054\u7684\u5185\u5b58\u4e2d</p> C<pre><code>p-&gt;trapframe-epc = r_sepc();\n</code></pre> </li> <li> <p>syscall</p> </li> <li> <p>\u6839\u636e\u7cfb\u7edf\u8c03\u7528\u7684\u7f16\u53f7\u67e5\u627e\u76f8\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002Shell \u8c03\u7528\u7684 write \u51fd\u6570\u5c06 a7 \u8bbe\u7f6e\u6210\u4e86\u7cfb\u7edf\u8c03\u7528\u7f16\u53f7 16</p> </li> <li> <p>\u5411 trapframe \u4e2d\u7684 a0 \u8d4b\u503c\uff0c\u6240\u6709\u7684\u7cfb\u7edf\u8c03\u7528\u90fd\u6709\u4e00\u4e2a\u8fd4\u56de\u503c</p> </li> <li> <p>usertrapret</p> </li> <li> <p>\u5173\u95ed\u4e2d\u65ad</p> </li> <li>\u8bbe\u7f6e\u4e86 STVEC \u5bc4\u5b58\u5668\u6307\u5411 trampoline \u4ee3\u7801\uff0c\u5728\u90a3\u91cc\u6700\u7ec8\u4f1a\u6267\u884c sret \u6307\u4ee4\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4</li> <li>\u8bbe\u7f6e trapframe \u53c2\u6570\u4f9b\u4e0b\u4e00\u6b21 trap \u4f7f\u7528<ul> <li>\u5b58\u50a8\u4e86 kernel page table \u7684\u6307\u9488</li> <li>\u5b58\u50a8\u4e86\u5f53\u524d\u7528\u6237\u8fdb\u7a0b\u7684 kernel stack</li> <li>\u5b58\u50a8\u4e86 usertrap \u51fd\u6570\u7684\u6307\u9488\uff0c\u8fd9\u6837 trampoline \u4ee3\u7801\u624d\u80fd\u8df3\u8f6c\u5230\u8fd9\u4e2a\u51fd\u6570</li> <li>\u4ece tp \u5bc4\u5b58\u5668\u4e2d\u8bfb\u53d6\u5f53\u524d\u7684 CPU \u6838\u7f16\u53f7\uff0c\u5e76\u5b58\u50a8\u5728 trapframe \u4e2d\uff0c\u8fd9\u6837 trampoline \u4ee3\u7801\u624d\u80fd\u6062\u590d\u8fd9\u4e2a\u6570\u5b57\uff0c\u56e0\u4e3a\u7528\u6237\u4ee3\u7801\u53ef\u80fd\u4f1a\u4fee\u6539\u8fd9\u4e2a\u6570\u5b57</li> </ul> </li> <li>\u8bbe\u7f6e SSTATUS \u5bc4\u5b58\u5668</li> <li>SEPC \u5bc4\u5b58\u5668\u7684\u503c\u8bbe\u7f6e\u6210\u4e4b\u524d\u4fdd\u5b58\u7684\u7528\u6237\u7a0b\u5e8f\u8ba1\u6570\u5668\u7684\u503c</li> <li>\u6839\u636e user page table \u5730\u5740\u751f\u6210\u76f8\u5e94\u7684 SATP \u503c</li> <li>trapframe \u5730\u5740\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1b\u5c06 page table \u6307\u9488\u51c6\u5907\u597d\uff0c\u5e76\u5c06\u8fd9\u4e2a\u6307\u9488\u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f20\u9012\u7ed9\u6c47\u7f16\u4ee3\u7801\uff0c\u8fd9\u4e2a\u53c2\u6570\u4f1a\u51fa\u73b0\u5728 a1 \u5bc4\u5b58\u5668\uff1bfn \u4e3a\u51fd\u6570\u8df3\u8f6c\u4f4d\u7f6e</li> </ul> C<pre><code>uint64 fn = TRAMPOLINE + (userret - trampoline);\n((void(*)(uint64,uint64))fn)(TRAPFRAME, satp);\n</code></pre> <ul> <li> <p>userret\uff0c\u4f4d\u4e8e trampoline.s \u6587\u4ef6</p> </li> <li> <p>\u5207\u6362\u4e3a\u7528\u6237\u9875\u8868</p> </li> <li>\u4e4b\u524d\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u7684\u503c\u52a0\u8f7d\u5230\u5bf9\u5e94\u7684\u5404\u4e2a\u5bc4\u5b58\u5668\u4e2d</li> <li> <p>\u4ea4\u6362 SSCRATCH \u5bc4\u5b58\u5668\u548c a0 \u5bc4\u5b58\u5668\u7684\u503c\uff0c\u4fdd\u8bc1 SSCRATCH \u6301\u6709\u7684\u662f trapframe \u7684\u5730\u5740</p> </li> <li> <p>sret</p> <ul> <li>\u7a0b\u5e8f\u5207\u6362\u4e3a user mode</li> <li>SEPC \u7684\u503c\u62f7\u8d1d\u5230 PC</li> <li>\u5f00\u4e2d\u65ad</li> </ul> </li> </ul> <ul> <li>\u786c\u4ef6\u548c\u8f6f\u4ef6\u9700\u8981\u534f\u540c\u5de5\u4f5c\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u91cd\u65b0\u8bbe\u8ba1 XV6\uff0c\u91cd\u65b0\u8bbe\u8ba1 RISC-V \u6765\u4f7f\u5f97\u8fd9\u91cc\u7684\u5904\u7406\u6d41\u7a0b\u66f4\u52a0\u7b80\u5355\uff0c\u66f4\u52a0\u5feb\u901f\u3002</li> <li>\u53e6\u4e00\u4e2a\u9700\u8981\u65f6\u523b\u8bb0\u4f4f\u7684\u95ee\u9898\u662f\uff0c\u6076\u610f\u8f6f\u4ef6\u662f\u5426\u80fd\u6ee5\u7528\u8fd9\u91cc\u7684\u673a\u5236\u6765\u6253\u7834\u9694\u79bb\u6027\u3002</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/","title":"4-\u7f3a\u9875\u4e2d\u65ad","text":"<code>#Operator System</code>","tags":["Operator System"]},{"location":"notes/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/#page-fault","title":"Page Fault","text":"<p> \u7ea6 985 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <ul> <li>\u901a\u8fc7 page fault \u53ef\u4ee5\u5b9e\u73b0\u7684\u4e00\u7cfb\u5217\u865a\u62df\u5185\u5b58\u529f\u80fd</li> <li>lazy allocation</li> <li>copy-on-write fork</li> <li>demand paging</li> <li>memory mapped files</li> <li> <p>\u865a\u62df\u5185\u5b58\u597d\u5904</p> </li> <li> <p>isolation\uff0c\u9694\u79bb\u6027\uff1b\u865a\u62df\u5185\u5b58\u4f7f\u5f97\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u5c5e\u4e8e\u5b83\u4eec\u81ea\u5df1\u7684\u5730\u5740\u7a7a\u95f4</p> </li> <li> <p>level of indirection\uff0c\u63d0\u4f9b\u4e86\u4e00\u5c42\u62bd\u8c61\uff0c\u5904\u7406\u5668\u548c\u6240\u6709\u7684\u6307\u4ee4\u90fd\u53ef\u4ee5\u4f7f\u7528\u865a\u62df\u5730\u5740\uff0c\u5185\u6838\u4f1a\u5b9a\u4e49\u4ece\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb</p> </li> <li> <p>page fault \u5f97\u5230\u7684\u4fe1\u606f</p> </li> <li>\u5f15\u8d77 page fault \u7684\u5185\u5b58\u5730\u5740\uff08STVAL \u5bc4\u5b58\u5668\uff09</li> <li>\u5f15\u8d77 page fault \u7684\u539f\u56e0\u7c7b\u578b\uff08SCAUSE \u5bc4\u5b58\u5668\uff09</li> <li>\u5f15\u8d77 page fault \u65f6\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\u503c\uff0c\u8fd9\u8868\u660e\u4e86 page fault \u5728\u7528\u6237\u7a7a\u95f4\u53d1\u751f\u7684\u4f4d\u7f6e\uff08SEPC \u5bc4\u5b58\u5668\u4e2d\uff0ctrapframe-&gt;epc\uff09</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/#sbrk","title":"sbrk","text":"<ul> <li>\u5f53 sbrk \u5b9e\u9645\u53d1\u751f\u6216\u8005\u88ab\u8c03\u7528\u7684\u65f6\u5019\uff0c\u5185\u6838\u4f1a\u5206\u914d\u4e00\u4e9b\u7269\u7406\u5185\u5b58\uff0c\u5e76\u5c06\u8fd9\u4e9b\u5185\u5b58\u6620\u5c04\u5230\u7528\u6237\u5e94\u7528\u7a0b\u5e8f\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u7136\u540e\u5c06\u5185\u5b58\u5185\u5bb9\u521d\u59cb\u5316\u4e3a 0\uff0c\u518d\u8fd4\u56de sbrk \u7cfb\u7edf\u8c03\u7528\u3002\u8fd9\u6837\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u591a\u6b21 sbrk \u7cfb\u7edf\u8c03\u7528\u6765\u589e\u52a0\u5b83\u6240\u9700\u8981\u7684\u5185\u5b58\u3002\u7c7b\u4f3c\u7684\uff0c\u5e94\u7528\u7a0b\u5e8f\u8fd8\u53ef\u4ee5\u901a\u8fc7\u7ed9 sbrk \u4f20\u5165\u8d1f\u6570\u4f5c\u4e3a\u53c2\u6570\uff0c\u6765\u51cf\u5c11\u6216\u8005\u538b\u7f29\u5b83\u7684\u5730\u5740\u7a7a\u95f4\u3002</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/#lazy-allocation","title":"lazy allocation","text":"<ul> <li>sbrk \u7cfb\u7edf\u8c03\u57fa\u672c\u4e0a\u4e0d\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u552f\u4e00\u9700\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u662f\u63d0\u5347p-&gt;sz\uff0c\u5c06p-&gt;sz\u589e\u52a0 n\uff0c\u5176\u4e2d n \u662f\u9700\u8981\u65b0\u5206\u914d\u7684\u5185\u5b58 page \u6570\u91cf\u3002\u4f46\u662f\u5185\u6838\u5728\u8fd9\u4e2a\u65f6\u95f4\u70b9\u5e76\u4e0d\u4f1a\u5206\u914d\u4efb\u4f55\u7269\u7406\u5185\u5b58\u3002</li> <li>\u4e4b\u540e\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\uff0c\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u5230\u4e86\u65b0\u7533\u8bf7\u7684\u90a3\u90e8\u5206\u5185\u5b58\uff0c\u8fd9\u65f6\u4f1a\u89e6\u53d1 page fault\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd8\u6ca1\u6709\u5c06\u65b0\u7684\u5185\u5b58\u6620\u5c04\u5230 page table\u3002</li> <li>\u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u89e3\u6790\u4e00\u4e2a\u5927\u4e8e\u65e7\u7684p-&gt;sz\uff0c\u4f46\u662f\u53c8\u5c0f\u4e8e\u65b0\u7684p-&gt;sz\uff08\u6ce8\uff0c\u4e5f\u5c31\u662f\u65e7\u7684 p-&gt;sz + n\uff09\u7684\u865a\u62df\u5730\u5740\uff0c\u6211\u4eec\u5e0c\u671b\u5185\u6838\u80fd\u591f\u5206\u914d\u4e00\u4e2a\u5185\u5b58 page\uff0c\u5e76\u4e14\u91cd\u65b0\u6267\u884c\u6307\u4ee4\u3002</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/#zero-fill-on-demand","title":"Zero Fill On Demand","text":"<ul> <li> <p>\u5728\u4e00\u4e2a\u6b63\u5e38\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u5982\u679c\u6267\u884c exec\uff0cexec \u4f1a\u7533\u8bf7\u5730\u5740\u7a7a\u95f4\uff0c\u91cc\u9762\u4f1a\u5b58\u653e text \u548c data\u3002\u56e0\u4e3a BSS \u91cc\u9762\u4fdd\u5b58\u4e86\u672a\u88ab\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u8fd9\u91cc\u6216\u8bb8\u6709\u8bb8\u591a\u8bb8\u591a\u4e2a page\uff0c\u4f46\u662f\u6240\u6709\u7684 page \u5185\u5bb9\u90fd\u4e3a 0\u3002</p> </li> <li> <p>\u901a\u5e38\u53ef\u4ee5\u8c03\u4f18\u7684\u5730\u65b9\u662f\uff0c\u6211\u6709\u5982\u6b64\u591a\u7684\u5185\u5bb9\u5168\u662f 0 \u7684 page\uff0c\u5728\u7269\u7406\u5185\u5b58\u4e2d\uff0c\u6211\u53ea\u9700\u8981\u5206\u914d\u4e00\u4e2a page\uff0c\u8fd9\u4e2a page \u7684\u5185\u5bb9\u5168\u662f 0\u3002\u7136\u540e\u5c06\u6240\u6709\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u5168 0 \u7684 page \u90fd map \u5230\u8fd9\u4e00\u4e2a\u7269\u7406 page \u4e0a\u3002\u8fd9\u6837\u81f3\u5c11\u5728\u7a0b\u5e8f\u542f\u52a8\u7684\u65f6\u5019\u80fd\u8282\u7701\u5927\u91cf\u7684\u7269\u7406\u5185\u5b58\u5206\u914d\u3002</p> </li> <li>\u53ea\u6709 BSS \u8fdb\u884c\u4fee\u6539\u624d\u91cd\u65b0\u5206\u914d\u4e00\u4e2a\u65b0\u7684\u9875\u9762</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/#copy-on-write-fork","title":"Copy-on-Write Fork","text":"<ul> <li>\u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u76f4\u63a5\u5171\u4eab\u7236\u8fdb\u7a0b\u7684\u7269\u7406\u5185\u5b58 page\\</li> <li>\u66f4\u6539\u5185\u5bb9\u65f6\uff0c\u89e6\u53d1 page fault\uff0c\u5f97\u5230 page fault \u4e4b\u540e\uff0c\u6211\u4eec\u9700\u8981\u62f7\u8d1d\u76f8\u5e94\u7684\u7269\u7406 page</li> <li>\u9700\u8981\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u7269\u7406\u5185\u5b58 page \u7684\u5f15\u7528\u8fdb\u884c\u8ba1\u6570\uff0c\u5f53\u6211\u4eec\u91ca\u653e\u865a\u62df page \u65f6\uff0c\u6211\u4eec\u5c06\u7269\u7406\u5185\u5b58 page \u7684\u5f15\u7528\u6570\u51cf 1\uff0c\u5982\u679c\u5f15\u7528\u6570\u7b49\u4e8e 0\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u80fd\u91ca\u653e\u7269\u7406\u5185\u5b58 page</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/#memory-mapped-files","title":"Memory Mapped Files","text":"<ul> <li> <p>\u4e2a\u73b0\u4ee3\u7684\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u63d0\u4f9b\u4e00\u4e2a\u53eb\u505a mmap \u7684\u7cfb\u7edf\u8c03\u7528\u3002\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u4f1a\u63a5\u6536\u4e00\u4e2a\u865a\u62df\u5185\u5b58\u5730\u5740\uff08VA\uff09\uff0c\u957f\u5ea6\uff08len\uff09\uff0cprotection\uff0c\u4e00\u4e9b\u6807\u5fd7\u4f4d\uff0c\u4e00\u4e2a\u6253\u5f00\u6587\u4ef6\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u548c\u504f\u79fb\u91cf\uff08offset\uff09</p> </li> <li> <p>\u4ece\u6587\u4ef6\u63cf\u8ff0\u7b26\u5bf9\u5e94\u7684\u6587\u4ef6\u7684\u504f\u79fb\u91cf\u7684\u4f4d\u7f6e\u5f00\u59cb\uff0c\u6620\u5c04\u957f\u5ea6\u4e3a len \u7684\u5185\u5bb9\u5230\u865a\u62df\u5185\u5b58\u5730\u5740 VA</p> </li> <li> <p>\u4fe1\u606f\u5728 VMA\uff08virtual memory area\uff09\u4e2d\u5b58\u50a8\uff1b\u5f53\u6211\u4eec\u5f97\u5230\u4e00\u4e2a\u4f4d\u4e8e VMA \u5730\u5740\u8303\u56f4\u7684 page fault \u65f6\uff0c\u5185\u6838\u53ef\u4ee5\u4ece\u78c1\u76d8\u4e2d\u8bfb\u6570\u636e\uff0c\u5e76\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002</p> </li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/","title":"5-\u786c\u4ef6\u4e2d\u65ad","text":"<code>#Operator System</code>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#interrupts","title":"Interrupts","text":"<p> \u7ea6 1621 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <ul> <li>\u4e2d\u65ad\u4e0e\u7cfb\u7edf\u8c03\u7528\u533a\u522b</li> <li>asynchronous\uff0c\u5f02\u6b65\uff0c\u4e0e\u5f53\u524d\u8fd0\u884c\u5728 CPU \u7684\u8fdb\u7a0b\u65e0\u5173</li> <li>concurrency\uff0cCPU \u548c\u4ea7\u751f\u4e2d\u65ad\u7684\u8bbe\u5907\u5e76\u884c\u8fd0\u884c</li> <li>program device\uff0c\u9700\u8981\u5173\u6ce8\u5916\u90e8\u8bbe\u5907</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#_1","title":"\u4e2d\u65ad\u5904\u7406\u2014\u2014\u786c\u4ef6","text":"<ul> <li>PLIC \u4f1a\u901a\u77e5\u5f53\u524d\u6709\u4e00\u4e2a\u5f85\u5904\u7406\u7684\u4e2d\u65ad</li> <li>\u5176\u4e2d\u4e00\u4e2a CPU \u6838\u4f1a Claim \u63a5\u6536\u4e2d\u65ad\uff0c\u8fd9\u6837 PLIC \u5c31\u4e0d\u4f1a\u628a\u4e2d\u65ad\u53d1\u7ed9\u5176\u4ed6\u7684 CPU \u5904\u7406</li> <li>CPU \u6838\u5904\u7406\u5b8c\u4e2d\u65ad\u4e4b\u540e\uff0cCPU \u4f1a\u901a\u77e5 PLIC</li> <li>PLIC \u5c06\u4e0d\u518d\u4fdd\u5b58\u4e2d\u65ad\u7684\u4fe1\u606f</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#_2","title":"\u4e2d\u65ad\u5904\u7406\u2014\u2014\u8f6f\u4ef6","text":"<p>\u4f7f\u7528\u9a71\u52a8\u7ba1\u7406\u8bbe\u5907</p> <ul> <li>bottom\uff1a\u901a\u5e38\u662f Interrupt handler\u3002\u5f53\u4e00\u4e2a\u4e2d\u65ad\u9001\u5230\u4e86 CPU\uff0c\u5e76\u4e14 CPU \u8bbe\u7f6e\u63a5\u6536\u8fd9\u4e2a\u4e2d\u65ad\uff0cCPU \u4f1a\u8c03\u7528\u76f8\u5e94\u7684 Interrupt handler\u3002Interrupt handler \u5e76\u4e0d\u8fd0\u884c\u5728\u4efb\u4f55\u7279\u5b9a\u8fdb\u7a0b\u7684 context \u4e2d\uff0c\u5b83\u53ea\u662f\u5904\u7406\u4e2d\u65ad\u3002</li> <li> <p>top\uff1a\u662f\u7528\u6237\u8fdb\u7a0b\uff0c\u6216\u8005\u5185\u6838\u7684\u5176\u4ed6\u90e8\u5206\u8c03\u7528\u7684\u63a5\u53e3\u3002\u5bf9\u4e8e UART \u6765\u8bf4\uff0c\u8fd9\u91cc\u6709 read/write \u63a5\u53e3\uff0c\u8fd9\u4e9b\u63a5\u53e3\u53ef\u4ee5\u88ab\u66f4\u9ad8\u5c42\u7ea7\u7684\u4ee3\u7801\u8c03\u7528\u3002</p> </li> <li> <p>\u9a71\u52a8\u4e2d\u4f1a\u6709\u4e00\u4e9b\u961f\u5217\uff08\u6216\u8005\u8bf4 buffer\uff09\uff0ctop \u90e8\u5206\u7684\u4ee3\u7801\u4f1a\u4ece\u961f\u5217\u4e2d\u8bfb\u5199\u6570\u636e\uff0c\u800c Interrupt handler\uff08bottom \u90e8\u5206\uff09\u540c\u65f6\u4e5f\u4f1a\u5411\u961f\u5217\u4e2d\u8bfb\u5199\u6570\u636e\u3002\u8fd9\u91cc\u7684\u961f\u5217\u53ef\u4ee5\u5c06\u5e76\u884c\u8fd0\u884c\u7684\u8bbe\u5907\u548c CPU \u89e3\u8026\u5f00\u6765</p> </li> </ul> <p></p> <ul> <li>\u6211\u4eec\u901a\u8fc7 load \u5c06\u6570\u636e\u5199\u5165\u5230 Transmit Holding Register \u4e2d\uff0c\u4e4b\u540e UART \u82af\u7247\u4f1a\u901a\u8fc7\u4e32\u53e3\u7ebf\u5c06\u8fd9\u4e2a Byte \u9001\u51fa\u3002\u5f53\u5b8c\u6210\u4e86\u53d1\u9001\uff0cUART \u4f1a\u751f\u6210\u4e00\u4e2a\u4e2d\u65ad\u7ed9\u5185\u6838\uff0c\u8fd9\u4e2a\u65f6\u5019\u624d\u80fd\u518d\u6b21\u5199\u5165\u4e0b\u4e00\u4e2a\u6570\u636e\u3002</li> <li>\u6240\u4ee5\u5185\u6838\u548c\u8bbe\u5907\u4e4b\u95f4\u9700\u8981\u9075\u5b88\u4e00\u4e9b\u534f\u8bae\u624d\u80fd\u786e\u4fdd\u4e00\u5207\u5de5\u4f5c\u6b63\u5e38\u3002\u4e0a\u56fe\u4e2d\u7684 UART \u82af\u7247\u4f1a\u6709\u4e00\u4e2a\u5bb9\u91cf\u662f 16 \u7684 FIFO\uff0c\u4f46\u662f\u4f60\u8fd8\u662f\u8981\u5c0f\u5fc3\uff0c\u56e0\u4e3a\u5982\u679c\u963b\u585e\u4e86 16 \u4e2a Byte \u4e4b\u540e\u518d\u6b21\u5199\u5165\u8fd8\u662f\u4f1a\u9020\u6210\u6570\u636e\u8986\u76d6</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#_3","title":"\u952e\u5165\u5b57\u7b26\u4e2d\u65ad\u8fc7\u7a0b","text":"<ul> <li>\u7528\u6237\u8f93\u5165\u7684\u5b57\u7b26\u3002\u952e\u76d8\u8fde\u63a5\u5230\u4e86 UART \u7684\u8f93\u5165\u7ebf\u8def\uff0c\u5f53\u4f60\u5728\u952e\u76d8\u4e0a\u6309\u4e0b\u4e00\u4e2a\u6309\u952e\uff0cUART \u82af\u7247\u4f1a\u5c06\u6309\u952e\u5b57\u7b26\u901a\u8fc7\u4e32\u53e3\u7ebf\u53d1\u9001\u5230\u53e6\u4e00\u7aef\u7684 UART \u82af\u7247\u3002</li> <li>\u53e6\u4e00\u7aef\u7684 UART \u82af\u7247\u5148\u5c06\u6570\u636e bit \u5408\u5e76\u6210\u4e00\u4e2a Byte\uff0c\u4e4b\u540e\u518d\u4ea7\u751f\u4e00\u4e2a\u4e2d\u65ad\uff0c\u5e76\u544a\u8bc9\u5904\u7406\u5668\u8bf4\u8fd9\u91cc\u6709\u4e00\u4e2a\u6765\u81ea\u4e8e\u952e\u76d8\u7684\u5b57\u7b26\u3002\u4e4b\u540e Interrupt handler \u4f1a\u5904\u7406\u6765\u81ea\u4e8e UART \u7684\u5b57\u7b26\u3002</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#_4","title":"\u4e2d\u65ad\u76f8\u5173\u5bc4\u5b58\u5668","text":"<ul> <li>SIE\uff0c\u5bc4\u5b58\u5668\u4e2d\u6709\u4e00\u4e2a bit\uff08E\uff09\u4e13\u95e8\u9488\u5bf9\u4f8b\u5982 UART \u7684\u5916\u90e8\u8bbe\u5907\u7684\u4e2d\u65ad\uff1b\u6709\u4e00\u4e2a bit\uff08S\uff09\u4e13\u95e8\u9488\u5bf9\u8f6f\u4ef6\u4e2d\u65ad\uff0c\u8f6f\u4ef6\u4e2d\u65ad\u53ef\u80fd\u7531\u4e00\u4e2a CPU \u6838\u89e6\u53d1\u7ed9\u53e6\u4e00\u4e2a CPU \u6838\uff1b\u8fd8\u6709\u4e00\u4e2a bit\uff08T\uff09\u4e13\u95e8\u9488\u5bf9\u5b9a\u65f6\u5668\u4e2d\u65ad</li> <li> <p>SSTATUS\uff1a\u6709\u4e00\u4e2a bit \u6765\u6253\u5f00\u6216\u8005\u5173\u95ed\u4e2d\u65ad\u3002\u6bcf\u4e00\u4e2a CPU \u6838\u90fd\u6709\u72ec\u7acb\u7684 SIE \u548c SSTATUS \u5bc4\u5b58\u5668\uff0c\u9664\u4e86\u901a\u8fc7 SIE \u5bc4\u5b58\u5668\u6765\u5355\u72ec\u63a7\u5236\u7279\u5b9a\u7684\u4e2d\u65ad\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 SSTATUS \u5bc4\u5b58\u5668\u4e2d\u7684\u4e00\u4e2a bit \u6765\u63a7\u5236\u6240\u6709\u7684\u4e2d\u65ad\u3002</p> </li> <li> <p>SIP\uff08Supervisor Interrupt Pending\uff09\u5bc4\u5b58\u5668\u3002\u5f53\u53d1\u751f\u4e2d\u65ad\u65f6\uff0c\u5904\u7406\u5668\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u8fd9\u4e2a\u5bc4\u5b58\u5668\u77e5\u9053\u5f53\u524d\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u4e2d\u65ad\u3002</p> </li> <li>SCAUSE \u5bc4\u5b58\u5668\uff0c\u8fd9\u4e2a\u5bc4\u5b58\u5668\u6211\u4eec\u4e4b\u524d\u770b\u8fc7\u5f88\u591a\u6b21\u3002\u5b83\u4f1a\u8868\u660e\u5f53\u524d\u72b6\u6001\u7684\u539f\u56e0\u3002</li> <li>STVEC \u5bc4\u5b58\u5668\uff0c\u5b83\u4f1a\u4fdd\u5b58\u5f53 trap\uff0cpage fault \u6216\u8005\u4e2d\u65ad\u53d1\u751f\u65f6\uff0cCPU \u8fd0\u884c\u7684\u7528\u6237\u7a0b\u5e8f\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u8fd9\u6837\u624d\u80fd\u5728\u7a0d\u540e\u6062\u590d\u7a0b\u5e8f\u7684\u8fd0\u884c\u3002</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#_5","title":"\u63a7\u5236\u53f0\u521d\u59cb\u5316","text":"<ul> <li> <p>uartinit \u51fd\u6570\uff0c\u5173\u95ed\u4e2d\u65ad\uff0c\u8bbe\u7f6e\u6ce2\u7279\u7387\uff0c\u8bbe\u7f6e\u5b57\u7b26\u957f\u5ea6\u4e3a 8bit\uff0c\u91cd\u7f6e FIFO\uff0c\u6700\u540e\u91cd\u65b0\u6253\u5f00\u4e2d\u65ad</p> </li> <li> <p>\u9700\u8981\u8ba9\u4e2d\u65ad\u88ab CPU \u611f\u77e5\uff0c\u9700\u8981\u8c03\u7528 plicinit \u51fd\u6570</p> </li> <li> <p>PLIC \u4e0e\u5916\u8bbe\u4e00\u6837\uff0c\u4e5f\u5360\u7528\u4e86\u4e00\u4e2a I/O \u5730\u5740\uff080xC000_0000</p> </li> <li> <p>plicinithart \u51fd\u6570\u3002</p> </li> <li> <p>plicinit \u662f\u7531 0 \u53f7 CPU \u8fd0\u884c\uff0c\u4e4b\u540e\uff0c\u6bcf\u4e2a CPU \u7684\u6838\u90fd\u9700\u8981\u8c03\u7528 plicinithart \u51fd\u6570\u8868\u660e\u5bf9\u4e8e\u54ea\u4e9b\u5916\u8bbe\u4e2d\u65ad\u611f\u5174\u8da3\u3002</p> </li> <li> <p>\u6bcf\u4e2a CPU \u7684\u6838\u90fd\u8868\u660e\u81ea\u5df1\u5bf9\u6765\u81ea\u4e8e UART \u548c VIRTIO \u7684\u4e2d\u65ad\u611f\u5174\u8da3\u3002\u56e0\u4e3a\u6211\u4eec\u5ffd\u7565\u4e2d\u65ad\u7684\u4f18\u5148\u7ea7\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u4f18\u5148\u7ea7\u8bbe\u7f6e\u4e3a 0</p> </li> <li> <p>\u8bbe\u7f6e SSTATUS \u5bc4\u5b58\u5668\uff0c\u63a5\u6536\u4e2d\u65ad</p> </li> <li>scheduler \u51fd\u6570\u4e2d\u5f00\u4e2d\u65ad</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#uart-driver-top","title":"uart driver top","text":"<ul> <li> <p>consolewrite()</p> </li> <li> <p>either_copyin \u5c06\u5b57\u7b26\u62f7\u5165\uff0c\u4e4b\u540e\u8c03\u7528 uartputc \u51fd\u6570\u3002uartputc \u51fd\u6570\u5c06\u5b57\u7b26\u5199\u5165\u7ed9 UART \u8bbe\u5907\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u8ba4\u4e3a consolewrite \u662f\u4e00\u4e2a UART \u9a71\u52a8\u7684 top \u90e8\u5206</p> </li> <li> <p>\u5728 UART \u7684\u5185\u90e8\u4f1a\u6709\u4e00\u4e2a buffer \u7528\u6765\u53d1\u9001\u6570\u636e\uff0cbuffer \u7684\u5927\u5c0f\u662f 32 \u4e2a\u5b57\u7b26\u3002\u540c\u65f6\u8fd8\u6709\u4e00\u4e2a\u4e3a consumer \u63d0\u4f9b\u7684\u8bfb\u6307\u9488\u548c\u4e3a producer \u63d0\u4f9b\u7684\u5199\u6307\u9488\uff0c\u6765\u6784\u5efa\u4e00\u4e2a\u73af\u5f62\u7684 buffer</p> </li> <li>uartstart()</li> <li>\u9996\u5148\u662f\u68c0\u67e5\u5f53\u524d\u8bbe\u5907\u662f\u5426\u7a7a\u95f2\uff0c\u5982\u679c\u7a7a\u95f2\u7684\u8bdd\uff0c\u6211\u4eec\u4f1a\u4ece buffer \u4e2d\u8bfb\u51fa\u6570\u636e\uff0c\u7136\u540e\u5c06\u6570\u636e\u5199\u5165\u5230 THR\uff08Transmission Holding Register\uff09\u53d1\u9001\u5bc4\u5b58\u5668\u3002\u8fd9\u91cc\u76f8\u5f53\u4e8e\u544a\u8bc9\u8bbe\u5907\uff0c\u6211\u8fd9\u91cc\u6709\u4e00\u4e2a\u5b57\u8282\u9700\u8981\u4f60\u6765\u53d1\u9001\u3002</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#uart-driver-bottom","title":"uart driver bottom","text":"<ul> <li> <p>plic_claim \u51fd\u6570\u4f4d\u4e8e plic.c \u6587\u4ef6\u4e2d\u3002\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\uff0c\u5f53\u524d CPU \u6838\u4f1a\u544a\u77e5 PLIC\uff0c\u81ea\u5df1\u8981\u5904\u7406\u4e2d\u65ad\uff0cPLIC_SCLAIM \u4f1a\u5c06\u4e2d\u65ad\u53f7\u8fd4\u56de\uff0c\u5bf9\u4e8e UART \u6765\u8bf4\uff0c\u8fd4\u56de\u7684\u4e2d\u65ad\u53f7\u662f 10\u3002</p> </li> <li> <p>\u4f4d\u4e8e uart.c \u6587\u4ef6\u7684 uartintr \u51fd\u6570\uff0c\u4f1a\u4ece UART \u7684\u63a5\u53d7\u5bc4\u5b58\u5668\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u4e4b\u540e\u5c06\u83b7\u53d6\u5230\u7684\u6570\u636e\u4f20\u9012\u7ed9 consoleintr \u51fd\u6570\u3002\u6ca1\u6709\u901a\u8fc7\u952e\u76d8\u8f93\u5165\u4efb\u4f55\u6570\u636e\uff0c\u6240\u4ee5 UART \u7684\u63a5\u53d7\u5bc4\u5b58\u5668\u4e3a\u7a7a\uff0c\u8c03\u7528 uartstart \u5c06 buffer \u4e2d\u7684\u5b57\u7b26\u9001\u51fa</p> </li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#_6","title":"\u4e2d\u65ad\u5e76\u53d1","text":"<ul> <li>\u8bbe\u5907\u548c CPU \u5e76\u884c\uff0c\u5f53 UART \u5411 Console \u53d1\u9001\u5b57\u7b26\u7684\u65f6\u5019\uff0cCPU \u4f1a\u8fd4\u56de\u6267\u884c Shell\uff0c\u800c Shell \u53ef\u80fd\u4f1a\u518d\u6267\u884c\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u5411 buffer \u4e2d\u5199\u5165\u53e6\u4e00\u4e2a\u5b57\u7b26\uff0c\u8fd9\u4e9b\u90fd\u662f\u5728\u5e76\u884c\u7684\u6267\u884c\u3002\u8fd9\u91cc\u7684\u5e76\u884c\u79f0\u4e3a producer-consumer \u5e76\u884c\u3002</li> <li>\u4e2d\u65ad\u505c\u6b62\u8fd0\u884c\u5f53\u524d\u7a0b\u5e8f\uff0c\u5982\u679c\u4e0d\u80fd\u5728\u6267\u884c\u671f\u95f4\u88ab\u4e2d\u65ad\uff0c\u8fd9\u65f6\u5185\u6838\u9700\u8981\u4e34\u65f6\u5173\u95ed\u4e2d\u65ad\uff0c\u6765\u786e\u4fdd\u8fd9\u6bb5\u4ee3\u7801\u7684\u539f\u5b50\u6027</li> <li>\u9a71\u52a8\u7684 top \u548c bottom \u90e8\u5206\u662f\u5e76\u884c\u8fd0\u884c\u7684\uff0c\u6240\u4ee5\u4e00\u4e2a\u9a71\u52a8\u7684 top \u548c bottom \u90e8\u5206\u53ef\u4ee5\u5e76\u884c\u7684\u5728\u4e0d\u540c\u7684 CPU \u4e0a\u8fd0\u884c\u3002\u8fd9\u91cc\u6211\u4eec\u901a\u8fc7 lock \u6765\u7ba1\u7406\u5e76\u884c\u3002\u56e0\u4e3a\u8fd9\u91cc\u6709\u5171\u4eab\u7684\u6570\u636e\uff0c\u6211\u4eec\u60f3\u8981 buffer \u5728\u4e00\u4e2a\u65f6\u95f4\u53ea\u88ab\u4e00\u4e2a CPU \u6838\u6240\u64cd\u4f5c</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/#producer-consumer","title":"producer-consumer \u5e76\u53d1","text":"<ul> <li> <p>producer \u53ef\u4ee5\u4e00\u76f4\u5199\u5165\u6570\u636e\uff0c\u76f4\u5230\u5199\u6307\u9488 + 1 \u7b49\u4e8e\u8bfb\u6307\u9488</p> </li> <li> <p>uartintr \u51fd\u6570\u662f consumer\uff0c\u6bcf\u5f53\u6709\u4e00\u4e2a\u4e2d\u65ad\uff0c\u5e76\u4e14\u8bfb\u6307\u9488\u843d\u540e\u4e8e\u5199\u6307\u9488\uff0cuartintr \u51fd\u6570\u5c31\u4f1a\u4ece\u8bfb\u6307\u9488\u4e2d\u8bfb\u53d6\u4e00\u4e2a\u5b57\u7b26\u518d\u901a\u8fc7 UART \u8bbe\u5907\u53d1\u9001\uff0c\u5e76\u4e14\u5c06\u8bfb\u6307\u9488\u52a0 1</p> </li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/","title":"6-\u591a\u6838\u548c\u9501","text":"<code>#Operator System</code>","tags":["Operator System"]},{"location":"notes/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/#multiprocessor-and-lock","title":"Multiprocessor and Lock","text":"<p> \u7ea6 1171 \u4e2a\u5b57  95 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <ul> <li> <p>\u9501\u5c31\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5c31\u50cf\u5176\u4ed6\u5728\u5185\u6838\u4e2d\u7684\u5bf9\u8c61\u4e00\u6837\u3002\u6709\u4e00\u4e2a\u7ed3\u6784\u4f53\u53eb\u505a lock\uff0c\u5b83\u5305\u542b\u4e86\u4e00\u4e9b\u5b57\u6bb5\uff0c\u8fd9\u4e9b\u5b57\u6bb5\u4e2d\u7ef4\u62a4\u4e86\u9501\u7684\u72b6\u6001\u3002\u9501\u6709\u975e\u5e38\u76f4\u89c2\u7684 API\uff1a</p> </li> <li> <p>acquire\uff0c\u63a5\u6536\u6307\u5411 lock \u7684\u6307\u9488\u4f5c\u4e3a\u53c2\u6570\u3002acquire \u786e\u4fdd\u4e86\u5728\u4efb\u4f55\u65f6\u95f4\uff0c\u53ea\u4f1a\u6709\u4e00\u4e2a\u8fdb\u7a0b\u80fd\u591f\u6210\u529f\u7684\u83b7\u53d6\u9501\u3002</p> </li> <li> <p>release\uff0c\u4e5f\u63a5\u6536\u6307\u5411 lock \u7684\u6307\u9488\u4f5c\u4e3a\u53c2\u6570\u3002\u5728\u540c\u4e00\u65f6\u95f4\u5c1d\u8bd5\u83b7\u53d6\u9501\u7684\u5176\u4ed6\u8fdb\u7a0b\u9700\u8981\u7b49\u5f85\uff0c\u76f4\u5230\u6301\u6709\u9501\u7684\u8fdb\u7a0b\u5bf9\u9501\u8c03\u7528 release\u3002</p> </li> <li> <p>\u9501\u5e94\u8be5\u4e0e\u64cd\u4f5c\u800c\u4e0d\u662f\u6570\u636e\u5173\u8054\uff0c\u6240\u4ee5\u81ea\u52a8\u52a0\u9501\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u4f1a\u51fa\u95ee\u9898</p> </li> <li> <p>\u60f3\u8981\u7a0b\u5e8f\u7b80\u5355\u70b9\uff0c\u53ef\u4ee5\u901a\u8fc7 coarse-grain locking\uff08\u6ce8\uff0c\u4e5f\u5c31\u662f\u5927\u9501\uff09\uff0c\u4f46\u662f\u8fd9\u65f6\u4f60\u5c31\u5931\u53bb\u4e86\u6027\u80fd</p> </li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/#_1","title":"\u9501\u7684\u7279\u6027","text":"<ul> <li>\u907f\u514d\u4e22\u5931\u66f4\u65b0</li> <li>\u9501\u53ef\u4ee5\u6253\u5305\u591a\u4e2a\u64cd\u4f5c\uff0c\u4f7f\u5b83\u4eec\u5177\u6709\u539f\u5b50\u6027</li> <li>\u53ef\u4ee5\u7ef4\u62a4\u5171\u4eab\u6570\u636e\u7ed3\u6784\u7684\u4e0d\u53d8\u6027</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/#challenge","title":"challenge","text":"<ul> <li>\u6b7b\u9501</li> <li> <p>\u7834\u574f\u4e86\u7a0b\u5e8f\u7684\u6a21\u5757\u5316</p> </li> <li> <p>\u901a\u5e38\u6765\u8bf4\uff0c\u5f00\u53d1\u7684\u6d41\u7a0b\u662f\uff1a</p> </li> <li>\u5148\u4ee5 coarse-grained lock\uff08\u6ce8\uff0c\u4e5f\u5c31\u662f\u5927\u9501\uff09\u5f00\u59cb\u3002</li> <li>\u518d\u5bf9\u7a0b\u5e8f\u8fdb\u884c\u6d4b\u8bd5\uff0c\u6765\u770b\u4e00\u4e0b\u7a0b\u5e8f\u662f\u5426\u80fd\u4f7f\u7528\u591a\u6838\u3002</li> <li>\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\uff0c\u90a3\u4e48\u5de5\u4f5c\u5c31\u7ed3\u675f\u4e86\uff0c\u4f60\u5bf9\u4e8e\u9501\u7684\u8bbe\u8ba1\u8db3\u591f\u597d\u4e86\uff1b\u5982\u679c\u4e0d\u53ef\u4ee5\u7684\u8bdd\uff0c\u90a3\u610f\u5473\u7740\u9501\u5b58\u5728\u7ade\u4e89\uff0c\u591a\u4e2a\u8fdb\u7a0b\u4f1a\u5c1d\u8bd5\u83b7\u53d6\u540c\u4e00\u4e2a\u9501\uff0c\u56e0\u6b64\u5b83\u4eec\u5c06\u4f1a\u5e8f\u5217\u5316\u7684\u6267\u884c\uff0c\u6027\u80fd\u4e5f\u4e0a\u4e0d\u53bb\uff0c\u4e4b\u540e\u4f60\u5c31\u9700\u8981\u91cd\u6784\u7a0b\u5e8f\u3002</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/#uart","title":"uart \u4e2d\u7684\u9501","text":"<ul> <li>\u5411 buffer \u4e2d\u5199\u5165\u6570\u636e\u65f6\u52a0\u9501</li> </ul> C<pre><code>void\nuartputc(int c)\n{\n  acquire(&amp;uart_tx_lock);\n\n  if(panicked){\n    for(;;)\n      ;\n  }\n  while(uart_tx_w == uart_tx_r + UART_TX_BUF_SIZE){\n    // buffer is full.\n    // wait for uartstart() to open up space in the buffer.\n    sleep(&amp;uart_tx_r, &amp;uart_tx_lock);\n  }\n  uart_tx_buf[uart_tx_w % UART_TX_BUF_SIZE] = c;\n  uart_tx_w += 1;\n  uartstart();\n  release(&amp;uart_tx_lock);\n}\n</code></pre> <ul> <li>\u5f53 UART \u786c\u4ef6\u5b8c\u6210\u4f20\u8f93\uff0c\u4f1a\u4ea7\u751f\u4e00\u4e2a\u4e2d\u65ad\u3002\u5728\u524d\u9762\u7684\u4ee3\u7801\u4e2d\u6211\u4eec\u77e5\u9053\u4e86 uartstart \u7684\u8c03\u7528\u8005\u4f1a\u83b7\u5f97\u9501\u4ee5\u786e\u4fdd\u4e0d\u4f1a\u6709\u591a\u4e2a\u8fdb\u7a0b\u540c\u65f6\u5411 THR \u5bc4\u5b58\u5668\u5199\u6570\u636e\u3002\u4f46\u662f UART \u4e2d\u65ad\u672c\u8eab\u4e5f\u53ef\u80fd\u4e0e\u8c03\u7528 printf \u7684\u8fdb\u7a0b\u5e76\u884c\u6267\u884c\u3002\u5982\u679c\u4e00\u4e2a\u8fdb\u7a0b\u8c03\u7528\u4e86 printf\uff0c\u5b83\u8fd0\u884c\u5728 CPU0 \u4e0a\uff1bCPU1 \u5904\u7406\u4e86 UART \u4e2d\u65ad\uff0c\u90a3\u4e48 CPU1 \u4e5f\u4f1a\u8c03\u7528 uartstart\u3002\u56e0\u4e3a\u6211\u4eec\u60f3\u8981\u786e\u4fdd\u5bf9\u4e8e THR \u5bc4\u5b58\u5668\u53ea\u6709\u4e00\u4e2a\u5199\u5165\u8005\uff0c\u540c\u65f6\u4e5f\u786e\u4fdd\u4f20\u8f93\u7f13\u5b58\u7684\u7279\u6027\u4e0d\u53d8\uff08\u6ce8\uff0c\u8fd9\u91cc\u6307\u7684\u662f\u5728 uartstart \u4e2d\u5bf9\u4e8e uart_tx_r \u6307\u9488\u7684\u66f4\u65b0\uff09\uff0c\u6211\u4eec\u9700\u8981\u5728\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u4e2d\u4e5f\u83b7\u53d6\u9501\u3002</li> </ul> C<pre><code>void\nuartintr(void)\n{\n  // read and process incoming characters.\n  while(1){\n    int c = uartgetc();\n    if(c == -1)\n      break;\n    consoleintr(c);\n  }\n\n  // send buffered characters.\n  acquire(&amp;uart_tx_lock);\n  uartstart();\n  release(&amp;uart_tx_lock);\n}\n</code></pre>","tags":["Operator System"]},{"location":"notes/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/#spin-lock","title":"spin lock","text":"<p>\u5b9e\u73b0\u65b9\u6cd5</p> <ul> <li>\u7279\u6b8a\u7684\u786c\u4ef6\u6307\u4ee4</li> <li>\u8fd9\u4e2a\u7279\u6b8a\u7684\u786c\u4ef6\u6307\u4ee4\u4f1a\u4fdd\u8bc1\u4e00\u6b21 test-and-set \u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002\u5728 RISC-V \u4e0a\uff0c\u8fd9\u4e2a\u7279\u6b8a\u7684\u6307\u4ee4\u5c31\u662f amoswap\uff08atomic memory swap\uff09\u3002</li> <li>\u8fd9\u4e2a\u6307\u4ee4\u63a5\u6536 3 \u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f address\uff0c\u5bc4\u5b58\u5668 r1\uff0c\u5bc4\u5b58\u5668 r2\u3002\u8fd9\u6761\u6307\u4ee4\u4f1a\u5148\u9501\u5b9a\u4f4f address\uff0c\u5c06 address \u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5728\u4e00\u4e2a\u4e34\u65f6\u53d8\u91cf\u4e2d\uff08tmp\uff09\uff0c\u4e4b\u540e\u5c06 r1 \u4e2d\u7684\u6570\u636e\u5199\u5165\u5230\u5730\u5740\u4e2d\uff0c\u4e4b\u540e\u518d\u5c06\u4fdd\u5b58\u5728\u4e34\u65f6\u53d8\u91cf\u4e2d\u7684\u6570\u636e\u5199\u5165\u5230 r2 \u4e2d\uff0c\u6700\u540e\u518d\u5bf9\u4e8e\u5730\u5740\u89e3\u9501\u3002</li> </ul> C<pre><code>struct spinlock {\n  uint locked;       // Is the lock held?\n\n  // For debugging:\n  char *name;        // Name of lock.\n  struct cpu *cpu;   // The cpu holding the lock.\n};\n\nvoid\nacquire(struct spinlock *lk)\n{\n  push_off(); // disable interrupts to avoid deadlock.\n  if(holding(lk))\n    panic(\"acquire\");\n\n  // On RISC-V, sync_lock_test_and_set turns into an atomic swap:\n  //   a5 = 1\n  //   s1 = &amp;lk-&gt;locked\n  //   amoswap.w.aq a5, a5, (s1)\n  while(__sync_lock_test_and_set(&amp;lk-&gt;locked, 1) != 0)\n    ;\n\n  // Tell the C compiler and the processor to not move loads or stores\n  // past this point, to ensure that the critical section's memory\n  // references happen strictly after the lock is acquired.\n  // On RISC-V, this emits a fence instruction.\n  __sync_synchronize();\n\n  // Record info about lock acquisition for holding() and debugging.\n  lk-&gt;cpu = mycpu();\n}\n\n// Release the lock.\nvoid\nrelease(struct spinlock *lk)\n{\n  if(!holding(lk))\n    panic(\"release\");\n\n  lk-&gt;cpu = 0;\n\n  // Tell the C compiler and the CPU to not move loads or stores\n  // past this point, to ensure that all the stores in the critical\n  // section are visible to other CPUs before the lock is released,\n  // and that loads in the critical section occur strictly before\n  // the lock is released.\n  // On RISC-V, this emits a fence instruction.\n  __sync_synchronize();\n\n  // Release the lock, equivalent to lk-&gt;locked = 0.\n  // This code doesn't use a C assignment, since the C standard\n  // implies that an assignment might be implemented with\n  // multiple store instructions.\n  // On RISC-V, sync_lock_release turns into an atomic swap:\n  //   s1 = &amp;lk-&gt;locked\n  //   amoswap.w zero, zero, (s1)\n  __sync_lock_release(&amp;lk-&gt;locked);\n\n  pop_off();\n}\n</code></pre>","tags":["Operator System"]},{"location":"notes/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/#spin-lock_1","title":"spin lock \u7684\u4e09\u4e2a\u7ec6\u8282","text":"<ul> <li> <p>\u4e00\u4e2a store \u6307\u4ee4\u5e76\u4e0d\u603b\u662f\u4e00\u4e2a\u539f\u5b50\u6307\u4ee4\uff0c\u53d6\u51b3\u4e8e\u5177\u4f53\u7684\u5b9e\u73b0</p> </li> <li> <p>\u5bf9\u4e8e CPU \u5185\u7684\u7f13\u5b58\uff0c\u6bcf\u4e00\u4e2a cache line \u7684\u5927\u5c0f\u53ef\u80fd\u5927\u4e8e\u4e00\u4e2a\u6574\u6570\uff0c\u90a3\u4e48 store \u6307\u4ee4\u5b9e\u9645\u7684\u8fc7\u7a0b\u5c06\u4f1a\u662f\uff1a\u9996\u5148\u4f1a\u52a0\u8f7d cache line\uff0c\u4e4b\u540e\u518d\u66f4\u65b0 cache line\u3002\u6240\u4ee5\u5bf9\u4e8e store \u6307\u4ee4\u6765\u8bf4\uff0c\u91cc\u9762\u5305\u542b\u4e86\u4e24\u4e2a\u5fae\u6307\u4ee4\u3002\u8fd9\u6837\u7684\u8bdd\u5c31\u6709\u53ef\u80fd\u5f97\u5230\u9519\u8bef\u7684\u7ed3\u679c\u3002\u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u7406\u89e3\u786c\u4ef6\u5b9e\u73b0\u7684\u6240\u6709\u7ec6\u8282\uff0c\u4f8b\u5982\u6574\u6570\u64cd\u4f5c\u4e0d\u662f\u539f\u5b50\u7684\uff0c\u6216\u8005\u5411\u4e00\u4e2a 64bit \u7684\u5185\u5b58\u503c\u5199\u6570\u636e\u662f\u4e0d\u662f\u539f\u5b50\u7684\uff0c\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u4e00\u4e2a RISC-V \u63d0\u4f9b\u7684\u786e\u4fdd\u539f\u5b50\u6027\u7684\u6307\u4ee4\u6765\u5c06 locked \u5b57\u6bb5\u5199\u4e3a 0\u3002</p> </li> <li> <p>spinlock \u9700\u8981\u5904\u7406\u4e24\u7c7b\u5e76\u53d1\uff0c\u4e00\u7c7b\u662f\u4e0d\u540c CPU \u4e4b\u95f4\u7684\u5e76\u53d1\uff0c\u4e00\u7c7b\u662f\u76f8\u540c CPU \u4e0a\u4e2d\u65ad\u548c\u666e\u901a\u7a0b\u5e8f\u4e4b\u95f4\u7684\u5e76\u53d1\u3002\u9488\u5bf9\u540e\u4e00\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u9700\u8981\u5728 acquire \u4e2d\u5173\u95ed\u4e2d\u65ad\u3002\u4e2d\u65ad\u4f1a\u5728 release \u7684\u7ed3\u675f\u4f4d\u7f6e\u518d\u6b21\u6253\u5f00\uff0c\u56e0\u4e3a\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u624d\u80fd\u518d\u6b21\u5b89\u5168\u7684\u63a5\u6536\u4e2d\u65ad</p> </li> <li> <p>\u7b2c\u4e09\u4e2a\u7ec6\u8282\u5c31\u662f memory ordering\u3002</p> </li> <li> <p>\u5047\u8bbe\u6211\u4eec\u5148\u901a\u8fc7\u5c06 locked \u5b57\u6bb5\u8bbe\u7f6e\u4e3a 1 \u6765\u83b7\u53d6\u9501\uff0c\u4e4b\u540e\u5bf9 x \u52a0 1\uff0c\u6700\u540e\u518d\u5c06 locked \u5b57\u6bb5\u8bbe\u7f6e 0 \u6765\u91ca\u653e\u9501\uff1b\u7f16\u8bd1\u5668\u4f1a\u4f18\u5316\u6307\u4ee4\u987a\u5e8f\u6765\u63d0\u9ad8\u6027\u80fd</p> </li> <li> <p>\u4e3a\u4e86\u7981\u6b62\uff0c\u6216\u8005\u8bf4\u4e3a\u4e86\u544a\u8bc9\u7f16\u8bd1\u5668\u548c\u786c\u4ef6\u4e0d\u8981\u8fd9\u6837\u505a\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528 memory fence \u6216\u8005\u53eb\u505a synchronize \u6307\u4ee4\uff0c\u6765\u786e\u5b9a\u6307\u4ee4\u7684\u79fb\u52a8\u8303\u56f4\u3002\u5bf9\u4e8e synchronize \u6307\u4ee4\uff0c\u4efb\u4f55\u5728\u5b83\u4e4b\u524d\u7684 load/store \u6307\u4ee4\uff0c\u90fd\u4e0d\u80fd\u79fb\u52a8\u5230\u5b83\u4e4b\u540e\u3002\u9501\u7684 acquire \u548c release \u51fd\u6570\u90fd\u5305\u542b\u4e86 synchronize \u6307\u4ee4\u3002</p> </li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/7-%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2/","title":"7-\u8fdb\u7a0b\u5207\u6362","text":"<code>#Operator System</code>","tags":["Operator System"]},{"location":"notes/6.s081/7-%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2/#_1","title":"\u8fdb\u7a0b\u5207\u6362","text":"<p> \u7ea6 265 \u4e2a\u5b57  50 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p> <ul> <li> <p>P1 \u8fdb\u5165\u5185\u6838\uff0c\u5207\u6362\u5230\u8c03\u5ea6\u5668\u8fdb\u7a0b\uff0c\u8c03\u5ea6\u5668\u8fdb\u7a0b\u5207\u6362\u5230 P2</p> </li> <li> <p>\u6838\u5fc3\u51fd\u6570\u4e3a swtch()\u51fd\u6570\uff1b\u8be5\u51fd\u6570\u4fdd\u5b58\u5e76\u52a0\u8f7d\u90e8\u5206\u5bc4\u5b58\u5668\u7684\u503c\uff08RISC-V \u4e2d\u5b58\u5728\u8c03\u7528\u8005\u4fdd\u5b58\u5e76\u6062\u590d\u7684\u5bc4\u5b58\u5668\uff08caller-saved registers\uff09\uff0c\u4e0d\u9700\u8981\u4fdd\u5b58\u5168\u90e8\u5bc4\u5b58\u5668\uff09</p> </li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/7-%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2/#_2","title":"\u5207\u6362\u8fc7\u7a0b","text":"<ul> <li> <p>yield \u8c03\u7528\u4e86 sched \u51fd\u6570</p> </li> <li> <p>sched \u51fd\u6570\u8fdb\u884c\u5408\u7406\u6027\u68c0\u67e5\uff0c\u6700\u540e\u8c03\u7528 swtch \u51fd\u6570\u4ea4\u6362\u5f53\u524d\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u548c CPU \u8c03\u5ea6\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\uff0c\u8fd4\u56de\u5730\u5740\u4e3a\u5207\u6362\u540e\u4e0a\u4e0b\u6587\u7684 ra \u5bc4\u5b58\u5668\u5b58\u7684\u503c\uff1b\u5b9e\u9645\u4e0a\u662f scheduler \u51fd\u6570</p> </li> </ul> C<pre><code>void\nsched(void)\n{\n  int intena;\n  struct proc *p = myproc();\n\n  if(!holding(&amp;p-&gt;lock))\n    panic(\"sched p-&gt;lock\");\n  if(mycpu()-&gt;noff != 1)\n    panic(\"sched locks\");\n  if(p-&gt;state == RUNNING)\n    panic(\"sched running\");\n  if(intr_get())\n    panic(\"sched interruptible\");\n\n  intena = mycpu()-&gt;intena;\n  swtch(&amp;p-&gt;context, &amp;mycpu()-&gt;context);\n  mycpu()-&gt;intena = intena;\n}\n</code></pre> <ul> <li>\u8c03\u5ea6\u5668\u627e\u5230\u4e00\u4e2a\u53ef\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u518d\u6b21\u8fd0\u884c swtch \u51fd\u6570\u5207\u6362\u4e0a\u4e0b\u6587\uff0c \u6b64\u65f6\u7684 ra \u5bc4\u5b58\u5668\u662f\u4e4b\u524d\u662f\u88ab\u5b9a\u65f6\u5668\u4e2d\u65ad\u901a\u8fc7 sched \u51fd\u6570\u6302\u8d77\u7684</li> </ul> C<pre><code>void\nscheduler(void)\n{\n  struct proc *p;\n  struct cpu *c = mycpu();\n\n  c-&gt;proc = 0;\n  for(;;){\n    // The most recent process to run may have had interrupts\n    // turned off; enable them to avoid a deadlock if all\n    // processes are waiting.\n    intr_on();\n\n    for(p = proc; p &lt; &amp;proc[NPROC]; p++) {\n      acquire(&amp;p-&gt;lock);\n      if(p-&gt;state == RUNNABLE) {\n        // Switch to chosen process.  It is the process's job\n        // to release its lock and then reacquire it\n        // before jumping back to us.\n        p-&gt;state = RUNNING;\n        c-&gt;proc = p;\n        swtch(&amp;c-&gt;context, &amp;p-&gt;context);\n\n        // Process is done running for now.\n        // It should have changed its p-&gt;state before coming back.\n        c-&gt;proc = 0;\n      }\n      release(&amp;p-&gt;lock);\n    }\n  }\n}\n</code></pre> <ul> <li>\u7b2c\u4e00\u6b21\u5207\u6362\u8fdb\u7a0b\u65f6\uff0c\u6784\u9020\u4e00\u4e2a forkret\uff0callocproc \u8bbe\u7f6e\u4e86 ra \u548c sp \u5bc4\u5b58\u5668\uff0cforkret \u672c\u8eab\u53ea\u91ca\u653e\u9501\uff0c\u8c03\u7528 usertrapret</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/","title":"8-Coordination","text":"<code>#Operator System</code>","tags":["Operator System"]},{"location":"notes/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/#coordination","title":"Coordination","text":"<p> \u7ea6 1153 \u4e2a\u5b57  63 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p>","tags":["Operator System"]},{"location":"notes/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/#1","title":"1 \u8fdb\u7a0b\u5207\u6362\u8fc7\u7a0b","text":"<ol> <li>\u4e00\u4e2a\u8fdb\u7a0b\u51fa\u4e8e\u67d0\u79cd\u539f\u56e0\u60f3\u8981\u8fdb\u5165\u4f11\u7720\u72b6\u6001\uff0c\u6bd4\u5982\u8bf4\u51fa\u8ba9 CPU \u6216\u8005\u7b49\u5f85\u6570\u636e\uff0c\u5b83\u4f1a\u5148\u83b7\u53d6\u81ea\u5df1\u7684\u9501\uff1b</li> <li>\u4e4b\u540e\u8fdb\u7a0b\u5c06\u81ea\u5df1\u7684\u72b6\u6001\u4ece RUNNING \u8bbe\u7f6e\u4e3a RUNNABLE\uff1b</li> <li>\u4e4b\u540e\u8fdb\u7a0b\u8c03\u7528 switch \u51fd\u6570\uff0c\u5176\u5b9e\u662f\u8c03\u7528 sched \u51fd\u6570\u5728 sched \u51fd\u6570\u4e2d\u518d\u8c03\u7528\u7684 switch \u51fd\u6570\uff1b</li> <li>switch \u51fd\u6570\u5c06\u5f53\u524d\u7684\u7ebf\u7a0b\u5207\u6362\u5230\u8c03\u5ea6\u5668\u7ebf\u7a0b\uff1b</li> <li>\u8c03\u5ea6\u5668\u7ebf\u7a0b\u4e4b\u524d\u4e5f\u8c03\u7528\u4e86 switch \u51fd\u6570\uff0c\u73b0\u5728\u6062\u590d\u6267\u884c\u4f1a\u4ece\u81ea\u5df1\u7684 switch \u51fd\u6570\u8fd4\u56de\uff1b</li> <li>\u8fd4\u56de\u4e4b\u540e\uff0c\u8c03\u5ea6\u5668\u7ebf\u7a0b\u4f1a\u91ca\u653e\u521a\u521a\u51fa\u8ba9\u4e86 CPU \u7684\u8fdb\u7a0b\u7684\u9501</li> </ol> C<pre><code>// \u9700\u8981\u5207\u6362\u7684\u8fdb\u7a0b\nacquire(&amp;p-&gt;lock);\np-&gt;state = RUNNABLE;\nswtch();\n// \u8c03\u5ea6\u5668\u8fdb\u7a0b\nswtch();\nrelease(&amp;p-&gt;lock);\n</code></pre> <ul> <li> <p>\u5728\u8fdb\u7a0b\u5207\u6362\u7684\u6700\u5f00\u59cb\uff0c\u8fdb\u7a0b\u5148\u83b7\u53d6\u81ea\u5df1\u7684\u9501\uff0c\u5e76\u4e14\u76f4\u5230\u8c03\u7528 swtch \u51fd\u6570\u65f6\u4e5f\u4e0d\u91ca\u653e\u9501\u3002\u800c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4e5f\u5c31\u662f\u8c03\u5ea6\u5668\u7ebf\u7a0b\u4f1a\u5728\u8fdb\u7a0b\u7684\u7ebf\u7a0b\u5b8c\u5168\u505c\u6b62\u4f7f\u7528\u81ea\u5df1\u7684\u6808\u4e4b\u540e\uff0c\u518d\u91ca\u653e\u8fdb\u7a0b\u7684\u9501\u3002</p> </li> <li> <p>\u5982\u679c\u5728 swtch()\u524d\u91ca\u653e\u9501\uff0c\u53ef\u80fd\u6709\u53e6\u4e00\u4e2a CPU \u6838\u5fc3\u8fd0\u884c\u540c\u6837\u7684\u8fdb\u7a0b\uff1b\u4f1a\u9020\u6210\u7a0b\u5e8f\u5d29\u6e83</p> </li> <li> <p>XV6 \u4e2d\uff0c\u4e0d\u5141\u8bb8\u8fdb\u7a0b\u5728\u6267\u884c switch \u51fd\u6570\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6301\u6709\u4efb\u4f55\u5176\u4ed6\u7684\u9501\u3002</p> </li> <li>\u5982\u679c p1 \u6301\u6709\u53e6\u4e00\u4e2a\u9501 l1\uff0c\u5f53 p1 \u5207\u6362\u5230 p2 \u65f6\uff1bp1 \u7684 l1 \u672a\u91ca\u653e\uff0c\u800c\u5982\u679c p2 \u9700\u8981 l1\uff1b\u4f1a\u9020\u6210\u6b7b\u9501\uff1ap2 \u9700\u8981 l1 \u6765\u8fdb\u884c\u8fdb\u7a0b\u5207\u6362\uff0cp1 \u62e5\u6709 l1\uff0c\u4f46\u4e0d\u80fd\u8fdb\u884c\u8fdb\u7a0b\u5207\u6362</li> <li>\u6211\u4eec\u4e0d\u80fd\u5728\u7b49\u5f85\u9501\u7684\u65f6\u5019\u5904\u7406\u4e2d\u65ad\uff1b\u6240\u4ee5\u5b9a\u65f6\u5668\u4e2d\u65ad (\u8c03\u7528 yield\uff0c\u8ba9\u8fdb\u7a0b\u51fa\u8ba9 CPU) \u4e0d\u80fd\u6253\u7834\u6b7b\u9501</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/#2-sleep-wakeup","title":"2 Sleep &amp; Wakeup","text":"<ul> <li>\u901a\u8fc7\u5faa\u73af\u7b49\u5f85\u786c\u4ef6\u8bbe\u5907\u5728\u73b0\u5728\u7b49\u5f85\u7684\u65f6\u95f4\u662f\u4e0d\u53ef\u63a5\u53d7\u7684\uff1b</li> <li>xv6 \u4e2d\u901a\u8fc7 uart \u786c\u4ef6\u8fdb\u884c\u8bfb\u53d6\u5b57\u7b26\u5230\u63a7\u5236\u53f0\uff1b\u5f53\u5199\u5165\u4e00\u4e2a\u5b57\u7b26\u540e\u5199\u5165\u8fdb\u7a0b sleep\uff0c\u89e6\u53d1\u4e2d\u65ad uartintr\uff1b\u4e2d\u65ad\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u5199\u5165\u5b8c\u6210\uff0c\u5982\u679c\u5199\u5165\u5b8c\u6210\uff0c\u5524\u9192\u5199\u5165\u8fdb\u7a0b\u8fdb\u884c\u4e0b\u4e00\u6b21\u5199\u5165</li> <li>sleep \u548c wakeup \u9700\u8981\u7279\u5b9a\u7684\u53c2\u6570\u4e00\u4e2a channel\uff1bsleep \u9700\u8981\u4f20\u9012\u4e00\u4e2a\u9501</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/#21-lose-wakeup","title":"2.1 lose wakeup","text":"<ul> <li>\u4f7f\u7528\u4e0b\u9762\u7684 sleep \u548c wakeup\uff1b\u4f1a\u9020\u6210\u4e22\u5931\u5524\u9192\u95ee\u9898</li> <li>\u53ef\u80fd\u5728\u8fdb\u7a0b\u672a sleep \u524d\uff0c\u4e2d\u65ad\u4f8b\u7a0b\u6267\u884c\u6210\u529f\uff0cwakeup \u672a\u5524\u9192\u4efb\u4f55\u8fdb\u7a0b</li> </ul> C<pre><code>void broken_sleep(chan) {\n  p-&gt;state = SLEEPING;\n  p-&gt;chan = chan;\n  swtch();\n}\nvoid wakeup(chan) {\n  for(each p in prics[]) {\n    if(p-&gt;state == SLEEPING&amp;&amp;p-&gt;chan == chan) {\n      p-&gt;state = RUNNABLE;\n    }\n  }\n}\n\nvoid uartwrite(buf) {\n  for each c in buf:\n    lock;\n    while not done;\n      unlock;\n      // \u4e2d\u65ad\u53d1\u751f\u5730\n      sleep(&amp;tx_chan);\n      // \u518d\u6b21\u83b7\u5f97\u9501\u8fdb\u884c\u4e0b\u4e00\u6b65\u64cd\u4f5c\n      lock\n    send c;\n    done = 0;\n    unlock;\n}\n\nvoid uartintr() {\n  lock;\n  done = 1;\n  wakeup(&amp;tx_chan);\n  unlock;\n}\n</code></pre> <ul> <li>sleep \u9700\u8981\u4f20\u5165\u4e00\u4e2a\u4fdd\u62a4\u6761\u4ef6\u7684\u9501\uff1b\u8c03\u7528 sleep \u65f6\uff0c\u9501\u88ab\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\uff0c\u4e4b\u540e\u8fd9\u4e2a\u9501\u88ab\u4f20\u9012\u7ed9 sleep</li> <li>wakeup \u5fc5\u987b\u5728\u6301\u6709\u6761\u4ef6\u9501\uff08\u8fdb\u7a0b\u7684\u9501\uff09\u65f6\u624d\u80fd\u5524\u9192\u8fdb\u7a0b</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/#22-exit","title":"2.2 exit","text":"<ul> <li>\u5173\u95ed\u6240\u6709\u6253\u5f00\u7684\u6587\u4ef6\uff1b\u7236\u8fdb\u7a0b\u9000\u51fa\uff0c\u5b50\u8fdb\u7a0b\u7531 init \u8fdb\u7a0b\u7ba1\u7406\uff1b\u5c06\u81ea\u5df1\u53d8\u4e3a\u50f5\u5c38\u8fdb\u7a0b\uff1b\u8fdb\u5165 sched()\u51fd\u6570</li> <li>\u4e00\u4e2a\u8fdb\u7a0b exit \u540e\uff0c\u7236\u8fdb\u7a0b\u5982\u679c\u8c03\u7528\u4e86 wait\uff0c\u7236\u8fdb\u7a0b\u4f1a\u8fd4\u56de\u5b50\u8fdb\u7a0b\u9000\u51fa\u503c</li> <li>\u626b\u63cf\u8fdb\u7a0b\u8868\uff0c\u627e\u5230\u5b50\u8fdb\u7a0b\u4e3a\u50f5\u5c38\u8fdb\u7a0b\u7684\u8fdb\u7a0b\uff1b\u8c03\u7528 freeproc()</li> </ul> C<pre><code>static void\nfreeproc(struct proc *p) {\n  if(p-&gt;trapframe)\n    kfree((void*)p-&gt;trapframe);\n  p-&gt;trapframe = 0;\n  if(p-&gt;pagetable)\n    proc_freepagetable(p-&gt;pagetable, p-&gt;sz);\n  p-&gt;pagetable = 0;\n  p-&gt;sz = 0;\n  p-&gt;pid = 0;\n  p-&gt;parent = 0;\n  p-&gt;name[0] = 0;\n  p-&gt;chan = 0;\n  p-&gt;killed = 0;\n  p-&gt;xstate = 0;\n  p-&gt;state = UNUSED;\n}\n</code></pre> <ul> <li>\u5728 Unix \u4e2d\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u9000\u51fa\u7684\u8fdb\u7a0b\uff0c\u90fd\u9700\u8981\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684 wait \u7cfb\u7edf\u8c03\u7528</li> </ul>","tags":["Operator System"]},{"location":"notes/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/#23-kill","title":"2.3 kill","text":"<ul> <li>Unix \u4e2d\u7684\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u5c06\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u7684 ID \u4f20\u9012\u7ed9 kill \u7cfb\u7edf\u8c03\u7528\uff0c\u5e76\u8ba9\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u505c\u6b62\u8fd0\u884c</li> <li>\u5b83\u5148\u626b\u63cf\u8fdb\u7a0b\u8868\u5355\uff0c\u627e\u5230\u76ee\u6807\u8fdb\u7a0b\u3002\u7136\u540e\u53ea\u662f\u5c06\u8fdb\u7a0b\u7684 proc \u7ed3\u6784\u4f53\u4e2d killed \u6807\u5fd7\u4f4d\u8bbe\u7f6e\u4e3a 1\u3002\u5982\u679c\u8fdb\u7a0b\u6b63\u5728 SLEEPING \u72b6\u6001\uff0c\u5c06\u5176\u8bbe\u7f6e\u4e3a RUNNABLE\u3002\u8fd9\u91cc\u53ea\u662f\u5c06 killed \u6807\u5fd7\u4f4d\u8bbe\u7f6e\u4e3a 1\uff0c\u5e76\u6ca1\u6709\u505c\u6b62\u8fdb\u7a0b\u7684\u8fd0\u884c\u3002\u6240\u4ee5 kill \u7cfb\u7edf\u8c03\u7528\u672c\u8eab\u8fd8\u662f\u5f88\u6e29\u548c\u7684\u3002</li> <li>\u800c\u76ee\u6807\u8fdb\u7a0b\u8fd0\u884c\u5230\u5185\u6838\u4ee3\u7801\u4e2d\u80fd\u5b89\u5168\u505c\u6b62\u8fd0\u884c\u7684\u4f4d\u7f6e\u65f6\uff0c\u4f1a\u68c0\u67e5\u81ea\u5df1\u7684 killed \u6807\u5fd7\u4f4d\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a 1\uff0c\u76ee\u6807\u8fdb\u7a0b\u4f1a\u81ea\u613f\u7684\u6267\u884c exit \u7cfb\u7edf\u8c03\u7528</li> <li>\u5982\u679c\u8fdb\u7a0b\u5728\u7528\u6237\u7a7a\u95f4\uff0c\u90a3\u4e48\u4e0b\u4e00\u6b21\u5b83\u6267\u884c\u7cfb\u7edf\u8c03\u7528\u5b83\u5c31\u4f1a\u9000\u51fa\uff0c\u53c8\u6216\u8005\u76ee\u6807\u8fdb\u7a0b\u6b63\u5728\u6267\u884c\u7528\u6237\u4ee3\u7801\uff0c\u5f53\u65f6\u4e0b\u4e00\u6b21\u5b9a\u65f6\u5668\u4e2d\u65ad\u6216\u8005\u5176\u4ed6\u4e2d\u65ad\u89e6\u53d1\u4e86\uff0c\u8fdb\u7a0b\u624d\u4f1a\u9000\u51fa\u3002\u6240\u4ee5\u4ece\u4e00\u4e2a\u8fdb\u7a0b\u8c03\u7528 kill\uff0c\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u771f\u6b63\u9000\u51fa\uff0c\u4e2d\u95f4\u53ef\u80fd\u6709\u5f88\u660e\u663e\u7684\u5ef6\u65f6</li> <li>\u5728\u5185\u6838\u6001 kill \u8fdb\u7a0b\uff0c\u4f1a\u5c06\u8fdb\u7a0b\u5524\u9192\uff1b\u5728 sleep \u5faa\u73af\u4e2d\u8fdb\u884c killed \u6807\u5fd7\u4f4d\u7684\u68c0\u67e5</li> <li>\u5728\u9a71\u52a8\u4e2d\uff0c\u6211\u4eec\u671f\u671b\u6587\u4ef6\u64cd\u4f5c\u4e0d\u4f1a\u4e2d\u65ad\uff1b\u6240\u4ee5\u4e0d\u4f1a\u5728 sleep \u5faa\u73af\u4e2d\u8fdb\u884c killed \u6807\u5fd7\u4f4d\u7684\u68c0\u67e5</li> <li>init \u8fdb\u7a0b\u7684\u76ee\u6807\u5c31\u662f\u4e0d\u9000\u51fa\uff0c\u5b83\u5c31\u662f\u5728\u4e00\u4e2a\u5faa\u73af\u4e2d\u4e0d\u505c\u7684\u8c03\u7528 wait\u3002\u5982\u679c init \u8fdb\u7a0b\u9000\u51fa\u4e86\uff0c\u6211\u8ba4\u4e3a\u8fd9\u662f\u4e00\u4e2a Fatal \u7ea7\u522b\u7684\u9519\u8bef\uff0c\u7136\u540e\u7cfb\u7edf\u4f1a\u5d29\u6e83\u3002\u5728 exit \u51fd\u6570\u7684\u6700\u5f00\u59cb\u5c31\u4f1a\u6709\u5982\u4e0b\u68c0\u67e5</li> </ul> C<pre><code>void\nexit(int status) {\n  struct proc *p = myproc();\n  if(p == initproc)\n    panic(\"init exiting\");\n}\n</code></pre>","tags":["Operator System"]},{"location":"notes/C%2B%2B/1-Container/","title":"1-Container","text":""},{"location":"notes/C%2B%2B/1-Container/#1-container","title":"1 Container","text":"<p> \u7ea6 23 \u4e2a\u5b57  1 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p>"},{"location":"notes/C%2B%2B/1-Container/#11-stdvector","title":"1.1 std::vector","text":"<ul> <li>\u8fed\u4ee3\u5668\u5728vector\u63d2\u5165\u8d85\u8fc7\u5bb9\u91cf\u540e\uff0c\u81ea\u52a8\u6269\u5bb9\u65f6\u5931\u6548 <code>admonish info   \u5f15\u7528\u8bed\u4e49\u5728\u4f7f\u7528 span \u65f6\u5fc5\u987b\u8c28\u614e\u3002\u5c06\u4e00\u4e2a\u65b0\u5143\u7d20\u63d2\u5165 vector \u4e2d,\u8be5 vector \u4e2d\u4fdd\u5b58\u4e86\u8de8\u5ea6\u6240\u5f15\u7528\u7684\u5143\u7d20\u3002\u7531\u4e8e span \u7684\u5f15\u7528\u8bed\u4e49,\u82e5 vector \u5206\u914d\u65b0\u7684\u5185\u5b58\uff0c\u4f1a\u4f7f\u6240\u6709\u8fed\u4ee3\u5668\u548c\u6307\u5411\u5176\u5143\u7d20\u7684\u6307\u9488\u65e0\u6548,\u6240\u4ee5\u91cd\u65b0\u5206\u914d\u4e5f\u4f1a\u4f7f\u5f15\u7528 vector \u5143\u7d20\u7684 span \u5931\u6548\u3002span \u6307\u5411\u4e86\u4e0d\u518d\u5b58\u5728\u7684\u5143\u7d20\u3002  \u51fa\u4e8e\u8fd9\u4e2a\u539f\u56e0,\u9700\u8981\u5728\u63d2\u5165\u524d\u540e\u90fd\u8981\u4ed4\u7ec6\u68c0\u67e5\u5bb9\u91cf (\u5206\u914d\u5185\u5b58\u7684\u6700\u5927\u5143\u7d20\u6570\u91cf)\u3002\u82e5\u5bb9\u91cf\u53d1\u751f\u53d8\u5316,\u5219\u91cd\u65b0\u521d\u59cb\u5316 span</code></li> </ul>"},{"location":"notes/C%2B%2B/2-Algorithm/","title":"2-Algorithm","text":""},{"location":"notes/C%2B%2B/2-Algorithm/#2-algorithm","title":"2 Algorithm","text":"<p> \u7ea6 749 \u4e2a\u5b57  293 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p>"},{"location":"notes/C%2B%2B/2-Algorithm/#21-stdtransform","title":"2.1 std::transform","text":"<ul> <li>std::transform applies the given function to the elements of the given input range(s), and stores the result in an output range starting from d_first.</li> </ul>"},{"location":"notes/C%2B%2B/2-Algorithm/#parameters","title":"parameters","text":"<p>``` admonish info first1, last1: the pair of iterators defining the source range of elements to transform ; first2: the beginning of the second range of elements to transform, (3,4) only; d_first: the beginning of the destination range, may be equal to first1 or first2; policy: the execution policy to use; unary_op: Ret fun(const Type &amp;a); binary_op: Ret fun(const Type1 &amp;a, const Type2 &amp;b); </p>Text Only<pre><code>## possible implementation\n\n``` c++\ntemplate&lt;class InputIt, class OutputIt, class UnaryOp&gt;\nconstexpr //&lt; since C++20\nOutputIt transform(InputIt first1, InputIt last1,\n                   OutputIt d_first, UnaryOp unary_op)\n{\n    for (; first1 != last1; ++d_first, ++first1)\n        *d_first = unary_op(*first1);\n\n    return d_first;\n}\n\ntemplate&lt;class InputIt1, class InputIt2, \n         class OutputIt, class BinaryOp&gt;\nconstexpr //&lt; since C++20\nOutputIt transform(InputIt1 first1, InputIt1 last1, InputIt2 first2,\n                   OutputIt d_first, BinaryOp binary_op)\n{\n    for (; first1 != last1; ++d_first, ++first1, ++first2)\n        *d_first = binary_op(*first1, *first2);\n\n    return d_first;\n}\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#example","title":"example","text":"C++<pre><code>#include &lt;algorithm&gt;\n#include &lt;cctype&gt;\n#include &lt;iomanip&gt;\n#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;utility&gt;\n#include &lt;vector&gt;\n\nvoid print_ordinals(const std::vector&lt;unsigned&gt;&amp; ordinals)\n{\n    std::cout &lt;&lt; \"ordinals: \";\n    for (unsigned ord : ordinals)\n        std::cout &lt;&lt; std::setw(3) &lt;&lt; ord &lt;&lt; ' ';\n    std::cout &lt;&lt; '\\n';\n}\n\nchar to_uppercase(unsigned char c)\n{\n    return std::toupper(c);\n}\n\nvoid to_uppercase_inplace(char&amp; c)\n{\n    c = to_uppercase(c);\n}\n\nvoid unary_transform_example(std::string&amp; hello, std::string world)\n{\n    // Transform string to uppercase in-place\n\n    std::transform(hello.cbegin(), hello.cend(), hello.begin(), to_uppercase);\n    std::cout &lt;&lt; \"hello = \" &lt;&lt; std::quoted(hello) &lt;&lt; '\\n';\n\n    // for_each version (see Notes above)\n    std::for_each(world.begin(), world.end(), to_uppercase_inplace);\n    std::cout &lt;&lt; \"world = \" &lt;&lt; std::quoted(world) &lt;&lt; '\\n';\n}\n\nvoid binary_transform_example(std::vector&lt;unsigned&gt; ordinals)\n{\n    // Transform numbers to doubled values\n\n    print_ordinals(ordinals);\n\n    std::transform(ordinals.cbegin(), ordinals.cend(), ordinals.cbegin(),\n                   ordinals.begin(), std::plus&lt;&gt;{});\n\n    print_ordinals(ordinals);\n}\n\nint main()\n{\n    std::string hello(\"hello\");\n    unary_transform_example(hello, \"world\");\n\n    std::vector&lt;unsigned&gt; ordinals;\n    std::copy(hello.cbegin(), hello.cend(), std::back_inserter(ordinals));\n    binary_transform_example(std::move(ordinals));\n}\n// OUTPUT\n// hello = \"HELLO\"\n// world = \"WORLD\"\n// ordinals:  72  69  76  76  79 \n// ordinals: 144 138 152 152 158\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#22-stdaccumulate","title":"2.2 std::accumulate","text":"<p>```admonish info Computes the sum of the given value init and the elements in the range [first, last). </p>Text Only<pre><code>## parameters\n\n- first, last   -   the pair of iterators defining the range of elements to accumulate\n- init  -   initial value of the accumulate\n- op    -   Ret fun(const Type1 &amp;a, const Type2 &amp;b);\n  ``` admonish example\n  \u5982\u6807\u51c6\u5e93\u4e2d\u7684std::plus&lt;&gt;\n  ```\n\n\n## possible implementation\n\n```c++\n\naccumulate (1)\ntemplate&lt;class InputIt, class T&gt;\nconstexpr // since C++20\nT accumulate(InputIt first, InputIt last, T init)\n{\n    for (; first != last; ++first)\n        init = std::move(init) + *first; // std::move since C++20\n\n    return init;\n}\n\ntemplate&lt;class InputIt, class T, class BinaryOperation&gt;\nconstexpr // since C++20\nT accumulate(InputIt first, InputIt last, T init, BinaryOperation op)\n{\n    for (; first != last; ++first)\n        init = op(std::move(init), *first); // std::move since C++20\n\n    return init;\n}\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#23-stdoptinal","title":"2.3 std::optinal","text":"<ul> <li> <p>std::optional\u6700\u9ad8\u6548\u7684\u5199\u6cd5\u662f\u89e6\u53d1RVO\u7684\u5199\u6cd5\uff0c\u5373\uff1a</p> C++<pre><code>optional&lt;A&gt; optional_best(int n) {\n    optional&lt;A&gt; temp(someFn(n));\n    return temp;\n}\n</code></pre> </li> </ul> \u53c2\u6570 \u7c7b\u578b \u63cf\u8ff0 first InputIt \u6e90\u8303\u56f4\u7684\u8d77\u59cb\u8fed\u4ee3\u5668\uff08\u6307\u5411\u8981\u79fb\u52a8\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff09 last InputIt \u6e90\u8303\u56f4\u7684\u7ed3\u675f\u8fed\u4ee3\u5668\uff08\u6307\u5411\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\uff09 d_first OutputIt \u76ee\u6807\u8303\u56f4\u7684\u8d77\u59cb\u8fed\u4ee3\u5668\uff08\u6307\u5411\u79fb\u52a8\u540e\u7b2c\u4e00\u4e2a\u5143\u7d20\u4f4d\u7f6e\uff09"},{"location":"notes/C%2B%2B/2-Algorithm/#24-stdmove","title":"2.4 std::move","text":"<ul> <li>\u5c06 <code>[first, last)</code> \u8303\u56f4\u5185\u7684\u5143\u7d20\u79fb\u52a8\u5230\u4ee5 d_first \u5f00\u59cb\u7684\u76ee\u6807\u8303\u56f4 C++<pre><code>template &lt;typename InputIt, typename OutputIt&gt;\nOutputIt std::move(InputIt first, InputIt last, OutputIt d_first);\n</code></pre></li> <li>\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u6307\u5411\u76ee\u6807\u8303\u56f4\u79fb\u52a8\u540e\u7684\u7ed3\u675f\u4f4d\u7f6e\uff08\u5373 d_first + (last - first)\uff09\u3002</li> </ul>"},{"location":"notes/C%2B%2B/2-Algorithm/#25-stdmove_backward","title":"2.5 std::move_backward","text":"<ul> <li>\u76ee\u6807\u4f4d\u7f6e\uff1a\u5143\u7d20\u4f1a\u88ab\u79fb\u52a8\u5230\u4ee5 d_last \u4e3a\u7ed3\u675f\u7684\u76ee\u6807\u8303\u56f4\uff0c\u5373\u76ee\u6807\u8303\u56f4\u662f <code>[d_last - N, d_last)</code>\uff0c\u5176\u4e2d N = last - first\u3002 C++<pre><code>template &lt;class BidirIt1, class BidirIt2&gt;\nBidirIt2 std::move_backward(BidirIt1 first, BidirIt1 last, BidirIt2 d_last);\n</code></pre></li> <li>\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u6307\u5411\u76ee\u6807\u8303\u56f4\u79fb\u52a8\u540e\u7684\u8d77\u59cb\u4f4d\u7f6e\uff08\u5373 d_last - (last - first)\uff09</li> </ul> \u53c2\u6570 \u7c7b\u578b \u63cf\u8ff0 first BidirIt1 \u6e90\u8303\u56f4\u7684\u8d77\u59cb\u8fed\u4ee3\u5668\uff08\u6307\u5411\u8981\u79fb\u52a8\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff09 last BidirIt1 \u6e90\u8303\u56f4\u7684\u7ed3\u675f\u8fed\u4ee3\u5668\uff08\u6307\u5411\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\uff09 d_last BidirIt2 \u76ee\u6807\u8303\u56f4\u7684\u7ed3\u675f\u8fed\u4ee3\u5668\uff08\u6307\u5411\u79fb\u52a8\u540e\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\uff09"},{"location":"notes/C%2B%2B/2-Algorithm/#26-stdlower_bound-stdupper_bound","title":"2.6 std::lower_bound \u548c std::upper_bound","text":"<ul> <li>\u5b9e\u9645\u4e0a\u662f\u4e8c\u5206\u67e5\u627e\u7684\u5b9e\u73b0</li> </ul> <p>``` admonish info std::lower_bound: \u8fd4\u56de\u7b2c\u4e00\u4e2a\u4e0d\u5c0f\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20\u4f4d\u7f6e\u3002 \u8fd4\u56de\u503c: \u6307\u5411\u7b2c\u4e00\u4e2a\u6ee1\u8db3 *it &gt;= value \u7684\u5143\u7d20\u7684\u8fed\u4ee3\u5668\u3002\u82e5\u6ca1\u6709\u8fd9\u6837\u7684\u5143\u7d20\uff0c\u5219\u8fd4\u56de end() </p>Text Only<pre><code>``` admonish info\nstd::upper_bound: \u8fd4\u56de\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7ed9\u5b9a\u503c\u7684\u5143\u7d20\u4f4d\u7f6e\u3002\n\u8fd4\u56de\u503c: \u6307\u5411\u7b2c\u4e00\u4e2a\u6ee1\u8db3 *it &gt; value \u7684\u5143\u7d20\u7684\u8fed\u4ee3\u5668\u3002\u82e5\u6ca1\u6709\u8fd9\u6837\u7684\u5143\u7d20\uff0c\u5219\u8fd4\u56de end()\u3002\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#27-stddistance","title":"2.7 std::distance","text":"<p>```admonish info std::distance \u8fd4\u56de\u4ece\u7b2c\u4e00\u4e2a\u8fed\u4ee3\u5668\u5230\u7b2c\u4e8c\u4e2a\u8fed\u4ee3\u5668\u4e4b\u95f4\u7684\u5143\u7d20\u6570\u91cf\u3002\u5bf9\u4e8e\u968f\u673a\u8bbf\u95ee\u8fed\u4ee3\u5668\uff08\u5982 std::vector\u3001std::deque\u3001std::array \u7684\u8fed\u4ee3\u5668\uff09\uff0c\u5b83\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\uff1b\u5bf9\u4e8e\u5176\u4ed6\u7c7b\u578b\u7684\u8fed\u4ee3\u5668\uff08\u5982 std::list\u3001std::forward_list \u7684\u8fed\u4ee3\u5668\uff09\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u9010\u4e2a\u904d\u5386\u5143\u7d20\u3002 </p>Text Only<pre><code>```c++\ntemplate&lt;class InputIterator&gt;\ntypename std::iterator_traits&lt;InputIterator&gt;::difference_type\n    std::distance(InputIterator first, InputIterator last);\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#28-stdall_of-stdany_of-stdnone_of","title":"2.8 std::all_of, std::any_of, std::none_of","text":"Text Only<pre><code>std::all_of: \u68c0\u67e5\u6240\u6709\u5143\u7d20\u662f\u5426\u90fd\u6ee1\u8db3\u6761\u4ef6\uff08Predicate \u8fd4\u56de true\uff09\u3002  \nstd::any_of: \u68c0\u67e5\u662f\u5426\u81f3\u5c11\u6709\u4e00\u4e2a\u5143\u7d20\u6ee1\u8db3\u6761\u4ef6\u3002  \nstd::non_of: \u68c0\u67e5\u662f\u5426\u5168\u90e8\u4e0d\u6ee1\u8db3\u6761\u4ef6\n</code></pre> - \u53c2\u6570\u8bf4\u660e |\u53c2\u6570|    \u8bf4\u660e| |---|---| |first| \u8d77\u59cb\u8fed\u4ee3\u5668\uff0c\u6307\u5411\u5f85\u68c0\u67e5\u8303\u56f4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u3002| |last|  \u7ec8\u6b62\u8fed\u4ee3\u5668\uff0c\u6307\u5411\u5f85\u68c0\u67e5\u8303\u56f4\u7684\u672b\u5c3e\uff08\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\uff09\u3002| |p| \u8c13\u8bcd\uff08Predicate\uff09\uff0c\u63a5\u53d7\u4e00\u4e2a\u5143\u7d20\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u8fd4\u56de bool \u7c7b\u578b\u7684\u6761\u4ef6\u7ed3\u679c\u3002|"},{"location":"notes/C%2B%2B/2-Algorithm/#29-stdcount-stdcount_if","title":"2.9 std::count, std::count_if","text":"<ul> <li>std::count Text Only<pre><code>\u7edf\u8ba1\u503c\u4e3a value \u7684\u5143\u7d20\u4e2a\u6570\n</code></pre></li> </ul> C++<pre><code>template&lt;class InputIt, class T&gt;\ntypename iterator_traits&lt;InputIt&gt;::difference_type\n      count(InputIt first, InputIt last, const T&amp; value);\n</code></pre> - std::count_if Text Only<pre><code>\u7edf\u8ba1\u7b26\u5408\u6761\u4ef6\u7684\u5143\u7d20\u4e2a\u6570\n</code></pre> C++<pre><code>template&lt;class InputIt, class Predicate&gt;\ntypename iterator_traits&lt;InputIt&gt;::difference_type\n  count_if(InputIt first, InputIt last, Predicate p);\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#210-stdfind-stdfind_if","title":"2.10 std::find, std::find_if","text":"<ul> <li> <p>std::find: \u8fd4\u56de\u7b2c\u4e00\u4e2a\u7b49\u4e8e value \u7684\u8fed\u4ee3\u5668 </p>Text Only<pre><code>\u81ea\u5b9a\u4e49\u5bf9\u8c61\u4f7f\u7528std::find\uff0c\u9700\u91cd\u8f7d operator==\n</code></pre> C++<pre><code>template&lt;class InputIt, class T&gt;\nInputIt find(InputIt first, InputIt last, const T&amp; value);\n</code></pre> </li> <li> <p>std::find_if: \u5728\u8303\u56f4\u5185\u67e5\u627e\u7b2c\u4e00\u4e2a\u6ee1\u8db3\u8c13\u8bcd\u6761\u4ef6\u7684\u5143\u7d20\u3002 </p>C++<pre><code>template&lt;class InputIt, class Predicate&gt;\nInputIt find_if(InputIt first, InputIt last, Predicate p);\n</code></pre> </li> </ul>"},{"location":"notes/C%2B%2B/2-Algorithm/#211-stdcopy-stdcopy_if","title":"2.11 std::copy, std::copy_if","text":"<ul> <li> <p>std::copy: \u5b8c\u5168\u590d\u5236\u6240\u6709\u5143\u7d20 </p>C++<pre><code>template&lt;class InputIt, class OutputIt, class Predicate&gt;\nOutputIt copy(InputIt first, InputIt last, OutputIt d_first);\n</code></pre> </li> <li> <p>std::copy_if: \u9009\u62e9\u6027\u590d\u5236\u5143\u7d20 </p>C++<pre><code>template&lt;class InputIt, class OutputIt, class Predicate&gt;\nOutputIt copy_if(InputIt first, InputIt last, OutputIt d_first, Predicate pred);\n</code></pre> </li> </ul>"},{"location":"notes/C%2B%2B/2-Algorithm/#212-stdfill-stdgenerate","title":"2.12 std::fill, std::generate","text":"<ul> <li>std::fill: \u7528\u56fa\u5b9a\u503c\u586b\u5145\u8303\u56f4 C++<pre><code>template&lt;class ForwardIt, class T&gt;\nvoid fill(ForwardIt first, ForwardIt last, const T&amp; value);\n</code></pre></li> <li>std::generate: \u7528\u751f\u6210\u5668\u51fd\u6570\u586b\u5145\u8303\u56f4 C++<pre><code>template&lt;class ForwardIt, class Generator&gt;\nvoid generate(ForwardIt first, ForwardIt last, Generator gen);\n</code></pre></li> </ul> <p>```admonish example \u53ef\u4ee5\u4f7f\u7528\u968f\u673a\u6570\u751f\u6210\u5668\u6765\u8fdb\u884c\u586b\u5145 </p>Text Only<pre><code>```c++\n#include &lt;vector&gt;\n#include &lt;algorithm&gt;\n#include &lt;random&gt;\n\nstd::vector&lt;int&gt; v(5);\nint counter = 0;\nstd::generate(v.begin(), v.end(), [&amp;counter]() {\n    return counter++; // \u751f\u6210 0, 1, 2, 3, 4\n});\n\n// \u751f\u6210\u968f\u673a\u6570\nstd::random_device rd;\nstd::mt19937 rng(rd());\nstd::uniform_int_distribution&lt;int&gt; dist(1, 10);\nstd::generate(v.begin(), v.end(), [&amp;]() { return dist(rng); });\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#213-stdsearch-stdmismatch","title":"2.13 std::search, std::mismatch","text":"<ul> <li> <p>std::search: \u5728\u5e8f\u5217\u4e2d\u641c\u7d22\u5b50\u5e8f\u5217\u3002 </p>C++<pre><code>  template&lt;class ForwardIt1, class ForwardIt2&gt;\n  ForwardIt1 search(ForwardIt1 first1, ForwardIt1 last1, ForwardIt2 first2, ForwardIt2 last2);\n\n  // \u793a\u4f8b\uff1a\u5728 v1 \u4e2d\u67e5\u627e\u5b50\u5e8f\u5217 v2\n  std::vector&lt;int&gt; v1 = {1, 2, 3, 4, 5, 6};\n  std::vector&lt;int&gt; v2 = {3, 4};\n  auto it = std::search(v1.begin(), v1.end(), v2.begin(), v2.end()); // \u8fd4\u56de\u6307\u54113\u7684\u8fed\u4ee3\u5668\n</code></pre> </li> <li> <p>std::mismatch: \u5728\u6bd4\u8f83\u4e24\u4e2a\u5e8f\u5217\uff0c\u8fd4\u56de\u7b2c\u4e00\u4e2a\u4e0d\u5339\u914d\u7684\u4f4d\u7f6e\u3002 </p>C++<pre><code>  template&lt;class InputIt1, class InputIt2&gt;\n  std::pair&lt;InputIt1, InputIt2&gt; mismatch(InputIt1 first1, InputIt1 last1, InputIt2 first2);\n\n  // \u793a\u4f8b\uff1a\u6bd4\u8f83\u4e24\u4e2a\u5b57\u7b26\u4e32\n  std::string s1 = \"hello\", s2 = \"hxllo\";\n  auto [it1, it2] = std::mismatch(s1.begin(), s1.end(), s2.begin()); \n  // it1\u6307\u5411s1\u7684'e', it2\u6307\u5411s2\u7684'x'\n</code></pre> </li> </ul>"},{"location":"notes/C%2B%2B/2-Algorithm/#214-stdreplace-stdreplace_if","title":"2.14 std::replace, std::replace_if","text":"<ul> <li>std::replace: \u66ff\u6362\u6240\u6709\u7b49\u4e8e old_value \u7684\u5143\u7d20\u3002 C++<pre><code>template&lt;class ForwardIt, class T&gt;\nvoid replace(ForwardIt first, ForwardIt last, const T&amp; old_value, const T&amp; new_value);\n\n// \u793a\u4f8b\uff1a\u66ff\u6362\u6240\u67093\u4e3a5\nstd::vector&lt;int&gt; v = {1, 2, 3, 3, 4};\nstd::replace(v.begin(), v.end(), 3, 5); // v\u53d8\u4e3a{1, 2, 5, 5, 4}\n</code></pre></li> <li>std::replace_if: \u66ff\u6362\u6ee1\u8db3\u8c13\u8bcd\u7684\u5143\u7d20 C++<pre><code>template&lt;class ForwardIt, class Predicate, class T&gt;\nvoid replace_if(ForwardIt first, ForwardIt last, Predicate pred, const T&amp; new_value);\n\n// \u793a\u4f8b\uff1a\u66ff\u6362\u6240\u6709\u5076\u6570\u4e3a0\nstd::replace_if(v.begin(), v.end(), [](int x) { return x % 2 == 0; }, 0);\n</code></pre></li> </ul>"},{"location":"notes/C%2B%2B/2-Algorithm/#215-stdremove-stdremove_if","title":"2.15 std::remove / std::remove_if","text":"Text Only<pre><code>\u79fb\u52a8\u6ee1\u8db3\u6761\u4ef6\u7684\u5143\u7d20\u5230\u672b\u5c3e\uff0c\u8fd4\u56de\u65b0\u903b\u8f91\u7ed3\u5c3e\u3002\n</code></pre> C++<pre><code>template&lt;class ForwardIt, class T&gt;\nForwardIt remove(ForwardIt first, ForwardIt last, const T&amp; value);\n\ntemplate&lt;class ForwardIt, class Predicate&gt;\nForwardIt remove_if(ForwardIt first, ForwardIt last, Predicate pred);\n\n// \u793a\u4f8b\uff1a\u5220\u9664\u6240\u67093\uff08\u9700\u7ed3\u5408erase\uff09\nstd::vector&lt;int&gt; v = {1, 2, 3, 4, 3};\nauto new_end = std::remove(v.begin(), v.end(), 3);\nv.erase(new_end, v.end()); // v\u53d8\u4e3a{1, 2, 4}\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#216-stdreverse","title":"2.16 std::reverse","text":"<ul> <li>\u53cd\u8f6c\u6574\u4e2a\u5e8f\u5217</li> </ul> C++<pre><code>template&lt;class BidirIt&gt;\nvoid reverse(BidirIt first, BidirIt last);\n\n// \u793a\u4f8b\uff1a\u53cd\u8f6cvector\nstd::reverse(v.begin(), v.end()); // {1, 2, 3} \u2192 {3, 2, 1}\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#217-stdrotate","title":"2.17 std::rotate","text":"<ul> <li>\u628amiddle\u65cb\u8f6c\u5230\u5f00\u5934</li> </ul> C++<pre><code>template&lt;class ForwardIt&gt;\nForwardIt rotate(ForwardIt first, ForwardIt middle, ForwardIt last);\n\n// \u793a\u4f8b\uff1a\u5c06\u4e2d\u95f4\u5143\u7d20\u65cb\u8f6c\u5230\u5f00\u5934\nstd::vector&lt;int&gt; v = {1, 2, 3, 4, 5};\nstd::rotate(v.begin(), v.begin() + 2, v.end()); // v\u53d8\u4e3a{3, 4, 5, 1, 2}\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#218-stdshuffle","title":"2.18 std::shuffle","text":"<ul> <li>\u4f7f\u7528\u4e00\u4e2a\u968f\u673a\u751f\u6210\u5668\uff0c\u6253\u4e71\u5e8f\u5217</li> </ul> C++<pre><code>template&lt;class RandomIt, class RandomGen&gt;\nvoid shuffle(RandomIt first, RandomIt last, RandomGen&amp;&amp; g);\n\n// \u793a\u4f8b\uff1a\u4f7f\u7528\u968f\u673a\u5f15\u64ce\n#include &lt;random&gt;\nstd::vector&lt;int&gt; v = {1, 2, 3, 4};\nstd::random_device rd;\nstd::mt19937 rng(rd());\nstd::shuffle(v.begin(), v.end(), rng); // \u968f\u673a\u6392\u5217\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#219-stdunique","title":"2.19 std::unique","text":"Text Only<pre><code>\u5220\u9664\u76f8\u90bb\u91cd\u590d\u5143\u7d20\uff08\u9700\u5148\u6392\u5e8f\uff09\u3002\n</code></pre> C++<pre><code>template&lt;class ForwardIt&gt;\nForwardIt unique(ForwardIt first, ForwardIt last);\n\n// \u793a\u4f8b\uff1a\u5220\u9664\u76f8\u90bb\u91cd\u590d\u9879\nstd::vector&lt;int&gt; v = {1, 1, 2, 3, 3};\nauto last = std::unique(v.begin(), v.end());\nv.erase(last, v.end()); // v\u53d8\u4e3a{1, 2, 3}\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#220-stdsort-stdstable_sort-stdpartial_sort","title":"2.20 std::sort, std::stable_sort, std::partial_sort","text":"<ul> <li>std::partial_sort\u662f\u90e8\u5206\u6392\u5e8f C++<pre><code>template&lt;class RandomIt&gt;\nvoid sort(RandomIt first, RandomIt last);\n\ntemplate&lt;class RandomIt&gt;\nvoid stable_sort(RandomIt first, RandomIt last);\n\n// \u793a\u4f8b\uff1a\u964d\u5e8f\u6392\u5e8f\nstd::sort(v.begin(), v.end(), [](int a, int b) { return a &gt; b; });\n\ntemplate&lt;class RandomIt&gt;\nvoid partial_sort(RandomIt first, RandomIt middle, RandomIt last);\n\n// \u793a\u4f8b\uff1a\u627e\u5230\u524d3\u5c0f\u7684\u5143\u7d20\nstd::vector&lt;int&gt; v = {5, 3, 1, 4, 2};\nstd::partial_sort(v.begin(), v.begin() + 3, v.end()); // \u524d3\u4e2a\u5143\u7d20\u4e3a{1, 2, 3}\n</code></pre></li> </ul>"},{"location":"notes/C%2B%2B/2-Algorithm/#221-stdnth_element","title":"2.21 std::nth_element","text":"<ul> <li>\u5c06\u7b2cn\u4e2a\u5143\u7d20\u6392\u5e8f\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\u4e0a</li> </ul> C++<pre><code>template&lt;class RandomIt&gt;\nvoid nth_element(RandomIt first, RandomIt nth, RandomIt last);\n\n// \u793a\u4f8b\uff1a\u627e\u5230\u7b2c3\u5c0f\u7684\u5143\u7d20\nstd::nth_element(v.begin(), v.begin() + 2, v.end()); \n// v = 3\uff0c\u5176\u4ed6\u5143\u7d20\u76f8\u5bf9\u65e0\u5e8f\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#222-stdmerge","title":"2.22 std::merge","text":"<ul> <li>\u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u5e8f\u5217 C++<pre><code>template&lt;class InputIt1, class InputIt2, class OutputIt&gt;\nOutputIt merge(InputIt1 first1, InputIt1 last1, InputIt2 first2, InputIt2 last2, OutputIt d_first);\n\n// \u793a\u4f8b\uff1a\u5408\u5e76\u4e24\u4e2a\u6709\u5e8fvector\nstd::vector&lt;int&gt; v1 = {1, 3, 5}, v2 = {2, 4, 6}, result;\nstd::merge(v1.begin(), v1.end(), v2.begin(), v2.end(), std::back_inserter(result)); \n// result = {1, 2, 3, 4, 5, 6}\n</code></pre></li> </ul>"},{"location":"notes/C%2B%2B/2-Algorithm/#223-stdpartition-stdstable_partition-stdpartition_point","title":"2.23 std::partition, std::stable_partition, std::partition_point","text":"<ul> <li>std::partition: \u5c06\u6ee1\u8db3\u6761\u4ef6\u7684\u5143\u7d20\u79fb\u52a8\u5230\u524d\u7aef</li> </ul> C++<pre><code>template&lt;class ForwardIt, class Predicate&gt;\nForwardIt partition(ForwardIt first, ForwardIt last, Predicate pred);\n\n// \u793a\u4f8b\uff1a\u6309\u5947\u5076\u5206\u533a\nstd::vector&lt;int&gt; v = {1, 2, 3, 4, 5};\nauto it = std::partition(v.begin(), v.end(), [](int x) { return x % 2 != 0; });\n// \u5947\u6570\u5728\u524d\uff0c\u5076\u6570\u5728\u540e\uff08\u53ef\u80fd\u6539\u53d8\u76f8\u5bf9\u987a\u5e8f\uff09\n</code></pre> - std::partition_point: \u8fd4\u56de\u5206\u533a\u70b9 C++<pre><code>template&lt;class ForwardIt, class Predicate&gt;\nForwardIt partition_point(ForwardIt first, ForwardIt last, Predicate pred);\n\n// \u793a\u4f8b\uff1a\u627e\u5230\u5206\u533a\u70b9\nauto it = std::partition_point(v.begin(), v.end(), [](int x) { return x % 2 != 0; });\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#224-stdminelement-stdmaxelement-stdclamp","title":"2.24 std::minelement, std::maxelement, std::clamp","text":"C++<pre><code>template&lt;class ForwardIt&gt;\nForwardIt min_element(ForwardIt first, ForwardIt last);\n\n// \u793a\u4f8b\uff1a\u627e\u5230\u6700\u5927\u503c\nauto it = std::max_element(v.begin(), v.end());\n</code></pre> - std: \u5c06\u5143\u7d20\u9650\u5236\u5728\u8303\u56f4\u5185 C++<pre><code>template&lt;class T&gt;\nconst T&amp; clamp(const T&amp; value, const T&amp; lo, const T&amp; hi);\n\n// \u793a\u4f8b\uff1a\u9650\u5236\u6570\u503c\u5728[0, 100]\nint x = 150;\nx = std::clamp(x, 0, 100); // x\u53d8\u4e3a100\n</code></pre>"},{"location":"notes/C%2B%2B/2-Algorithm/#225-stdsample","title":"2.25 std::sample","text":"<ul> <li>\u968f\u673a\u91c7\u6837\uff0c\u9700\u8981\u63d2\u5165\u8fed\u4ee3\u5668 C++<pre><code>template&lt;class PopulationIt, class SampleIt, class Distance, class UniformRandomBitGenerator&gt;\nSampleIt sample(PopulationIt first, PopulationIt last, SampleIt out, Distance n, UniformRandomBitGenerator&amp;&amp; g);\n\n// \u793a\u4f8b\uff1a\u968f\u673a\u91c7\u68373\u4e2a\u5143\u7d20\nstd::vector&lt;int&gt; src = {1, 2, 3, 4, 5}, dest;\nstd::sample(src.begin(), src.end(), std::back_inserter(dest), 3, std::mt19937{});\n</code></pre></li> </ul>"},{"location":"notes/C%2B%2B/3-Iterator/","title":"3-Iterator","text":""},{"location":"notes/C%2B%2B/3-Iterator/#3-iterator","title":"3 Iterator","text":"<p> \u7ea6 442 \u4e2a\u5b57  45 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p> <ul> <li>\u8f93\u5165\u8fed\u4ee3\u5668\uff1a\u53ea\u80fd\u7528\u6765\u8bfb\u53d6\u6307\u5411\u7684\u503c\uff1b\u5f53\u8be5\u8fed\u4ee3\u5668\u81ea\u52a0\u65f6\uff0c\u4e4b\u524d\u6307\u5411\u7684\u503c\u5c31\u4e0d\u53ef\u8bbf\u95ee\u3002 <code>admonish example   std::istream_iterator \u5c31\u662f\u8fd9\u6837\u7684\u8fed\u4ee3\u5668\u3002</code></li> <li>\u524d\u5411\u8fed\u4ee3\u5668\uff1a\u7c7b\u4f3c\u4e8e\u8f93\u5165\u8fed\u4ee3\u5668\uff0c\u53ef\u4ee5\u5728\u6307\u793a\u8303\u56f4\u8fed\u4ee3\u591a\u6b21 <code>admonish example   std::forward_list \u5c31\u662f\u8fd9\u6837\u7684\u8fed\u4ee3\u5668\u3002\u5c31\u50cf\u4e00\u4e2a\u5355\u5411\u94fe\u8868\u4e00\u6837\uff0c\u53ea\u80fd\u5411\u524d\u904d\u5386\uff0c\u4e0d\u80fd\u5411\u540e\u904d\u5386\uff0c\u4f46\u53ef\u4ee5\u53cd\u590d\u8fed\u4ee3\u3002</code> </li> <li>\u53cc\u5411\u8fed\u4ee3\u5668\uff1a\u8fd9\u4e2a\u8fed\u4ee3\u5668\u53ef\u4ee5\u81ea\u589e\uff0c\u4e5f\u53ef\u4ee5\u81ea\u51cf\uff0c\u8fed\u4ee3\u5668\u53ef\u4ee5\u5411\u524d\u6216\u5411\u540e\u8fed\u4ee3\u3002 <code>admonish example   std::list, std::set \u548c std::map \u90fd\u652f\u6301\u53cc\u5411\u8fed\u4ee3\u5668\u3002</code></li> <li>\u968f\u673a\u8bbf\u95ee\u8fed\u4ee3\u5668\uff1a\u4e0e\u5176\u4ed6\u8fed\u4ee3\u5668\u4e0d\u540c\uff0c\u968f\u673a\u8bbf\u95ee\u8fed\u4ee3\u5668\u4e00\u6b21\u53ef\u4ee5\u8df3\u8f6c\u5230\u4efb\u4f55\u5bb9\u5668\u4e2d\u7684\u5143\u7d20\u4e0a\uff0c\u800c\u975e\u4e4b\u524d\u7684\u8fed\u4ee3\u5668\uff0c\u4e00\u6b21\u53ea\u80fd\u79fb\u52a8\u4e00\u683c\u3002  <code>admonish example   std::vector \u548c std::deque \u7684\u8fed\u4ee3\u5668\u5c31\u662f\u8fd9\u79cd\u7c7b\u578b\u3002</code></li> <li>\u8fde\u7eed\u8fed\u4ee3\u5668\uff1a\u8fd9\u79cd\u8fed\u4ee3\u5668\u5177\u6709\u524d\u8ff0\u51e0\u79cd\u8fed\u4ee3\u5668\u7684\u6240\u6709\u7279\u6027\uff0c\u4e0d\u8fc7\u9700\u8981\u5bb9\u5668\u5185\u5bb9\u5728\u5185\u5b58\u4e0a\u662f\u8fde\u7eed\u7684\uff0c\u7c7b\u4f3c\u4e00\u4e2a\u6570\u7ec4\u6216 std::vector \u3002</li> <li>\u8f93\u51fa\u8fed\u4ee3\u5668\uff1a\u8be5\u8fed\u4ee3\u5668\u4e0e\u5176\u4ed6\u8fed\u4ee3\u5668\u4e0d\u540c\u3002\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a\u5355\u7eaf\u7528\u4e8e\u5199\u51fa\u7684\u8fed\u4ee3\u5668\uff0c\u5176\u53ea\u80fd\u589e\u52a0\uff0c\u5e76\u4e14\u5c06\u5bf9\u5e94\u5185\u5bb9\u5199\u5165\u6587\u4ef6\u5f53\u4e2d\u3002\u5982\u679c\u8981\u8bfb\u53d6\u8fd9\u4e2a\u8fed\u4ee3\u4e2d\u7684\u6570\u636e\uff0c\u90a3\u4e48\u8bfb\u53d6\u5230\u7684\u503c\u5c31\u662f\u672a\u5b9a\u4e49\u7684</li> <li>\u53ef\u53d8\u8fed\u4ee3\u5668\uff1a\u5982\u679c\u4e00\u4e2a\u8fed\u4ee3\u5668\u65e2\u6709\u8f93\u51fa\u8fed\u4ee3\u5668\u7684\u7279\u6027\uff0c\u53c8\u6709\u5176\u4ed6\u8fed\u4ee3\u5668\u7684\u7279\u6027\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8fed\u4ee3\u5668\u5c31\u662f\u53ef\u53d8\u8fed\u4ee3\u5668\u3002 <code>admonish example   \u8be5\u8fed\u4ee3\u5668\u53ef\u8bfb\u53ef\u5199\u3002\u5982\u679c\u6211\u4eec\u4ece\u4e00\u4e2a\u975e\u5e38\u91cf\u5bb9\u5668\u7684\u5b9e\u4f8b\u4e2d\u83b7\u53d6\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8fed\u4ee3\u5668\u901a\u5e38\u90fd\u662f\u53ef\u53d8\u8fed\u4ee3\u5668\u3002</code></li> </ul>"},{"location":"notes/C%2B%2B/3-Iterator/#31-stdback_insert_iterator","title":"3.1 std::back_insert_iterator","text":"<ul> <li> <p>\u5185\u90e8\u8c03\u7528\u5bb9\u5668\u7684<code>push_back</code>\u65b9\u6cd5</p> C++<pre><code>// \u4f7f\u7528 back_insert_iterator \u5728 destination \u7684\u672b\u5c3e\u63d2\u5165\u5143\u7d20\nstd::copy(source.begin(), source.end(), std::back_inserter(destination));\n</code></pre> </li> </ul> C++<pre><code>// \u4f7f\u7528 front_insert_iterator \u5728 destination \u7684\u5f00\u5934\u63d2\u5165\u5143\u7d20\nstd::copy(source.begin(), source.end(), std::front_inserter(destination));  \n</code></pre>"},{"location":"notes/C%2B%2B/3-Iterator/#32-stdfront_insert_iterator","title":"3.2 std::front_insert_iterator","text":"<ul> <li>\u5185\u90e8\u8c03\u7528\u5bb9\u5668\u7684<code>push_front</code>\u65b9\u6cd5</li> </ul>"},{"location":"notes/C%2B%2B/3-Iterator/#33-stdinsert_iterator","title":"3.3 std::insert_iterator","text":"<ul> <li>std::insert_iterator \u662f\u4e00\u4e2a\u901a\u7528\u7684\u63d2\u5165\u8fed\u4ee3\u5668\uff0c\u53ef\u4ee5\u5728\u5bb9\u5668\u7684\u4efb\u610f\u4f4d\u7f6e\u63d2\u5165\u5143\u7d20\u3002\u5b83\u9700\u8981\u4e00\u4e2a\u5bb9\u5668\u548c\u4e00\u4e2a\u63d2\u5165\u4f4d\u7f6e\u3002</li> </ul> C++<pre><code>// \u5728 destination \u7684\u7b2c\u4e8c\u4e2a\u4f4d\u7f6e\u63d2\u5165 source \u7684\u5143\u7d20\nstd::copy(source.begin(), source.end(), std::inserter(destination, destination.begin() + 1));\n</code></pre>"},{"location":"notes/C%2B%2B/3-Iterator/#34-stdistream_iterator","title":"3.4 std::istream_iterator","text":""},{"location":"notes/C%2B%2B/3-Iterator/#-stdistream_iterator-stdcin","title":"- std::istream_iterator \u662f\u4e00\u4e2a\u8f93\u5165\u6d41\u8fed\u4ee3\u5668\uff0c\u7528\u4e8e\u4ece\u8f93\u5165\u6d41\uff08\u5982 std::cin\uff09\u8bfb\u53d6\u6570\u636e","text":"C++<pre><code>#include &lt;iostream&gt;\n#include &lt;vector&gt;\n#include &lt;iterator&gt;\n#include &lt;algorithm&gt; // std::copy\n\nint main() {\n    std::vector&lt;int&gt; numbers;\n\n    std::cout &lt;&lt; \"Enter some integers (end with EOF):\" &lt;&lt; std::endl;\n\n    // \u4f7f\u7528 istream_iterator \u4ece std::cin \u8bfb\u53d6\u6574\u6570\n    std::copy(std::istream_iterator&lt;int&gt;(std::cin), std::istream_iterator&lt;int&gt;(), std::back_inserter(numbers));\n\n    std::cout &lt;&lt; \"You entered:\" &lt;&lt; std::endl;\n    for (int num : numbers) {\n        std::cout &lt;&lt; num &lt;&lt; \" \";\n    }\n    // \u8f93\u51fa\u7528\u6237\u8f93\u5165\u7684\u6574\u6570\n    return 0;\n}\n</code></pre>"},{"location":"notes/C%2B%2B/3-Iterator/#35-stdostream_iterator","title":"3.5 std::ostream_iterator","text":"<ul> <li>std::ostream_iterator \u662f\u4e00\u4e2a\u8f93\u51fa\u6d41\u8fed\u4ee3\u5668\uff0c\u7528\u4e8e\u5c06\u6570\u636e\u5199\u5165\u8f93\u51fa\u6d41\uff08\u5982 std::cout\uff09</li> </ul> C++<pre><code>#include &lt;iostream&gt;\n#include &lt;vector&gt;\n#include &lt;iterator&gt;\n#include &lt;algorithm&gt; // std::copy\n\nint main() {\n    std::vector&lt;int&gt; numbers = {1, 2, 3, 4, 5};\n\n    // \u4f7f\u7528 ostream_iterator \u5c06 numbers \u5199\u5165 std::cout\uff0c\u6bcf\u4e2a\u5143\u7d20\u540e\u52a0\u7a7a\u683c\n    std::copy(numbers.begin(), numbers.end(), std::ostream_iterator&lt;int&gt;(std::cout, \" \"));\n\n    // \u8f93\u51fa: 1 2 3 4 5\n    return 0;\n}\n</code></pre>"},{"location":"notes/C%2B%2B/4-Filesystem/","title":"4 Filesystem","text":"<p> \u7ea6 826 \u4e2a\u5b57  243 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p>"},{"location":"notes/C%2B%2B/4-Filesystem/#4-filesystem","title":"4 FileSystem","text":"<ul> <li> <p>\u6587\u4ef6\u7cfb\u7edf\u5e93\u63d0\u4f9b\u5bf9\u6587\u4ef6\u7cfb\u7edf\u53ca\u5176\u7ec4\u4ef6\uff08\u4f8b\u5982\u8def\u5f84\u3001\u5e38\u89c4\u6587\u4ef6\u548c\u76ee\u5f55\uff09\u6267\u884c\u64cd\u4f5c\u7684\u5de5\u5177\u3002</p> <p><code>admonish info \u6587\u4ef6\u7cfb\u7edf\u5e93\u6700\u521d\u5f00\u53d1\u4e3aboost.filesystem \uff0c\u5e76\u4f5c\u4e3a\u6280\u672f\u89c4\u8303 ISO/IEC TS 18822:2015\u53d1\u5e03\uff0c\u6700\u7ec8\u4e8e C++17 \u5408\u5e76\u5230 ISO C++ \u4e2d\u3002\u76ee\u524d\uff0cboost \u5b9e\u73b0\u5728\u6bd4 C++17 \u5e93\u66f4\u591a\u7684\u7f16\u8bd1\u5668\u548c\u5e73\u53f0\u4e0a\u53ef\u7528\u3002</code></p> </li> <li> <p>\u5982\u679c\u5bf9\u6b64\u5e93\u4e2d\u7684\u51fd\u6570\u7684\u8c03\u7528\u5f15\u53d1\u6587\u4ef6\u7cfb\u7edf\u7ade\u4e89\uff0c\u5373\u5f53\u591a\u4e2a\u7ebf\u7a0b\u3001\u8fdb\u7a0b\u6216\u8ba1\u7b97\u673a\u4ea4\u9519\u8bbf\u95ee\u548c\u4fee\u6539\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u540c\u4e00\u5bf9\u8c61\u65f6\uff0c\u5219\u884c\u4e3a\u672a\u5b9a\u4e49\u3002</p> </li> </ul>"},{"location":"notes/C%2B%2B/4-Filesystem/#41","title":"4.1 \u5b9a\u4e49","text":"<ul> <li>file\uff1a\u4fdd\u5b58\u6570\u636e\u7684\u6587\u4ef6\u7cfb\u7edf\u5bf9\u8c61\uff0c\u53ef\u4ee5\u5199\u5165\u3001\u8bfb\u53d6\u6216\u4e24\u8005\u517c\u800c\u6709\u4e4b\u3002\u6587\u4ef6\u5177\u6709\u540d\u79f0\u3001\u5c5e\u6027\uff0c\u5176\u4e2d\u4e4b\u4e00\u662f\u6587\u4ef6\u7c7b\u578b\uff1a<ul> <li>\u76ee\u5f55\uff1a\u5145\u5f53\u76ee\u5f55\u6761\u76ee\u5bb9\u5668\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u6807\u8bc6\u5176\u4ed6\u6587\u4ef6\uff08\u5176\u4e2d\u4e00\u4e9b\u53ef\u80fd\u662f\u5176\u4ed6\u5d4c\u5957\u76ee\u5f55\uff09\u3002\u5728\u8ba8\u8bba\u7279\u5b9a\u6587\u4ef6\u65f6\uff0c\u8be5\u6587\u4ef6\u4f5c\u4e3a\u6761\u76ee\u51fa\u73b0\u7684\u76ee\u5f55\u662f\u5176\u7236\u76ee\u5f55\u3002\u7236\u76ee\u5f55\u53ef\u4ee5\u7528\u76f8\u5bf9\u8def\u5f84\u540d\u8868\u793a\u201c\u2026\u2026\u201d\u3002</li> <li>\u5e38\u89c4\u6587\u4ef6\uff1a\u5c06\u540d\u79f0\u4e0e\u73b0\u6709\u6587\u4ef6\u5173\u8054\u7684\u76ee\u5f55\u6761\u76ee\uff08\u5373\u786c\u94fe\u63a5\uff09\u3002\u5982\u679c\u652f\u6301\u591a\u4e2a\u786c\u94fe\u63a5\uff0c\u5219\u5728\u5220\u9664\u6307\u5411\u8be5\u6587\u4ef6\u7684\u6700\u540e\u4e00\u4e2a\u786c\u94fe\u63a5\u540e\uff0c\u8be5\u6587\u4ef6\u5c06\u88ab\u5220\u9664\u3002</li> <li>\u7b26\u53f7\u94fe\u63a5\uff1a\u5c06\u540d\u79f0\u4e0e\u8def\u5f84\u76f8\u5173\u8054\u7684\u76ee\u5f55\u6761\u76ee\uff0c\u8be5\u8def\u5f84\u53ef\u80fd\u5b58\u5728\u4e5f\u53ef\u80fd\u4e0d\u5b58\u5728\u3002</li> <li>\u5176\u4ed6\u7279\u6b8a\u6587\u4ef6\u7c7b\u578b\uff1a\u5757\u3001\u5b57\u7b26\u3001fifo\u3001\u5957\u63a5\u5b57\u3002</li> </ul> </li> <li>\u6587\u4ef6\u540d\uff1a\u7528\u4e8e\u547d\u540d\u6587\u4ef6\u7684\u5b57\u7b26\u4e32\u3002\u5141\u8bb8\u7684\u5b57\u7b26\u3001\u533a\u5206\u5927\u5c0f\u5199\u3001\u6700\u5927\u957f\u5ea6\u548c\u4e0d\u5141\u8bb8\u7684\u540d\u79f0\u7531\u5b9e\u73b0\u5b9a\u4e49\u3002\u540d\u79f0\u201c.\u201d\u548c\u201c..\u201d\u5728\u5e93\u5c42\u9762\u5177\u6709\u7279\u6b8a\u542b\u4e49\u3002</li> <li>\u8def\u5f84\uff1a\u6807\u8bc6\u6587\u4ef6\u7684\u5143\u7d20\u5e8f\u5217\u3002\u5b83\u4ee5\u53ef\u9009\u7684\u6839\u540d\u79f0\u5f00\u5934\u200b\u200b\uff08\u4f8b\u5982\u201cC\uff1a\u201d\u6216\u8005\u201c//server\u201d\u5728 Windows \u4e0a\uff09\uff0c\u7136\u540e\u662f\u53ef\u9009\u7684\u6839\u76ee\u5f55\uff08\u4f8b\u5982\u201c/\u201d\u5728 Unix \u4e0a\uff09\uff0c\u540e\u8ddf\u96f6\u4e2a\u6216\u591a\u4e2a\u6587\u4ef6\u540d\u5e8f\u5217\uff08\u9664\u6700\u540e\u4e00\u4e2a\u6587\u4ef6\u540d\u5916\uff0c\u5176\u4ed6\u6587\u4ef6\u540d\u90fd\u5fc5\u987b\u662f\u76ee\u5f55\u6216\u76ee\u5f55\u94fe\u63a5\uff09\u3002\u8def\u5f84 (pathname )\u7684\u5b57\u7b26\u4e32\u8868\u793a\u7684\u672c\u673a\u683c\u5f0f\uff08\u4f8b\u5982\uff0c\u4f7f\u7528\u54ea\u4e9b\u5b57\u7b26\u4f5c\u4e3a\u5206\u9694\u7b26\uff09\u548c\u5b57\u7b26\u7f16\u7801\u662f\u5b9e\u73b0\u5b9a\u4e49\u7684\uff0c\u6b64\u5e93\u63d0\u4f9b\u53ef\u79fb\u690d\u7684\u8def\u5f84\u8868\u793a\u3002<ul> <li>\u7edd\u5bf9\u8def\u5f84\uff1a\u660e\u786e\u6807\u8bc6\u6587\u4ef6\u4f4d\u7f6e\u7684\u8def\u5f84\u3002</li> <li>\u89c4\u8303\u8def\u5f84\uff1a\u4e0d\u5305\u542b\u7b26\u53f7\u94fe\u63a5\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u201c.\u201d\u6216\u8005\u201c..\u201d\u5143\u7d20\u3002</li> <li>\u76f8\u5bf9\u8def\u5f84\uff1a\u7528\u4e8e\u6807\u8bc6\u6587\u4ef6\u76f8\u5bf9\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e0a\u67d0\u4e2a\u4f4d\u7f6e\u7684\u4f4d\u7f6e\u7684\u8def\u5f84\u3002\u7279\u6b8a\u8def\u5f84\u540d\u201c.\u201d\uff08\u70b9\uff0c\u201c\u5f53\u524d\u76ee\u5f55\u201d\uff09\u548c\u201c..\u201d\uff08\u70b9\u70b9\uff0c\u201c\u7236\u76ee\u5f55\u201d\uff09\u662f\u76f8\u5bf9\u8def\u5f84\u3002</li> </ul> </li> </ul>"},{"location":"notes/C%2B%2B/4-Filesystem/#42-directory","title":"4.2 directory","text":"C++<pre><code>#include &lt;algorithm&gt;\n#include &lt;filesystem&gt;\n#include &lt;fstream&gt;\n#include &lt;iostream&gt;\n\nint main()\n{\n    const std::filesystem::path sandbox{\"sandbox\"};\n    std::filesystem::create_directories(sandbox/\"dir1\"/\"dir2\");\n    std::ofstream{sandbox/\"file1.txt\"};\n    std::ofstream{sandbox/\"file2.txt\"};\n\n    std::cout &lt;&lt; \"directory_iterator:\\n\";\n    // directory_iterator can be iterated using a range-for loop\n    for (auto const&amp; dir_entry : std::filesystem::directory_iterator{sandbox}) \n        std::cout &lt;&lt; dir_entry.path() &lt;&lt; '\\n';\n\n    std::cout &lt;&lt; \"\\ndirectory_iterator as a range:\\n\";\n    // directory_iterator behaves as a range in other ways, too\n    std::ranges::for_each(\n        std::filesystem::directory_iterator{sandbox},\n        [](const auto&amp; dir_entry) { std::cout &lt;&lt; dir_entry &lt;&lt; '\\n'; });\n\n    std::cout &lt;&lt; \"\\nrecursive_directory_iterator:\\n\";\n    for (auto const&amp; dir_entry : std::filesystem::recursive_directory_iterator{sandbox}) \n        std::cout &lt;&lt; dir_entry &lt;&lt; '\\n';\n\n    // delete the sandbox dir and all contents within it, including subdirs\n    std::filesystem::remove_all(sandbox);\n}\n// Possible output:\n// directory_iterator:\n// \"sandbox/file2.txt\"\n// \"sandbox/file1.txt\"\n// \"sandbox/dir1\"\n\n// directory_iterator as a range:\n// \"sandbox/file2.txt\"\n// \"sandbox/file1.txt\"\n// \"sandbox/dir1\"\n\n// recursive_directory_iterator:\n// \"sandbox/file2.txt\"\n// \"sandbox/file1.txt\"\n// \"sandbox/dir1\"\n// \"sandbox/dir1/dir2\"\n</code></pre>"},{"location":"notes/C%2B%2B/4-Filesystem/#43-space_info","title":"4.3 space_info","text":"<ul> <li> <p>\u786e\u5b9a\u8def\u5f84\u540d\u6240\u5728\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\u4fe1\u606f\u9875\u4f4d\u4e8e\uff0c\u5982\u540c\u901a\u8fc7 POSIX \u7684 statvfs \u64cd\u4f5c\u4e00\u6837\u3002</p> </li> <li> <p>\u8be5\u5bf9\u8c61\u7531 POSIX struct statvfs \u5185\u5bb9\u8fdb\u884c\u586b\u5145\u5982\u4e0b\u6240\u793a\uff1a</p> <ul> <li>space_info.capacity\u8bbe\u7f6e\u4e3af_blocks * f_frsize\u3002</li> <li>space_info.free\u8bbe\u7f6e\u4e3af_bfree * f_frsize\u3002</li> <li>space_info.available\u8bbe\u7f6e\u4e3af_bavail * f_frsize\u3002</li> <li>\u4efb\u4f55\u65e0\u6cd5\u786e\u5b9a\u7684\u6210\u5458\u90fd\u8bbe\u7f6e\u4e3astatic_cast(-1)</li> </ul> </li> </ul> C++<pre><code>#include &lt;cstdint&gt;\n#include &lt;filesystem&gt;\n#include &lt;iostream&gt;\n#include &lt;locale&gt;\n\nstd::uintmax_t disk_usage_percent(const std::filesystem::space_info&amp; si,\n                                  bool is_privileged = false) noexcept\n{\n    if (constexpr std::uintmax_t X(-1);\n        si.capacity == 0 || si.free == 0 || si.available == 0 ||\n        si.capacity == X || si.free == X || si.available == X\n    )\n        return 100;\n\n    std::uintmax_t unused_space = si.free, capacity = si.capacity;\n    if (!is_privileged)\n    {\n        const std::uintmax_t privileged_only_space = si.free - si.available;\n        unused_space -= privileged_only_space;\n        capacity -= privileged_only_space;\n    }\n    const std::uintmax_t used_space{capacity - unused_space};\n    return 100 * used_space / capacity;\n}\n\nvoid print_disk_space_info(auto const&amp; dirs, int width = 14)\n{\n    (std::cout &lt;&lt; std::left).imbue(std::locale(\"en_US.UTF-8\"));\n\n    for (const auto s : {\"Capacity\", \"Free\", \"Available\", \"Use%\", \"Dir\"})\n        std::cout &lt;&lt; \"\u2502 \" &lt;&lt; std::setw(width) &lt;&lt; s &lt;&lt; ' ';\n\n    for (std::cout &lt;&lt; '\\n'; auto const&amp; dir : dirs)\n    {\n        std::error_code ec;\n        const std::filesystem::space_info si = std::filesystem::space(dir, ec);\n        for (auto x : {si.capacity, si.free, si.available, disk_usage_percent(si)})\n            std::cout &lt;&lt; \"\u2502 \" &lt;&lt; std::setw(width) &lt;&lt; static_cast&lt;std::intmax_t&gt;(x) &lt;&lt; ' ';\n        std::cout &lt;&lt; \"\u2502 \" &lt;&lt; dir &lt;&lt; '\\n';\n    }\n}\n\nint main()\n{\n    const auto dirs = {\"/dev/null\", \"/tmp\", \"/home\", \"/proc\", \"/null\"};\n    print_disk_space_info(dirs);\n}\n// Possible output:\n\n// \u2502 Capacity       \u2502 Free           \u2502 Available      \u2502 Use%           \u2502 Dir            \n// \u2502 84,417,331,200 \u2502 42,732,986,368 \u2502 40,156,028,928 \u2502 50             \u2502 /dev/null\n// \u2502 84,417,331,200 \u2502 42,732,986,368 \u2502 40,156,028,928 \u2502 50             \u2502 /tmp\n// \u2502 -1             \u2502 -1             \u2502 -1             \u2502 100            \u2502 /home\n// \u2502 0              \u2502 0              \u2502 0              \u2502 100            \u2502 /proc\n// \u2502 -1             \u2502 -1             \u2502 -1             \u2502 100            \u2502 /null\n</code></pre>"},{"location":"notes/C%2B%2B/4-Filesystem/#44-symlink","title":"4.4 symlink","text":"<ul> <li>\u8f6f\u94fe\u63a5\u4e5f\u53eb\u7b26\u53f7\u94fe\u63a5\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684inode\u5757\uff0c\u91cc\u9762\u7684\u6570\u636e\u5185\u5bb9\u662f\u94fe\u63a5\u7684\u6587\u4ef6\u540d\u79f0</li> <li>\u521b\u5efa\u4e00\u4e2a\u8f6f\u94fe\u63a5</li> </ul> C++<pre><code>#include &lt;cassert&gt;\n#include &lt;filesystem&gt;\n#include &lt;iostream&gt;\nnamespace fs = std::filesystem;\n\nint main()\n{\n    fs::create_directories(\"sandbox/subdir\");\n    fs::create_symlink(\"target\", \"sandbox/sym1\");\n    fs::create_directory_symlink(\"subdir\", \"sandbox/sym2\");\n\n    for (auto it = fs::directory_iterator(\"sandbox\"); it != fs::directory_iterator(); ++it)\n        if (is_symlink(it-&gt;symlink_status()))\n            std::cout &lt;&lt; *it &lt;&lt; \"-&gt;\" &lt;&lt; read_symlink(*it) &lt;&lt; '\\n';\n\n    assert(std::filesystem::equivalent(\"sandbox/sym2\", \"sandbox/subdir\"));\n    fs::remove_all(\"sandbox\");\n}\n\n// Possible output:\n\n// \"sandbox/sym1\"-&gt;\"target\"\n// \"sandbox/sym2\"-&gt;\"subdir\"\n</code></pre> <p>```admonish info \u8bfb\u53d6\u8f6f\u94fe\u63a5\u6587\u4ef6\uff0c\u4f1a\u83b7\u53d6\u5230\u88ab\u94fe\u63a5\u7684\u6587\u4ef6\u672c\u8eab </p>Text Only<pre><code>```c++\n#include &lt;filesystem&gt;\n#include &lt;iostream&gt;\n\nnamespace fs = std::filesystem;\n\nint main()\n{\n    for (fs::path p : {\"/usr/bin/gcc\", \"/bin/cat\", \"/bin/mouse\"})\n    {\n        std::cout &lt;&lt; p;\n        fs::exists(p) ?\n            fs::is_symlink(p) ?\n                std::cout &lt;&lt; \" -&gt; \" &lt;&lt; fs::read_symlink(p) &lt;&lt; '\\n' :\n                std::cout &lt;&lt; \" exists but it is not a symlink\\n\" :\n            std::cout &lt;&lt; \" does not exist\\n\";\n    }\n}\n\n// Possible output:\n\n// \"/usr/bin/gcc\" -&gt; \"gcc-5\"\n// \"/bin/cat\" exists but it is not a symlink\n// \"/bin/mouse\" does not exist\n</code></pre>"},{"location":"notes/C%2B%2B/4-Filesystem/#45-status","title":"4.5 status","text":"<p>```admonish info \u5c31\u50cfPOSIX\u4e2d stat \u83b7\u53d6\u6587\u4ef6\u65b9\u5f0f\u7c7b\u4f3c </p>Text Only<pre><code>```c++\n#include &lt;cstdio&gt;\n#include &lt;cstring&gt;\n#include &lt;filesystem&gt;\n#include &lt;fstream&gt;\n#include &lt;iostream&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;sys/un.h&gt;\n#include &lt;unistd.h&gt;\n\nnamespace fs = std::filesystem;\n\nvoid demo_status(const fs::path&amp; p, fs::file_status s)\n{\n    std::cout &lt;&lt; p;\n    // alternative: switch(s.type()) { case fs::file_type::regular: ...}\n    if (fs::is_regular_file(s))\n        std::cout &lt;&lt; \" is a regular file\\n\";\n    if (fs::is_directory(s))\n        std::cout &lt;&lt; \" is a directory\\n\";\n    if (fs::is_block_file(s))\n        std::cout &lt;&lt; \" is a block device\\n\";\n    if (fs::is_character_file(s))\n        std::cout &lt;&lt; \" is a character device\\n\";\n    if (fs::is_fifo(s))\n        std::cout &lt;&lt; \" is a named IPC pipe\\n\";\n    if (fs::is_socket(s))\n        std::cout &lt;&lt; \" is a named IPC socket\\n\";\n    if (fs::is_symlink(s))\n        std::cout &lt;&lt; \" is a symlink\\n\";\n    if (!fs::exists(s))\n        std::cout &lt;&lt; \" does not exist\\n\";\n}\n\nint main()\n{\n    // create files of different kinds\n    fs::create_directory(\"sandbox\");\n    fs::create_directory(\"sandbox/dir\");\n    std::ofstream{\"sandbox/file\"}; // create regular file\n    fs::create_symlink(\"file\", \"sandbox/symlink\");\n\n    mkfifo(\"sandbox/pipe\", 0644);\n    sockaddr_un addr;\n    addr.sun_family = AF_UNIX;\n    std::strcpy(addr.sun_path, \"sandbox/sock\");\n    int fd = socket(PF_UNIX, SOCK_STREAM, 0);\n    bind(fd, reinterpret_cast&lt;sockaddr*&gt;(&amp;addr), sizeof addr);\n\n    // demo different status accessors\n    for (auto it{fs::directory_iterator(\"sandbox\")}; it != fs::directory_iterator(); ++it)\n        demo_status(*it, it-&gt;symlink_status()); // use cached status from directory entry\n    demo_status(\"/dev/null\", fs::status(\"/dev/null\")); // direct calls to status\n    demo_status(\"/dev/sda\", fs::status(\"/dev/sda\"));\n    demo_status(\"sandbox/no\", fs::status(\"/sandbox/no\"));\n\n    // cleanup (prefer std::unique_ptr-based custom deleters)\n    close(fd);\n    fs::remove_all(\"sandbox\");\n}\n// Possible output:\n\n// \"sandbox/file\" is a regular file\n// \"sandbox/dir\" is a directory\n// \"sandbox/pipe\" is a named IPC pipe\n// \"sandbox/sock\" is a named IPC socket\n// \"sandbox/symlink\" is a symlink\n// \"/dev/null\" is a character device\n// \"/dev/sda\" is a block device\n// \"sandbox/no\" does not exist\n</code></pre>"},{"location":"notes/C%2B%2B/4-Filesystem/#46-hard-link","title":"4.6 hard link","text":"<ul> <li>\u5728POSIX\u7cfb\u7edf\u4e2d\uff0c\u6bcf\u4e2a\u76ee\u5f55\u81f3\u5c11\u6709\u4e24\u4e2a\u786c\u94fe\u63a5\uff0c\u81ea\u5df1\u4ee5\u53ca\".\"</li> <li>\"..\"\u6709\u4e09\u4e2a\u786c\u94fe\u63a5\uff0c\u76ee\u5f55\u672c\u8eab\uff0c\".\"\u4ee5\u53ca\"..\"</li> <li> <p>\u591a\u4e2a\u6587\u4ef6\u540d\u540c\u65f6\u6307\u5411\u540c\u4e00\u4e2a\u7d22\u5f15\u8282\u70b9\uff08Inode\uff09\uff0c\u53ea\u589e\u52a0i_nlink\u786c\u94fe\u63a5\u8ba1\u6570\u3002 <code>admonish info   \u53ea\u8981\u6587\u4ef6\u7684\u7d22\u5f15\u8282\u70b9\u8fd8\u5b58\u5728\u4e00\u4e2a\u4ee5\u4e0a\u7684\u94fe\u63a5\uff0c\u5220\u9664\u5176\u4e2d\u4e00\u4e2a\u94fe\u63a5\u5e76\u4e0d\u5f71\u54cd\u7d22\u5f15\u8282\u70b9\u672c\u8eab\u548c\u5176\u4ed6\u7684\u94fe\u63a5\uff08\u4e5f\u5c31\u662f\u8bf4\u8be5\u6587\u4ef6\u7684\u5b9e\u4f53\u5e76\u672a\u5220\u9664\uff09\uff0c\u800c\u53ea\u6709\u5f53\u6700\u540e\u4e00\u4e2a\u94fe\u63a5\u88ab\u5220\u9664\u540e\uff0c\u4e14\u6b64\u65f6\u6709\u65b0\u6570\u636e\u8981\u5b58\u50a8\u5230\u78c1\u76d8\u4e0a\uff0c\u90a3\u4e48\u88ab\u5220\u9664\u7684\u6587\u4ef6\u7684\u6570\u636e\u5757\u53ca\u76ee\u5f55\u7684\u94fe\u63a5\u624d\u4f1a\u88ab\u91ca\u653e\uff0c\u5b58\u50a8\u7a7a\u95f4\u624d\u4f1a\u88ab\u65b0\u6570\u636e\u6240\u8986\u76d6\u3002\u56e0\u6b64\uff0c\u8be5\u673a\u5236\u53ef\u4ee5\u6709\u6548\u7684\u9632\u6b62\u8bef\u5220\u64cd\u4f5c\u3002</code></p> </li> <li> <p> \u786c\u94fe\u63a5\u53ea\u80fd\u5728\u540c\u4e00\u7c7b\u578b\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u8fdb\u884c\u94fe\u63a5\uff0c\u4e0d\u80fd\u8de8\u6587\u4ef6\u7cfb\u7edf\u3002\u540c\u65f6\u5b83\u53ea\u80fd\u5bf9\u6587\u4ef6\u8fdb\u884c\u94fe\u63a5\uff0c\u4e0d\u80fd\u94fe\u63a5\u76ee\u5f55\u3002</p> </li> </ul> C++<pre><code>#include &lt;filesystem&gt;\n#include &lt;iostream&gt;\nnamespace fs = std::filesystem;\n\nint main()\n{\n    // On a POSIX-style filesystem, each directory has at least 2 hard links:\n    // itself and the special member pathname \".\"\n    fs::path p = fs::current_path();\n    std::cout &lt;&lt; \"Number of hard links for current path is \"\n              &lt;&lt; fs::hard_link_count(p) &lt;&lt; '\\n';\n\n    // Each \"..\" is a hard link to the parent directory, so the total number\n    // of hard links for any directory is 2 plus number of direct subdirectories\n    p = fs::current_path() / \"..\"; // Each dot-dot is a hard link to parent\n    std::cout &lt;&lt; \"Number of hard links for .. is \"\n              &lt;&lt; fs::hard_link_count(p) &lt;&lt; '\\n';\n}\n// Possible output:\n\n// Number of hard links for current path is 2\n// Number of hard links for .. is 3\n</code></pre>"},{"location":"notes/C%2B%2B/5-View/","title":"5-View","text":""},{"location":"notes/C%2B%2B/5-View/#5-view","title":"5 View","text":"<p> \u7ea6 81 \u4e2a\u5b57  30 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <p>```admonish info \u901a\u5e38\u82e5\u5f15\u7528\u8303\u56f4\u7684\u5143\u7d20\u4fee\u6539,\u5219\u89c6\u56fe\u7684\u5143\u7d20\u4e5f\u4f1a\u4fee\u6539\u3002 \u82e5\u89c6\u56fe\u7684\u5143\u7d20\u4fee\u6539,\u5219\u5f15\u7528\u8303\u56f4\u7684\u5143\u7d20\u4e5f\u4f1a\u4fee\u6539\u3002 </p>Text Only<pre><code>```admonish example \n\u89c6\u56fe\u901a\u5e38\u7528\u4e8e\u5728\u7279\u5b9a\u7684\u57fa\u7840\u4e0a,\u5904\u7406\u57fa\u7840\u8303\u56f4\u7684\u5143\u7d20\u5b50\u96c6\u548c/\u6216\u7ecf\u8fc7\u4e00\u4e9b\u53ef\u9009\u8f6c\u6362\u540e\u7684\u503c\u3002\u4f8b \u5982,\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u89c6\u56fe\u6765\u8fed\u4ee3\u4e00\u4e2a\u8303\u56f4\u7684\u524d\u4e94\u4e2a\u5143\u7d20\n</code></pre> C++<pre><code>for (const auto&amp; elem : std::views::take(coll, 5)) {  ...  }\n</code></pre> <ul> <li>\u7ba1\u9053\u8bed\u6cd5\u4e2d\u8ba9\u89c6\u56fe\u5bf9\u8303\u56f4\u8fdb\u884c\u64cd\u4f5c\u3002\u901a\u8fc7\u4f7f\u7528\u64cd\u4f5c\u7b26 |,\u53ef\u4ee5\u521b\u5efa\u89c6\u56fe\u7684\u7ba1\u9053:</li> </ul> C++<pre><code>auto v = coll \n      | std::views::filter([](auto elem){return elem % 3 == 0;}) \n      | std::views::transform([](auto elem){return elem * elem;}) \n      |std::views::take(3);\n</code></pre> <ul> <li>\u901a\u8fc7\u7c7b\u6a21\u677f\u6307\u5b9a\u8303\u56f4\u7ed3\u675f\u7684\u503c</li> </ul> C++<pre><code>template&lt;auto End&gt;\nstruct EndValue {\n  bool operator== (auto pos) const {\n      return *pos == End;  // end is where iterator points to End\n  }\n};\n\nint main() {\n  std::vector coll = {42, 8, 0, 15, 7, -1};\n  std::ranges::subrange range{coll.begin(), EndValue&lt;7&gt;{}};\n  std::ranges::sort(range);\n  std::ranges::for_each(coll.begin(), EndValue&lt;-1&gt;{}, \n                        [](auto value){std::cout &lt;&lt; ' ' &lt;&lt; value;})\n}\n</code></pre> <ul> <li>\u652f\u6301\u6295\u5f71\u529f\u80fd\uff0c\u907f\u514d\u5199\u663e\u793a\u7684\u6bd4\u8f83\u5668\uff0c\u76f4\u63a5\u901a\u8fc7\u6295\u5f71\u7684\u65b9\u5f0f\u6307\u5b9a\u4f7f\u7528Person\u7684age\u8fdb\u884c\u6392\u5e8f</li> </ul> C++<pre><code>struct Person {\n  std::string name;\n  int age;\n};\nstd::vector&lt;Person&gt; people = {{\"Alice\", 25}, {\"Bob\", 30}, {\"Charlie\", 20}};\nstd::sort(people.begin(), people.end(), \n          [](const Person&amp; a, const Person&amp; b) { return a.age &lt; b.age; });\nstd::ranges::sort(people, std::less&lt;int&gt;{}, &amp;Person::age);\n</code></pre>"},{"location":"notes/C%2B%2B/6-Span/","title":"6-Span","text":""},{"location":"notes/C%2B%2B/6-Span/#6-span","title":"6 Span","text":"<p> \u7ea6 2 \u4e2a\u5b57  4 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p> <p>```admonish danger  \u8fd9\u6bb5\u4ee3\u7801\u4f1a\u5bfc\u81f4\u672a\u5b9a\u4e49\u7684\u884c\u4e3a,\u56e0\u4e3a\u57fa\u4e8e\u8303\u56f4\u7684 for \u5faa\u73af\u4e2d\u5b58\u5728\u4e00\u4e2a bug,\u5728\u5bf9\u4e34\u65f6\u5bf9\u8c61\u7684\u5f15\u7528\u4e0a\u8fdb\u884c\u8fed\u4ee3\u65f6\u4f1a\u4f7f\u7528\u5df2\u7ecf\u9500\u6bc1\u7684\u503c </p>Text Only<pre><code>```c++\n// for the last 3 returned elements:\nfor (auto s : std::span{arrayOfConst()}.last(3)) \n// fatal runtime ERROR  \n</code></pre>"},{"location":"notes/C%2B%2BConcurrency/1-thread/","title":"2.1 thread &amp; jthread","text":""},{"location":"notes/C%2B%2BConcurrency/1-thread/#21-thread-jthread","title":"2.1 thread &amp; jthread","text":"<p> \u7ea6 749 \u4e2a\u5b57  160 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p>"},{"location":"notes/C%2B%2BConcurrency/1-thread/#thread","title":"thread \u4f20\u9012\u53c2\u6570","text":"<ul> <li>\u5982\u679cthread\u6267\u884c\u7684\u51fd\u6570\u53c2\u6570\u662f\u4e00\u4e2a\u5f15\u7528\u7684\u8bdd\uff0c\u9700\u8981<code>std::ref</code> C++<pre><code> void update_data_for_widget(widget_id w,widget_data&amp; data); // 1  \n void oops_again(widget_id w)  {  \n  widget_data data;  std::thread t(update_data_for_widget,w,std::ref(data)); // 2  \n  display_status();  \n  t.join();  \n  process_widget_data(data); \n } \n</code></pre></li> <li>\u8fd9\u4f9d\u8d56\u4e8e std::thread \u5b9e\u4f8b\u7684\u53ef\u79fb\u52a8\u4e14\u4e0d\u53ef\u590d  \u5236\u6027\u3002\u4e0d\u53ef\u590d\u5236\u6027\u8868\u793a\u5728\u67d0\u4e00\u65f6\u95f4\u70b9,\u4e00\u4e2a std::thread \u5b9e\u4f8b\u53ea\u80fd\u5173\u8054\u4e00\u4e2a\u6267\u884c\u7ebf\u7a0b\u3002\u53ef\u79fb\u52a8\u6027\u4f7f\u5f97\u5f00\u53d1\u8005\u53ef  \u4ee5\u81ea\u5df1\u51b3\u5b9a,\u54ea\u4e2a\u5b9e\u4f8b\u62e5\u6709\u7ebf\u7a0b\u5b9e\u9645\u6267\u884c\u7684\u6240\u6709\u6743</li> <li><code>std::thread::hardware_concurrency()</code> \u4f1a\u8fd4\u56de\u5e76\u53d1\u7ebf\u7a0b\u7684\u6570\u91cf\u3002\u4f8b\u5982,\u591a\u6838\u7cfb\u7edf\u4e2d,  \u8fd4\u56de\u503c\u53ef\u4ee5\u662fCPU\u6838\u82af\u7684\u6570\u91cf\u3002\u8fd4\u56de\u503c\u4e5f\u4ec5\u4ec5\u662f\u4e00\u4e2a\u6807\u8bc6,\u5f53\u65e0\u6cd5\u83b7\u53d6\u65f6,\u51fd\u6570\u8fd4\u56de0\u3002 C++<pre><code>// parallel accumulate\ntemplate&lt;typename Iterator,typename T&gt;  \nstruct accumulate_block  {  \n  void operator()(Iterator first,Iterator last,T&amp; result)  {  result=std::accumulate(first,last,result);  \n  }  \n}; \ntemplate&lt;typename Iterator,typename T&gt;  \nT parallel_accumulate(Iterator first,Iterator last,T init)  \n{  \n  unsigned long const length=std::distance(first,last);  \n  if(!length) // 1  \n      return init;  \n  unsigned long const min_per_thread=25;  \n  unsigned long const max_threads=  (length+min_per_thread-1)/min_per_thread; // 2  \n  unsigned long const hardware_threads=  std::thread::hardware_concurrency();  unsigned long const num_threads= // 3 \n  std::min(hardware_threads != 0 ? hardware_threads : 2, max_threads);  unsigned long const block_size=length/num_threads; // 4  \n  std::vector&lt;T&gt; results(num_threads);  \n  std::vector&lt;std::thread&gt; threads(num_threads-1); // 5  \n  Iterator block_start=first;  \n  for(unsigned long i=0; i &lt; (num_threads-1); ++i)  \n  {  \n      Iterator block_end=block_start;  \n      std::advance(block_end,block_size); // 6  \n      threads[i]=std::thread( // 7  \n          accumulate_block&lt;Iterator,T&gt;(),  \n          block_start,block_end,std::ref(results[i]));\n      block_start=block_end; // 8  \n  }  \n  accumulate_block&lt;Iterator,T&gt;()(  block_start,last,results[num_threads-1]); // 9 \n  for (auto&amp; entry : threads)  entry.join(); // 10 \n  return std::accumulate(results.begin(),results.end(),init); // 11 \n}\n</code></pre></li> </ul>"},{"location":"notes/C%2B%2BConcurrency/1-thread/#jthread","title":"jthread","text":"<ul> <li>C++11 \u5f15\u5165\u4e86 std::thread \u7c7b\u578b,\u5176\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u7ebf\u7a0b\u5bf9\u5e94,\u4f46\u8be5\u7c7b\u578b\u6709\u4e00\u4e2a\u4e25\u91cd\u7684\u8bbe\u8ba1\u7f3a  \u9677: \u4e0d\u662f RAII \u7c7b\u578b\u3002</li> </ul>"},{"location":"notes/C%2B%2BConcurrency/1-thread/#thread_1","title":"thread \u5b58\u5728\u7684\u95ee\u9898","text":"<p>std::thread \u8981\u6c42\u5728\u5176\u751f\u547d\u5468\u671f\u7ed3\u675f\u65f6,\u82e5\u8868\u793a\u6b63\u5728\u8fd0\u884c\u7684\u7ebf\u7a0b,\u5219\u8c03\u7528 join()(\u7b49\u5f85\u7ebf\u7a0b\u7ed3\u675f) \u6216  detach()(\u8ba9\u7ebf\u7a0b\u5728\u540e\u53f0\u8fd0\u884c)\u3002\u82e5\u4e24\u8005\u90fd\u6ca1\u6709\u8c03\u7528,\u6790\u6784\u51fd\u6570\u4f1a\u7acb\u5373\u5bfc\u81f4\u5f02\u5e38\u7684\u7a0b\u5e8f\u7ec8\u6b62 (\u5728\u67d0\u4e9b\u7cfb\u7edf\u4e0a\u5bfc\u81f4\u6bb5\u9519\u8bef)\u3002  </p> <p>\u5982\u679c\u901a\u8fc7\u786e\u4fdd\u5728\u79bb\u5f00\u4f5c\u7528\u57df\u65f6\u8c03\u7528 join() \u6765\u5bf9\u5f02\u5e38\u4f5c\u51fa\u53cd\u5e94,\u800c\u4e0d\u89e3\u51b3\u5f02\u5e38\u3002\u4e0d\u5e78\u7684\u662f,\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u963b\u585e (\u6c38\u8fdc)\u3002\u7136\u800c,\u8c03\u7528 detach() \u4e5f\u662f\u4e00\u4e2a\u95ee\u9898,\u56e0\u4e3a\u7ebf\u7a0b\u5728\u7a0b\u5e8f\u7684\u540e\u53f0\u7ee7\u7eed\u8fd0\u884c,\u4f7f\u7528 CPU \u65f6\u95f4\u548c\u8d44\u6e90,\u800c\u8fd9\u4e9b\u65f6\u95f4\u548c\u8d44\u6e90\u73b0\u5728\u53ef\u80fd\u4f1a\u9500\u6bc1\u3002\u82e5\u5728\u66f4\u590d\u6742\u7684\u4e0a\u4e0b\u6587\u4e2d\u4f7f\u7528\u591a\u4e2a\u7ebf\u7a0b,\u95ee\u9898\u4f1a\u53d8\u5f97\u66f4\u7cdf,\u5e76\u4e14\u4f1a\u4ea7\u751f\u975e\u5e38\u7cdf\u7cd5\u7684\u4ee3\u7801\u3002 </p>C++<pre><code>void foo(){\n  std::thread t1{task1, name, val};\n  std::thread t2;\n  try {\n    t2 = std::thread{task2, name, val};\n    ...\n  }\n  catch(...){\n    t1.join();\n    if(t2.joinable()) {\n      t2.join();\n    }\n    throw;\n  }\n\n  t1.join();\n  t2.join();\n}\n</code></pre>"},{"location":"notes/C%2B%2BConcurrency/1-thread/#stdjthread","title":"std::jthread","text":"<ul> <li>std::jthread \u89e3\u51b3\u4e86\u8fd9\u4e9b\u95ee\u9898,\u5b83\u662f RAII \u7c7b\u578b\u3002\u82e5\u7ebf\u7a0b\u662f\u53ef\u6c47\u5165\u7684 (\u201cj\u201d\u4ee3\u8868\u201c\u6c47\u5165\u201d),\u6790\u6784\u51fd\u6570\u4f1a\u81ea\u52a8\u8c03\u7528 join()\u3002</li> <li>\u5185\u7f6e\u505c\u6b62\u673a\u5236\uff1astd::jthread \u4e0e std::stop_token \u96c6\u6210\uff0c\u652f\u6301\u76f4\u63a5\u8bf7\u6c42\u505c\u6b62\u7ebf\u7a0b C++<pre><code>void foo(){\n  std::jthread t1{task1, name, val};\n  std::jthread t2{task2, name, val};\n  ...\n\n  t1.join();\n  t2.join();\n}\n</code></pre></li> </ul>"},{"location":"notes/C%2B%2BConcurrency/1-thread/#jthread_1","title":"jthread\u7684\u505c\u6b62\u4ee4\u724c\u548c\u505c\u6b62\u56de\u8c03","text":"<ul> <li>\u81ea\u52a8\u7ba1\u7406\u505c\u6b62\u4ee4\u724c\uff1a\u5f53\u4f7f\u7528 std::jthread \u65f6\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u521b\u5efa std::stop_source\u3002std::jthread \u81ea\u52a8\u5305\u542b\u4e00\u4e2a\u5185\u90e8\u7684 std::stop_source\uff0c\u5e76\u5728\u542f\u52a8\u7ebf\u7a0b\u65f6\u5c06\u76f8\u5173\u7684 std::stop_token \u4f20\u9012\u7ed9\u7ebf\u7a0b\u51fd\u6570\u3002</li> <li>\u63a5\u6536\u505c\u6b62\u4ee4\u724c\uff1a\u7ebf\u7a0b\u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u63a5\u53d7\u4e00\u4e2a std::stop_token \u53c2\u6570\uff0c\u8be5\u4ee4\u724c\u7531 std::jthread \u63d0\u4f9b\uff0c\u786e\u4fdd\u4e0e\u7ebf\u7a0b\u7684\u5185\u90e8\u505c\u6b62\u673a\u5236\u540c\u6b65\u3002</li> <li>\u5b9a\u671f\u68c0\u67e5\u505c\u6b62\u8bf7\u6c42\uff1a\u5728\u7ebf\u7a0b\u51fd\u6570\u4e2d\uff0c\u5e94\u5b9a\u671f\u8c03\u7528 std::stop_token::stop_requested() \u6765\u68c0\u67e5\u662f\u5426\u63a5\u6536\u5230\u505c\u6b62\u8bf7\u6c42\u3002\u8fd9\u4e3a\u5b89\u5168\u4e14\u53ca\u65f6\u5730\u505c\u6b62\u6267\u884c\u63d0\u4f9b\u4e86\u673a\u5236\u3002</li> <li>\u54cd\u5e94\u505c\u6b62\u8bf7\u6c42\uff1a\u4e00\u65e6 std::stop_token \u8868\u660e\u505c\u6b62\u5df2\u88ab\u8bf7\u6c42\uff0c\u7ebf\u7a0b\u51fd\u6570\u5e94\u91c7\u53d6\u5fc5\u8981\u7684\u6b65\u9aa4\u6765\u5b89\u5168\u5730\u7ec8\u6b62\uff0c\u8fd9\u53ef\u80fd\u5305\u62ec\u8d44\u6e90\u7684\u6e05\u7406\u548c\u72b6\u6001\u7684\u4fdd\u5b58\u3002</li> </ul> C++<pre><code>#include &lt;iostream&gt;\n#include &lt;chrono&gt;\n#include &lt;thread&gt;\n\n// \u4f7f\u7528 std::jthread \u8fd0\u884c\u7684\u51fd\u6570\nvoid task(std::stop_token stoken) {\n    while (!stoken.stop_requested()) {\n        std::cout &lt;&lt; \"\u4efb\u52a1\u6b63\u5728\u8fd0\u884c...\" &lt;&lt; std::endl;\n        // \u6a21\u62df\u4e00\u4e9b\u5de5\u4f5c\n        std::this_thread::sleep_for(std::chrono::seconds(1));\n    }\n    std::cout &lt;&lt; \"\u4efb\u52a1\u5df2\u6536\u5230\u505c\u6b62\u8bf7\u6c42\uff0c\u73b0\u5728\u505c\u6b62\u8fd0\u884c\u3002\" &lt;&lt; std::endl;\n}\n\nint main() {\n    // \u521b\u5efa std::jthread\uff0c\u81ea\u52a8\u5904\u7406\u505c\u6b62\u4ee4\u724c\n    std::jthread worker(task);\n\n    // \u6a21\u62df\u4e3b\u7ebf\u7a0b\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u540e\u9700\u8981\u505c\u6b62\u5b50\u7ebf\u7a0b\n    std::this_thread::sleep_for(std::chrono::seconds(5));\n    std::cout &lt;&lt; \"\u4e3b\u7ebf\u7a0b\u8bf7\u6c42\u505c\u6b62\u5b50\u7ebf\u7a0b...\" &lt;&lt; std::endl;\n\n    // \u89e6\u53d1\u505c\u6b62\u8bf7\u6c42\n    worker.request_stop();\n\n    // std::jthread \u5728\u6790\u6784\u65f6\u81ea\u52a8\u52a0\u5165\n    return 0;\n}\n</code></pre>"},{"location":"notes/C%2B%2BConcurrency/1-thread/#stdstop_token-stdstop_callback","title":"std::stop_token \u548c std::stop_callback\u7684\u5176\u4ed6\u4f7f\u7528\u6848\u4f8b;","text":"<p>\u53e6\u5916, std::stop_token \u548c std::stop_callback \u5e76\u4e0d\u5c40\u9650\u4e8e\u4e0e\u7ebf\u7a0b\uff08\u5982 std::jthread\uff09\u7684\u4f7f\u7528,\u5b83\u4eec\u72ec\u7acb\u4e8e\u7ebf\u7a0b\u7684\uff0c\u7528\u4e8e\u7a0b\u5e8f\u4e2d\u7684\u4efb\u4f55\u5730\u65b9\uff0c\u4ee5\u63d0\u4f9b\u4e00\u79cd\u7075\u6d3b\u7684\u505c\u6b62\u4fe1\u53f7\u5904\u7406\u673a\u5236\u3002</p> <p></p>C++<pre><code>#include &lt;iostream&gt;\n#include &lt;chrono&gt;\n#include &lt;stop_token&gt;\n\nint main() {\n    std::stop_source source;\n    std::stop_token token = source.get_token();\n\n    // \u6a21\u62df\u4e00\u4e9b\u53ef\u4ee5\u88ab\u53d6\u6d88\u7684\u5de5\u4f5c\n    auto startTime = std::chrono::steady_clock::now();\n    auto endTime = startTime + std::chrono::seconds(10);  // \u8bbe\u5b9a10\u79d2\u540e\u7ed3\u675f\u4efb\u52a1\n\n    while (std::chrono::steady_clock::now() &lt; endTime) {\n        if (token.stop_requested()) {\n            std::cout &lt;&lt; \"Task was canceled!\" &lt;&lt; std::endl;\n            break;\n        }\n        std::cout &lt;&lt; \"Working...\" &lt;&lt; std::endl;\n        std::this_thread::sleep_for(std::chrono::seconds(1));\n\n        // \u6a21\u62df\u5728\u67d0\u4e2a\u6761\u4ef6\u4e0b\u8bf7\u6c42\u505c\u6b62\n        if (std::chrono::steady_clock::now() &gt; startTime + std::chrono::seconds(5)) {\n            source.request_stop();\n        }\n    }\n\n    if (!token.stop_requested()) {\n        std::cout &lt;&lt; \"Task completed normally.\" &lt;&lt; std::endl;\n    }\n\n    return 0;\n}\n</code></pre> - stop_token\u4e0estd::thread\u7ed3\u5408 C++<pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;stop_token&gt;\n#include &lt;chrono&gt;\n\nvoid threadFunction(std::stop_token stoken) {\n    std::stop_callback callback(stoken, []() {\n        std::cout &lt;&lt; \"Stop request received.\\n\";\n    });\n   // 4. \u5b9a\u671f\u68c0\u67e5\u505c\u6b62\u8bf7\u6c42\n    while (!stoken.stop_requested()) {\n        std::cout &lt;&lt; \"Running...\\n\";\n        std::this_thread::sleep_for(std::chrono::seconds(1));\n    }\n   // 5. \u54cd\u5e94\u53d6\u6d88\u8bf7\u6c42\n    std::cout &lt;&lt; \"Thread finishing.\\n\";\n}\n\nint main() {\n     // 1. \u521b\u5efa\u5e76\u53d1\u8d77\u53d6\u6d88\u8bf7\u6c42\u7684\u6e90\n    std::stop_source stopSource;\n     // 2. \u751f\u6210\u505c\u6b62\u4ee4\u724c\n    std::stop_token stoken = stopSource.get_token();\n    // 3. \u4f20\u9012\u505c\u6b62\u4ee4\u724c\n    std::thread t(threadFunction, stoken);\n\n    std::this_thread::sleep_for(std::chrono::seconds(5));\n     // \u89e6\u53d1\u505c\u6b62\u8bf7\u6c42\n    stopSource.request_stop();\n\n    t.join();\n    std::cout &lt;&lt; \"Thread stopped.\\n\";\n    return 0;\n}\n</code></pre>"},{"location":"notes/C%2B%2BConcurrency/2-Memory%20Model/","title":"2-Memory Model in C++","text":""},{"location":"notes/C%2B%2BConcurrency/2-Memory%20Model/#22","title":"2.2 \u5185\u5b58\u6a21\u578b","text":"<p> \u7ea6 964 \u4e2a\u5b57  108 \u884c\u4ee3\u7801  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <ul> <li><code>volatile</code>\u8bbf\u95ee\u4e0d\u4f1a\u5efa\u7acb\u7ebf\u7a0b\u95f4\u7684\u540c\u6b65\u3002</li> <li>\u6b64\u5916\uff0c<code>volatile</code>\u8bbf\u95ee\u4e0d\u662f\u539f\u5b50\u7684\uff08\u5e76\u53d1\u8bfb\u5199\u662f\u4e00\u4e2a\u6570\u636e\u7ade\u4e89\u95ee\u9898\uff09\uff0c\u5e76\u4e14\u4e0d\u4f1a\u5bf9\u5185\u5b58\u8fdb\u884c\u6392\u5e8f\uff08\u975e<code>volatile</code>\u7684\u5185\u5b58\u8bbf\u95ee\u53ef\u4ee5\u81ea\u7531\u5730\u5728<code>volatile</code>\u8bbf\u95ee\u5468\u56f4\u91cd\u65b0\u6392\u5e8f\uff09\u3002</li> </ul>"},{"location":"notes/C%2B%2BConcurrency/2-Memory%20Model/#221","title":"2.2.1 \u534f\u8bae\u7ea7\u522b","text":"<ul> <li>\u539f\u5b50\u64cd\u4f5c\u7684\u987a\u5e8f\u4e00\u81f4\u8bed\u4e49\u88ab\u79f0\u4e3a\u5f3a\u5185\u5b58\u6a21\u578b\uff0c\u539f\u5b50\u64cd\u4f5c\u7684\u81ea\u7531\u8bed\u4e49\u88ab\u79f0\u4e3a\u5f31\u5185\u5b58\u6a21\u578b\u3002</li> </ul>"},{"location":"notes/C%2B%2BConcurrency/2-Memory%20Model/#222-c","title":"2.2.2 C++\u7684\u5185\u5b58\u5e8f","text":"<p>\u539f\u5b50\u64cd\u4f5c\u9ed8\u8ba4\u7684\u5185\u5b58\u5e8f\u662f std::memory_order_seq_cst\uff0c\u987a\u5e8f\u4e00\u81f4\u6027</p> C++<pre><code>enum memory_order{\n  memory_order_relaxed,\n  memory_order_consume,\n  memory_order_acquire,\n  memory_order_release,\n  memory_order_acq_rel,\n  memory_order_seq_cst\n}\n</code></pre> <ul> <li> <p>\u987a\u5e8f\u4e00\u81f4: <code>memory_order_seq_cst</code></p> </li> <li> <p>\u83b7\u53d6-\u91ca\u653e(Acquire-release)\uff1a<code>memory_order_consume</code> , <code>memory_order_acquire</code> ,<code>memory_order_release</code>\u548c<code>memory_order_acq_rel</code></p> </li> <li> <p>\u81ea\u7531\u5e8f(Relaxed): <code>memory_order_relaxed</code></p> </li> </ul>"},{"location":"notes/C%2B%2BConcurrency/2-Memory%20Model/#sequentially-consistent-ordering","title":"Sequentially-consistent ordering","text":"<p>\u987a\u5e8f\u4e00\u81f4\u4e2d\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u770b\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u64cd\u4f5c\uff0c\u56e0\u6b64\u4e5f\u53ef\u4ee5\u770b\u5230\u6240\u6709\u5176\u4ed6\u7ebf\u7a0b\u7684\u64cd\u4f5c\u3002\u5982\u679c\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u7684\u83b7\u53d6-\u91ca\u653e\u8bed\u4e49\uff0c\u90a3\u4e48\u987a\u5e8f\u4e00\u81f4\u5c31\u4e0d\u6210\u7acb\u4e86\u3002</p> <ul> <li>\u6807\u8bb0\u4e3a memory_order_seq_cst \u7684\u539f\u5b50\u64cd\u4f5c\u4e0d\u4ec5\u50cf\u91ca\u653e/\u83b7\u53d6\u987a\u5e8f\u90a3\u6837\u5bf9\u5185\u5b58\u8fdb\u884c\u6392\u5e8f\uff08\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u5728\u5b58\u50a8\u64cd\u4f5c\u4e4b\u524d\u53d1\u751f\u7684\u6240\u6709\u4e8b\u60c5\u90fd\u6210\u4e3a\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u52a0\u8f7d\u64cd\u4f5c\u7684\u53ef\u89c1\u526f\u4f5c\u7528\uff09\uff0c\u800c\u4e14\u5efa\u7acb\u4e86\u4e00\u4e2a\u6240\u6709\u8fd9\u6837\u6807\u8bb0\u7684\u539f\u5b50\u64cd\u4f5c\u7684\u5355\u4e00\u603b\u4fee\u6539\u987a\u5e8f\u3002</li> </ul>"},{"location":"notes/C%2B%2BConcurrency/2-Memory%20Model/#release-acquire-ordering","title":"Release-Acquire ordering","text":"<ul> <li>\u5982\u679c\u7ebf\u7a0b A \u4e2d\u7684\u539f\u5b50\u5b58\u50a8\u64cd\u4f5c\u6807\u8bb0\u4e3a<code>memory_order_release</code>\uff0c\u800c\u7ebf\u7a0b B \u4e2d\u5bf9\u540c\u4e00\u53d8\u91cf\u7684\u539f\u5b50\u52a0\u8f7d\u64cd\u4f5c\u6807\u8bb0\u4e3a<code>memory_order_acquire</code>\uff0c\u5e76\u4e14\u7ebf\u7a0b B \u4e2d\u7684\u52a0\u8f7d\u64cd\u4f5c\u8bfb\u53d6\u4e86\u7ebf\u7a0b A \u4e2d\u5b58\u50a8\u64cd\u4f5c\u5199\u5165\u7684\u503c\uff0c\u90a3\u4e48\u7ebf\u7a0b A \u4e2d\u7684\u5b58\u50a8\u64cd\u4f5c\u4e0e\u7ebf\u7a0b B \u4e2d\u7684\u52a0\u8f7d\u64cd\u4f5c\u4e4b\u95f4\u5c31\u5efa\u7acb\u4e86\u540c\u6b65\u5173\u7cfb\uff08synchronizes-with\uff09\u3002   \u6240\u6709\u5728\u539f\u5b50\u5b58\u50a8\u64cd\u4f5c\u4e4b\u524d\u53d1\u751f\uff08\u4ece\u7ebf\u7a0b A \u7684\u89d2\u5ea6\u770b\uff09\u7684\u5185\u5b58\u5199\u5165\u64cd\u4f5c\uff08\u5305\u62ec\u975e\u539f\u5b50\u64cd\u4f5c\u548c\u6807\u8bb0\u4e3a<code>memory_order_relaxed</code>\u7684\u539f\u5b50\u64cd\u4f5c\uff09\u90fd\u5c06\u6210\u4e3a\u7ebf\u7a0b B \u4e2d\u53ef\u89c1\u7684\u526f\u4f5c\u7528\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u65e6\u539f\u5b50\u52a0\u8f7d\u64cd\u4f5c\u5b8c\u6210\uff0c\u7ebf\u7a0b B \u5c06\u80fd\u591f\u770b\u5230\u7ebf\u7a0b A \u5199\u5165\u7684\u6240\u6709\u5185\u5bb9\u3002\u8fd9\u79cd\u4fdd\u8bc1\u4ec5\u5728 B \u5b9e\u9645\u8fd4\u56de\u7ebf\u7a0b A \u5b58\u50a8\u7684\u503c\uff0c\u6216\u8005\u8fd4\u56de\u91ca\u653e\u5e8f\u5217\u4e2d\u66f4\u665a\u7684\u503c\u65f6\u624d\u6210\u7acb\u3002</li> <li>\u8fd9\u79cd\u540c\u6b65\u4ec5\u5728\u91ca\u653e\u548c\u83b7\u53d6\u540c\u4e00\u539f\u5b50\u53d8\u91cf\u7684\u7ebf\u7a0b\u4e4b\u95f4\u5efa\u7acb\u3002\u5176\u4ed6\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u770b\u5230\u4e0e\u540c\u6b65\u7ebf\u7a0b\u4e4b\u4e00\u6216\u4e24\u8005\u90fd\u4e0d\u540c\u7684\u5185\u5b58\u8bbf\u95ee\u987a\u5e8f\u3002\u3002</li> </ul> <p>\u4e92\u65a5\u9501\uff08\u5982 std::mutex \u6216\u539f\u5b50\u81ea\u65cb\u9501\uff09\u662f\u91ca\u653e-\u83b7\u53d6\u540c\u6b65\u7684\u4e00\u4e2a\u4f8b\u5b50\uff1a\u5f53\u7ebf\u7a0b A \u91ca\u653e\u9501\uff0c\u7ebf\u7a0b B \u83b7\u53d6\u9501\u65f6\uff0c\u7ebf\u7a0b A \u5728\u91ca\u653e\u9501\u4e4b\u524d\u5728\u4e34\u754c\u533a\u4e2d\u53d1\u751f\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u5fc5\u987b\u5bf9\u7ebf\u7a0b B \u53ef\u89c1\uff08\u7ebf\u7a0b B \u5728\u83b7\u53d6\u9501\u4e4b\u540e\u6267\u884c\u76f8\u540c\u7684\u4e34\u754c\u533a\uff09\u3002 \u540c\u6837\u7684\u539f\u7406\u4e5f\u9002\u7528\u4e8e\u7ebf\u7a0b\u7684\u542f\u52a8\u548c\u6c47\u5165\u3002\u8fd9\u4e24\u79cd\u64cd\u4f5c\u90fd\u662f\u83b7\u53d6-\u91ca\u653e\u64cd\u4f5c\u3002\u63a5\u4e0b\u6765\u662f wait \u548c notify_one \u5bf9\u6761\u4ef6\u53d8\u91cf\u7684\u8c03\u7528\uff1bwait \u662f\u83b7\u53d6\u64cd\u4f5c\uff0cnotify_one \u662f\u91ca\u653e\u64cd\u4f5c\u3002\u90a3 notify_all \u5462\uff1f\u5f53\u7136\uff0c\u4e5f\u662f\u4e00\u4e2a\u91ca\u653e\u64cd\u4f5c\u3002</p> <ul> <li>\u5728\u4e00\u4e2a\u91ca\u653e\u5e8f\u5217\u4e2d\uff0c\u5373\u4f7f RMW \u64cd\u4f5c\u4f7f\u7528\u4e86 memory_order_relaxed\uff0c\u5b83\u4e5f\u4e0d\u4f1a\u7834\u574f\u91ca\u653e\u5e8f\u5217\u7684\u540c\u6b65\u6548\u679c\u3002</li> </ul> C++<pre><code>#include &lt;atomic&gt;\n#include &lt;cassert&gt;\n#include &lt;thread&gt;\n#include &lt;vector&gt;\n\nstd::vector&lt;int&gt; data;\nstd::atomic&lt;int&gt; flag = {0};\n\nvoid thread_1()\n{\n    data.push_back(42);\n    flag.store(1, std::memory_order_release);\n}\n\nvoid thread_2()\n{\n    int expected = 1;\n    // memory_order_relaxed is okay because this is an RMW,\n    // and RMWs (with any ordering) following a release form a release sequence\n    while (!flag.compare_exchange_strong(expected, 2, std::memory_order_relaxed))\n    {\n        expected = 1;\n    }\n}\n\nvoid thread_3()\n{\n    while (flag.load(std::memory_order_acquire) &lt; 2)\n        ;\n    // if we read the value 2 from the atomic flag, we see 42 in the vector\n    assert(data.at(0) == 42); // will never fire\n}\n\nint main()\n{\n    std::thread a(thread_1);\n    std::thread b(thread_2);\n    std::thread c(thread_3);\n    a.join(); b.join(); c.join();\n}\n</code></pre> <ul> <li>\u9519\u8bef\u6848\u4f8b <p>dataProduced.store(true, std::memory_order_release)\u4e0e dataProduced.load(std::memory_order_acquire)\u540c\u6b65\u3002\u4e0d\u8fc7\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u83b7\u53d6\u64cd\u4f5c\u8981\u5bf9\u91ca\u64cd\u4f5c\u8fdb\u884c\u7b49\u5f85\uff0c\u800c\u8fd9\u6b63\u662f\u4e0b\u56fe\u4e2d\u7684\u5185\u5bb9\u3002\u56fe\u4e2d\uff0cdataProduced.load(std::memory_order_acquire)\u5728\u6307\u4ee4 dataProduced.store(true, std::memory_order_release)\u4e4b\u524d\uff0c\u6240\u4ee5\u8fd9\u91cc\u6ca1\u6709\u540c\u6b65\u5173\u7cfb\u3002</p> </li> </ul> <p></p> C++<pre><code>// acquireReleaseWithoutWaiting.cpp\n\n#include &lt;atomic&gt;\n#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;vector&gt;\n\nstd::vector&lt;int&gt; mySharedWork;\nstd::atomic&lt;bool&gt; dataProduced(false);\n\nvoid dataProducer(){\n  mySharedWork = {1,0,3};\n  dataProduced.store(true, std::memory_order_release);\n}\n\nvoid dataConsumer(){\n     dataProduced.load(std::memory_order_acquire);\n  myShraedWork[1] = 2;\n}\n\nint main(){\n\n  std::cout &lt;&lt; std::endl;\n\n  std::thread t1(dataConsumer);\n  std::thread t2(dataProducer);\n\n  t1.join();\n  t2.join();\n\n  for (auto v : mySharedWork){\n    std::cout &lt;&lt; v &lt;&lt; \" \";\n  }\n\n  std::cout &lt;&lt; \"\\n\\n\";\n\n}\n</code></pre> <ul> <li>\u5f53 dataProduced.store(true, std::memory_order_release)\u5148\u884c\u4e8e dataProduced.load(std::memory_order_acquire)\uff0c\u90a3\u4e48 dataProduced.store(true, std::memory_order_release)\u4e4b\u524d\u548c dataProduced.load(std::memory_order_acquire)\u4e4b\u540e\u6267\u884c\u7684\u64cd\u4f5c\u662f\u6240\u6709\u7ebf\u7a0b\u53ef\u89c1\u7684\u3002</li> </ul>"},{"location":"notes/C%2B%2BConcurrency/2-Memory%20Model/#relax-ordering","title":"Relax Ordering","text":"<p>Typical use for relaxed memory ordering is incrementing counters, such as the reference counters of std::shared_ptr, since this only requires atomicity, but not ordering or synchronization (note that decrementing the std::shared_ptr counters requires acquire-release synchronization with the destructor).</p> C++<pre><code>#include &lt;atomic&gt;\n#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;vector&gt;\n\nstd::atomic&lt;int&gt; cnt = {0};\n\nvoid f()\n{\n    for (int n = 0; n &lt; 1000; ++n)\n        cnt.fetch_add(1, std::memory_order_relaxed);\n}\n\nint main()\n{\n    std::vector&lt;std::thread&gt; v;\n    for (int n = 0; n &lt; 10; ++n)\n        v.emplace_back(f);\n    for (auto&amp; t : v)\n        t.join();\n    std::cout &lt;&lt; \"Final counter value is \" &lt;&lt; cnt &lt;&lt; '\\n';\n}\n// always 10000\n</code></pre>"},{"location":"notes/CMU15445/10-Join%20Algorithm/","title":"10-Join Algorithm","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#10-join-algorithm","title":"10-Join Algorithm","text":"<p> \u7ea6 349 \u4e2a\u5b57  21 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#101-join-algorithms","title":"10.1 join algorithms","text":"<p>\u5c3d\u53ef\u80fd\u9009\u62e9\u8f83\u5c0f\u7684\u8868\u4f5c\u4e3a\u5916\u56f4\u8868</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#102-join-opetators","title":"10.2 Join opetators","text":"","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#output","title":"Output","text":"","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#data","title":"data","text":"","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#cost-analysis-criteria","title":"Cost Analysis Criteria","text":"","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#nested-loop-join","title":"Nested Loop Join","text":"","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#nested-loop-join_1","title":"Nested Loop Join","text":"<p>\u5df2\u77e5\u8868\u975e\u5e38\u5c0f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528 nested loop join\uff0c\u53ef\u4ee5\u9002\u914d L3 \u7f13\u5b58</p> <p></p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#index-nested-loop-join","title":"Index Nested Loop Join","text":"","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#block-nested-loop-join","title":"Block Nested loop join","text":"","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#nested-loop-join-summary","title":"Nested Loop Join Summary","text":"<p>Key Takeaways</p> <p>\u9009\u62e9\u66f4\u5c0f\u7684\u8868\u4f5c\u4e3a Outer table \u5c3d\u53ef\u80fd\u5728 bufferpool \u4e2d\u7f13\u5b58 outer table \u4f7f\u7528\u7d22\u5f15\u5feb\u901f\u8bbf\u95ee inner table</p> <p>Algorithms</p> <p>Naive Block Index</p>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#sort-merge-join","title":"Sort-Merge Join","text":"<ol> <li>Sort</li> </ol> <ol> <li>Merge</li> </ol> <p>\u6b64\u65f6 R \u4e2d id \u4e3a 200\uff1bS \u7684 id \u6bd4 200 \u5927\uff0c\u9700\u8981\u56de\u6eaf\uff0c\u4f46\u662f\u7531\u4e8e\u8868\u662f\u6709\u5e8f\u7684\uff0c\u4e0d\u5fc5\u50cf nested loop join \u56de\u6eaf\u5230\u5f00\u5934\u53ea\u9700\u8981\u56de\u6eaf\u5230\u4e0a\u4e00\u4e2a\u4e0d\u5927\u4e8e R.id \u7684\u503c\u5c31\u53ef\u4ee5 </p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#when-is-sort-merge-join-useful","title":"when is sort-merge join useful","text":"<ol> <li>\u5176\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u8868\u5728 Join key \u4e0a\u5df2\u7ecf\u6392\u5e8f</li> <li>\u8f93\u51fa\u5fc5\u987b\u5728 join key \u4e0a\u6392\u5e8f</li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#hash-join","title":"Hash Join","text":"","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#simple-hash-join-algorithm","title":"simple hash join algorithm","text":"<p>\u53ef\u4ee5\u5728 probe \u9636\u6bb5\u4f7f\u7528 bloom filter \u8fdb\u884c\u4f18\u5316\uff1b\u9996\u5148\u6982\u7387\u6027\u5730\u67e5\u627e\u662f\u5426\u5b58\u5728\u8fd9\u4e2a Key</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#partitioned-hash-join","title":"Partitioned hash join","text":"<ol> <li>partiion phase</li> <li>probe phase</li> </ol> <p>\u5982\u679c\u5176\u4e2d\u7684\u6876\u4ecd\u7136\u6ea2\u51fa\uff0c\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u54c8\u5e0c\u51fd\u6570\u8fdb\u884c rehash </p>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#hybird-hash-join","title":"Hybird hash join","text":"<p>\u4ec5\u4ec5\u5728\u6570\u636e\u5206\u5e03\u53ca\u5176\u503e\u659c\u7684\u65f6\u5019\u4f7f\u7528\uff1b\u5c06\u5927\u91cf\u4f7f\u7528\u7684 hash \u6876\u4fdd\u5b58\u5728\u5185\u5b58 </p>","tags":["Database"]},{"location":"notes/CMU15445/10-Join%20Algorithm/#join-algorithms-summary","title":"Join algorithms summary","text":"<p>hashing is almost always better than sorting for operator executino sorting is better on non-uniform data sorting si better when result needs to be sorted</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/","title":"11 Query Execution","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#11-query-execution","title":"11. Query Execution","text":"<p> \u7ea6 420 \u4e2a\u5b57  31 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#processing-models","title":"Processing Models","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#iterator-model","title":"Iterator Model","text":"<p>\u8fed\u4ee3\u5668\u6a21\u578b\uff0c\u4e5f\u53eb\u505a\u706b\u5c71\u6216\u8005\u6d41\u6c34\u7ebf\u6a21\u578b</p> <p>\u5927\u91cf\u51fd\u6570\u8c03\u7528\uff0c\u6307\u4ee4\u7f13\u5b58\u4f1a\u5f88\u5feb\u5931\u6548</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#materialization-model","title":"Materialization Model","text":"<p>\u751f\u6210\u6240\u6709\u6570\u636e\u7136\u540e\u8fd4\u56de\u7ed9\u4e0a\u5c42</p> <p>\u5bf9\u4e8e OLTP \u8868\u73b0\u4e0d\u9519\uff0c\u56e0\u4e3a\u6ca1\u6709\u5f88\u5927\u7684\u8868\u9700\u8981\u4f20\u9012</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#vectorizedbatch-model","title":"Vectorized/Batch MOdel","text":"<p>\u5728\u7269\u5316\u6a21\u578b\u548c\u706b\u5c71\u6a21\u578b\u95f4\u662f\u4e00\u4e2a\u826f\u597d\u7684\u5e73\u8861 \u53ef\u4ee5\u4f7f\u7528 SIMD \u6307\u4ee4\u52a0\u901f</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#plan-processing-direction","title":"Plan Processing Direction","text":"<p>\u81ea\u4e0a\u800c\u4e0b\u5bf9\u4e8e\u4e0a\u9762\u7684\u6a21\u578b\u6765\u8bf4\u66f4\u52a0\u81ea\u7136</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#access-methods","title":"Access Methods","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#sequential-scan","title":"Sequential Scan","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#optimization","title":"Optimization","text":"<ul> <li>Prefetching</li> <li>Buffer Pool Bypass</li> <li>Parallelization</li> <li>Heap Clustering</li> <li>\u53ea\u662f\u53d6\u56de RID\uff0c\u6700\u540e\u624d\u53d6\u56de\u771f\u6b63\u7684\u6570\u636e</li> <li>Late Materialization</li> <li>Data Skipping</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#data-sipping","title":"Data Sipping","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#zone-maps","title":"ZONE MAPS","text":"<p>one zone map in one zone\uff0czone \u7684\u5927\u5c0f\u53d6\u51b3\u4e8e\u6211\u4eec\u7684\u5b9e\u73b0\uff0c\u4e00\u822c\u4e3a\u9875 \u5f53 zone map \u5b58\u50a8\u5728\u533a\u57df\u4e4b\u5916\uff0c\u4e0e\u7d22\u5f15\u7684\u5de5\u4f5c\u6d41\u7a0b\u5f88\u50cf</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#index-scan","title":"Index Scan","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#multi-index-scan","title":"Multi-Index Scan","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#modification-queries","title":"Modification Queries","text":"<p>Halloween problem: \u8ddf\u8e2a\u5df2\u7ecf\u4fee\u6539\u8fc7\u7684 record id\uff0c\u4e00\u822c\u5728\u64cd\u4f5c\u7b26\u5185\u90e8\u4f7f\u7528\u6570\u636e\u7ed3\u6784\u6765\u8ddf\u8e2a\uff0c\u907f\u514d\u4e0b\u4e00\u6b21\u518d\u6b21\u4fee\u6539 materailization \u4e0d\u4f1a\u6709\u8fd9\u6837\u7684\u95ee\u9898</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#expression-evaluation","title":"Expression Evaluation","text":"<p>JIT compilation \u53ef\u4ee5\u9ad8\u6548\u5730\u8bc4\u4f30\u8868\u8fbe\u5f0f\uff1b\u8868\u8fbe\u5f0f\u4f1a\u88ab\u7f16\u8bd1\u6210\u5e38\u91cf\u6216\u51fd\u6570</p> <p></p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#scheduler","title":"Scheduler","text":"<p>quickstep \u7684 scheduler \u539f\u578b\uff1b\u5de5\u4f5c\u7ebf\u7a0b\u6c60\u662f\u65e0\u72b6\u6001\u7684\u3001\u5f39\u6027\u53ef\u4f38\u7f29\u7684\uff0c\u53ef\u4ee5\u5bf9\u67e5\u8be2\u8fdb\u884c\u4f18\u5148\u7ea7\u7684\u6267\u884c</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#process-models","title":"Process Models","text":"<ol> <li>Process per DBMS Worker </li> <li>Thread per DBMS Worker </li> <li>Embedded DBMS </li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#execution-parallelism","title":"Execution Parallelism","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#inter-query-parallelism","title":"Inter-query Parallelism","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#intra-query-parallelism","title":"Intra-query Parallelism","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#intra-operatorhorizontal","title":"Intra-Operator(Horizontal)","text":"<p>\u901a\u8fc7\u786c\u4ef6\u5e76\u884c\u6027\u52a8\u6001\u786e\u5b9a\uff0c\u73b0\u5728\u4e00\u822c\u901a\u8fc7\u8c03\u5ea6\u5668\u6765\u5b9e\u73b0</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#inter-operatorvertical","title":"Inter-Operator(Vertical)","text":"<p>\u6295\u5f71\u8fd0\u7b97\u7b26\u5728\u4e0b\u5c42\u8fd0\u7b97\u7b26\u8fd8\u6ca1\u6709\u6267\u884c\u5b8c\u6210\u65f6\uff0c\u5c31\u5f00\u59cb\u5de5\u4f5c</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#bushy","title":"Bushy","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#io-parallelism","title":"I/O Parallelism","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#multi-disk-parallelism","title":"Multi-Disk Parallelism","text":"","tags":["Database"]},{"location":"notes/CMU15445/11-Query_Execution/#database-partitioning","title":"Database Partitioning","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/","title":"12 Query Planning and Optimization","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#query-planning-and-optimization","title":"Query Planning and Optimization","text":"<p> \u7ea6 308 \u4e2a\u5b57  32 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p> <p>catalog \u662f\u4e00\u4e2a\u8bb0\u5f55\u5143\u6570\u636e\u4fe1\u606f\u7684\u6587\u4ef6</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#the-physical-plan","title":"The Physical Plan","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#query-optimizationqo","title":"Query Optimization(QO)","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#heuristicsrules","title":"Heuristics/Rules","text":"<ul> <li>\u91cd\u5199\u67e5\u8be2\u6765\u53bb\u9664\u90a3\u4e9b\u65e0\u6548\u7684\u6761\u4ef6</li> <li>\u8fd9\u4e9b\u6280\u5de7\u9700\u8981\u8bbf\u95ee catalog\uff0c\u4f46\u662f\u5b83\u4eec\u4e0d\u9700\u8981\u8bbf\u95ee\u6570\u636e</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#predicate-pushdown","title":"Predicate Pushdown","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#replace-cartesian-product","title":"Replace Cartesian Product","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#projection-pushdown","title":"Projection Pushdown","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#equivalence","title":"Equivalence","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#architecture-overview","title":"Architecture Overview","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#cost-based-search","title":"Cost-based Search","text":"<ul> <li>\u4f7f\u7528\u4e00\u4e2a\u6a21\u578b\u6765\u9884\u6d4b\u6267\u884c\u4e00\u4e2a\u8ba1\u5212\u7684\u6210\u672c</li> <li>\u904d\u5386\u591a\u79cd\u8ba1\u5212\uff0c\u9009\u62e9\u4e00\u4e2a\u6210\u672c\u6700\u5c0f\u7684\u8ba1\u5212\u6765\u6267\u884c</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#bottom-up-optimization","title":"Bottom-up Optimization","text":"<p>\u4f7f\u7528\u52a8\u6001\u89c4\u5212\uff0c\u81ea\u5e95\u5411\u4e0a\u6784\u5efa\u67e5\u8be2\u8ba1\u5212\u6210\u672c\u6700\u4f4e\u7684\u8ba1\u5212</p> <p></p> <ul> <li>single-relation query palnning</li> </ul> <p></p> <p>system R optimization \u5c06\u903b\u8f91\u8ba1\u5212\u6784\u5efa\u4e3a\u5de6\u6df1\u6811</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#top-down-optimization","title":"Top-Down Optimization","text":"<p>\u81ea\u9876\u5411\u4e0b\u7684\u4f18\u5316\u63a7\u5236\u6743\u66f4\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u4e00\u4e2a\u8ba1\u5212\u5f00\u59cb\u9010\u6b65\u7ec6\u5316\u8fc7\u7a0b</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#nested-sub-queries","title":"Nested Sub-queries","text":"<p>\u76f8\u5173\u5b50\u67e5\u8be2\u5f88\u5bb9\u6613\u88ab\u6241\u5e73\u5316\u4e3a join \u7684\u67e5\u8be2 \u4e0d\u76f8\u5173\u7684\u5b50\u67e5\u53ef\u4ee5\u62c6\u5206\u6210\u4e0d\u540c\u7684\u8bed\u53e5\u8fdb\u884c\u6267\u884c</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#rewrite","title":"Rewrite","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#decomposing-queries","title":"Decomposing Queries","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#expression-rerwriteing","title":"Expression rerwriteing","text":"","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#cost-estimation","title":"Cost Estimation","text":"<ul> <li>Physical Costs</li> </ul> <p>predict CPU-cycles, I/O, cache misses, RAM consumption, network messages... Depends heavily on hardware</p> <ul> <li>Logical Costs <p>estimate output size per operator independent of the operator algorithm need estimations for operator result sizes</p> </li> </ul> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#selection-cardinality","title":"selection cardinality","text":"<p>\u53ef\u4ee5\u4f7f\u7528 selection cardinality \u6765\u63a8\u6d4b\u8f93\u51fa\u7684\u5927\u5c0f</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/12-Query_Plan%26Optimization/#statistics","title":"Statistics","text":"","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/","title":"13 Concurrency Control Theory","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#concurrency-control-theory","title":"Concurrency Control Theory","text":"<p> \u7ea6 229 \u4e2a\u5b57  15 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#transaction-in-sql","title":"Transaction in sql","text":"","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#acid","title":"ACID","text":"","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#mechanisms-for-ensuring-atomicity","title":"Mechanisms for ensuring atomicity","text":"","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#logging","title":"Logging","text":"<p>LSM tree \u662f\u9488\u5bf9\u5355\u4e2a\u8868\u6587\u4ef6\u914d\u7f6e\u7684\uff1b\u800c logging \u662f\u9488\u5bf9\u5168\u5c40\u8de8\u6587\u4ef6\u8bbe\u7f6e\u7684</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#shadow-paging","title":"Shadow Paging","text":"<p>\u5373\u4f7f\u6539\u53d8\u51e0\u5b57\u8282\uff0c\u4e5f\u4f1a\u590d\u5236\u6574\u4e2a\u9875</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#consistency","title":"Consistency","text":"<p>\u5f88\u591a\u7cfb\u7edf\u91c7\u7528\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u4f46\u5728\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u51fa\u73b0\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#mechanisms-for-ensuring-isolation","title":"Mechanisms for ensuring isolation","text":"","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#formal-properties-of-schedules","title":"Formal Properties of schedules","text":"","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#unreaptable-read","title":"Unreaptable Read","text":"<p>\u8bfb\u5199\u51b2\u7a81\u7684\u60c5\u51b5\u4e0b\uff0c\u540c\u4e00\u4e8b\u52a1\u5728\u4e24\u6b21\u8bfb\u53d6\u540c\u4e00\u4e2a\u503c\u65f6\u8bfb\u5230\u4e24\u4e2a\u4e0d\u540c\u7684\u503c</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#dirty-read","title":"Dirty Read","text":"<p>\u5199\u8bfb\u51b2\u7a81\u4e0b\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u8bfb\u53d6\u4e86\u5176\u4ed6\u4e8b\u52a1\u5e76\u672a\u63d0\u4ea4\u7684\u503c\u5e76\u63d0\u4ea4</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#lost-update","title":"Lost Update","text":"<p>\u5199\u5199\u51b2\u7a81\u5bfc\u81f4\u4e8b\u52a1\u66f4\u65b0\u503c\u6d88\u5931</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#dependency-graph-confict-serializable","title":"Dependency Graph &amp; Confict Serializable","text":"<p>\u5927\u591a\u6570 DBMS \u5b9e\u73b0\u51b2\u7a81\u53ef\u4e32\u884c\u5316 \u5982\u679c\u56fe\u4e2d\u51fa\u73b0\u73af\u8def\uff0c\u8bf4\u660e\u8fd9\u4e2a\u8c03\u5ea6\u662f bad schedule</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/13-Concurrency_Control_Theory/#transaction-durability","title":"Transaction Durability","text":"","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/","title":"14 Two Phase Lock","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#two-phase-lock-concurrency-control","title":"Two Phase Lock Concurrency Control","text":"<p> \u7ea6 662 \u4e2a\u5b57  18 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#executing-with-locks","title":"Executing with locks","text":"<p>\u4e8b\u52a1\u9700\u8981\u9501(upgrade) \u9501\u7ba1\u7406\u5668\u4e3a\u8bf7\u6c42\u7533\u8bf7\u9501 \u4e8b\u52a1\u91ca\u653e\u9501 \u9501\u7ba1\u7406\u5668\u66f4\u65b0\u5185\u90e8\u7684 lock table lock table \u8ddf\u8e2a\u6bcf\u4e2a\u4e8b\u52a1\u6301\u6709\u4ec0\u4e48\u9501\uff0c\u5e76\u6b63\u5728\u7b49\u5f85\u4ec0\u4e48\u9501</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#locks-vs-latches","title":"Locks vs. Latches","text":"<p>locks \u4fdd\u62a4\u6570\u636e\u5e93\u78c1\u76d8\u4e0a\u7684\u5bf9\u8c61\uff1block manager \u662f\u5185\u5b58\u6570\u636e\u7ed3\u6784\uff0c\u8be5\u7ed3\u6784\u4f7f\u7528 latch \u8fdb\u884c\u4fdd\u62a4</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#basic-lock-types","title":"Basic Lock Types","text":"<ul> <li>S-LOCK: shared locks for reads</li> <li>X-LOCK: Exclusive lock for writes</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#two-phase-locking2pl","title":"Two-Phase locking(2PL)","text":"<p>\u662f\u4e00\u79cd\u5e76\u53d1\u63a7\u5236\u534f\u8bae \u8be5\u534f\u8bae\u4e0d\u9700\u8981\u77e5\u9053\u4e8b\u52a1\u5c06\u8981\u6267\u884c\u7684\u6240\u6709\u67e5\u8be2 \u4e24\u9636\u6bb5\u9501\u534f\u8bae\u53ef\u80fd\u4f1a\u53d1\u751f\u6b7b\u9501\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u9002\u5f53\u7684\u7b56\u7565\uff08\u5982\u6b7b\u9501\u68c0\u6d4b\u548c\u9884\u9632\uff09\u6765\u5904\u7406\u548c\u907f\u514d\u3002</p> <ol> <li>Growing</li> </ol> <p>\u6bcf\u4e2a\u4e8b\u52a1\u5411 DBMS \u7684\u9501\u7ba1\u7406\u5668\u8bf7\u6c42\u5b83\u6240\u9700\u8981\u7684\u9501 \u9501\u7ba1\u7406\u5668\u540c\u610f\u6216\u62d2\u7edd\u9501\u8bf7\u6c42</p> <ol> <li>Shrinking <p>\u4e8b\u52a1\u5728\u8be5\u9636\u6bb5\u4ec5\u4ec5\u91ca\u653e\u6216\u8005\u5bf9\u9501\u964d\u7ea7 \u4e0d\u53ef\u4ee5\u518d\u6b21\u7533\u8bf7\u9501</p> </li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#executing-with-2pl","title":"Executing with 2PL","text":"<p>\u9501\u673a\u5236\u5b9e\u9645\u4e0a\u662f\u5728\u6253\u7834 dependency graph \u7684\u5faa\u73af\u4f9d\u8d56 \u4f46\u662f\u5b83\u4f1a\u51fa\u73b0\u7ea7\u8054\u7ec8\u6b62\u95ee\u9898</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#cascading-aborts","title":"Cascading aborts","text":"<p>\u5f53 T1 \u4e8b\u52a1\u91ca\u653e\u9501\u540e abort\uff0cT2 \u4e8b\u52a1\u5df2\u7ecf\u83b7\u53d6\u4e86 T1 \u4e2d\u7684 A \u9501\uff0c\u9020\u6210\u810f\u8bfb</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#strong-strict-two-phase-locking","title":"Strong strict two-phase locking","text":"<p>\u4ec5\u4ec5\u5f53\u4e8b\u52a1 commit \u6216\u8005 abort \u624d\u80fd\u91ca\u653e\u9501</p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#2pl-deadlocks","title":"2PL Deadlocks","text":"<p>\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a\u6b7b\u9501\u68c0\u6d4b\u6216\u8005\u6b7b\u9501\u907f\u514d</p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#deadlock-detection","title":"Deadlock detection","text":"<p>node \u662f\u4e8b\u52a1 \\(T_{i}\\)\u5230\\(T_{j}\\)\u7684\u8fb9\u8868\u793a\\(T_{i}\\)\u7b49\u5f85\\(T_{j}\\)\u91ca\u653e\u9501 \u8fd9\u4e2a\u7cfb\u7edf\u68c0\u67e5 waits-for graph \u7684 cycle \u5e76\u51b3\u5b9a\u5982\u4f55\u6253\u7834\u5b83</p> <p></p> <p>\u5f53 DBMS \u53d1\u73b0\u4e00\u4e2a\u6b7b\u9501\uff0c\u5b83\u4f1a\u9009\u62e9\u4e00\u4e2a victim \u4e8b\u52a1\u53ca\u9006\u884c\u56de\u6eda\u6765\u6253\u7834\u601d\u7d22 victim \u4e8b\u52a1\u901a\u5e38\u4f1a\u91cd\u542f\u6216\u8005 abort \u5728\u68c0\u6d4b\u6b7b\u9501\u9891\u7387\u4ee5\u53ca\u4e8b\u52a1\u5728\u6b7b\u9501\u524d\u7b49\u5f85\u65f6\u95f4\u662f\u4e00\u4e2a trade-off \u95ee\u9898</p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#rollback-length","title":"Rollback length","text":"","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#deadlock-prevention","title":"Deadlock prevention","text":"<p>Wait-Die: \u5982\u679c\u7b49\u5f85\u9501\u7684\u4e8b\u52a1\u66f4\u65e9\u5f00\u59cb\uff0c\u53ef\u4ee5\u7b49\u5f85\u6301\u6709\u9501\u7684\u4e8b\u52a1\u91ca\u653e\u9501\uff1b\u5426\u5219\u7b49\u5f85\u9501\u7684\u4e8b\u52a1\u76f4\u63a5 abort Wound-Die: \u5982\u679c\u7b49\u5f85\u9501\u7684\u4e8b\u52a1\u66f4\u65e9\u5f00\u59cb\uff0c\u53ef\u4ee5\u62a2\u593a\u6301\u6709\u9501\u7684\u4e8b\u52a1\u7684\u9501\u4f7f\u5176 abort\uff1b\u5426\u5219\u7b49\u5f85\u9501\u7684\u4e8b\u52a1 wait </p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#lock-granularities","title":"Lock Granularities(\u9501\u7c92\u5ea6)","text":"","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#intention-locks","title":"intention locks(\u610f\u5411\u9501)","text":"<p>\u5982\u679c\u53ea\u662f\u4e00\u4e2a\u53ea\u8bfb\u4e8b\u52a1\uff0c\u53ea\u4f1a\u5728\u8868\u4e0a\u83b7\u53d6 S \u9501\uff0c\u800c\u4e0d\u662f\u610f\u5411\u9501</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#example","title":"example","text":"<p>\u4f7f\u7528\u610f\u5411\u9501\uff0c\u5fc5\u987b\u5728 tuple \u4e2d\u83b7\u53d6\u6700\u7ec8\u7684 S \u6216 X \u9501\uff1b\u5b83\u7684\u7236\u8282\u70b9\u5fc5\u987b\u662f IS\u3001IX \u6216\u8005 SIX \u9501</p> <p></p> <p></p> <p>\u5347\u7ea7\u9501\u7684\u8bf7\u6c42\u53ef\u80fd\u62e5\u6709\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7</p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#lock-escalation","title":"Lock Escalation(\u9501\u5347\u7ea7)","text":"<p>\u5728\u4f4e\u5c42\u7ea7\u7684\u8bb8\u591a\u9501\u90fd\u662f X \u9501\uff1b\u5b83\u7684\u7236\u8282\u70b9\u7684\u5c42\u7ea7\u9501\u4e5f\u4f1a\u53d8\u4e3a X \u9501</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/14-Two_Phase_Lock/#postgresql-lock-table","title":"PostgreSQL lock table","text":"","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/","title":"15 Timestamp Ordering Concurrency Control","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#timestamp-ordering-concurrency-control","title":"Timestamp Ordering Concurrency Control","text":"<p> \u7ea6 844 \u4e2a\u5b57  28 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>2PL \u548c\u65f6\u95f4\u6233\u6392\u5e8f\u7b97\u6cd5\u662f\u60b2\u89c2\u5e76\u53d1\u63a7\u5236\u7b97\u6cd5 \u8fd8\u6709\u4e50\u89c2\u5e76\u53d1\u63a7\u5236\u7b97\u6cd5</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#to-concurrency-control","title":"T/O Concurrency Control","text":"<p>\u4f7f\u7528\u65f6\u95f4\u6233\u6765\u786e\u4fdd\u4e8b\u52a1\u6267\u884c\u7684\u987a\u5e8f \u5982\u679c TS(\\(T_I\\)) &lt; TS(\\(T_j\\))\uff0cDBMS \u9700\u8981\u786e\u4fdd\u6267\u884c\u7684\u8c03\u5ea6\u5fc5\u987b\u548c\\(T_i\\)\u53d1\u751f\u5728\\(T_j\\)\u524d\u7684\u4e32\u884c\u5316\u8c03\u5ea6\u76f8\u540c</p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#timestamp-allocation","title":"Timestamp allocation","text":"<ol> <li>System/Wall Clock</li> <li>Logical Counter</li> <li>Hybrid</li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#basic-to","title":"Basic T/O","text":"<p>\u4e8b\u52a1\u8bfb\u53d6\u548c\u5199\u5165\u5bf9\u8c61\u4e0d\u9700\u8981\u9501</p> <p>W-TS(X)\uff1a\u662f\u6700\u540e\u6210\u529f\u5199\u5165\u7684\u4e8b\u52a1\u7684\u65f6\u95f4\u6233</p> <p>R-TS(X)\uff1a\u662f\u6700\u540e\u6210\u529f\u8bfb\u53d6\u7684\u4e8b\u52a1\u7684\u65f6\u95f4\u6233</p> <p>\u5982\u679c\u4e8b\u52a1\u5c1d\u8bd5\u83b7\u53d6\u65f6\u95f4\u6233\u5728\u81ea\u5df1\u4e4b\u540e\u7684\u5bf9\u8c61\uff0c\u4f1a abort \u7136\u540e restart</p> <p>\u4e3a\u6bcf\u4e2a\u4e8b\u52a1\u4fdd\u5b58\u6570\u636e\u526f\u672c\u5f00\u9500\u5f88\u5927\uff1b\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4e8b\u52a1\u5f88\u53ef\u80fd\u4f1a\u88ab\u997f\u6b7b\uff0c\u65b0\u4e8b\u52a1\u53ef\u80fd\u4f1a\u4f7f\u5f97\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4e8b\u52a1 abort \u5e76 restart</p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#reads","title":"Reads","text":"<p>\u4f1a\u4e3a X \u521b\u5efa\u4e00\u4e2a\u672c\u5730\u526f\u672c\u6765\u786e\u4fdd\\(T_i\\)\u53ef\u91cd\u590d\u8bfb</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#writes","title":"Writes","text":"","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#optimistic-concurrency-control","title":"Optimistic Concurrency Control","text":"<p>\u4e8b\u52a1\u5bf9\u6570\u636e\u7684\u4fee\u6539\u53ea\u53d1\u751f\u5728\u4e8b\u52a1\u672c\u5730\u7684 workspace</p> <p></p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#occ-validation","title":"occ validation","text":"","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#occ-write-phase","title":"occ write phase","text":"<p>\u4e32\u884c\u63d0\u4ea4\uff0c\u6bcf\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a\u4e8b\u52a1\u5904\u4e8e validation/write \u9636\u6bb5</p> <p></p> <p>OCC \u5728\u51b2\u7a81\u6bd4\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\u5de5\u4f5c\u6bd4\u8f83\u597d\uff1a  \u6240\u6709\u7684\u4e8b\u52a1\u90fd\u662f\u53ea\u8bfb\u7684(ideal)  \u4e8b\u52a1\u8bbf\u95ee\u7684\u6570\u636e\u6ca1\u6709\u4ea4\u96c6</p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#occ-performance-issues","title":"OCC-performance issues","text":"<ol> <li>\u672c\u5730\u590d\u5236\u6570\u636e\u7684\u9ad8\u6210\u672c</li> <li>Validation/Write \u9636\u6bb5\u7684\u74f6\u9888</li> <li>abort \u6bd4 2PL \u66f4\u52a0\u6d6a\u8d39(\u56e0\u4e3a\u53d1\u751f\u5728\u4e8b\u52a1\u5df2\u7ecf\u6267\u884c\u540e\u624d\u8fdb\u884c abort)</li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#the-phantom-problem","title":"The phantom Problem(\u5e7b\u8bfb\u95ee\u9898)","text":"<p>\\(T_1\\)\u4ec5\u5bf9\u5df2\u7ecf\u5b58\u5728\u7684\u8bb0\u5f55\u8fdb\u884c\u9501\u5b9a\uff0c\u65e0\u6cd5\u770b\u5230\u65b0\u63d2\u5165\u7684\u8bb0\u5f55\uff08\u4f7f\u7528 table-level \u7684\u9501\u65e0\u95ee\u9898\uff1b\u4f7f\u7528 record-level \u9501\u4f1a\u51fa\u73b0\u4e0a\u8ff0\u95ee\u9898\uff09</p> <p>2PL, OCC \u90fd\u662f\u521b\u5efa\u672c\u5730\u526f\u672c\uff0c\u4ecd\u7136\u65e0\u6cd5\u770b\u5230\u4e8b\u52a1\u8fd0\u884c\u540e\u5176\u5b83\u4e8b\u52a1\u65b0\u63d2\u5165\u7684\u8bb0\u5f55</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#solution","title":"solution","text":"<ol> <li>\u5b8c\u6210\u4e8b\u52a1\u4e4b\u524d\uff0c\u91cd\u65b0\u8bfb\u53d6\u67e5\u8be2\u6307\u5b9a\u7684\u6240\u6709\u6570\u636e</li> <li>\u8c13\u8bcd\u9501\uff1a\u5728\u67e5\u8be2\u771f\u6b63\u5f00\u59cb\u8fd0\u884c\u4e4b\u524d\u903b\u8f91\u4e0a\u51b3\u5b9a\u8986\u76d6\u54ea\u4e9b\u8c13\u8bcd</li> <li>\u7d22\u5f15\u9501\uff1a\u7c7b\u4f3c\u8c13\u8bcd\u9501</li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#re-execute-scans","title":"Re-execute scans","text":"","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#preidcate-locking","title":"Preidcate Locking","text":"<p>\u8c13\u8bcd\u9501\u7684\u5de5\u4f5c\u539f\u7406\u53ef\u4ee5\u6982\u8ff0\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u5b9a\u4e49\u8c13\u8bcd\uff1a\u5728\u6267\u884c\u67e5\u8be2\u6216\u66f4\u65b0\u64cd\u4f5c\u65f6\uff0c\u5b9a\u4e49\u4e00\u4e2a\u8c13\u8bcd\u6761\u4ef6\uff08\u5982 age &gt; 18\uff09\uff0c\u63cf\u8ff0\u60f3\u8981\u9501\u5b9a\u7684\u6761\u4ef6\u3002\u8fd9\u4e00\u8c13\u8bcd\u4f1a\u6839\u636e\u67e5\u8be2\u6216\u64cd\u4f5c\u6d89\u53ca\u7684\u6570\u636e\u8303\u56f4\u800c\u53d8\u5316\u3002</li> <li>\u5e94\u7528\u8c13\u8bcd\u9501\uff1a\u6570\u636e\u5e93\u5c06\u8fd9\u4e00\u8c13\u8bcd\u5e94\u7528\u4e8e\u5f53\u524d\u6570\u636e\u8868\u7684\u8303\u56f4\uff0c\u6807\u8bb0\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u9879\uff08\u5982\u5e74\u9f84\u5927\u4e8e 18 \u7684\u6240\u6709\u884c\uff09\u3002\u5728\u6ca1\u6709\u5177\u4f53\u6570\u636e\u4fe1\u606f\u65f6\uff0c\u5b83\u5e76\u4e0d\u662f\u76f4\u63a5\u9501\u4f4f\u67d0\u4e00\u884c\uff0c\u800c\u662f\u9501\u4f4f\u6ee1\u8db3\u6761\u4ef6\u7684\u6570\u636e\u533a\u57df\u3002</li> <li>\u5224\u65ad\u51b2\u7a81\uff1a\u5f53\u5176\u4ed6\u4e8b\u52a1\u5c1d\u8bd5\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u7cfb\u7edf\u4f1a\u68c0\u67e5\u5b83\u4eec\u662f\u5426\u6d89\u53ca\u5230\u5df2\u7ecf\u88ab\u8c13\u8bcd\u9501\u9501\u5b9a\u7684\u533a\u57df\u3002\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u7684\u8c13\u8bcd\u6761\u4ef6\u4e0e\u5f53\u524d\u9501\u4ea7\u751f\u51b2\u7a81\uff0c\u7cfb\u7edf\u4f1a\u963b\u6b62\u8be5\u4e8b\u52a1\u7ee7\u7eed\uff0c\u76f4\u81f3\u9501\u91ca\u653e\u3002</li> <li>\u9501\u91ca\u653e\uff1a\u5b8c\u6210\u5bf9\u88ab\u9501\u5b9a\u533a\u57df\u7684\u64cd\u4f5c\u540e\uff0c\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\uff0c\u7cfb\u7edf\u968f\u5373\u91ca\u653e\u8c13\u8bcd\u9501\u3002</li> </ol> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#index-locking","title":"Index Locking","text":"<p>\u901a\u8fc7\u95f4\u9699\u9501\u6765\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u51fa\u73b0\u95ee\u9898</p> <p></p> <p>\u4e0b\u9762\u8fd9\u4e24\u79cd\u65b9\u5f0f\u53ea\u80fd\u5b9e\u73b0\u4e00\u79cd\uff0c\u5982\u679c\u4e24\u79cd\u90fd\u5b9e\u73b0\u4f1a\u53d1\u751f\u6b7b\u9501</p> <p> </p> <p>\u5c42\u6b21\u9501</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#locking-without-an-index","title":"Locking without an index","text":"<p>\u4f7f\u7528\u7c97\u7c92\u5ea6\u7684\u9501\uff08page lock or table lock\uff09\uff0c\u635f\u5931\u5e76\u884c\u5ea6</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/15-Timestamp_Ordering_Concurrency/#isolation-levels","title":"Isolation levels","text":"<p>\u8bfb\u5df2\u63d0\u4ea4\u5e76\u6ca1\u6709\u4e25\u683c\u9075\u5b88 2PL \u534f\u8bae\uff0c\u800c\u662f\u8bfb\u53d6\u540e\u76f4\u63a5\u91ca\u653e\u5171\u4eab\u9501</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/","title":"16 Multi-Version Concurrency","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#mutli-version-concurrency","title":"Mutli-Version Concurrency","text":"<p> \u7ea6 550 \u4e2a\u5b57  17 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p> <p>DBMS \u6709\u591a\u4e2a\u7269\u7406\u7248\u672c\u548c\u4e00\u4e2a\u903b\u8f91\u7248\u672c</p> <p>\u4e00\u4e2a\u4e8b\u52a1\u5199\u5165\u65f6\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7248\u672c\uff1b\u8bfb\u53d6\u65f6\u4f1a\u8bfb\u53d6\u8be5\u4e8b\u52a1\u5f00\u59cb\u65f6\u6700\u65b0\u7684\u7248\u672c</p> <p>MVCC \u5b9e\u9645\u4e0a\u662f\u7ef4\u62a4\u591a\u4e2a\u7248\u672c\u7684\u673a\u5236\uff1b\u800c\u7248\u672c\u4e4b\u95f4\u7684\u5e76\u53d1\u6b63\u786e\u6027\u4ecd\u7136\u9700\u8981\u5e76\u53d1\u63a7\u5236\u534f\u8bae\u6765\u7ef4\u62a4</p> <p></p> <p>writers do not block readers and readers do not block writers</p> <p>\u53ea\u8bfb\u4e8b\u52a1\u53ef\u4ee5\u4e0d\u83b7\u53d6\u9501\u8bfb\u53d6\u4e00\u4e2a\u4e00\u81f4\u6027\u7684\u5feb\u7167</p>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#mvcc-example","title":"MVCC example","text":"","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#write-skew-anomaly","title":"Write Skew Anomaly","text":"<p>\u5feb\u7167\u9694\u79bb\u5e76\u4e0d\u80fd\u786e\u4fdd\u53ef\u4e32\u884c\u6027\uff1b\u53ef\u80fd\u51fa\u73b0\u8fd9\u79cd\u5199\u504f\u659c\u95ee\u9898</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#version-storage","title":"Version Storage","text":"","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#append-only-storage","title":"Append-Only Storage","text":"<p>\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u591a\u7248\u672c\u7684\u5355\u94fe\u8868</p> <ol> <li>Oldest to Newest(O2N)</li> <li>Newest to Oldest(N2O)</li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#time-travel-storage","title":"Time-Travel Storage","text":"<p>\u4e3a\u672c\u6765\u6ca1\u6709\u505a MVCC \u7684\u7cfb\u7edf\u63d0\u4f9b\u7684\u4e00\u79cd MVCC \u673a\u5236</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#delta-storage","title":"Delta Storage","text":"<p>\u589e\u91cf\u5b58\u50a8\uff1a\u53ea\u5b58\u50a8\u66f4\u6539\u540e\u7684\u5217</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#garbage-collection","title":"Garbage Collection","text":"","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#tuple-level-gc","title":"Tuple-level GC","text":"<p>\u540e\u53f0\u6e05\u7406\uff1a\u53ea\u626b\u63cf\u88ab\u4fee\u6539\u7684\u9875\uff0c\u5bfb\u627e\u5230\u4e0d\u5728\u88ab\u5f15\u7528\u7684\u9875\u7684\u7248\u672c\uff0c\u5c06\u8fd9\u4e9b tuple \u901a\u8fc7\u540e\u53f0\u8fdb\u7a0b\u5904\u7406\u6389</p> <p></p> <p>\u534f\u540c\u6e05\u7406\uff1a\u7d22\u5f15\u53ef\u80fd\u6307\u5411 O2N \u7684\u94fe\uff0c\u4e8b\u52a1\u5728\u627e\u5230\u5f53\u524d\u9700\u8981\u7684\u7248\u672c\u65f6\u4f1a\u540c\u65f6\u6e05\u7406\u4e0d\u518d\u9700\u8981\u7684\u7248\u672c\u53f7</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#transaction-level-gc","title":"Transaction-level GC","text":"<p>\u6bcf\u4e2a\u4e8b\u52a1\u4f1a\u8ddf\u8e2a\u4ed6\u81ea\u5df1\u7684\u8bfb\u5199\u96c6\u5408\u5e76\u4ea4\u7ed9 GC worker</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#index-management","title":"Index Management","text":"","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#secondary-indexes","title":"Secondary Indexes","text":"<ol> <li>Logical Pointers: \u4e0d\u4f1a\u76f4\u63a5\u6307\u5411\u771f\u5b9e\u6570\u636e\uff0c\u800c\u662f\u6307\u5411\u4e00\u4e2a\u95f4\u63a5\u5c42\uff1b\u4e00\u822c\u6307\u5411\u4e3b\u952e\u7d22\u5f15</li> </ol> <ol> <li>Physical Pointers: \u76f4\u63a5\u6307\u5411\u7248\u672c\u94fe\u7684\u5934\u90e8</li> </ol> <p>\u5982\u679c\u6211\u8981\u66f4\u65b0\u7248\u672c\u94fe\uff0c\u6211\u4f1a\u66f4\u65b0\u591a\u4e2a\u6307\u9488\u7684\u6307\u5411\uff1b\u5f00\u9500\u8fc7\u5927</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#mvcc-indexes","title":"MVCC Indexes","text":"<ol> <li>\u6bcf\u4e2a\u7d22\u5f15\u5fc5\u987b\u652f\u6301\u91cd\u590d\u7684\u952e\u6765\u6307\u5411\u4e0d\u540c\u7684\u5feb\u7167 <p>\u76f8\u540c\u7684 key \u5728\u4e0d\u540c\u7684\u5feb\u7167\u4e2d\u6307\u5411\u4e0d\u540c\u7684\u903b\u8f91 tuples</p> </li> </ol> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/16-Mult-Version_Concurrency/#mvcc-deletes","title":"MVCC Deletes","text":"<p>\u903b\u8f91\u5220\u9664\uff1a \u5728\u67d0\u4e9b MVCC \u5b9e\u73b0\u4e2d\uff0c\u5220\u9664\u64cd\u4f5c\u53ef\u80fd\u53ea\u662f\u5c06\u6570\u636e\u6807\u8bb0\u4e3a\u201c\u5df2\u5220\u9664\u201d\uff0c\u800c\u4e0d\u662f\u7269\u7406\u79fb\u9664\u3002\u8fd9\u610f\u5473\u7740\u6570\u636e\u4ecd\u7136\u5b58\u5728\u4e8e\u6570\u636e\u5e93\u4e2d\uff0c\u4f46\u5728\u67e5\u8be2\u65f6\u4e0d\u4f1a\u88ab\u8fd4\u56de\u3002 \u8fd9\u6837\u53ef\u4ee5\u4fdd\u6301\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u53ef\u8ffd\u6eaf\u6027\u3002 \u771f\u6b63\u7684\u7269\u7406\u5220\u9664\u7531\u540e\u53f0\u7ebf\u7a0b\u81ea\u52a8\u6e05\u7406\u8fc7\u671f\u7684\u7248\u672c</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/","title":"17 Database Logging","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#database-logging","title":"Database Logging","text":"<p> \u7ea6 586 \u4e2a\u5b57  12 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#crash-recovery","title":"Crash Recovery","text":"<ol> <li>Actions during normal txn processing to ensure that the DBMS can recover from a failure</li> <li>Actions after a failure to recovver the database to a state that ensures atomicity, consistency, and durability</li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#failure-classification","title":"Failure Classification","text":"","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#transaction-failures","title":"Transaction Failures","text":"<ol> <li>Logical Errors: \u4e8b\u52a1\u56e0\u4e3a\u4e00\u4e9b\u5185\u90e8\u539f\u56e0\u6ca1\u6709\u5b8c\u6210\uff08\u5b8c\u6574\u6027\u7ea6\u675f\u5931\u6548\uff09</li> <li>Internal State Errors: DBMS \u5fc5\u987b\u7ec8\u6b62\u4e00\u4e2a\u6d3b\u8dc3\u7684\u4e8b\u52a1\u56e0\u4e3a\u4e00\u4e2a\u9519\u8bef\u7684\u6761\u4ef6\uff08\u6b7b\u9501\uff09</li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#system-failures","title":"System Failures","text":"<ol> <li>Software Failure: OS \u6216\u8005 DBMS \u5b9e\u73b0\u7684\u9519\u8bef</li> <li>Hardware Failure: <p>the computer hosting the DBMS crahsed(\u7535\u6e90\u7ebf\u88ab\u62c9\u4e86) Fail-stop Assumption: \u975e\u6613\u5931\u6027\u5b58\u50a8\u7684\u5185\u5bb9\u88ab\u5047\u8bbe\u4e0d\u4f1a\u88ab system crash \u7834\u574f</p> </li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#storage-media-failures","title":"Storage Media Failures","text":"<p>Non-Repairable\uff08\u65e0\u6cd5\u4fee\u590d\u7684\uff09 Hardware Failure</p> <ol> <li>head crash \u6216\u8005\u76f8\u4f3c\u7684\u78c1\u76d8 failure \u7834\u574f\u4e86\u6240\u6709\u6216\u8005\u90e8\u5206\u7684 non-volatile storage</li> <li>\u91cd\u5efa\u88ab\u5047\u8bbe\u53ef\u4ee5\u88ab detectable(\u78c1\u76d8\u63a7\u5236\u5668\u4f7f\u7528\u6821\u9a8c\u548c\u6765\u68c0\u6d4b\u9519\u8bef)</li> </ol> <p>\u6570\u636e\u5e93\u4e0d\u80fd\u4ece\u8fd9\u79cd\u9519\u8bef\u4e2d\u6062\u590d\u6570\u636e</p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#undo-vs-redo","title":"UNDO VS. REDO","text":"","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#steal-policy","title":"Steal Policy","text":"<p>\u4f3c\u4e4e\u5426\u5141\u8bb8 DBMS \u5141\u8bb8\u4e00\u4e2a\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u8986\u76d6\u6700\u8fd1\u63d0\u4ea4\u7684\u6570\u636e</p> <p>Steal: is allowed No-steal: is not allowed</p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#force-policy","title":"Force Policy","text":"<p>\u662f\u5426\u4e00\u4e2a DBMS \u8981\u6c42\u4e8b\u52a1\u7684\u6240\u6709\u66f4\u65b0\u90fd\u5728\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u524d\u53cd\u5e94\u5230 non-valaile \u5b58\u50a8\u4e2d</p> <p>Force: is required NO-force: is not required</p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#combination","title":"Combination","text":"","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#no-steal-force","title":"NO-STEAL + FORCE","text":"<p>\u4e0d\u5fc5 undo\uff0c\u56e0\u4e3a\u6539\u53d8\u8fd8\u672a\u5199\u5165\u78c1\u76d8\uff1b \u4e0d\u5fc5 redo\uff0c\u56e0\u4e3a\u6240\u6709\u7684\u6539\u53d8\u5728\u63d0\u4ea4\u65f6\u5df2\u7ecf\u786e\u4fdd\u5199\u5165\u78c1\u76d8</p> <p></p> <p>Shadow Paging \u5b9e\u9645\u4e0a\u5728\u526f\u672c\u4e0a\u8fdb\u884c\u4fee\u6539\uff0c\u4e8b\u52a1 commit \u540e\uff0c\u5c06 master \u6e05\u7a7a\u5e76\u5c06 shadow \u4f5c\u4e3a\u65b0\u7684 master</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#steal-no-force","title":"STEAL + NO-FORCE","text":"<p>\u7ef4\u62a4\u4e00\u4e2a log \u5305\u542b\u4e86\u4e8b\u52a1\u5bf9\u6570\u636e\u5e93\u7684\u6539\u53d8</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#wal-protocol","title":"WAL PROTOCOL","text":"<p>\u5728\u6570\u636e\u5199\u5165\u78c1\u76d8\u524d\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u7684\u65e5\u5fd7\u5fc5\u987b\u5148\u843d\u76d8</p> <p></p> <p>\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u9700\u8981\u7b49\u5f85 log \u843d\u76d8\uff0c\u8fd9\u53ef\u80fd\u4f1a\u6210\u4e3a\u74f6\u9888\uff1b\u6240\u4ee5 DBMS \u4f7f\u7528 group commit optimization \u6765 batch multiple log flushed\uff1b\u8fd9\u4f1a\u63d0\u9ad8\u541e\u5410\u91cf</p> <ol> <li>\u5982\u679c buffer \u6ee1\u4e86\uff0c\u5199\u78c1\u76d8</li> <li>\u5982\u679c\u8d85\u65f6\u4e86\uff0c\u5199\u78c1\u76d8\uff085ms\uff09</li> </ol> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#logging-schemes","title":"Logging Schemes","text":"<p>\u903b\u8f91\u65e5\u5fd7\u9700\u8981\u91cd\u65b0\u6267\u884c\u8bed\u53e5\uff0c\u6210\u672c\u8fc7\u4e8e\u9ad8\u6602\uff1bPhysiological \u5728\u9875\u7ea7\u522b\u662f\u7269\u7406\u7684\uff0c\u4f46\u662f\u9875\u5185\u90e8\u53ea\u8bb0\u5f55\u4fee\u6539\u7684\u6570\u636e</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#checkpoints","title":"Checkpoints","text":"<p>\u591a\u9891\u7e41\u5730\u8fdb\u884c\u68c0\u67e5\u70b9\u7684\u8bbe\u7f6e\u662f\u4e00\u4e2a tradeoff</p>","tags":["Database"]},{"location":"notes/CMU15445/17-Database_Logging/#blockingconsistent-checkpoint-protocol","title":"Blocking/Consistent Checkpoint Protocol","text":"<ol> <li>\u6682\u505c\u6240\u6709\u67e5\u8be2</li> <li>\u5c06\u6240\u6709\u7684 WAL \u8bb0\u5f55\u843d\u76d8</li> <li>\u5c06\u6240\u6709\u5728 Buffer Pool \u4e2d\u7684\u66f4\u6539\u7684\u9875\u843d\u76d8</li> <li>\u5728 WAL \u4e2d\u5199\u5165\u5e76\u843d\u76d8</li> <li>\u6062\u590d\u67e5\u8be2</li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/","title":"18 Database Recovery","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#database-recovery","title":"Database Recovery","text":"<p> \u7ea6 429 \u4e2a\u5b57  27 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#aries","title":"ARIES","text":"","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#log-sequence-numbers","title":"Log Sequence Numbers","text":"<p>MasterRecord \u88ab\u786c\u7f16\u7801\u5230 DBMS\uff0c\u6240\u4ee5\u6211\u4eec\u6062\u590d\u65f6\u8fd9\u4e2a\u9875\u9762\u4f1a\u5148\u88ab\u62c9\u5230\u5185\u5b58\u4e2d</p> <p></p> <p>\u4ec5\u4ec5\u5f53 pageLSN &lt;= flushLSN\uff0c\u624d\u80fd\u5c06 log \u5237\u5165\u78c1\u76d8 \u6240\u6709\u7684\u8bb0\u5f55\u90fd\u6709\u4e00\u4e2a LSN \u6bcf\u6b21\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e00\u4e2a\u9875\u4e0a\u7684 record\uff0cpageLSN \u4f1a\u6539\u53d8 \u6bcf\u6b21 DBMS \u5c06 WAL buffer \u4e2d\u7684\u4e1c\u897f\u5199\u5165\u78c1\u76d8\uff0cflushedLSN \u4f1a\u66f4\u65b0</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#normal-execution","title":"Normal Execution","text":"","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#transaction-commit","title":"Transaction Commit","text":"<p>\u6211\u4eec\u53ea\u9700\u8981\u4fdd\u8bc1\u5728\u5237\u65b0 flushLSN \u4e4b\u524d\u5148\u5c06\u65e5\u5fd7\u8bb0\u5f55\u5237\u65b0\u5230\u78c1\u76d8\u5373\u53ef TXN-END \u5199\u5165\u540e\u8bf4\u660e commit \u5df2\u7ecf\u6210\u529f\uff0c\u6240\u4ee5 wal \u53ef\u4ee5\u6e05\u9664\u6ca1\u6709\u7528\u7684 Log</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#transaction-abort","title":"Transaction Abort","text":"<p>prevLSN \u7ef4\u62a4\u4e00\u4e2a\u94fe\u8868\u5141\u8bb8\u6211\u4eec\u8ffd\u8e2a abort \u4e8b\u52a1\u7684\u8bb0\u5f55\u94fe\u8868</p> <p></p> <p>\u6211\u4eec\u5728 abort \u548c end \u4e4b\u95f4\u53ef\u80fd\u5b58\u5728\u5176\u4ed6\u65e5\u5fd7\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u8fd9\u4e9b\u65e5\u5fd7\uff1b\u6211\u4eec\u4e0d\u4f1a\u5728 abort \u65f6\u7acb\u5373\u5c06\u8fd9\u4e9b\u8bb0\u5f55\u5237\u5199\u5230\u78c1\u76d8</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#compensation-log-records","title":"Compensation Log records","text":"<p>\u662f\u5bf9 update \u7684\u64a4\u9500\u64cd\u4f5c undoNextLSN \u662f\u4e00\u4e2a\u6548\u7387\u4f18\u5316\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u6838\u5fc3\u4f18\u5316</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#abort-algorithm","title":"Abort Algorithm","text":"","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#checkpoints","title":"Checkpoints","text":"","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#non-fuzzy-checkpoints","title":"Non-Fuzzy Checkpoints","text":"<ol> <li>\u4efb\u4f55\u65b0\u4e8b\u52a1\u5f00\u59cb\u90fd\u4f1a\u88ab\u505c\u6b62</li> <li>\u6240\u6709\u6d3b\u8dc3\u7684\u4e8b\u52a1\u7b49\u5f85\u76f4\u5230 checkpoint \u6267\u884c\u5b8c\u6210</li> <li>\u5c06\u6240\u6709\u7684\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8</li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#slightly-better-checkpoints","title":"Slightly better Checkpoints","text":"<p>\u6682\u505c\u4e8b\u52a1\uff0c\u7136\u540e\u5c06\u90e8\u5206\u63d0\u4ea4\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\uff1b \u7f29\u77ed\u4e86\u7b49\u5f85\u65f6\u95f4\uff0c\u4f46\u662f\u78c1\u76d8\u4e0a\u5b58\u50a8\u7684\u5e76\u975e\u662f\u7a33\u5b9a\u5feb\u7167</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#active-transaction-tableatt","title":"Active Transaction Table(ATT)","text":"","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#dirty-page-tabledpt","title":"Dirty Page Table(DPT)","text":"<p>ATT \u548c DPT \u5fc5\u987b\u5237\u8fdb\u78c1\u76d8\u540e\u518d\u6062\u590d\u4e8b\u52a1\u6267\u884c</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#fuzzy-checkpoints","title":"Fuzzy Checkpoints","text":"<p>\u590d\u5236\u4e86 ATT \u548c DPT \u7684\u526f\u672c\u5728\u5185\u5b58\u4e2d</p> <p></p> <p>\u4efb\u4f55\u5728\u4e4b\u540e\u5f00\u59cb\u7684\u4e8b\u52a1\u4f1a\u88ab\u7684 ATT \u6392\u9664</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#aries-recovery-algorithm","title":"ARIES - Recovery Algorithm","text":"","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#overview","title":"Overview","text":"","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#analysis-phase","title":"Analysis Phase","text":"<p>analysis \u7684\u8fc7\u7a0b\u4ec5\u4ec5\u662f\u786e\u5b9a ATT \u548c DPT</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#redo-phase","title":"Redo Phase","text":"","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#undo-phase","title":"Undo Phase","text":"","tags":["Database"]},{"location":"notes/CMU15445/18-Database_Recovery/#additional-crash-issues","title":"Additional Crash Issues","text":"","tags":["Database"]},{"location":"notes/CMU15445/19-Introducd_to_distributed_database/","title":"19 Introduction to distributed database","text":"<code>#Database</code> <code>#Distributed System</code>","tags":["Database","Distributed System"]},{"location":"notes/CMU15445/19-Introducd_to_distributed_database/#introduction-to-distributed-database","title":"Introduction to distributed database","text":"<p> \u7ea6 36 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p>","tags":["Database","Distributed System"]},{"location":"notes/CMU15445/3-Database%20Storage/","title":"3_Database_Storage I","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#3-database-storage-i","title":"3-Database Storage I","text":"<p> \u7ea6 1250 \u4e2a\u5b57  13 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#1-disk-based-architecture","title":"1 DISK-BASED ARCHITECTURE","text":"<ul> <li>\u6613\u5931\u6027\u5b58\u50a8\u548c\u975e\u6613\u5931\u6027\u5b58\u50a8\u76f8\u7ed3\u5408</li> <li>Volatile\uff1aRandom Access Byte-Addressable \uff08DRAM \u4e4b\u4e0a\uff09</li> <li>Non-Volatile\uff1aSequential Access Block-Addressable\uff08SSD \u4e4b\u4e0b \uff09</li> <li>SSD \u4ee5\u4e0b\u53ea\u80fd\u6309\u5757\u6765\u5b58\u53d6</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#_1","title":"\u987a\u5e8f\u8bbf\u95ee\u548c\u968f\u673a\u8bbf\u95ee","text":"<ul> <li>\u975e\u6613\u5931\u6027\u5b58\u50a8\u4e2d\u987a\u5e8f\u8bbf\u95ee\u6bd4\u968f\u673a\u8bbf\u95ee\u5feb\u5f97\u591a</li> <li>\u4e00\u822c\u6570\u636e\u5b58\u50a8\u5728\u8fde\u7eed\u7684\u5757\u4e2d\uff0c\u540c\u65f6\u5206\u914d\u591a\u4e2a\u7269\u7406\u9875\u53eb\u533a</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#2-dbms","title":"2 DBMS \u8bbe\u8ba1\u76ee\u6807","text":"<ul> <li>\u5141\u8bb8\u7ba1\u7406\u6bd4\u53ef\u7528\u5185\u5b58\u5927\u7684\u6570\u636e\u5e93</li> <li>\u8bfb\u5199\u78c1\u76d8\u4ee3\u4ef7\u9ad8\u6602\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u5927\u7684\u505c\u987f\u548c\u6027\u80fd\u4e0b\u964d</li> <li>DBMS \u5e0c\u671b\u6700\u5927\u5316\u987a\u5e8f\u8bfb\u5199</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#3-os","title":"3 \u4e3a\u4ec0\u4e48\u4e0d\u4f7f\u7528 OS","text":"<ul> <li> <p>The DBMS can use memory mapping (mmap) to store the contents of a file into the address space of a program.</p> </li> <li> <p>The OS is responsible for moving the pages of the file in and out of memory, so the DBMS doesn\u2019t need to worry about it.</p> </li> </ul> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#os","title":"\u4f7f\u7528 OS \u53ef\u80fd\u51fa\u73b0\u95ee\u9898","text":"<ul> <li>\u5982\u679c\u6b64\u65f6\u7269\u7406\u5185\u5b58\u5df2\u7ecf\u5360\u6ee1\uff0c\u9700\u8981\u6dd8\u6c70\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u9020\u6210\u963b\u585e</li> <li>\u591a\u7ebf\u7a0b\u5e76\u53d1\u8bfb\u5199\u53ef\u80fd\u51fa\u73b0\u95ee\u9898</li> <li>\u9519\u8bef\u5904\u7406</li> <li>\u6027\u80fd\u95ee\u9898\uff1aOS \u7684\u7ed3\u6784\u6210\u4e3a\u6027\u80fd\u74f6\u9888</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#os_1","title":"OS \u89e3\u51b3\u65b9\u6848","text":"<ul> <li>\u6309\u6b63\u786e\u7684\u987a\u5e8f\u5c06\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u4e2d</li> <li>\u7279\u6b8a\u7684\u9884\u7f13\u5b58\u60c5\u51b5\uff0c\u8fd9\u6837\u6267\u884c\u5668\u5c31\u4e0d\u7528\u7b49\u5f85\u7279\u5b9a\u7684\u9875\u52a0\u8f7d\u5230\u7f13\u51b2\u6c60\u4e2d</li> <li>\u7f13\u51b2\u66ff\u6362\u7b56\u7565</li> <li>\u7ebf\u7a0b\u3001\u8fdb\u7a0b\u8c03\u5ea6</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#4-file-storage","title":"4 File Storage","text":"<ul> <li> <p>Table \u53ef\u4ee5\u770b\u4e3a\u662f tuple \u7684\u96c6\u5408\uff0c\u5728\u78c1\u76d8\u4e2d\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5355\u4f4d\u662f\u6587\u4ef6\u3002\u4e00\u4e2a\u6587\u4ef6\u4e2d\u4f1a\u4fdd\u5b58\u591a\u4e2a page\uff0c\u800c page \u4e2d\u4f1a\u5b58\u50a8\u591a\u4e2a tuple\u3002</p> </li> <li> <p>DBMS \u5728\u78c1\u76d8\u4e0a\uff0c\u7528\u4e00\u4e2a\u6216\u591a\u4e2a\u6587\u4ef6\uff0c\u4ee5\u7279\u5b9a\u7684\u683c\u5f0f\u5b58\u50a8\u6570\u636e\u5e93</p> </li> <li> <p>OS \u4e0d\u5173\u5fc3\u4e5f\u4e0d\u77e5\u9053\u8fd9\u4e9b\u6587\u4ef6\u7684\u5185\u5bb9</p> </li> <li> <p>1980 \u5e74\u4ee3\u7684 \u4e00\u4e9b DBMS \u5728\u539f\u59cb\u5b58\u50a8\uff08Raw Storage\uff09\u4e0a\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u6587\u4ef6\u7cfb\u7edf</p> </li> <li>\u73b0\u5728\u7684\u4e00\u4e9b\u5546\u4e1a DBMS \u8fd8\u5728\u8fd9\u4e48\u5e72</li> <li>\u5927\u591a\u6570\u65b0\u51fa\u6765\u7684 DBMS \u4e0d\u8fd9\u4e48\u505a\u4e86</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#41-storage-manager","title":"4.1 storage manager","text":"<ul> <li>\u8c03\u5ea6\u8bfb\u5199\u64cd\u4f5c\u63d0\u9ad8\u7a7a\u95f4\u548c\u65f6\u95f4\u5c40\u90e8\u6027</li> <li>\u5c06\u6587\u4ef6\u7ec4\u7ec7\u6210\u9875\u7684\u96c6\u5408</li> <li>\u8ddf\u8e2a\u5df2\u7ecf\u8bfb\u548c\u5199\u7684\u9875</li> <li>\u8ddf\u8e2a\u7a7a\u95f2\u9875</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#42-database-pages","title":"4.2 Database Pages","text":"<p>\u56e0\u4e3a\u6570\u636e\u5e93\u6587\u4ef6\u53ef\u80fd\u5f88\u5927\uff0c\u9700\u8981\u5207\u5206\u6210\u591a\u4e2a\u5757</p> <ul> <li> <p>\u4e00\u9875\u662f\u5f88\u591a\u4e2a block \u7ec4\u6210\u7684\u96c6\u5408</p> </li> <li> <p>\u9875\u91cc\u53ef\u80fd\u5b58\u7740\u5143\u7ec4\u3001\u5143\u6570\u636e\u3001\u7d22\u5f15\u3001\u65e5\u5fd7\u8bb0\u5f55...</p> </li> <li>\u5927\u591a\u6570\u7cfb\u7edf\u5bf9\u4e8e\u9875\u7684\u4f7f\u7528\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u6bd4\u5982\u5b58\u50a8\u7d22\u5f15\u7684\u9875\u4e0d\u4f1a\u7528\u6765\u5b58\u6570\u636e</li> <li> <p>\u5927\u591a\u6570\u7cfb\u7edf\u9700\u8981\u9875\u662f\u81ea\u7ec4\u7ec7\uff08self-contained\uff09\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u9875\u7684 Header \u91cc\u6807\u8bc6\u4e86\u8fd9\u4e2a\u9875\u7684\u7c7b\u578b</p> </li> <li> <p>\u6bcf\u4e2a\u9875\u90fd\u6709\u4e00\u4e2a\u72ec\u7279\u7684\u6807\u8bc6\u7b26</p> </li> <li> <p>DBMS \u4f7f\u7528\u975e\u76f4\u63a5\u7684\u5c42\u6765\u628a page id \u6620\u5c04\u5230\u7269\u7406\u4f4d\u7f6e\u786c\u76d8\u9875</p> </li> <li>\u6700\u5c0f\u80fd\u4fdd\u8bc1\u539f\u5b50\u64cd\u4f5c\u7684\u5355\u4f4d</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#_2","title":"\u4e0d\u540c\u7684\u9875\u6982\u5ff5","text":"<ul> <li> <p>\u786c\u4ef6\u9875\uff08\u5982\u574f\u5757\uff09\uff1a4KB</p> </li> <li> <p>\u64cd\u4f5c\u7cfb\u7edf\u9875\uff08\u4e00\u822c\u4e3a 4kb\uff09\u64cd\u4f5c\u7cfb\u7edf\u8bfb\u5199\u786c\u76d8\u7684\u6700\u5c0f\u5355\u4f4d</p> </li> <li> <p>\u6570\u636e\u5e93\u9875\uff08512b ~ 16kb\uff09</p> </li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#43-page-storage-architecture","title":"4.3 Page Storage Architecture","text":"<ul> <li>heap file organization</li> <li>tree file organization</li> <li>sequential/sorted file organization (ISAM)</li> <li>hashing file organization</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#heap-file","title":"heap file","text":"<ul> <li>\u65e0\u5e8f\u5b58\u653e\u9875\uff0c\u5bb9\u6613\u5bfb\u627e\u5355\u4e2a\u6587\u4ef6</li> <li>\u53ef\u4ee5 create, get, write, delete \u9875</li> <li>\u5fc5\u987b\u652f\u6301\u8fed\u4ee3\u6240\u6709\u7684\u9875</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#_3","title":"\u5b9e\u73b0\u65b9\u5f0f","text":"<ul> <li> <p>page directory (\u8bbe\u7f6e\u4e00\u9875\u4e3a directory)</p> </li> <li> <p>pagedirectory \u548c data page \u8981\u540c\u6b65\u66f4\u65b0</p> </li> <li>The directory also records meta-data about available space:     \u2192 The number of free slots per page.     \u2192 List of free / empty pages</li> </ul> <p></p> <ul> <li> <p>linked list</p> </li> <li> <p>\u4e00\u4e2a header page\uff0c\u7ef4\u62a4\u4e24\u4e2a\u94fe\u8868\u5934\u8282\u70b9\uff1bfree page list, data page list</p> </li> </ul> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#44-page-layout","title":"4.4 page layout","text":"","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#page-header","title":"page header","text":"<ul> <li>page \u5185\u5bb9\u7684\u5143\u4fe1\u606f</li> <li>page size</li> <li>checknum\uff08\u9875\u7684\u6821\u9a8c\u548c\uff09</li> <li>DBMS version</li> <li>Transaction Visibility\uff08\u5e76\u53d1\u662f\u5426\u9501\u4f4f\u8be5\u9875\uff09</li> <li>Compression Information\uff08\u538b\u7f29\u4fe1\u606f\uff09</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#data-inside-of-the-page","title":"data inside of the page","text":"<ul> <li>tuple-oriented</li> <li>Log-strctured</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#1-tuple-storage-in-page","title":"1 tuple storage in page","text":"<ul> <li>Keep track of the number of tuples in a page and then just append a new tuple to the end.</li> </ul> <ul> <li>\u4e0a\u56fe\u6240\u793a\u7684\u662f\u4e00\u79cd\u6734\u7d20\u7684\u505a\u6cd5\uff0c\u7c7b\u4f3c\u6570\u7ec4\u7684\u65b9\u5f0f\u53bb\u5b58\u50a8\uff0cheader \u7ef4\u62a4\u4e00\u4e2a\u6570\u7ec4\u7684\u4fe1\u606f\u3002</li> <li>\u4e3b\u8981\u95ee\u9898\uff1a\u5220\u9664\u65f6\u4ea7\u751f\u5185\u5b58\u788e\u7247\uff0c\u6587\u4ef6\u7684\u4e0d\u8fde\u7eed\u7b49\u7b49\uff08\u5982\u679c\u662f\u53d8\u957f\u7684 tuple \u5c06\u4f1a\u6709\u66f4\u591a\u95ee\u9898\uff09\uff0ctuple \u7684\u67e5\u627e\u4e5f\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u5f00\u9500</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#2-slotted-pages","title":"2 slotted pages\uff08\u9875\u69fd\uff09","text":"<ul> <li>\u5c06\u7279\u5b9a slot \u6620\u5c04\u5230 page \u67d0\u4e2a\u7279\u5b9a\u504f\u79fb\u91cf\u4e0a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u6837\u4e00\u4e2a\u5143\u7ec4\u5c31\u662f\u7531\u4e00\u4e2a page id \u548c slot id \u6765\u552f\u4e00\u5b9a\u4f4d\uff0c\u5e76\u4e14 tuple \u662f\u5012\u5e8f\u5b58\u50a8\u7684\u3002\u8fd9\u6837\u5f53\u7136\u53ef\u80fd\u4f1a\u5728\u4e2d\u95f4\u6709\u90e8\u5206\u6570\u636e\u7684\u6d6a\u8d39\uff0c\u4f46\u662f\u4e3a\u4e86\u652f\u6301\u53d8\u957f\u7684\u5143\u7d20\u6211\u4eec\u4e0d\u5f97\u4e0d\u8fd9\u4e48\u505a\u3002\u5f53\u7136\uff0c\u6709\u529e\u6cd5\u53bb\u5e94\u5bf9\uff0c\u53ef\u4ee5\u53bb\u6574\u7406\u6216\u8005\u538b\u7f29</li> <li>header keeps track of</li> <li>used slots</li> <li>the offset of the starting location of the last slot used</li> </ul> <ul> <li>\u6bcf\u4e2a tuple \u9700\u8981\u4e00\u4e2a\u72ec\u4e00\u65e0\u4e8c\u7684\u8bb0\u5f55\u53f7\uff1apage_id + offset/slot</li> <li>\u7528\u6237\u4e0d\u80fd\u4f7f\u7528 record ID \u6765\u4f7f\u7528</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#45-tuple-layout","title":"4.5 tuple layout","text":"<ul> <li>tuple \u662f\u78c1\u76d8\u4e0a\u7684\u4e8c\u8fdb\u5236\u6d41\u6570\u636e</li> </ul> <ul> <li>header contaions meta-data about tuple</li> <li>visibility info (concurrency control)</li> <li>Bit Map for NULL values</li> <li>\u5b58\u50a8\u6570\u636e\u65e0\u5206\u9694\u7b26\uff0c\u9700\u8981\u8bb0\u5f55 NULL \u4fe1\u606f</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/3-Database%20Storage/#denormalized-tuple-data","title":"denormalized tuple data","text":"<ul> <li>\u7269\u7406\u5b58\u50a8\u4e0a\u53cd\u89c4\u8303\u5316\uff0c\u5c06\u6709\u5173\u8054\u7684\u5143\u7ec4\u5b58\u50a8\u5728\u540c\u4e00\u9875\u4e0a\uff1b\u76f8\u5f53\u4e8e\u63d0\u524d\u5c06\u8868\u5173\u8054 join</li> <li>\u51cf\u5c11 IO \u6570\u91cf</li> <li>\u66f4\u65b0\u7684\u4ee3\u4ef7\u5de8\u5927</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/","title":"4_Database_Storage II","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#4-database-storage-ii","title":"4 Database Storage II","text":"<p> \u7ea6 1070 \u4e2a\u5b57  17 \u884c\u4ee3\u7801  12 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <ul> <li>\u6570\u636e\u5e93\u8d1f\u8d23\u5c06\u975e\u6613\u5931\u6027\u5b58\u50a8\u4e2d\u7684\u6570\u636e\u548c\u5185\u5b58\u8fdb\u884c\u4ea4\u4e92</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#41-problem-with-slotted-page-design","title":"4.1 problem with slotted page design","text":"<ul> <li>Fragmentation (\u788e\u7247)</li> <li>Useless Disk I/O</li> <li>Random Disk I/O (update 20 tuples on 20 pages)</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#42-log-structed-storage","title":"4.2 Log-structed storage","text":"<p>\u66f4\u591a\u4f7f\u7528 KV \u6570\u636e\u5e93\u4e0a\uff0c\u53ea\u6709\u4e00\u4e2a\u952e\u4e00\u4e2a\u503c</p> <ul> <li> <p>\u4e0d\u5b58\u6570\u636e\uff0c\u5b58\u653e\u6570\u636e\u7684\u64cd\u4f5c\uff08insert, delete, update\uff09</p> </li> <li> <p>\u76f4\u63a5\u5728\u540e\u9762\u52a0\u4e0a\u65b0\u64cd\u4f5c\uff0c\u4e0d\u68c0\u67e5\u524d\u9762\u7684\u6240\u6709\u64cd\u4f5c\u662f\u5426\u6b63\u786e</p> </li> </ul> <p></p> <ul> <li>\u8bfb\u53d6\u4e00\u4e2a\u8bb0\u5f55\uff0c\u4ece\u540e\u5411\u524d\u8fdb\u884c\u626b\u63cf\u8bb0\u5f55\uff1b\u627e\u5230\u9700\u8981\u7684\u6570\u636e</li> </ul> <p></p> <ul> <li>\u8003\u8651\u5bf9\u76f8\u540c id \u7684 log record \u8fdb\u884c\u7d22\u5f15</li> </ul> <p></p> <ul> <li>\u56e0\u4e3a Log \u6570\u636e\u4f1a\u975e\u5e38\u5927\uff0c\u9700\u8981\u5468\u671f\u6027\u5bf9\u9875\u5185\u8fdb\u884c\u538b\u7f29</li> </ul> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#log-structured-compaction","title":"Log-Structured Compaction","text":"<ul> <li> <p>Level Compaction</p> </li> <li> <p>\u5c06\u4e0d\u540c\u7684\u5757\u4e2d\u8bb0\u5f55\u8fde\u63a5\u8d77\u6765\uff0c\u5c06\u538b\u7f29\u540e\u7684\u7ed3\u679c\u5b58\u5165\u4e0b\u4e00\u5c42</p> </li> <li>\u4ece level0 \u5f00\u59cb\u5411\u4e0b\u8bfb\uff0c\u4e00\u76f4\u5230\u6700\u540e\u4e00\u5c42</li> </ul> <p></p> <ul> <li> <p>Universal Compaction</p> </li> <li> <p>\u5c3d\u53ef\u80fd\u5c06\u5468\u8fb9\u7684\u5757\u5408\u5e76\uff1b\u5728\u540c\u4e00\u5c42</p> </li> </ul> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#_1","title":"\u4f18\u52bf","text":"<ul> <li>\u5c06\u968f\u673a\u5199\u53d8\u6210\u987a\u5e8f\u5199\uff0cIO \u6548\u7387\u9ad8\uff0c\u4f46\u662f\u67e5\u627e\u4ee3\u4ef7\u5f88\u9ad8</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#add-log-structured-merge-tree","title":"add: Log-Structured Merge Tree","text":"<ul> <li>\u9996\u5148\u662f\u5185\u5b58\u7684 C0 \u5c42\uff0c\u4fdd\u5b58\u4e86\u6240\u6709\u6700\u8fd1\u5199\u5165\u7684 \uff08k\uff0cv\uff09\uff0c\u8fd9\u4e2a\u5185\u5b58\u7ed3\u6784\u662f\u6709\u5e8f\u7684\uff0c\u5e76\u4e14\u53ef\u4ee5\u968f\u65f6\u539f\u5730\u66f4\u65b0\uff0c\u540c\u65f6\u652f\u6301\u968f\u65f6\u67e5\u8be2\u3002\u5269\u4e0b\u7684 C1 \u5230 Ck \u5c42\u90fd\u5728\u78c1\u76d8\u4e0a\uff0c\u6bcf\u4e00\u5c42\u90fd\u662f\u4e00\u4e2a\u5728 key \u4e0a\u6709\u5e8f\u7684\u7ed3\u6784\u3002</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#_2","title":"\u5199\u5165\u6d41\u7a0b","text":"<ul> <li> <p>\u9996\u5148\u5c06\u5199\u5165\u64cd\u4f5c\u52a0\u5230\u5199\u524d\u65e5\u5fd7\u4e2d\uff0c\u63a5\u4e0b\u6765\u628a\u6570\u636e\u5199\u5230 memtable \u4e2d\uff0c\u5f53 memtable \u6ee1\u4e86\uff0c\u5c31\u5c06\u8fd9\u4e2a memtable \u5207\u6362\u4e3a\u4e0d\u53ef\u66f4\u6539\u7684 immutable memtable\uff0c\u5e76\u65b0\u5f00\u4e00\u4e2a memtable \u63a5\u6536\u65b0\u7684\u5199\u5165\u8bf7\u6c42\u3002\u800c\u8fd9\u4e2a immutable memtable \u5c31\u53ef\u4ee5\u5237\u78c1\u76d8\u4e86\u3002\u8fd9\u91cc\u5237\u78c1\u76d8\u662f\u76f4\u63a5\u5237\u6210 L0 \u5c42\u7684 SSTable \u6587\u4ef6\uff0c\u5e76\u4e0d\u76f4\u63a5\u8ddf L0 \u5c42\u7684\u6587\u4ef6\u5408\u5e76\u3002</p> </li> <li> <p>\u6bcf\u4e00\u5c42\u7684\u6240\u6709\u6587\u4ef6\u603b\u5927\u5c0f\u662f\u6709\u9650\u5236\u7684\uff0c\u6bcf\u4e0b\u4e00\u5c42\u5927\u5341\u500d\u3002\u4e00\u65e6\u67d0\u4e00\u5c42\u7684\u603b\u5927\u5c0f\u8d85\u8fc7\u9608\u503c\u4e86\uff0c\u5c31\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u548c\u4e0b\u4e00\u5c42\u7684\u6587\u4ef6\u5408\u5e76\u3002\u5c31\u50cf\u73a9 2048 \u4e00\u6837\uff0c\u6bcf\u6b21\u80fd\u89e6\u53d1\u5408\u5e76\u90fd\u4f1a\u89e6\u53d1\uff0c\u8fd9\u5728 2048 \u91cc\u662f\u6700\u723d\u7684\uff0c\u4f46\u662f\u5728\u7cfb\u7edf\u91cc\u662f\u633a\u9ebb\u70e6\u7684\u4e8b\uff0c\u56e0\u4e3a\u9700\u8981\u5012\u817e\u7684\u6570\u636e\u591a\uff0c\u4f46\u662f\u4e5f\u4e0d\u662f\u574f\u4e8b\uff0c\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u52a0\u901f\u67e5\u8be2\u3002</p> </li> <li> <p>\u8fd9\u91cc\u6ce8\u610f\uff0c\u6240\u6709\u4e0b\u4e00\u5c42\u88ab\u5f71\u54cd\u5230\u7684\u6587\u4ef6\u90fd\u4f1a\u53c2\u4e0e Compaction\u3002\u5408\u5e76\u4e4b\u540e\uff0c\u4fdd\u8bc1 L1 \u5230 L6 \u5c42\u7684\u6bcf\u4e00\u5c42\u7684\u6570\u636e\u90fd\u662f\u5728 key \u4e0a\u5168\u5c40\u6709\u5e8f\u7684\u3002\u800c L0 \u5c42\u662f\u53ef\u4ee5\u6709\u91cd\u53e0\u7684\u3002</p> </li> </ul> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#_3","title":"\u67e5\u8be2\u6d41\u7a0b","text":"<ul> <li> <p>\u5148\u67e5 memtable\uff0c\u518d\u67e5 immutable memtable\uff0c\u7136\u540e\u67e5 L0 \u5c42\u7684\u6240\u6709\u6587\u4ef6\uff0c\u6700\u540e\u4e00\u5c42\u4e00\u5c42\u5f80\u4e0b\u67e5\u3002</p> </li> <li> <p>\u4e3a\u4e86\u52a0\u901f\u67e5\u8be2\uff0c\u56e0\u4e3a\u6bcf\u4e2a key \u5728\u6bcf\u5c42\u81f3\u591a\u51fa\u73b0\u4e00\u6b21\uff1b\u6240\u4ee5\u67e5\u8be2\u53ef\u4ee5\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u8fdb\u884c\u4f18\u5316</p> </li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#43-data-representation","title":"4.3 Data Representation","text":"<ul> <li>\u6d6e\u70b9\u6570\u7684\u7cbe\u786e\u503c\u6709\u95ee\u9898</li> <li>\u6570\u636e\u5e93\u4e2d\u5b58\u50a8\u6570\u636e\uff0c\u5c06\u6570\u636e\u7684\u503c\u53d8\u6210\u5b57\u7b26\u4e32\u6765\u5b58\uff0c\u4fdd\u8bc1\u7cbe\u5ea6</li> </ul> C<pre><code>// POSTGRES\ntypedef unsigned char NumericDigit;\ntypedef struct {\n    int ndigits;            // \u6570\u636e\u4f4d\u6570\n    int weight;             // \u6743\u91cd\n    int scale;              // \u6307\u6570\n    int sign;\n    NumericDigit *digits;\n}numeric;\n\n// MYSQL\ntypedef int32 decimal_digit_t;\nstruct decimal_t {\n  int intg, frac, len;  // \u5c0f\u6570\u70b9\u524d\u4f4d\u6570\uff0c\u5c0f\u6570\u70b9\u540e\u7684\u4f4d\u6570\uff0c\u603b\u4f4d\u6570\n  bool sign;\n  decimal_digit_t *buf;\n};\n</code></pre>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#large-values","title":"Large Values","text":"<ul> <li>\u5b58\u50a8\u7684\u503c\u8fc7\u5927\uff0c\u4f7f\u7528 overflow page\uff0c\u539f\u6765\u5b58\u653e\u503c\u7684\u4f4d\u7f6e\u5b58\u653e\u6307\u5411\u8be5\u9875\u7684\u6307\u9488</li> <li>\u6ea2\u51fa\u9875\u53ef\u4ee5\u7ee7\u7eed\u6307\u5411\u6ea2\u51fa\u9875\uff0c\u6210\u4e3a\u94fe\u8868</li> </ul> <ul> <li>\u5b58\u50a8\u5916\u90e8\u6587\u4ef6\u7684\u6307\u9488\uff1b\u4f46\u662f\u65e0\u6cd5\u4fdd\u8bc1\u5916\u90e8\u6587\u4ef6\u662f\u5426\u88ab\u4fee\u6539</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#system-catalogs","title":"System Catalogs","text":"<p>DBMS \u628a\u6570\u636e\u5e93\u5143\u6570\u636e\u5b58\u653e\u5728 internal catalog \u4e2d\uff1b\u6570\u636e\u5e93\u5c06\u5176\u5b58\u4e3a\u8868\uff0c\u81ea\u5df1\u7ba1\u7406\u81ea\u5df1\u7684\u5143\u6570\u636e</p> <ul> <li>tables, colums, indexs, views</li> <li>users, permissions</li> <li>internal statistics</li> </ul> <p>\u6bd4\u5982<code>information_schema</code>\u5b58\u653e\u6570\u636e\u5e93\u5143\u6570\u636e\uff1b\u5c06\u5143\u6570\u636e\u5b58\u653e\u6210\u8868</p>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#database-workloads","title":"Database workloads","text":"<ul> <li> <p>On-Line Transaction Processing (OLTP)</p> </li> <li> <p>\u5feb\u901f\u8bfb\u5199\u5c0f\u6570\u636e</p> </li> <li> <p>On-Line Analytical Processing (OLAP)</p> </li> <li>\u590d\u6742\u67e5\u8be2\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u6790</li> <li>Hybrid (\u6df7\u5408) Transaction + Analytical Processing</li> <li>OLTP + OLAP</li> <li>OLTP \u6536\u96c6\u6570\u636e\uff0c\u63d0\u53d6\u540e\u8fdb\u884c\u6570\u636e\u53d8\u6362\u548c\u52a0\u8f7d\uff1b\u5b58\u5165 OLAP\uff0cOLAP \u8fdb\u884c\u5206\u6790\u540e\u53ef\u4ee5\u5199\u56de OLTP</li> </ul> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#44-decompositon-storage-model","title":"4.4 Decompositon Storage Model (\u5217\u5b58\u50a8)","text":"<ul> <li> <p>N-ary Storage Model (\u884c\u5b58\u50a8)\uff1b\u5bf9\u5c0f\u6570\u636e\u66f4\u65b0\u548c\u67e5\u8be2\u5341\u5206\u6709\u6548\uff0c\u6548\u7387\u5f88\u9ad8</p> </li> <li> <p>\u590d\u6742\u67e5\u8be2\u5927\u91cf\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5217\u5b58\u50a8\uff1b\u5982\u679c\u4f7f\u7528\u884c\u5b58\u50a8\uff0c\u9700\u8981\u626b\u63cf\u6240\u6709\u6570\u636e\uff0c\u4ec5\u4ec5\u53d6\u51fa\u67d0\u51e0\u4e2a\u5c5e\u6027\uff1b\u6d6a\u8d39\u5927\u91cf\u65f6\u95f4\u8fdb\u884c\u626b\u63cf\uff1b</p> </li> <li>\u5217\u5b58\u50a8\u66f4\u9002\u5408\u5206\u6790\u6570\u636e\u7684\u60c5\u51b5</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/4-Database_Storage_II/#tuple-edentification","title":"tuple edentification","text":"<ul> <li>Fixed-length Offsets\uff1a\u76f8\u540c\u7684\u504f\u79fb\u5373\u5b58\u7684\u662f\u540c\u4e00\u884c\u7684\u5c5e\u6027</li> <li>Embedded Tuple Ids\uff1a\u589e\u52a0\u7d22\u5f15\uff1b\u9020\u6210\u5b58\u50a8\u7684\u5f00\u9500\uff0c\u4f46\u662f\u65b9\u4fbf\u5b58\u50a8</li> </ul> <p>OLTP = \u884c\u5b58\u50a8</p> <p>OLAP = \u5217\u5b58\u50a8</p>","tags":["Database"]},{"location":"notes/CMU15445/5-Buffer%20Pool/","title":"5_Database_Storage","text":""},{"location":"notes/CMU15445/5-Buffer%20Pool/#5-buffer-pool","title":"5 Buffer Pool","text":"<p> \u7ea6 1322 \u4e2a\u5b57  10 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <ul> <li>\u5728\u78c1\u76d8\u4e2d\u5c06\u6587\u4ef6\u5207\u6210\u4e00\u4e2a\u4e2a\u9875</li> <li>\u5728\u5185\u5b58\u4e2d\u5f00\u8f9f\u4e00\u4e2a\u7f13\u5b58\u6c60\uff1b\u52a0\u5feb\u5bf9\u9875\u7684\u8bbf\u95ee</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#51-buffer-pool","title":"5.1 Buffer Pool","text":""},{"location":"notes/CMU15445/5-Buffer%20Pool/#organization","title":"Organization","text":"<ul> <li> <p>\u662f\u4e00\u4e2a\u6709\u7740\u56fa\u5b9a\u9875\u6570\u7684\u6570\u7ec4\uff1b\u6bcf\u4e2a\u6570\u7ec4\u5143\u7d20\u53eb frame (\u5e27)</p> </li> <li> <p>\u901a\u8fc7 page table \u53bb\u7d22\u5f15\u5185\u5b58\u6c60\u4e2d\u7684\u9875</p> </li> <li>page table \u53ef\u4ee5 pin \u67d0\u4e2a\u9875\uff0c\u4e5f\u53ef\u4ee5\u9501\u4f4f\u67d0\u4e2a\u7d22\u5f15</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#mete-data","title":"Mete-Data","text":"<ul> <li> <p>\u9875\u8868\u8ddf\u8e2a\u73b0\u5728\u5728\u5185\u5b58\u4e2d\u7684\u9875</p> </li> <li> <p>Dirty flag</p> </li> <li>Pin/Reference Counter</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#locks-vs-latches","title":"locks vs latches","text":"<ul> <li>locks</li> <li>\u4fdd\u62a4\u4e8b\u52a1\u4e2d\u7684\u5185\u5bb9</li> <li>\u5728\u4e8b\u52a1\u671f\u95f4\u6301\u6709\u9501</li> <li>\u9700\u8981\u56de\u6eda</li> <li>latches</li> <li>\u4fdd\u62a4\u4e34\u754c\u533a\u6570\u636e\u7ed3\u6784</li> <li>\u5728\u64cd\u4f5c\u671f\u95f4\u6301\u6709\u9501</li> <li>\u4e0d\u5fc5\u56de\u6eda\u6539\u53d8</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#page-dictionary-vs-page-table","title":"page dictionary vs. page table","text":"<ul> <li>page dic</li> <li>\u5728\u78c1\u76d8\u4e2d\uff0c\u6807\u8bb0\u6bcf\u4e2a\u9875\u5728\u90a3\u4e2a\u6587\u4ef6\u4e2d</li> <li>page table</li> <li>\u5728\u5185\u5b58\u4e2d\uff0c\u6807\u8bb0\u9875\u5728 Buffer Pool \u7684\u4ec0\u4e48\u4f4d\u7f6e</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#52-allocation-policies","title":"5.2 Allocation Policies","text":"<ul> <li>\u5168\u5c40\uff1a\u540c\u4e00\u5b89\u6392\u7a7a\u95f4</li> <li>\u5c40\u90e8\uff1a\u4e3a\u67d0\u4e2a\u7ebf\u7a0b\u5206\u914d\u5e27\u4e0d\u8003\u8651\u5e76\u53d1\u7684\u5176\u4ed6\u7ebf\u7a0b</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#53-buffer-pool-optimizations","title":"5.3 Buffer Pool Optimizations","text":""},{"location":"notes/CMU15445/5-Buffer%20Pool/#multiple-buffer-pools","title":"Multiple Buffer Pools","text":"<ul> <li> <p>DBMS \u4f7f\u7528\u591a\u4e2a buffer pool\uff0c\u6bcf\u79cd Buffer pool \u53ef\u4ee5\u9488\u5bf9\u4e0d\u540c\u76ee\u7684</p> </li> <li> <p>Two approaches to mapping desired pages to a buffer pool are object IDs and hashing</p> </li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#pre-fetching","title":"Pre-fetching","text":"<ul> <li>\u5728\u6570\u636e\u6267\u884c\u8ba1\u5212\u65f6\u8fdb\u884c\u9884\u53d6</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#_1","title":"\u987a\u5e8f\u9884\u53d6","text":""},{"location":"notes/CMU15445/5-Buffer%20Pool/#scan-sharing","title":"Scan-Sharing","text":"<ul> <li> <p>If a query wants to scan a table and another query is already doing this, then the DBMS will attach the second query's cursor to the existing cursor.</p> </li> <li> <p>\u5982\u679c\u7b2c\u4e8c\u4e2a\u67e5\u8be2\u4e0e\u7b2c\u4e00\u4e2a\u67e5\u8be2\u7684\u8868\u76f8\u540c\uff0c\u5148\u8ddf\u7740\u7b2c\u4e00\u4e2a\u67e5\u8be2\u4e00\u8d77\u67e5\u8be2\uff1b\u6700\u540e\u67e5\u8be2\u8fd8\u672a\u67e5\u8be2\u7684 page</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#buffer-pool-bypass","title":"Buffer Pool Bypass","text":"<ul> <li>\u5728\u4e00\u4e9b\u7279\u6b8a\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u80fd\u5e76\u4e0d\u9700\u8981 Buffer Pool\uff0c\u4f8b\u5982\u987a\u5e8f\u626b\u63cf\u78c1\u76d8 page\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u52a0\u8f7d\u7684\u78c1\u76d8 page \u7684\u5206\u5e03\u662f\u8fde\u7eed\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u52a0\u8f7d\u78c1\u76d8\u6570\u636e\uff0c\u56e0\u4e3a\u662f\u987a\u5e8f IO\uff0c\u6027\u80fd\u4ecd\u7136\u80fd\u591f\u4e0d\u9519\uff0c\u5e76\u4e14\u7701\u53bb\u4e86 Buffer Pool \u6362\u5165\u6362\u51fa\u7684\u5f00\u9500\u3002</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#buffer-pool","title":"Buffer Pool \u6dd8\u6c70\u7b56\u7565","text":"<ul> <li>LRU</li> <li>CLOCK</li> <li>LRU-K</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#lru-k","title":"LRU-K \u7b97\u6cd5","text":"<ul> <li>\u6700\u8fd1 K \u6b21\u8bbf\u95ee\u6700\u5c11\uff1b\u6570\u636e\u5728\u8bbf\u95ee\u5386\u53f2\u5217\u8868\u91cc\u540e\u6ca1\u6709\u8fbe\u5230 K \u6b21\u8bbf\u95ee\uff0c\u5219\u6309\u7167\u4e00\u5b9a\u89c4\u5219\uff08FIFO\uff0cLRU\uff09\u6dd8\u6c70\uff1b\u5386\u53f2\u961f\u5217\u4e2d\u7684\u6570\u636e\u8bbf\u95ee\u6b21\u6570\u8fbe\u5230 K \u6b21\u540e\uff0c\u5c06\u6570\u636e\u7d22\u5f15\u4ece\u5386\u53f2\u961f\u5217\u5220\u9664\uff0c\u5c06\u6570\u636e\u79fb\u5230\u7f13\u5b58\u961f\u5217\u4e2d\uff0c\u5e76\u7f13\u5b58\u6b64\u6570\u636e\uff0c\u7f13\u5b58\u961f\u5217\u91cd\u65b0\u6309\u7167\u65f6\u95f4\u6392\u5e8f\uff1b\u6dd8\u6c70\u7f13\u5b58\u961f\u5217\u672b\u5c3e\u7684\u5143\u7d20</li> <li>LRU-K \u9700\u8981\u591a\u7ef4\u62a4\u4e00\u4e2a\u961f\u5217\uff0c\u7528\u4e8e\u8bb0\u5f55\u6240\u6709\u7f13\u5b58\u6570\u636e\u88ab\u8bbf\u95ee\u7684\u5386\u53f2\u3002\u53ea\u6709\u5f53\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u8fbe\u5230 K \u6b21\u7684\u65f6\u5019\uff0c\u624d\u5c06\u6570\u636e\u653e\u5165\u7f13\u5b58</li> <li>\u4f7f\u7528 List \u8fdb\u884c\u6570\u636e\u5220\u9664\u65f6\uff0c\u4f7f\u7528 erase \u9700\u8981 list \u7684\u8fed\u4ee3\u5668\uff1b\u540c\u65f6\u9700\u8981\u4e00\u4e2a map \u8fdb\u884c\u8fed\u4ee3\u5668\u7684\u5b58\u50a8</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#54-buffer-replacement-policies","title":"5.4 Buffer Replacement Policies","text":"<p>\u76ee\u6807\uff1a\u6b63\u786e\u3001\u51c6\u786e\u3001\u5feb\u901f\u3001\u66f4\u65b0\u5143\u6570\u636e</p>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#least-recently-used","title":"Least-recently Used","text":"<ul> <li>\u4fdd\u5b58\u6bcf\u4e2a\u9875\u6700\u8fd1\u8bbf\u95ee\u7684\u65f6\u95f4\u6233</li> <li>\u67e5\u8be2\u6d2a\u6cdb\u95ee\u9898</li> <li>\u70ed\u70b9\u9875\u591a\u6b21\u88ab\u6362\u5165\u6362\u51fa</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#clock","title":"Clock","text":"<ul> <li>\u6a21\u7cca\u7684 LRU \u4e0d\u9700\u8981\u6bcf\u4e2a\u9875\u6709\u65f6\u95f4\u6233</li> <li>\u6bcf\u4e2a\u9875\u6709\u4e00\u4e2a\u5f15\u7528\u4f4d</li> <li>\u5f53\u4e00\u4e2a\u9875\u88ab\u8bbf\u95ee\u4e86\uff0c\u5f15\u7528\u4f4d\u7f6e\u4e3a 1</li> <li>\u626b\u63cf\u6574\u4e2a\u7f13\u5b58\u6c60\uff1b\u5982\u679c ref bit = 1\uff0c\u7f6e\u4e3a 0\uff1b\u5982\u679c ref bit = 0\uff0c\u76f4\u63a5\u9a71\u9010</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#better-polices-lru-k","title":"Better polices: LRU-K","text":"<ul> <li>LRU \u548c CLOCK \u65b9\u6cd5\u4ec5\u4ec5\u53ea\u8003\u8651\u4e86\u8bbf\u95ee\u65f6\u95f4\u800c\u6ca1\u6709\u8003\u8651\u8bbf\u95ee\u9891\u7387\uff0c\u6613\u53d7\u5230\u987a\u5e8f\u6d2a\u6cdb\u7684\u5f71\u54cd</li> <li>\u6700\u8fd1 K \u6b21\u8bbf\u95ee\u6700\u5c11\uff1b\u6570\u636e\u5728\u8bbf\u95ee\u5386\u53f2\u5217\u8868\u91cc\u540e\u6ca1\u6709\u8fbe\u5230 K \u6b21\u8bbf\u95ee\uff0c\u5219\u6309\u7167\u4e00\u5b9a\u89c4\u5219\uff08FIFO\uff0cLRU\uff09\u6dd8\u6c70\uff1b\u5386\u53f2\u961f\u5217\u4e2d\u7684\u6570\u636e\u8bbf\u95ee\u6b21\u6570\u8fbe\u5230 K \u6b21\u540e\uff0c\u5c06\u6570\u636e\u7d22\u5f15\u4ece\u5386\u53f2\u961f\u5217\u5220\u9664\uff0c\u5c06\u6570\u636e\u79fb\u5230\u7f13\u5b58\u961f\u5217\u4e2d\uff0c\u5e76\u7f13\u5b58\u6b64\u6570\u636e\uff0c\u7f13\u5b58\u961f\u5217\u91cd\u65b0\u6309\u7167\u65f6\u95f4\u6392\u5e8f\uff1b\u6dd8\u6c70\u7f13\u5b58\u961f\u5217\u672b\u5c3e\u7684\u5143\u7d20</li> <li>LRU-K \u9700\u8981\u591a\u7ef4\u62a4\u4e00\u4e2a\u961f\u5217\uff0c\u7528\u4e8e\u8bb0\u5f55\u6240\u6709\u7f13\u5b58\u6570\u636e\u88ab\u8bbf\u95ee\u7684\u5386\u53f2\u3002\u53ea\u6709\u5f53\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u8fbe\u5230 K \u6b21\u7684\u65f6\u5019\uff0c\u624d\u5c06\u6570\u636e\u653e\u5165\u7f13\u5b58</li> <li>\u4f7f\u7528 List \u8fdb\u884c\u6570\u636e\u5220\u9664\u65f6\uff0c\u4f7f\u7528 erase \u9700\u8981 list \u7684\u8fed\u4ee3\u5668\uff1b\u540c\u65f6\u9700\u8981\u4e00\u4e2a map \u8fdb\u884c\u8fed\u4ee3\u5668\u7684\u5b58\u50a8</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#mysql-lru-k","title":"mysql \u7684 LRU-K \u7684\u66ff\u4ee3\u65b9\u5f0f","text":"<ul> <li>\u4ece\u672a\u51fa\u73b0\u8fc7\u7684 Page \u653e\u5165 old list \u7684 HEAD\uff0c\u5df2\u7ecf\u51fa\u73b0\u5728 Old list \u7684 page \u518d\u6b21\u8bbf\u95ee\uff0c\u653e\u5165 young list \u7684 HEAD </li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#better-polices-localization","title":"Better polices: Localization","text":"<ul> <li>\u53ea\u9a71\u9010\u81ea\u5df1\u4f7f\u7528\u7684\u9875\uff0c\u5982\u679c\u522b\u4eba\u4e5f\u4f7f\u7528\u8be5\u9875\uff0c\u4e0d\u4f1a\u9a71\u9010</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#better-polices-priority-hints","title":"Better polices: Priority Hints","text":"<p>\u5728 LRU \u57fa\u7840\u4e0a\u8fdb\u884c\u7684\u4f18\u5316</p> <ul> <li>\u5728\u67e5\u8be2\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4e86\u89e3\u6bcf\u4e2a\u9875\u7684\u5185\u5bb9</li> <li>\u63d0\u4f9b hint \u53bb\u5224\u65ad\u5185\u5b58\u6c60\u4e2d\u9875\u662f\u5426\u91cd\u8981</li> <li>\u73b0\u4ee3\u6570\u636e\u5e93\u4e00\u822c\u542f\u52a8\u65f6\u5c06\u6839\u7ed3\u70b9\u52a0\u5165\u5185\u5b58\u6c60</li> </ul> <p></p>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#55-dirty-pages","title":"5.5 Dirty pages","text":"<ul> <li>Fast Path\uff1a\u5982\u679c page \u975e dirty\uff0c\u76f4\u63a5\u9a71\u9010</li> <li>Slow Path\uff1a\u5982\u679c page \u662f dirty\uff0c\u5fc5\u987b\u5148\u5c06\u810f\u9875\u56de\u5199\u5230\u78c1\u76d8</li> <li>WAL\uff1a\u5148\u5199\u65e5\u5fd7\u5230\u78c1\u76d8\uff0c\u518d\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff08\u4f7f\u7528 dirty flag\uff09</li> </ul>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#background-writing","title":"Background Writing","text":"<p>DBMS \u5b9a\u671f\u5c06\u810f\u9875\u56de\u5199\u5230\u78c1\u76d8</p> <p>\u5982\u679c\u810f\u9875\u5df2\u7ecf\u5b89\u5168\u88ab\u5199\u5165\uff0cDBMS \u4f1a\u9a71\u9010\u8be5\u9875\u6216\u8005 unset dirty flag</p> <p>\u5728\u65e5\u5fd7\u6ca1\u6709\u843d\u76d8\u524d\uff0c\u4e0d\u5e94\u8be5\u5199\u5165\u810f\u9875\u4e2d\u7684\u4efb\u4f55\u6570\u636e</p>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#56-disk-io-scheduling","title":"5.6 DISK I/O SCHEDULING","text":"<p>OS/hardware \u901a\u8fc7\u91cd\u6392\u548c\u5bf9 IO \u8fdb\u884c\u6279\u91cf\u64cd\u4f5c\u6765\u5206\u644a\u5199\u5165\u7684\u6210\u672c</p> <p>\u4f46\u662f OS \u4e0d\u786e\u5b9a\u54ea\u4e2a IO \u662f\u66f4\u91cd\u8981\u7684\uff1b\u6211\u4eec\u9700\u8981\u629b\u5f03 OS \u7684\u6570\u636e\u5199\u5165\u63a7\u5236\u800c\u7531 DBMS \u6765\u63a5\u7ba1</p> <p></p>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#os-page-cache","title":"OS PAGE CACHE","text":"<p>\u6b63\u5e38\u7684 IO \u64cd\u4f5c\u4f1a\u7ecf\u8fc7 OS PAGE CACHE\uff0c\u4f46\u662f DBMS \u5e0c\u671b\u76f4\u63a5\u5bf9 IO \u8fdb\u884c\u63a7\u5236\uff0c\u6240\u4ee5\u91c7\u7528 direct I/O\uff0c\u7ed5\u8fc7 OS page cache</p> <p></p>"},{"location":"notes/CMU15445/5-Buffer%20Pool/#fsync-problems","title":"fsync problems","text":""},{"location":"notes/CMU15445/6-Hash%20Table/","title":"6_Hash_Table","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#6-hash-table","title":"6 Hash Table","text":"<p> \u7ea6 1064 \u4e2a\u5b57  11 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>\u4f7f\u7528\u8303\u56f4</p> <ul> <li>Internal Meta-data</li> <li>Core Data Storage</li> <li>Temporary Data Structures (join \u8054\u8868\u67e5\u8be2)</li> <li>Table Indexes</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#61-design-decisions","title":"6.1 Design Decisions","text":"<ul> <li>Data Organization</li> <li>Concurrency</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#unrealistic-assumptions","title":"unrealistic assumptions","text":"<ul> <li> <p>Hash Function</p> </li> <li> <p>\u8ba1\u7b97\u901f\u5ea6\u548c\u78b0\u649e\u7387\u7684\u53d6\u820d</p> </li> <li> <p>Hashing Scheme</p> </li> <li>\u9759\u6001\u54c8\u5e0c\u8868</li> <li>\u53ef\u6269\u5c55\u54c8\u5e0c\u8868</li> </ul>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#62-hash-functions","title":"6.2 hash functions","text":"","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#63-static-hashing-schemes","title":"6.3 static Hashing Schemes","text":"","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#linear-probe-hashing","title":"Linear probe hashing (\u7ebf\u6027\u63a2\u6d4b\u54c8\u5e0c)","text":"<p>\u5982\u679c\u78b0\u649e\uff0c\u5b58\u653e\u5230\u4e0b\u4e00\u4e2a\u7a7a\u95f2\u7684\u69fd\uff1b\u53ef\u80fd\u51fa\u73b0\u539f\u6765\u5b58\u5728\u51b2\u7a81\u7684\u503c\u88ab\u5220\u9664</p> <p>Tombstone (\u5893\u7891)\uff1a\u6807\u8bb0\u8be5\u4f4d\u7f6e\u6709\u503c\u88ab\u5220\u9664</p> <p>Movement\uff1a\u5c06\u7a7a\u69fd\u4e4b\u540e\u7684\u6570\u636e\u8fdb\u884c\u6574\u7406</p> <p>\u91cd\u590d\u7684\u952e\u95ee\u9898</p> <p>Separate Linked List\uff1a\u628a\u6bcf\u4e2a\u952e\u5bf9\u5e94\u7684\u952e\u503c\u5b58\u5728\u7279\u6b8a\u7ed3\u6784\u4e2d\uff0chash \u8868\u4e2d\u5b58\u653e\u6307\u5411\u8be5\u7ed3\u6784\u7684\u6307\u9488</p> <p>Redundant Keys\uff1a\u5c06\u952e\u503c\u4e00\u8d77\u4f5c\u4e3a\u952e\uff0c\u5b58\u653e\u5728\u54c8\u5e0c\u8868\u4e2d</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#optimization","title":"optimization","text":"<ul> <li>\u6309\u7167\u7c7b\u578b\u548c\u5927\u5c0f\u5bf9\u54c8\u5e0c\u8868\u8fdb\u884c\u7279\u4f8b\u5316\u5b9e\u73b0</li> <li>\u4f7f\u7528 hash table \u5b58\u50a8\u5143\u6570\u636e</li> <li>\u4f7f\u7528 table+slot+version \u6765\u5feb\u901f\u5bf9 hash table \u4e2d\u7684\u6240\u6709\u6761\u76ee\u8fdb\u884c Invalid</li> </ul> <p>\u5982\u679c table \u7684 version \u4e0e slot \u7684 version \u4e0d\u5339\u914d\uff0c\u5c06\u8be5 slot \u4f5c\u4e3a\u7a7a slot \u5904\u7406</p>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#robin-hood-hashing","title":"Robin Hood hashing","text":"<p>\u57fa\u4e8e\u5f00\u653e\u5730\u5740\u54c8\u5e0c\u7684\u6539\u8fdb\u7248,\u57fa\u672c\u601d\u8def\u662f\"\u52ab\u5bcc\u6d4e\u8d2b\", \u8bb0\u5f55\u6bcf\u4e2a\u5143\u7d20\u7684\u504f\u79fb\u91cf. \u6bcf\u6b21\u6bd4\u8f83\u662f\u6bd4\u8f83\u6bcf\u4e2a key \u8ddd\u79bb\u81ea\u5df1\u539f\u672c\u4f4d\u7f6e\u7684\u8ddd\u79bb(\u8d8a\u8fd1\u8d8a\u5bcc\u88d5), \u5982\u679c\u9047\u5230\u4e00\u4e2a\u5df2\u7ecf\u88ab\u5360\u7528\u7684 slot \u4e14\u5b83\u6bd4\u81ea\u5df1\u5bcc\u88d5, \u5c31\u4ee3\u66ff\u5b83\u7684\u4f4d\u7f6e, \u7136\u540e\u628a\u5b83\u987a\u5ef6\u5230\u65b0\u7684\u4f4d\u7f6e</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#cuckoo-hashing","title":"Cuckoo hashing\uff08\u5e03\u8c37\u9e1f\u54c8\u5e0c\uff09","text":"<p>linear hash \u662f\u987a\u5e8f IO \u800c cukoo hash \u662f\u968f\u673a IO</p> <p>\u5efa\u7acb\u591a\u4e2a\u6563\u5217\u8868, \u4f7f\u7528\u4e0d\u540c\u7684\u54c8\u5e0c\u51fd\u6570. \u5728\u63d2\u5165\u65f6\uff0c\u68c0\u67e5\u6bcf\u4e2a\u8868\u5e76\u9009\u62e9\u4efb\u4f55\u6709\u7a7a\u95f2\u63d2\u69fd\u7684\u8868\u3002\u5982\u679c\u6ca1\u6709\u8868\u6709\u7a7a\u95f2\u63d2\u69fd\uff0c\u5219\u4ece\u5176\u4e2d\u4e00\u4e2a\u4e2d\u5220\u9664\u8be5\u5143\u7d20\uff0c\u7136\u540e\u91cd\u65b0\u6563\u5217\u5b83\u4ee5\u627e\u5230\u65b0\u4f4d\u7f6e\u3002</p> <p>\u9632\u6b62\u65e0\u9650\u5faa\u73af: \u5faa\u73af\u8d77\u6765\u65f6\u7528\u65b0\u7684\u6563\u5217\u51fd\u6570\u91cd\u5efa\u6574\u4e2a\u6563\u5217\u8868</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#_1","title":"\u9759\u6001\u54c8\u5e0c\u7ed3\u6784\u7f3a\u9677","text":"<p>\u8981\u6c42\u4f7f\u7528\u8005\u80fd\u591f\u9884\u5224\u6240\u5b58\u6570\u636e\u7684\u603b\u91cf\uff0c\u5426\u5219\u6bcf\u6b21\u6570\u91cf\u8d85\u8fc7\u8303\u56f4\u65f6\u90fd\u9700\u8981\u91cd\u5efa Hash Table\u3002</p> <p>\u52a8\u6001\u54c8\u5e0c\u7ed3\u6784\u5c31\u53ef\u4ee5 resize themselves on demand.</p>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#dynamic-hash-table","title":"Dynamic Hash Table","text":"<p>\u652f\u6301\u52a8\u6001\u6309\u9700\u6269\u5bb9\u7f29\u5bb9</p>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#chained-hashing","title":"Chained Hashing","text":"<p>\u6bcf\u4e2a key \u5bf9\u5e94\u4e00\u4e2a\u94fe\u8868, \u6bcf\u4e2a\u8282\u70b9\u662f\u4e00\u4e2a bucket(\u53ef\u4ee5\u5b58\u50a8\u591a\u4e2a\u5143\u7d20).bucket \u6ee1\u4e86\u5c31\u5728\u540e\u9762\u518d\u6302\u4e00\u4e2a bucket</p> <p>\u8981\u5904\u7406\u5e76\u53d1\u6027: \u5728\u6876\u4e0a\u8bbe\u7f6e\u4e00\u4e2a latch</p> <p></p> <p>Java \u4e2d\u7684\u5b9e\u73b0\u5219\u662f\u505a\u4e86\u7b80\u5316, \u6bcf\u4e2a bucket \u76f8\u5f53\u4e8e\u53ea\u5b58\u653e\u4e00\u4e2a\u5143\u7d20. \u95ee\u9898\u5728\u4e8e\u5143\u7d20\u5f88\u591a\u4e8b\u94fe\u8868\u4f1a\u5f88\u957f, \u6240\u4ee5\u8fdb\u884c\u7684\u4f18\u5316(\u538b\u7f29\u6210\u7ea2\u9ed1\u6811)</p> <p>\u53ef\u4ee5\u5728 bucket pointers \u4e2d\u52a0\u5165 bloom filter \u6765\u52a0\u5feb\u67e5\u627e\u65f6\u7684\u901f\u5ea6</p> <p>\u5982\u679c\u4e0d\u5b58\u5728\uff0cBloom filter \u4f1a\u8fd4\u56de false\uff0c\u4e0d\u5fc5\u7ee7\u7eed\u8fdb\u884c\u987a\u5e8f\u67e5\u627e</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#extendible-hashing","title":"Extendible Hashing","text":"<p>\u57fa\u672c\u601d\u8def\u662f\u4e00\u8fb9\u6269\u5bb9\uff0c\u4e00\u8fb9 rehash.</p> <p>\u54c8\u5e0c\u51fd\u6570\u5f97\u5230\u4e8c\u8fdb\u5236, \u6839\u636e\u5168\u5c40\u6807\u5fd7\u4f4d\u51b3\u5b9a\u770b hash \u503c\u7684\u4e8c\u8fdb\u5236\u524d\u51e0\u4f4d, \u6839\u636e\u8fd9\u4e2a\u4f4d\u6570\u53bb\u51b3\u5b9a\u6254\u5230\u54ea\u4e2a\u6876\u91cc;</p> <p></p> <p>PS: \u8fd9\u91cc\u7684\u6876\u4ee3\u8868\u7b2c\u4e00\u4f4d\u662f 0, \u524d\u4e24\u4f4d\u662f 10, 11...</p> <p>\u4e00\u65e6\u6876\u6ee1\u4e86\u5c31\u8ba9\u5168\u5c40\u6807\u5fd7\u4f4d++, \u7136\u540e\u5404\u4e2a\u6876\u518d rehash(\u6876\u7684\u6570\u91cf\u8981\u53d8\u591a)</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/6-Hash%20Table/#linear-hashing","title":"Linear Hashing","text":"<p>\u7ef4\u62a4\u4e00\u4e2a split \u6307\u9488\uff0c\u6307\u5411\u4e0b\u4e00\u4e2a\u5c06\u88ab\u62c6\u5206\u7684 bucket\uff0c\u521d\u59cb split \u6307\u9488\u6307\u5411 0 \u53f7\u6876</p> <p>\u6bcf\u5f53\u4efb\u610f\u4e00\u4e2a bucket \u6ea2\u51fa\uff08\u6807\u51c6\u81ea\u5b9a\uff0c\u5982\u5229\u7528\u7387\u5230\u8fbe\u9608\u503c\u7b49\uff09\u65f6\uff0c\u5c06\u6307\u9488\u6307\u5411\u7684 bucket \u62c6\u5206\u3002</p> <p>\u62c6\u5206\u540e\u4f7f\u7528\u65b0\u7684 hash function \u5bf9 split \u6307\u5411\u7684\u5143\u7d20\u8fdb\u884c rehash\uff1b\u6bcf\u6b21\u6ea2\u51fa\u589e\u52a0\u4e00\u4e2a bucket pointer</p> <p>\u8fdb\u884c\u67e5\u627e\u65f6\uff0c\u5982\u679c\u67e5\u627e\u7684\u5143\u7d20\u5728 split pointer \u4e0b\u9762\uff0c\u4f7f\u7528\u539f\u59cb\u7684 hash function\uff0c\u5426\u5219\u4f7f\u7528\u65b0\u7684 hash function</p> <p></p> <p>\u73b0\u5728 17 \u5e94\u8be5\u88ab\u63d2\u5165\u7b2c\u4e8c\u4e2a\u6876, \u4f46\u662f\u5df2\u7ecf\u6ee1\u4e86,\u53c8\u4e0d\u60f3\u6302\u65b0\u7684\u6876. \u90a3\u4e48\u5bf9\u6307\u9488\u6307\u5411\u7684\u6876(0 \u53f7)\u8fdb\u884c\u5206\u88c2, \u5bf9\u5206\u5272\u70b9\u6307\u5411\u7684\u6876\u6240\u5305\u542b\u7684 key \u91c7\u7528\u65b0\u7684 hash \u51fd\u6570\u8fdb\u884c\u5206\u5272(\u539f\u6765\u662f a % n, \u6539\u6210 a % 2n). 17 \u4e5f\u653e\u5728\u65b0\u7684\u6876\u91cc</p> <p>\u4e4b\u524d\u6240\u6709\u7684\"\u586b\u6ee1\"\u4e0d\u4e00\u5b9a\u662f\u5b8c\u5168\u6ee1, \u53ef\u4ee5\u662f\u6bd4\u5982\u5230\u4e86 75%\u4e4b\u7c7b\u7684...</p> <p>\u5f53\u65b0\u589e\u52a0\u7684\u6876\u4e2d\u6ca1\u6709\u5143\u7d20\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u538b\u7f29/\u5408\u5e76\u6876\uff0c\u51cf\u5c0f\u5b58\u50a8\u7684\u7a7a\u95f4</p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/","title":"7_B+Tree Indexes","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#7-btree-indexes","title":"7-B+Tree Indexes","text":"<p> \u7ea6 1253 \u4e2a\u5b57  24 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#71-b-tree-family","title":"7.1 B-Tree Family","text":"","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#71-tree-indexes","title":"7.1 Tree Indexes","text":"<p>DBMS \u5728\u6267\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u66f4\u591a\u662f\u67e5\u8be2\u7d22\u5f15\u800c\u4e0d\u662f\u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u7684\u8868 \u7d22\u5f15\u95ee\u9898</p> <p>\u5b58\u50a8\u5f00\u9500</p> <p>\u7ef4\u62a4\u7d22\u5f15\u5f00\u9500</p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#72-b-tree","title":"7.2 B+ Tree","text":"<p>\u662f\u4e00\u4e2a\u81ea\u5e73\u8861\u6811\u3002\u8fd9\u662f\u4e00\u79cd\u63d2\u5165\u3001\u5220\u9664\u5747\u4e3a O(log n)\u7684\u6570\u636e\u7ed3\u6784\u3002\u53ef\u4ee5\u652f\u6301\u7ebf\u6027\u904d\u5386\uff08\u54c8\u5e0c\u8868\u4e0d\u80fd\u505a\u5230\uff09</p> <p>\u76f8\u6bd4 Hash Table\uff0c\u6700\u597d\u7684\u6027\u80fd\u662f O(1)\uff0c\u6700\u5dee\u65f6\u9000\u5316\u5230 O(n)\u3002\u56e0\u4e3a\u5e73\u8861\uff0c\u6240\u4ee5\u4efb\u610f\u4e00\u4e2a\u53f6\u5b50\u7ed3\u70b9\u5230\u6839\u7ed3\u70b9\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5747\u4e3a O(log n)</p> <p>\u5bf9\u4e8e\u8bfb\u5199\u78c1\u76d8\u4e0a\u6574\u9875\u6570\u636e\u5177\u6709\u5176\u4ed6\u6570\u636e\u7ed3\u6784\u4e0d\u5177\u5907\u7684\u4f18\u52bf</p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#721-b-tree-properties","title":"7.2.1 B+ Tree Properties","text":"<p>\\(M\\)\u9636\u641c\u7d22\u6811</p> <ul> <li> \\[ \\frac{M}{2} - 1 \\le keys \\le M - 1\\] </li> <li>\u6bcf\u4e2a\u4e2d\u95f4\u7ed3\u70b9\uff0c\\(k\\)\u4e2a\u5173\u952e\u5b57\u6709\\(k+1\\)\u4e2a\u975e\u7a7a\u5b69\u5b50</li> <li>\u53f6\u5b50\u7ed3\u70b9\u5b58\u653e\u5173\u952e\u5b57\u548c\u6570\u636e</li> </ul> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#node","title":"Node","text":"<p>key \u7ee7\u627f\u81ea\u7d22\u5f15\u4f9d\u8d56\u7684\u5c5e\u6027</p> <p>value</p> <p>inner node \u4e2d value \u662f\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684\u6307\u9488\uff1bleaf node \u4e2d\u662f\u5b58\u653e\u6570\u636e\u7684\u5730\u5740\u6216\u8005\u6570\u636e\u672c\u8eab</p> <p>\u6240\u6709\u7684 NULL \u503c\u8981\u4e48\u5b58\u653e\u5728 first leaf node\uff0c\u8981\u4e48\u662f last leaf node</p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#leaf-node","title":"Leaf Node","text":"<p>\u5e38\u89c1\u7684\u53f6\u5b50\u7ed3\u70b9\u5177\u4f53\u5b9e\u73b0\u5982\u56fe\u6240\u793a\uff1a</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#b-tree-vs-btree","title":"B-Tree VS. B+Tree","text":"<p>\u5c06 key \u6570\u7ec4\u548c values \u5206\u5f00\u4fdd\u5b58\u800c\u4e0d\u662f\u653e\u5728\u4e00\u8d77\u4fdd\u5b58\uff0c\u662f\u56e0\u4e3a\u67e5\u8be2\u65f6\u5e38\u9700\u8981\u626b\u63cf\u5927\u91cf key\uff0ckey \u7684\u957f\u5ea6\u56fa\u5b9a\uff0c\u6709\u52a9\u4e8e CPU cache hit\uff1b</p> <p>\u67e5\u8be2\u65f6\u53ea\u9700\u8981\u626b\u63cf key\uff0c\u5c31\u4e0d\u7528\u5728\u7f13\u5b58\u91cc\u8bfb\u53d6 value \u7684\u4fe1\u606f\u3002\u5f53\u67e5\u8be2\u5230\u5177\u4f53\u7684 key \u65f6\uff0c\u901a\u8fc7 offset \u80fd\u591f\u76f4\u63a5\u627e\u5230 values \u6570\u7ec4\u4e2d\u7684\u503c\u3002</p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#leaf-node-value","title":"leaf node value","text":"<ol> <li>Record IDs <p>\u5b58\u653e tuple \u7684\u6307\u9488</p> </li> <li>Tuple Data <p>\u76f4\u63a5\u5b58\u653e tuple \u7684\u5185\u5bb9</p> </li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#b-insert-delete","title":"B+\u6811 Insert / Delete","text":"","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#insert","title":"Insert","text":"","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#delete","title":"Delete","text":"","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#722-b-tree-selection-conditions","title":"7.2.2 B+ Tree Selection conditions","text":"<p>\u53ea\u6709\u5c11\u6570\u7cfb\u7edf\u652f\u6301\u524d\u7f00\u67e5\u627e\u53ca\u540e\u7f00\u67e5\u627e</p> <p>\\(Find \\ Key=(A,B), Find \\ Key=(A, *)\\)\uff1b\u5f88\u591a\u6570\u636e\u5e93\u4e0d\u652f\u6301\u5339\u914d\\(Find \\ Key=(*, B)\\)\uff1b\u8be5\u67e5\u8be2\u53ef\u80fd\u9700\u8981\u904d\u5386\u6574\u5f20\u8868</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#723-duplicate-keys","title":"7.2.3 Duplicate Keys","text":"<ol> <li> <p>append recordID: \u8054\u5408\u4e3b\u952e\uff08\uff09</p> </li> <li> <p>overflow leaf nodes: \u5916\u63a5\u4e00\u4e2a\u6ea2\u51fa(overflow)\u53f6\u5b50\u7ed3\u70b9\uff1b\u5c06\u91cd\u590d\u7684\u952e\u653e\u7f6e\u5728\u6ea2\u51fa\u53f6\u5b50\u7ed3\u70b9\u4e0a </p> </li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#724-clustered-indexs","title":"7.2.4 clustered indexs","text":"<ul> <li>\u6570\u636e\u6309\u7167\u4e3b\u952e\u7d22\u5f15\u6765\u7ec4\u7ec7</li> <li>\u7d22\u5f15\u4e0e\u6587\u4ef6\u4e00\u4e00\u5bf9\u5e94\uff0c\u5bf9\u4e8e\u7ebf\u6027\u904d\u5386\u6709\u597d\u5904</li> </ul> <p>\u975e\u805a\u7c07\u7d22\u5f15\uff0c\u904d\u5386\u53ef\u4ee5\u4f18\u5316</p> <p>\u626b\u63cf\u53f6\u8282\u70b9\u4e0d\u7acb\u5373\u68c0\u7d22\u5143\u7ec4\uff0c\u800c\u662f\u627e\u5230\u5b83\u4eec\u540e\u518d\u8fdb\u884c\u68c0\u7d22</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#725-node-size","title":"7.2.5 Node size","text":"<p>\u6162\u901f\u8bbe\u5907 B+\u6811\u7ed3\u70b9\u5e94\u8be5\u8bbe\u8ba1\u7684\u8d8a\u5927\uff0c\u4e00\u6b21 IO \u8bfb\u56de\u7684\u6570\u636e\u8d8a\u591a</p> <p>\u9ad8\u901f\u8bbe\u5907 SSD \u6216 Main memory \u5e94\u8be5\u8bbe\u8ba1\u7684\u66f4\u5c0f\uff0c\u4e0d\u9700\u8981\u592a\u591a\u7684\u5197\u4f59\u6570\u636e</p> <p>\u7ed3\u70b9\u7684\u5927\u5c0f\u4e5f\u53d6\u51b3\u4e8e\u8d1f\u8f7d</p> <p>AP \u578b\u6570\u636e\u5e93\uff1aLeaf Node Scans \u5927\u8282\u70b9</p> <p>TP \u578b\u6570\u636e\u5e93\uff1aRoot-to-Leaf Traversals (\u70b9\u67e5\u8be2) \u5c0f\u8282\u70b9</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#726-merge-threshold","title":"7.2.6 Merge Threshold","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u9608\u503c\u6765\u5ef6\u540e\u5206\u5272/\u5408\u5e76\u64cd\u4f5c </p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#726-variable-length-keys","title":"7.2.6 Variable-length Keys","text":"<ol> <li>\u5b58\u653e Key \u7684\u6307\u9488 <p>\u5927\u91cf\u975e\u987a\u5e8f IO \u64cd\u4f5c\uff0c\u67e5\u627e\u6210\u672c\u592a\u9ad8</p> </li> <li>\u4f7f\u7528\u53d8\u957f\u7ed3\u70b9</li> <li>Padding</li> <li>Key Map / Indirection <p>\u5728\u7ed3\u70b9\u5185\u90e8\u4f7f\u7528\u6307\u9488\u6765\u5bf9\u5e94 KV</p> </li> </ol> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#727-intra-node-search","title":"7.2.7 Intra-Node Search","text":"<ol> <li>Linear\uff1a\u4ece\u5f00\u59cb\u5230\u7ed3\u5c3e\u7ebf\u6027\u641c\u7d22\uff1b\u4f7f\u7528 SIMD \u8fdb\u884c\u5411\u91cf\u5316\u6bd4\u8f83 </li> <li>Binary\uff1a\u4e8c\u5206\u67e5\u627e</li> <li>Interpolation\uff1a\u63a8\u65ad\u9700\u8981\u67e5\u627e\u5173\u952e\u5b57\u7684\u4f4d\u7f6e(\u5355\u8c03\u9012\u589e\u4e14\u65e0\u95f4\u9699) </li> </ol>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#728-optimization","title":"7.2.8 Optimization","text":"<p>Prefix compression</p> <p>\u524d\u7f00\u538b\u7f29\u2014\u2014\u5b58\u653e\u5728\u76f8\u540c\u53f6\u5b50\u7ed3\u70b9\u4e2d\u7684\u6570\u636e\u5e94\u8be5\u5177\u6709\u76f8\u540c\u7684\u524d\u7f00</p> <p></p> <p>Deduplication</p> <p>\u5c06\u5197\u4f59\u7684\u952e\u538b\u7f29</p> <p></p> <p>suffix truncation</p> <p>\u540e\u7f00\u622a\u65ad</p> <p></p> <p>\u5f53\u7528\u4e8e\u786e\u8ba4\u65b9\u5411\u7684\u8def\u6807\u5f88\u957f\uff0c\u4f46\u662f\u8fe5\u7136\u4e0d\u540c\u65f6\uff0c\u4e5f\u6ca1\u6709\u5fc5\u8981\u5b58\u5b8c\u6574\u7684 key\uff0cabcdefg...\u5b58\u50a8\u4e3a abc\uff0clmnopq...\u5b58\u50a8\u4e3a lmn \u5373\u53ef\u3002\u8fd9\u79cd\u65b9\u5f0f\u5728\u6811\u4e0d\u4f1a\u7ecf\u5e38\u6539\u53d8\u65f6\u5f88\u6709\u7528\uff0c\u603b\u4f53\u4e0a\u7528\u7684\u6bd4\u524d\u7f00\u538b\u7f29\u8981\u5c11\u3002 </p> <p>bulk insert</p> <p>\u6279\u91cf\u63d2\u5165</p> <p>\u5f53\u63d0\u524d\u77e5\u9053\u9700\u8981\u63d2\u5165\u7684\u6240\u6709 key \u65f6\uff0c\u53ef\u4ee5\u9884\u5148\u5bf9 key \u4eec\u6392\u5e8f\uff0c\u7136\u540e\u81ea\u4e0b\u800c\u4e0a\u5730\u6784\u5efa\u6574\u9897\u6811\u3002\u8fd9\u5f88\u5feb\u3002</p> <p></p> <p>pointer swizzling</p> <p>\u5b58\u653e\u9875\u6307\u9488\u800c\u4e0d\u662f\u9875\u53f7</p> <p></p> <p>\u5f53\u786e\u4fdd\u9700\u8981\u904d\u5386\u7684\u7ed3\u70b9\u6240\u5728\u7684 page \u90fd\u88ab pin \u5728 buffer pool \u4e2d\u65f6\uff0c\u7ed3\u70b9\u95f4\u6307\u9488\u5c31\u4e0d\u7528\u518d(\u4ec5)\u5b58 page id\uff0c\u800c\u662f\u53ef\u4ee5\u76f4\u63a5(\u989d\u5916)\u5b58\u539f\u59cb\u6307\u9488\uff0c\u904d\u5386\u8fd9\u4e9b node \u65f6\u5c31\u80fd\u907f\u514d\u53bb\u8bbf\u95ee buffer pool \u7684\u65f6\u5ef6\u3002</p> <p>\u8fd9\u4e2a\u6280\u672f (Pointer swizzling - Wikipedia) \u7684\u672c\u610f\u662f\u7531\u4e8e\u6301\u4e45\u5316\u4fdd\u5b58(\u94fe\u8868\u7b49\u6570\u636e\u7ed3\u6784\u7684)\u6307\u9488\u903b\u8f91\u5730\u5740\u6ca1\u6709\u610f\u4e49\uff0c\u56e0\u4e3a\u628a\u903b\u8f91\u5730\u5740\u5199\u5230\u78c1\u76d8\u91cc\uff0c\u4f46\u662f\u518d\u8bfb\u51fa\u6765\u7684\u65f6\u5019\u903b\u8f91\u5730\u5740\u5c31\u4ec0\u4e48\u4e5f\u4e0d\u662f\u4e86\uff0c\u6240\u4ee5\u4fdd\u5b58\u4e0b\u4e00\u4e2a node \u7684 id \u800c\u4e0d\u662f\u5730\u5740\u503c\u5145\u5f53\u6307\u9488\u7684\u4f5c\u7528\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u53eb unswizzling\u3002\u5728\u6570\u636e\u5e93\u4e2d\u53cd\u5176\u9053\u800c\u884c\u4e4b\uff0c\u5982\u679c DBMS \u786e\u4fdd\u90fd\u4f1a\u5728\u5185\u5b58\u91cc\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u4e13\u95e8\u5b58\u5730\u5740\u7684\u539f\u59cb\u503c\u800c\u4e0d\u662f page id</p> <p>\u56e0\u4e3a\u6811\u7684\u9ad8\u5c42\u7ed3\u70b9\u4f7f\u7528\u9891\u7387\u975e\u5e38\u9ad8\uff0c\u5b83\u4eec pin \u5728 buffer pool \u91cc\u662f\u5e38\u89c1\u7684\u4e8b\u60c5\uff0c\u8fd9\u4e2a\u6280\u672f\u4f7f\u7528\u573a\u666f\u6bd4\u8f83\u591a\u3002</p>","tags":["Database"]},{"location":"notes/CMU15445/7-B%2BTree/#729-write-optimized-btree","title":"7.2.9 Write-Optimized B+Tree","text":"<p>\u5728\u5230\u8fbe\u53f6\u5b50\u8282\u70b9\u4e4b\u524d\uff0c\u6811\u7684\u7ed3\u6784\u4e0d\u53d1\u751f\u4efb\u4f55\u6539\u53d8</p> <p>\u65e5\u5fd7\u66f4\u6539\u662f\u589e\u91cf\u7ea7\u8054\u6539\u53d8</p> <p> </p>","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/","title":"8_Index Concurrency","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#8-index-concurrency","title":"8-Index Concurrency","text":"<p> \u7ea6 436 \u4e2a\u5b57  4 \u884c\u4ee3\u7801  13 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#80-concurrency-control","title":"8.0 Concurrency control","text":"","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#81-latch","title":"8.1 Latch","text":"","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#810-locks-vs-latches","title":"8.1.0 LOCKS VS. LATCHES","text":"","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#811-latch-modes","title":"8.1.1 Latch Modes","text":"","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#812-latch-implementations","title":"8.1.2 Latch implementations","text":"<p>Test-and-Set Spin Latch (TAS)\uff1b\u6bd4\u5982 std::atomic</p> <p>\u6709\u6548\uff0c\u4e0d\u80fd\u652f\u6301\u5927\u89c4\u6a21\u5e76\u53d1\uff1b\u5bf9\u7f13\u5b58\u4e0d\u53cb\u597d\uff1b\u5bf9 OS \u4e0d\u53cb\u597d</p> <p>CPU \u7a7a\u8f6c\uff0c\u56e0\u4e3a NUMA \u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4f1a\u589e\u52a0\u786c\u4ef6\u901a\u4fe1\u6d41\u91cf\u6210\u672c</p> C++<pre><code>std::atomic_flag latch;\nwhile(latch.test_and_set(...){\n  // Retry? Yield? Abort?\n})\n</code></pre> <p></p> <p>Blocking OS Mutex\uff1a\u963b\u585e\u5f0f\u5b9e\u73b0\uff1b\u4e0d\u80fd\u5927\u89c4\u6a21\u5e76\u53d1\uff1bstd::mutex</p> <p>OS \u652f\u6301\uff0c\u7ade\u4e89\u7ebf\u7a0b\u8fdb\u5165\u5185\u6838\u6001\u7c7b\u4f3c sleep</p> <p>\u6d89\u53ca\u5230 OS \u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u53ef\u80fd\u4f1a\u62d6\u6162\u6574\u4e2a\u7cfb\u7edf\u7684\u901f\u5ea6</p> <p></p> <p>Reader-Writer Latches</p> <p>\u5141\u8bb8\u5e76\u53d1\u8bfb</p> <p>\u4f9d\u636e spin latches \u5b9e\u73b0</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#82-hash-table-latching","title":"8.2 Hash table latching","text":"<ul> <li>\u5bf9\u4e00\u4e2a\u54c8\u5e0c\u7ed3\u6784\u52a0\u9501</li> <li>\u5bf9\u4e00\u4e2a\u54c8\u5e0c\u69fd\u8fdb\u884c\u52a0\u9501</li> </ul> <p>Compare-and-swap (CAS)</p> <p>\u539f\u5b50\u64cd\u4f5c\uff0c\u5bf9\u53d8\u91cf\u5730\u5740\u4e2d\u7684\u503c\u8fdb\u884c\u6539\u53d8</p>","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#83-b-tree-concurrency-control","title":"8.3 B+ Tree Concurrency Control","text":"","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#latch-crabbingcoupling","title":"latch crabbing/coupling","text":"<p>\u91ca\u653e Latch \u65f6\uff0c\u6211\u4eec\u5e0c\u671b\u5c3d\u53ef\u80fd\u5c06\u963b\u585e\u66f4\u591a\u7ebf\u7a0b\u7684 latch \u91ca\u653e\uff0c\u6240\u4ee5\u6211\u4eec\u603b\u662f\u81ea\u9876\u5411\u4e0b\u91ca\u653e latch</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#better-latching-algorithm","title":"Better Latching Algorithm","text":"<p>\u662f\u4e50\u89c2\u673a\u5236\uff1b\u5728 split \u548c merge \u53d1\u751f\u60c5\u51b5\u8f83\u5c11\u4e0b\u6548\u679c\u66f4\u597d\u3002</p> <p>\u5148\u91c7\u7528\u4e00\u8def\u8bfb\u9501\u5230\u53f6\u5b50\u8282\u70b9\u7684\u4e0a\u4e00\u4e2a\u8282\u70b9\uff0c\u5982\u679c\u51fa\u73b0 split \u6216 merge\uff0c\u91cd\u65b0\u4ece\u5934\u5f00\u59cb\u8fdb\u884c\u60b2\u89c2\u9501\u52a0\u9501</p> <p></p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/8-Index%20Concurrency/#multithread","title":"multithread \u5e76\u53d1\u51b2\u7a81","text":"<p>\u6216\u8005\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u540c\u4e00\u79cd\u987a\u5e8f\u52a0\u9501\uff0c\u6c38\u8fdc\u4ece\u5de6\u5411\u53f3\u52a0\u9501</p> <p>T2 \u4e0d\u77e5\u9053 T1 \u53d1\u751f\u4e86\u4ec0\u4e48\uff0c\u786e\u5b9a T1 \u7684\u5b8c\u6210\u65f6\u95f4\u5e76\u7b49\u5f85\u662f\u4e0d\u73b0\u5b9e\u7684\uff1b\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u901a\u4fe1\u4e5f\u662f\u6210\u672c\u5f88\u9ad8\u7684\uff1b\u6700\u4f73\u9009\u62e9\u662f\u7ec8\u6b62\u81ea\u5df1\u7684\u4e8b\u52a1\u5e76\u91cd\u65b0\u5f00\u59cb</p> <p></p> <p>\u8fd9\u79cd\u7ade\u6001\u6761\u4ef6\u51fa\u73b0\u8f83\u4e3a\u7f55\u89c1\uff1b\u800c\u4e14\u9884\u9632\u8be5\u79cd\u7ade\u6001\u6761\u4ef6\u6210\u672c\u9ad8\u6602\uff0c\u4e00\u822c\u65b9\u5f0f\u91c7\u7528\u53cc\u65b9\u4e8b\u52a1\u90fd\u76f4\u63a5\u7ec8\u6b62\u5e76\u91cd\u542f</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/","title":"9-Sort && Aggregation Algorithm","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#9-sort-aggregation-algorithm","title":"9-Sort &amp;&amp; Aggregation Algorithm","text":"<p> \u7ea6 443 \u4e2a\u5b57  16 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#90-query-plan","title":"9.0 Query Plan","text":"<p>\u64cd\u4f5c\u7b26\u53ef\u4ee5\u5904\u7406\u6bd4\u5185\u5b58\u66f4\u591a\u7684\u6570\u636e</p> <p>\u5c3d\u53ef\u80fd\u9ad8\u6548\u5730\u5229\u7528 buffer pool</p> <p>\u8bbf\u95ee\u78c1\u76d8\u7528\u5c3d\u53ef\u80fd\u591a\u7684\u987a\u5e8f IO</p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#91-sort","title":"9.1 Sort","text":"","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#911-why-do-we-need-to-sort","title":"9.1.1 Why do we need to sort","text":"<p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u57fa\u4e8e\u54c8\u5e0c\u7684\u65b9\u5f0f\u6bd4\u57fa\u4e8e\u6392\u5e8f\u7684\u65b9\u5f0f\u66f4\u4f18\uff1b\u4f46\u662f\u5bf9\u4e8e\u9884\u5148\u6392\u5e8f\u7684\u6570\u636e\u57fa\u4e8e\u6392\u5e8f\u7684\u65b9\u5f0f\u53ef\u80fd\u66f4\u4f18</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#912-in-memory-sorting","title":"9.1.2 IN-MEMORY SORTING","text":"","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#913-top-n-heap-sort","title":"9.1.3 TOP-N HEAP SORT","text":"<p>\u5982\u679c\u51fa\u73b0\u76f8\u7b49\u7684\u503c\uff0c\u5c31\u6269\u5c55\u5806\u6570\u7ec4\u7684\u5927\u5c0f</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#914-external-merge-sort","title":"9.1.4 EXTERNAL MERGE SORT","text":"","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#sorted-run","title":"sorted run","text":"<p>\u884c\u5b58\u50a8\u4e00\u822c\u91c7\u53d6\u65e9\u671f\u7269\u5316\uff0c\u5217\u5b58\u50a8\u9009\u62e9\u5ef6\u8fdf\u7269\u5316\uff0c\u5148\u5b58\u50a8 record ID </p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#2-way-external-merge-sort","title":"2-way external merge sort","text":"<p>\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u5220\u9664\u6392\u5e8f\u524d\u7684\u6e90\u6587\u4ef6\u6765\u6e05\u7406\u78c1\u76d8\u7a7a\u95f4</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#general-external-merge-sort","title":"general external merge sort","text":"","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#915-double-buffering","title":"9.1.5 Double Buffering","text":"<p>general external merge \u5728\u540c\u4e00\u65f6\u523b\uff0cCPU \u548c\u78c1\u76d8\u603b\u6709\u4e00\u4e2a\u4f1a\u7a7a\u95f2\uff0c\u6240\u4ee5 Double buffering \u5c06 Buffer pool \u4e2d\u7684\u7a7a\u95f2\u5e27\u5206\u4e3a\u4e24\u90e8\u5206(buffer and shadow buffer)\uff0c\u53ef\u4ee5\u63d0\u9ad8\u5e76\u884c\u5ea6</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#916-comparison-optimizations","title":"9.1.6 Comparison Optimizations","text":"<p>\u6bd4\u8f83\u5b57\u7b26\u4e32\u53ef\u4ee5\u4f7f\u7528\u524d\u7f00\u5b57\u7b26\u4e32\u7f16\u7801\u6bd4\u8f83\uff1b\u4ec5\u5f53\u524d\u7f00\u5b57\u7b26\u4e32\u7f16\u7801\u76f8\u7b49\u624d\u8fdb\u884c\u5b8c\u6574\u5b57\u7b26\u4e32\u7684\u6bd4\u8f83</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#917-using-btree-for-sorting","title":"9.1.7 using B+tree for sorting","text":"<p>\u5982\u679c\u6392\u5e8f\u7684 Key \u4e0a\u6709\u805a\u7c07 B+Tree\uff0c\u4f7f\u7528\u5b83\u6765\u6392\u5e8f\uff1b\u53ea\u9700\u8981\u5bf9 B+\u6811\u53f6\u5b50\u8282\u70b9\u626b\u63cf\u4e00\u904d</p> <p>\u5982\u679c\u662f\u975e\u805a\u7c07\u7d22\u5f15\uff0c\u9700\u8981\u591a\u6b21\u8bbf\u95ee\u540c\u4e00\u9875\u9762\u5e76\u53cd\u590d\u8df3\u8f6c\u9875\u9762\uff0c\u662f\u968f\u673a IO\uff1b\u5e94\u8be5\u4f7f\u7528\u5916\u90e8\u6392\u5e8f</p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#92-aggregations","title":"9.2 Aggregations","text":"","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#921-sorting-aggregation","title":"9.2.1 Sorting Aggregation","text":"<p>\u5728\u6392\u5e8f\u540e\u53bb\u91cd\u53ef\u4ee5\u4f18\u5316\uff1a\u5728\u5916\u90e8\u6392\u5e8f\u7b97\u6cd5\u4e2d\u8fdb\u884c\u53bb\u91cd</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#922-hashing-aggregation","title":"9.2.2 Hashing Aggregation","text":"<p>\u53ef\u4ee5\u8fdb\u884c\u5206\u533a\u540e\u81ea\u4e3b\u8fdb\u884c\u9009\u62e9\u57fa\u4e8e hash \u8fd8\u662f\u57fa\u4e8e sort \u8fdb\u884c\u540e\u7eed\u64cd\u4f5c</p> <p></p>","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#partition","title":"partition","text":"","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#rehash","title":"rehash","text":"","tags":["Database"]},{"location":"notes/CMU15445/9-Sort%26Aggregation/#hashing-summarization","title":"hashing summarization","text":"","tags":["Database"]},{"location":"notes/CS61C/lecture10_Combinational%20Logic/","title":"lecture10_Combinational_Logic","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture10_Combinational%20Logic/#combinational-logic","title":"Combinational Logic","text":"<p> \u7ea6 40 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture10_Combinational%20Logic/#cmos","title":"CMOS","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture10_Combinational%20Logic/#boolean-algebra","title":"Boolean algebra","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture10_Combinational%20Logic/#arithmetic-logic-unit-alu","title":"Arithmetic Logic Unit (ALU)","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/","title":"lecture11_FSMs","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#fsms-synchronous-digital-systems","title":"FSMs, Synchronous Digital Systems","text":"<p> \u7ea6 157 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#fsm-finite-state-machine","title":"FSM: Finite State Machine","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#state-transition-diagram","title":"state transition diagram","text":"<ul> <li>s0 \u521d\u59cb\u72b6\u6001\uff1binput/output\uff1b\u7bad\u5934\u6307\u5411\u662f next state</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#clock-and-registers","title":"clock and registers","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#flip-flop","title":"Flip-Flop","text":"<ul> <li>\u65f6\u949f\u4e0a\u5347\u6cbf\uff1bQ = D\uff0c\u5176\u4f59\u65f6\u523b\u4ec0\u4e48\u4e5f\u4e0d\u505a</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#register-delay","title":"register delay","text":"<ul> <li>clk-to-q delay</li> <li>Registers can\u2019t transfer the D input to Q output instantly</li> <li>clk-to-q delay: Time it takes after the rising edge for the Q output to change</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#register-constraints","title":"register constraints","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#setup-time","title":"setup time","text":"<ul> <li>Setup time: Time before rising edge when the D input must be stable</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#hold-time","title":"hold time","text":"<ul> <li>D input cannot change before this, so the register can read a stable value.</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture11_FSMs/#maximizing-clock-frequency","title":"maximizing clock frequency","text":"<ul> <li> <p><code>Clock period \u2265 clk-to-q delay + longest combinational delay + setup time</code></p> </li> <li> <p><code>Hold time \u2264 clk-to-q delay + shortest combinational delay</code></p> </li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture14_Datapath/","title":"lecture14_DataPath_Hazards","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture14_Datapath/#hazards","title":"Hazards","text":"<p> \u7ea6 264 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture14_Datapath/#structural-hazards","title":"Structural Hazards","text":"<ul> <li>\u4e24\u6761\u6216\u66f4\u591a\u6307\u4ee4\u5728\u6d41\u6c34\u7ebf\u9700\u8981\u8bbf\u95ee\u540c\u4e00\u4e2a\u7269\u7406\u5355\u5143</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture14_Datapath/#solutions","title":"Solutions","text":"<ul> <li>\u6307\u4ee4\u8f6e\u6d41\u4f7f\u7528\u7269\u7406\u8d44\u6e90</li> <li>\u589e\u52a0\u989d\u5916\u7684\u786c\u4ef6\u8d44\u6e90</li> <li>\u8bbe\u8ba1\u6307\u4ee4\u96c6\u907f\u514d\u7ed3\u6784\u5192\u9669</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture14_Datapath/#data-hazards","title":"Data Hazards","text":"<ul> <li>Some regfiles support writing a new value to a register, then reading the new value, in the same cycle.</li> <li>a register being written to is read from later.</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture14_Datapath/#solutions_1","title":"Solutions","text":"<ul> <li> <p>Stalling</p> </li> <li> <p>Wait for the first instruction to write its result before the second instruction reads the     value</p> </li> </ul> <p></p> <ul> <li> <p>Forwarding</p> </li> <li> <p>Add hardware to send the result back to earlier stages before the result is written</p> </li> <li>Requires extra connections in the datapath</li> </ul> <p></p> <ul> <li> <p>Code Scheduling</p> </li> <li> <p>Rearrange instructions to avoid data hazards</p> </li> <li>Compiler can put an unrelated instruction in the nop slot</li> </ul> <p></p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture14_Datapath/#control-hazards","title":"Control Hazards","text":"<ul> <li> <p>If branch is not taken:</p> </li> <li> <p>Instructions fetched sequentially after branch are correct</p> </li> <li> <p>No control hazard</p> </li> <li> <p>If branch is taken, or there\u2019s a jump:</p> </li> <li>The next two instructions still in the pipeline are incorrect</li> <li>Need to convert incorrect instructions in the pipeline to nops</li> <li>Called \u201cflushing\u201d the pipeline</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture14_Datapath/#solutions_2","title":"Solutions","text":"<ul> <li> <p>Branch Prediction to Reduce Penalties\uff08\u5206\u652f\u9884\u6d4b\uff09</p> </li> <li> <p>Early in the pipeline, guess which way branches will go.</p> </li> <li> <p>Flush pipeline if the guess was incorrect.</p> </li> <li> <p>Naive branch prediction: just predict branch \u201cnot taken\u201d, which always fetches PC+4</p> </li> </ul> <p></p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture15_Data-LevelParallelism/","title":"lecture15_Data_Level_Parallelism","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture15_Data-LevelParallelism/#data-level-parallelism","title":"Data-Level Parallelism","text":"<p> \u7ea6 98 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture15_Data-LevelParallelism/#simd","title":"SIMD","text":"<ul> <li>single instruction, multiple data or vector instructions</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture15_Data-LevelParallelism/#simd_1","title":"SIMD \u5b9e\u73b0\u77e9\u9635\u4e58\u6cd5","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture15_Data-LevelParallelism/#common-mistake","title":"common mistake","text":"<ul> <li>\u76f4\u63a5\u4f7f\u7528 32-bit \u7684 SIMD vector\uff08\u5bc4\u5b58\u5668\u4e0e\u5185\u5b58\u4e0d\u540c\uff09</li> <li>\u4f7f\u7528_mm_load or _mm_store \u65f6\u91c7\u7528\u672a\u5bf9\u9f50\u7684\u5185\u5b58</li> <li>\u5fd8\u8bb0\u5904\u7406\u5c3e\u90e8\u7279\u6b8a\u60c5\u51b5</li> <li>\u4f7f\u7528\u592a\u591a\u7684 vector</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture16_Thread-LevelParallelism/","title":"lecture16_Thread_Level_Parallelism","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture16_Thread-LevelParallelism/#thread-level-parallelism","title":"Thread-Level Parallelism","text":"<p> \u7ea6 372 \u4e2a\u5b57  1 \u884c\u4ee3\u7801  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p> <ul> <li>SISD\uff1a\u7ebf\u6027\u6267\u884c\u6307\u4ee4\uff0c\u6ca1\u6709\u5e76\u884c</li> <li>RISC-V \u5355\u5468\u671f CPU</li> <li>SIMD\uff1a\u5355\u6307\u4ee4\u6d41\uff0c\u591a\u6570\u636e\u6d41</li> <li>Intel instrinsics</li> <li>GPUS</li> <li>MISD\uff1a\u591a\u6307\u4ee4\u6d41\uff0c\u5355\u6570\u636e\u6d41</li> <li>Deep learning acceleration chips</li> <li>MIMD\uff1a\u591a\u6307\u4ee4\u6d41\uff0c\u591a\u6570\u636e\u6d41</li> <li>Modern processors</li> </ul> <p></p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture16_Thread-LevelParallelism/#_1","title":"\u591a\u6838\u6267\u884c\u6a21\u578b","text":"<ul> <li>\u72ec\u7acb\u8d44\u6e90</li> <li>Datapath (PC, registers, ALU)</li> <li>Highest level caches (L1, L2 cache)</li> <li>\u5171\u4eab\u8d44\u6e90</li> <li>Memory (DRAM)</li> <li>3<sup>rd</sup> level cache</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture16_Thread-LevelParallelism/#_2","title":"\u7ebf\u7a0b","text":"<ul> <li>\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u53ef\u4ee5\u5206\u88c2\u6216\u8005 fork \u51fa\u65b0\u7ebf\u7a0b\uff1b\u8fd9\u4e9b\u7ebf\u7a0b\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c</li> <li>\u5bf9\u4e8e\u5355\u6838\u6765\u8bf4\uff0cCPU \u5206\u65f6\u8fd0\u884c\u7ebf\u7a0b</li> </ul> <ul> <li>\u6bcf\u4e2a CPU \u6838\u63d0\u4f9b\u4e00\u4e2a\u6216\u591a\u4e2a\u786c\u4ef6\u7684\u7ebf\u7a0b\u6765\u6267\u884c\u6307\u4ee4</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture16_Thread-LevelParallelism/#_3","title":"\u786c\u4ef6\u591a\u7ebf\u7a0b","text":"<ul> <li>\u5728\u5904\u7406\u5668\u786c\u4ef6\u4e2d\u6709\u4e24\u4e2a PC \u6838\u5bf9\u5e94\u7684\u5bc4\u5b58\u5668\u7ec4</li> <li>simultaneous multithreading (SMT) or hyperthreading (HT)</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture16_Thread-LevelParallelism/#biglittle-processors","title":"Big/little Processors","text":"<ul> <li>\u5927\u6838\u6709\u66f4\u9ad8\u7684\u6027\u80fd</li> <li>higher frequency, more superscalar pipelines, larger caches</li> <li>\u73b0\u4ee3\u5904\u7406\u5668\u8bbe\u8ba1</li> <li>i9\uff0c8 performance cores + 16 efficiency cores</li> <li>8 Gen 2, 1 big core, 4 medium cores, 3 little cores</li> <li>M1 Pro, 8 performance cores, 2 efficiency cores</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture16_Thread-LevelParallelism/#thread-level-parallelism-tlp","title":"Thread-Level Parallelism (TLP)","text":"<ul> <li> <p>\u4e0d\u540c\u7684\u6307\u4ee4\u5728\u540c\u4e00\u4e2a\u6838\u4e0a\u8fd0\u884c</p> </li> <li> <p>\u7ebf\u7a0b\u5171\u4eab\u5185\u5b58</p> </li> <li> <p>\u7ebf\u7a0b\u5bb9\u6613\u901a\u4fe1</p> </li> <li> <p>Multithreading Framework</p> </li> <li>Registers</li> <li>PC</li> <li>Stach</li> <li> <p>Threads of same process share:</p> </li> <li> <p>Heap</p> </li> <li> <p>\u6ce8\u610f\u8d1f\u8f7d\u5747\u8861</p> </li> <li> <p>\u5728\u5faa\u73af\u4e2d\u9700\u8981\u786e\u5b9a\u7ebf\u7a0b\u7684\u6267\u884c\u987a\u5e8f\uff1b\u9700\u8981\u4fdd\u8bc1 cache \u7684\u9ad8\u547d\u4e2d\u7387</p> </li> </ul> C<pre><code>for(int i = tid*250000;i&lt;(tid+1)*250000;i++)\n</code></pre>","tags":["System Arch"]},{"location":"notes/CS61C/lecture16_Thread-LevelParallelism/#data-races","title":"Data Races","text":"<ul> <li>\u4e0d\u540c\u7ebf\u7a0b\u7ade\u4e89\u5171\u4eab\u7684\u5185\u5b58\uff0c\u53ef\u80fd\u51fa\u73b0\u9519\u8bef</li> <li>\u9700\u8981\u8bbe\u7f6e\u4e34\u754c\u533a\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u8be5\u90e8\u5206\u4ee3\u7801</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture17_Process_LevelParallelism/","title":"lecture17_Process_Level_Parallelism","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture17_Process_LevelParallelism/#process-level-parallelism","title":"Process-Level Parallelism","text":"<p> \u7ea6 147 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture17_Process_LevelParallelism/#multiprocess-framework","title":"Multiprocess Framework","text":"<ul> <li>\u4e0d\u540c\u7684\u6838\u4e0d\u5206\u4eab\u5185\u5b58\uff0c\u4f46\u662f\u5171\u4eab\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf</li> <li> <p>\u5728\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u4e00\u4e2a\u7ebf\u7a0b crash\uff0c\u6574\u4e2a\u7a0b\u5e8f\u53ef\u80fd crash\uff1b\u4f46\u662f\u591a\u6838\u7a0b\u5e8f\uff0c\u6bcf\u4e2a\u6838\u4e4b\u95f4\u662f\u72ec\u7acb\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u6838 crash\uff0c\u5176\u4ed6\u7684\u6838\u53ef\u4ee5\u7ee7\u7eed\u8fd0\u884c</p> </li> <li> <p>\u4e0d\u540c\u7684\u6838\u4ea4\u6d41\u5360\u7528\u5927\u91cf\u65f6\u95f4</p> </li> <li>\u5c06\u4e00\u4e2a\u5927\u95ee\u9898\u5206\u89e3\u6210\u72ec\u7acb\u7684\u5c0f\u95ee\u9898\uff1b\u4ee5\u6b64\u6765\u51cf\u5c11\u6570\u636e\u7684\u4f20\u8f93\u65f6\u95f4\u635f\u8017</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/","title":"lecture18_Caches","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#caches","title":"Caches","text":"<p> \u7ea6 749 \u4e2a\u5b57  8 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p></p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#memory-hierarchy","title":"Memory Hierarchy (\u5c42\u6b21\u5316\u5185\u5b58)","text":"<ul> <li>\u5bc4\u5b58\u5668\u79bb CPU \u6700\u8fd1\uff0c\u4f7f\u7528\u4e5f\u6700\u5feb\uff1b\u4f46\u662f\u5f88\u8d35\uff1b\u6bcf\u4e2a CPU \u53ea\u6709\u5c11\u91cf\u5bc4\u5b58\u5668</li> <li>DRAM \u66f4\u9002\u5408\u5b58\u50a8\u5927\u91cf\u6570\u636e\uff0c\u4f46\u662f\u901f\u5ea6\u66f4\u6162</li> <li>\u9700\u8981\u6570\u636e\u603b\u7ebf\u8fdb\u884c\u4f20\u8f93</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#_1","title":"\u52a0\u901f\u65b9\u5f0f","text":"<ul> <li> <p>Hardware Multithreaing</p> </li> <li> <p>\u5728\u7b49\u5f85\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u8fdb\u884c\u53bb\u6267\u884c\u4efb\u52a1</p> </li> <li> <p>\u6bcf\u4e2a\u7269\u7406\u6838\u542b\u6709\u4e24\u4e2a PC \u6838\u5bc4\u5b58\u5668\u7ec4\uff0c\u6240\u4ee5\u4e0a\u4e0b\u6587\u5207\u6362\u5f88\u5feb</p> </li> <li> <p>Prefetching</p> </li> <li> <p>\u6bcf\u4e2a\u5468\u671f\u9884\u53d6\u6307\u4ee4\u548c\u6570\u636e</p> </li> <li> <p>Caching</p> </li> <li> <p>\u5229\u7528\u7a7a\u95f4\u5c40\u90e8\u6027\u548c\u65f6\u95f4\u5c40\u90e8\u6027\uff0c\u51cf\u5c11\u548c\u4e3b\u5b58\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93</p> </li> <li> <p>\u7f13\u5b58\u4e2d\u5b58\u653e\u88ab\u4e3b\u5b58\u4f7f\u7528\u7684\u6570\u636e\u526f\u672c</p> </li> <li>\u4e3b\u5b58\u4e2d\u5b58\u653e\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u526f\u672c</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#_2","title":"\u5c42\u6b21\u5316\u7ba1\u7406","text":"<ul> <li>Registers &lt;---&gt; Memory</li> <li>\u901a\u8fc7\u7f16\u8bd1\u5668\u6216\u8005\u6c47\u7f16\u7ea7\u522b\u7f16\u7a0b</li> <li>Cache &lt;---&gt; \u4e3b\u5b58</li> <li>\u901a\u8fc7\u7f13\u5b58\u63a7\u5236\u786c\u4ef6</li> <li>Main Memory &lt;---&gt; Disks</li> <li>\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\uff08\u865a\u62df\u5185\u5b58\uff09</li> <li>\u901a\u8fc7\u7f16\u7a0b\u8005 (files)</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#cache","title":"Cache \u4e09\u79cd\u6620\u5c04","text":"<ul> <li> <p>\u5168\u76f8\u8054\u6620\u5c04</p> </li> <li> <p>\u6bcf\u4e2a\u6570\u636e\u53ef\u4ee5\u88ab\u6620\u5c04\u5230 n \u4e2a\u4f4d\u7f6e</p> </li> <li> <p>\u7269\u7406\u5730\u5740\u88ab\u5206\u4e3a tag and offset</p> </li> </ul> <p></p> <ul> <li> <p>\u76f4\u63a5\u6620\u5c04</p> </li> <li> <p>\u6bcf\u4e2a\u6570\u636e\u53ea\u80fd\u6620\u5c04\u5230\u56fa\u5b9a\u7684\u4e00\u4e2a\u4f4d\u7f6e</p> </li> </ul> <p></p> <ul> <li> <p>\u7ec4\u76f8\u8054\u6620\u5c04</p> </li> <li> <p>\u5206\u4e3a m \u4e2a\u7ec4\uff1b\u6bcf\u4e2a\u6570\u636e\u53ef\u4ee5\u88ab\u6620\u5c04\u5230\u6bcf\u4e2a\u7ec4\u7ec4\u5185\u7684\u4efb\u610f\u4f4d\u7f6e</p> </li> <li>\u6bcf\u4e2a\u5730\u5740\u88ab\u5206\u4e3a tag + index\uff08\u7ec4\u7684\u7d22\u5f15\uff09 + offset\uff08\u5757\u5927\u5c0f\uff09</li> </ul> <p></p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#_3","title":"\u66ff\u6362\u7b56\u7565","text":"<ul> <li>LRU</li> <li>\u6700\u8fd1\u6700\u5c11\u7528\u7684\u5757\u88ab\u9a71\u9010\u51fa\u7f13\u5b58</li> <li>MRU</li> <li>\u6700\u8fd1\u4f7f\u7528\u8fc7\u7684\u5757\u88ab\u9a71\u9010</li> <li>FIFO</li> <li>\u6700\u8001\u7684\u5757\u88ab\u9a71\u9010\uff08queue\uff09</li> <li>LIFO</li> <li>\u6700\u65b0\u7684\u5757\u88ab\u9a71\u9010\uff08stack\uff09</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#_4","title":"\u5199\u7b56\u7565","text":"<ul> <li>\u56de\u5199\u7b56\u7565</li> <li>\u6570\u636e\u6539\u53d8\uff0c\u9a6c\u4e0a\u66f4\u65b0 cache \u548c memory \u7684\u6570\u636e</li> <li>\u5199\u56de</li> <li>\u6bcf\u6b21\u53ea\u66f4\u65b0 cache \u7684\u6570\u636e</li> <li>\u76f4\u5230\u8be5\u5757\u88ab\u9a71\u9010\uff0c\u68c0\u67e5 dirty flag\uff0c\u5c06\u6539\u53d8\u5199\u56de main memory</li> <li>\u6bd4\u56de\u5199\u5feb</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#_5","title":"\u591a\u7ea7\u7f13\u5b58","text":"<ul> <li>\u6bcf\u7ea7\u7f13\u5b58\u6bd4\u524d\u4e00\u7ea7\u66f4\u5927\uff0c\u7f13\u5b58\u7684\u6570\u636e\u66f4\u591a</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#caching-with-multithreading","title":"caching with multithreading","text":"<ul> <li> <p>\u6bcf\u4e2a\u6838\u6709\u81ea\u5df1\u7684 L1\u3001L2 \u7f13\u5b58</p> </li> <li> <p>\u4e0d\u540c\u7684\u6838\u8fdb\u884c\u8bfb\u53d6\u6838\u5199\u5165\u65f6\u53ef\u80fd\u53d1\u751f\u7f13\u5b58\u7684\u4e0d\u4e00\u81f4\u95ee\u9898</p> </li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#msi-protocol","title":"MSI Protocol (\u7f13\u5b58\u4e00\u81f4\u6027)","text":"<ul> <li>\u8bfb\u53d6\u65f6\uff0c\u68c0\u67e5\u5176\u4ed6\u7684\u6838\u5fc3\u8be5\u5757\u662f\u5426\u662f\u810f\u5757\uff0c\u5982\u679c\u662f\u56de\u5199\u8be5\u6539\u52a8</li> <li>\u5199\u5165\u65f6\uff0c\u5982\u679c\u8be5\u5757\u5728\u5176\u4ed6\u6838\u4e2d\u53ef\u7528\uff0c\u4f7f\u5176\u4e0d\u53ef\u7528\uff08\u5982\u679c\u662f\u810f\u5757\uff0c\u56de\u5199\u6570\u636e\uff09</li> <li>Invalid\uff1a\u8be5\u5757\u4e0d\u5728\u7f13\u5b58</li> <li>Shared\uff1a\u8be5\u5757\u5728\u5176\u4ed6\u6838\u5fc3\uff1b\u8fd8\u672a\u8fdb\u884c\u66f4\u6539\uff0c\u5982\u679c\u8981\u66f4\u6539\uff0c\u9a71\u9010\u6bcf\u4e2a\u4eba\u7f13\u5b58\u4e2d\u7684\u8be5\u5757\uff0c\u8f6c\u5316\u4e3a modified</li> <li>Modified\uff1a\u8be5\u5757\u5df2\u7ecf\u88ab\u8bfb\u548c\u4fee\u6539\uff1b\u7a0d\u540e\u5176\u4ed6\u7f13\u5b58\u4e0d\u5728\u62e5\u6709\u8be5\u5757</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#moesi","title":"MOESI","text":"<ul> <li> <p>Exclusive: Same as valid bit on, dirty bit off in regular cache</p> </li> <li> <p>The block has been read, but not modified</p> </li> <li> <p>Further, no other cache has this block</p> </li> <li> <p>Owner:</p> </li> <li>The block is in some other cache</li> <li>If we make modifications, it's our responsibility to tell all the other caches in shared state about thesechanges</li> <li>Allows for writing while other threads read the same data.</li> </ul> <p></p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture18_Caches/#coherence-missed-miss","title":"Coherence Missed (\u4e00\u81f4\u6027 miss)","text":"<ul> <li>\u4e24\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5199\u76f8\u540c\u7684\u5757</li> <li>\u53ef\u80fd\u9020\u6210\u9519\u8bef\u5171\u4eab</li> <li>The entire block is invalidated and must be reloaded, even though technically no data is shared.</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/","title":"lecture2_Intro_to_C","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#intro-to-c","title":"Intro to C","text":"<p> \u7ea6 332 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#great-idea-in-computer-architecture","title":"Great idea in Computer Architecture","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#1-abstraction","title":"1. Abstraction","text":"<ul> <li>(Layers of Representation/Interpretation)</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#2-moores-law","title":"2. Moore's Law\uff08\u6469\u5c14\u5b9a\u5f8b\uff09","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#3-principle-of-localitymemory-hierarchy","title":"3. Principle of Locality/Memory Hierarchy\uff08\u5c40\u90e8\u6027\u548c\u5185\u5b58\u5c42\u6b21\u6027\u539f\u5219\uff09","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#4-parallelism","title":"4. Parallelism\uff08\u5e76\u884c\uff09","text":"<ul> <li>\u52a0\u901f\u9891\u7e41\u4e8b\u4ef6\uff08Amdahl's law\uff09</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#5-performance-measurement-improvement","title":"5. Performance Measurement &amp; Improvement","text":"","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#6-dependability-via-redundancy","title":"6. Dependability via redundancy\uff08\u5197\u4f59\u5b9e\u73b0\u53ef\u9760\u6027\uff09","text":"<ul> <li> <p>RAID...</p> </li> <li> <p>\u5931\u53bb\u4e00\u4e2a\u6570\u636e\u4e2d\u5fc3\uff0c\u4f46\u662f\u6574\u4e2a\u7f51\u7edc\u4e0d\u4f1a\u5b95\u673a</p> </li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#compiled-interpreted","title":"Compiled &amp; Interpreted\uff08\u7f16\u8bd1\u548c\u89e3\u91ca\uff09","text":"<ul> <li> <p>Translation happens in two ways   \u25cb Compilation   \u25cb Interpretation   \u25cb Some languages use both!</p> </li> <li> <p>C compilers map C programs directly into architecture-specific machinecode (string of 1s and 0s)</p> </li> <li> <p>Java converts to architecture-independent bytecode which is then compiled by a just-in-time (JIT) compiler.</p> </li> <li> <p>Python environments converts to Python bytecode at runtime instead of at compile-time.</p> </li> <li> <p>Runtime versus JIT compilation differ in when the program is converted to low-level assembly language that is eventually translated into machine code.</p> </li> <li> <p>With C, there is generally a 3-part process in handling a .c file</p> </li> <li> <p>.c files are compiled into .s files \u21d2 compilation by the compiler</p> </li> <li>.s files are assembled into .o files \u21d2 assembly by the assembler (this step is generally hidden, so most of the time we directly convert .c files into .o files)</li> <li>.o files are linked together to create an executable \u21d2 linking by the linker</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture2-Intro%20to%20C/#_1","title":"\u7f16\u8bd1\u7684\u4f18\u70b9\u548c\u7f3a\u70b9","text":"<ul> <li> <p>\u4f18\u70b9</p> </li> <li> <p>\u5f88\u597d\u7684\u8fd0\u884c\u65f6\u8868\u73b0(because it optimizes for a given architecture)</p> </li> <li> <p>\u7f3a\u70b9</p> </li> <li>\u4f9d\u8d56\u7279\u5b9a\u7684\u786c\u4ef6\u5e73\u53f0</li> <li>\u5728\u65b0\u7cfb\u7edf\u4e0a\u5fc5\u987b\u91cd\u65b0 build</li> <li>\u201cChange \u2192 Compile \u2192 Run [repeat]\u201d iteration cycle can be slow during development<ul> <li>but make only rebuilds changed pieces, and can compile in parallel: make -j</li> <li>linker is sequential though \u2192 Amdahl\u2019s Law</li> </ul> </li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture21_Virtual_Memory/","title":"lecture21_Virtual_Memory","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture21_Virtual_Memory/#virtual-memory","title":"Virtual Memory","text":"<p> \u7ea6 152 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <p>\u76f4\u63a5\u4f7f\u7528\u7269\u7406\u5185\u5b58\u95ee\u9898</p> <ul> <li>\u6ca1\u6709\u8db3\u591f\u7a7a\u95f4\uff1bRISC-V \u53ea\u63d0\u4f9b 32bit \u7a7a\u95f4\u5373 4GB</li> <li>\u5730\u5740\u7a7a\u95f4\u6709\u7a7a\u6d1e</li> <li>\u4e0d\u80fd\u4fdd\u8bc1\u5176\u4ed6\u7a0b\u5e8f\u4e0d\u8bbf\u95ee\u540c\u4e00\u5757\u5185\u5b58</li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture21_Virtual_Memory/#benefits","title":"Benefits","text":"<ul> <li>\u5141\u8bb8\u8fd0\u884c\u81ea\u8eab\u5927\u5c0f\u6bd4\u4e3b\u5b58\u5927\u5f97\u591a\u7684\u7a0b\u5e8f\uff1b\u53ea\u6709\u5de5\u4f5c\u7684\u9875\u653e\u5728\u4e3b\u5b58\uff0c\u5176\u4ed6\u9875\u653e\u5728\u78c1\u76d8\uff1b\u7531 OS \u8fdb\u884c\u9875\u7684\u8bf7\u6c42\u548c\u7f6e\u6362</li> <li> <p>OS \u53ef\u4ee5\u5171\u4eab\u5185\u5b58\u5e76\u5b9e\u73b0\u7a0b\u5e8f\u7684\u4e92\u76f8\u4fdd\u62a4</p> </li> <li> <p>\u9690\u85cf\u673a\u5668\u7ea7\u7684\u4e0d\u540c</p> </li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture4_C%20Memory%20Endianness/","title":"lecture4_C_Memory","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CS61C/lecture4_C%20Memory%20Endianness/#c-memory","title":"C Memory","text":"<p> \u7ea6 128 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CS61C/lecture4_C%20Memory%20Endianness/#memory-alignment","title":"memory alignment\uff08\u5185\u5b58\u5bf9\u9f50\uff09","text":"<ul> <li> <p>Memory alignment: a system-dependent rule that tells us where data   can be stored (usually not at every byte)</p> </li> <li> <p>Can be accomplished with the \"aligned\" attribute <code>__attribute__((aligned(n)));</code></p> </li> </ul>","tags":["System Arch"]},{"location":"notes/CS61C/lecture4_C%20Memory%20Endianness/#strings","title":"Strings","text":"<ul> <li> <p>Example: The string \u201cHi\u201d is stored in memory as an array of characters. This array would look like: {\u2018H\u2019, \u2018i\u2019, \u2018\\0\u2019}</p> </li> <li> <p>If the null terminator is missing, C will continue to read memory as if   it was part of the string until it comes across a byte that happens to have value 0.</p> </li> <li>This is a very common source of bugs.</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/","title":"csapp-5-\u4f18\u5316\u7a0b\u5e8f\u6027\u80fd","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#chapter-5","title":"Chapter 5 \u4f18\u5316\u7a0b\u5e8f\u6027\u80fd","text":"<p> \u7ea6 695 \u4e2a\u5b57  22 \u884c\u4ee3\u7801  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#_1","title":"\u7f16\u8bd1\u5668\u7684\u80fd\u529b\u548c\u5c40\u9650\u6027","text":"<ul> <li>\u5185\u5b58\u522b\u540d\u4f7f\u7528\uff1a\u4e24\u4e2a\u6307\u9488\u53ef\u80fd\u6307\u5411\u540c\u4e00\u4e2a\u5185\u5b58\u4f4d\u7f6e</li> <li>\u53ef\u80fd\u51fa\u73b0\u8fd9\u79cd\u95ee\u9898\uff0c\u7f16\u8bd1\u5668\u5fc5\u987b\u8fdb\u884c\u68c0\u67e5\u548c\u5904\u7406\uff0c\u8fd9\u9650\u5236\u4e86\u53ef\u80fd\u7684\u4f18\u5316</li> <li>restrict \u5173\u952e\u5b57\uff0c\u53ef\u4ee5\u544a\u77e5\u7f16\u8bd1\u5668\u4e24\u4e2a\u6307\u9488\u4e0d\u80fd\u6307\u5411\u540c\u4e00\u5757\u5185\u5b58\uff0c\u7f16\u8bd1\u5668\u53ef\u4ee5\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u4f18\u5316</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#inline-substitution","title":"\u5185\u8054\u51fd\u6570\u66ff\u6362\uff08inline substitution\uff09","text":"<ul> <li>\u5c06\u51fd\u6570\u8c03\u7528\u66ff\u6362\u6210\u51fd\u6570\u4f53\uff1b\u51cf\u8f7b\u8c03\u7528\u7684\u6df1\u5ea6</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#_2","title":"\u6d88\u9664\u5faa\u73af\u4e2d\u7684\u4f4e\u6548\u7387","text":"<ul> <li>\u6bd4\u5982\u5c06\u590d\u6742\u7684\u51fd\u6570\u52a0\u5165\u5faa\u73af\uff1b\u6b64\u65f6\u8003\u8651\u8bbe\u7f6e\u5c40\u90e8\u53d8\u91cf</li> <li>\u6d88\u9664\u5faa\u73af\u4e2d\u7684\u8fc7\u7a0b\u8c03\u7528\uff1b\u8003\u8651\u8fd4\u56de\u503c\u6765\u4f18\u5316</li> </ul> C<pre><code>void combine3(vec_ptr v, data_t* dest) {\n  long i;\n  long length = vec_length(v);\n  // \u6d88\u9664\u8fc7\u7a0b\u8c03\u7528\n  data_t* data = get_vec_start(v);\n\n  *dest = IDENT;\n  for(int i = 0; i &lt; length; ++i) {\n    *dest = *dest OP data[i];\n  }\n}\n</code></pre> <ul> <li>\u4e0a\u8ff0\u8fc7\u7a0b\u6c47\u7f16\u662f\u4f1a\u53d1\u73b0\uff0c\u6bcf\u6b21\u7d2f\u79ef\u53d8\u91cf\u7684\u6570\u503c\u90fd\u8981\u8bfb\u5165\u5185\u5b58\u518d\u5199\u56de\u5185\u5b58</li> <li>\u89e3\u51b3\u65b9\u6848\uff1a\u5f15\u5165\u4e34\u65f6\u53d8\u91cf\uff0c\u8be5\u4e34\u65f6\u53d8\u91cf\u4f7f\u7528\u5bc4\u5b58\u5668\u5b58\u50a8\uff1b\u6700\u540e\u53ea\u5199\u5165\u4e00\u6b21\u5185\u5b58</li> </ul> C<pre><code>void combine3(vec_ptr v, data_t* dest) {\n  long i;\n  long length = vec_length(v);\n  // \u6d88\u9664\u8fc7\u7a0b\u8c03\u7528\n  data_t* data = get_vec_start(v);\n  data_t acc = IDENT;\n  for(int i = 0; i &lt; length; ++i) {\n    acc = acc OP data[i];\n  }\n  *dest = acc;\n}\n</code></pre>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#_3","title":"\u5904\u7406\u5668\u64cd\u4f5c\u7684\u62bd\u8c61\u6a21\u578b","text":"","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#_4","title":"\u6570\u636e\u6d41\u56fe","text":"<ul> <li>\u53ef\u4ee5\u628a\u5faa\u73af\u5bc4\u5b58\u5668\u5355\u72ec\u62ff\u51fa\u6765\uff1b\u6839\u636e\u4e0d\u540c\u5faa\u73af\u64cd\u4f5c\u7684\u5468\u671f\u53ef\u4ee5\u5927\u6982\u4f30\u8ba1\u51fa\u8be5\u7a0b\u5e8f\u6027\u80fd\u74f6\u9888\u4f4d\u7f6e</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#_5","title":"\u5faa\u73af\u5c55\u5f00","text":"<ul> <li>\u901a\u8fc7\u589e\u52a0\u6bcf\u6b21\u8fed\u4ee3\u8ba1\u7b97\u7684\u6570\u91cf\uff1b\u51cf\u5c11\u5faa\u73af\u7684\u8fed\u4ee3\u6b21\u6570</li> <li>\u4f46\u662f\u5faa\u73af\u5c55\u5f00\u53ef\u80fd\u4f18\u5316\u7a0b\u5ea6\u6709\u9650\uff1b\u53d6\u51b3\u4e8e\u5173\u952e\u8def\u5f84\u7684\u6267\u884c\u8fc7\u7a0b</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#_6","title":"\u63d0\u9ad8\u5e76\u884c\u6027","text":"<ul> <li>\u6574\u6570\u8fd0\u7b97\u53ef\u4ee5\uff1b\u4f46\u662f\u6d6e\u70b9\u6570\u7684\u52a0\u6cd5\u548c\u4e58\u6cd5\u4e0d\u80fd\u7ed3\u5408\uff1b\u7531\u4e8e\u6d6e\u70b9\u6570\u7684\u820d\u5165\u548c\u6ea2\u51fa\u53ef\u80fd\u9020\u6210\u4e0d\u540c\u7684\u7ed3\u679c</li> </ul> <ul> <li>\u91cd\u65b0\u7ed3\u5408\u53d8\u6362\uff0c\u5c06\u62ec\u53f7\u7684\u4f4d\u7f6e\u6539\u53d8\uff1b\u53ef\u80fd\u53ef\u4ee5\u7ee7\u7eed\u4f18\u5316\u7a0b\u5e8f\u7684\u6027\u80fd</li> </ul> <p>\u5faa\u73af\u5c55\u5f00\u548c\u5e76\u884c\u79ef\u7d2f\u5728\u591a\u4e2a\u503c\u4e2d\uff0c\u662f\u63d0\u9ad8\u7a0b\u5e8f\u6027\u80fd\u7684\u66f4\u53ef\u9760\u65b9\u6cd5</p> <ul> <li>SIMD\uff1a\u5355\u6307\u4ee4\u6d41\u591a\u6570\u636e\u6d41\u65b9\u5f0f\u6267\u884c\u7a0b\u5e8f\uff1b\u6bcf\u6b21\u8fd0\u7b97\u6267\u884c\u5411\u91cf\u7684\u8ba1\u7b97</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#_7","title":"\u9650\u5236\u56e0\u7d20","text":"<ul> <li>\u5bc4\u5b58\u5668\u6ea2\u51fa\uff1a\u5982\u679c\u6ea2\u51fa\uff0c\u5c06\u4e24\u4e2a\u6570\u76f8\u4e58\u76f4\u63a5\u4fdd\u5b58\u5728\u5bc4\u5b58\u5668\u7684\u4f18\u52bf\u6d88\u5931</li> <li>\u5206\u652f\u9884\u6d4b\u548c\u9884\u6d4b\u9519\u8bef\u60e9\u7f5a\uff1a\u60e9\u7f5a\u662f 19 \u4e2a\u65f6\u949f\u5468\u671f</li> <li>\u5faa\u73af\u5206\u652f\u88ab\u9884\u6d4b\u4e3a\u9009\u62e9\u5206\u652f\uff0c\u53ea\u5728\u6700\u540e\u4e00\u6b21\u5bfc\u81f4\u9884\u6d4b\u9519\u8bef\u60e9\u7f5a</li> <li>\u4e66\u5199\u9002\u5408\u7528\u6761\u4ef6\u4f20\u9001\u5b9e\u73b0\u7684\u4ee3\u7801\uff1a\u4e09\u5143\u64cd\u4f5c\u7b26\u4ee3\u66ff if-else</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/#_8","title":"\u5185\u5b58\u6027\u80fd","text":"<ul> <li>\u52a0\u8f7d\u7684\u6027\u80fd\uff1a\u9664\u5f00\u4f7f\u7528 cache\uff0c\u6bcf\u6b21\u8fdb\u884c\u53d6\u53d6\u64cd\u4f5c\u6570\uff0c\u90fd\u9700\u8981\u8bbf\u5b58</li> <li> <p>\u5b58\u50a8\u7684\u6027\u80fd\uff1a\u6bcf\u6b21\u5b58\u653e\u7ed3\u679c\uff0c\u4e5f\u9700\u8981\u8bbf\u5b58</p> </li> <li> <p>\u6ce8\u610f\u7a0b\u5e8f\u4e2d\u53ef\u80fd\u5b58\u5728\u6f5c\u5728\u7684\u52a0\u8f7d-\u5b58\u50a8\u76f8\u5173\u7684\u64cd\u4f5c\uff08src \u548c dest \u6307\u5411\u76f8\u540c\u7684\u5730\u5740\u6216\u8005 dest \u4f9d\u8d56\u4e8e src \u8ba1\u7b97\u540e\u5b58\u50a8\u7684\u65b0\u7ed3\u679c\uff09</p> </li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/","title":"csapp-6-\u5b58\u50a8\u5668\u5c42\u6b21\u7ed3\u6784","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/#chapter-6","title":"Chapter 6 \u5b58\u50a8\u5668\u5c42\u6b21\u7ed3\u6784","text":"<p> \u7ea6 442 \u4e2a\u5b57  6 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/#ram","title":"RAM\uff08\u968f\u673a\u8bbf\u95ee\u5b58\u50a8\u5668\uff09","text":"<ul> <li>SRAM\uff1a\u5feb\u4f46\u8d35\uff1b\u4f5c\u4e3a\u9ad8\u901f\u7f13\u5b58</li> <li>DRAM\uff1a\u4f5c\u4e3a\u4e3b\u5b58</li> <li>\u5206\u65f6\u590d\u7528\u5730\u5740\u7ebf\uff1b\u51cf\u5c11\u5f15\u811a\u6570\u91cf\uff0c\u589e\u52a0\u8bbf\u95ee\u65f6\u95f4</li> <li>\u9996\u5148\u5c06\u4e00\u6574\u884c\u590d\u5236\u5230\u4e00\u4e2a\u5185\u90e8\u884c\u7f13\u51b2\u533a\uff1b\u63a5\u7740\u518d\u4ece\u884c\u7f13\u51b2\u533a\u4e2d\u590d\u5236\u51fa\u4e00\u4e2a\u5355\u5143</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/#_1","title":"\u975e\u6613\u5931\u6027\u5b58\u50a8\u5668","text":"<ul> <li>\u4e3b\u8981\u662f ROM\uff0c\u4f46\u662f ROM \u4e2d\u6709\u7684\u7c7b\u578b\u5b9e\u9645\u4e0a\u65e2\u53ef\u4ee5\u8bfb\u4e5f\u53ef\u4ee5\u5199</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/#_2","title":"\u56fa\u6001\u786c\u76d8","text":"<ul> <li>Solid State Disk (SSD)\uff0c\u662f\u57fa\u4e8e\u95ea\u5b58\u7684\u5b58\u50a8\u6280\u672f</li> <li>\u95ea\u5b58\u82af\u7247\u66ff\u4ee3\u4f20\u7edf\u65cb\u8f6c\u78c1\u76d8\u4e2d\u7684\u673a\u68b0\u9a71\u52a8\u5668</li> <li>\u95ea\u5b58\u7ffb\u8bd1\u5c42\u662f\u4e00\u4e2a\u786c\u4ef6/\u56fa\u4ef6\u8bbe\u5907\uff0c\u5c06\u5bf9\u903b\u8f91\u5757\u7684\u8bf7\u6c42\u7ffb\u8bd1\u6210\u5bf9\u5e95\u5c42\u7269\u7406\u8bbe\u5907\u7684\u8bbf\u95ee</li> <li>SSD \u4ee5\u9875\u4e3a\u8bfb\u5199\u5355\u4f4d</li> <li>\u5c06\u64e6\u9664\u5e73\u5747\u5206\u5e03\u5230\u6240\u6709\u7684\u5757\u4e0a</li> </ul> <ul> <li>\u968f\u673a\u5199\u5f88\u6162\u7684\u539f\u56e0</li> <li>\u64e6\u9664\u5757\u9700\u8981\u76f8\u5bf9\u8f83\u957f\u7684\u65f6\u95f4</li> <li>\u5982\u679c\u9700\u8981\u4fee\u6539\u6570\u636e\uff0c\u9700\u8981\u628a\u6240\u6709\u5e26\u6709\u7528\u6570\u636e\u7684\u9875\u590d\u5236\u5230\u4e00\u4e2a\u65b0\u7684\u5757\u4e0a\u540e\uff1b\u91cd\u65b0\u8fdb\u884c\u8bfb\u5199</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/#_3","title":"\u5b58\u50a8\u5668\u5b58\u50a8\u7ed3\u6784","text":"","tags":["System Arch"]},{"location":"notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/#cache","title":"cache","text":"<ul> <li>\u5728 CPU \u5bc4\u5b58\u5668\u548c\u4e3b\u5b58\u4e2d\u63d2\u5165\u4e86\u4e00\u4e2a\u5c0f\u7684 SRAM \u9ad8\u901f\u7f13\u5b58\u5b58\u50a8\u5668\uff0c\u79f0\u4e3a L1 cache\uff1b4 clock</li> <li>\u5728 L1 cache \u548c main memory \u4e2d\u63d2\u5165 L2 cache\uff0c10 clock</li> <li>\u5728 L2 cache \u548c L3 cache \u4e2d\u63d2\u5165 L3 cache\uff0c50 clock</li> </ul> <ul> <li>\u4f7f\u7528\u4e2d\u95f4\u7684\u4f4d\u6765\u7d22\u5f15\uff1b\u5982\u679c\u7528\u9ad8\u4f4d\u6765\u7d22\u5f15\uff0c\u76f8\u90bb\u7684\u5757\u57fa\u672c\u4f1a\u88ab\u6620\u5c04\u5230\u540c\u4e00\u4e2a cache \u884c\uff0ccache \u547d\u4e2d\u5927\u5927\u51cf\u5c11</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/#core-cache","title":"core \u4e2d\u7684 cache","text":"","tags":["System Arch"]},{"location":"notes/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/#_4","title":"\u7f16\u5199\u9ad8\u901f\u7f13\u5b58\u53cb\u597d\u7684\u4ee3\u7801","text":"<ul> <li>\u8ba9\u6700\u5e38\u89c1\u7684\u60c5\u51b5\u8fd0\u884c\u5f97\u5feb</li> <li>\u5c3d\u91cf\u51cf\u5c11\u6bcf\u4e2a\u5faa\u73af\u5185\u90e8\u7684\u7f13\u5b58\u4e0d\u547d\u4e2d\u6570\u91cf</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/","title":"csapp-7-\u94fe\u63a5","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#chapter-7","title":"Chapter 7 \u94fe\u63a5","text":"<p> \u7ea6 556 \u4e2a\u5b57  7 \u884c\u4ee3\u7801  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#_1","title":"\u9759\u6001\u94fe\u63a5","text":"<ul> <li>\u7b26\u53f7\u89e3\u6790</li> <li>\u91cd\u5b9a\u4f4d</li> <li>\u7f16\u8bd1\u5668\u548c\u6c47\u7f16\u5668\u751f\u6210.text \u548c.data</li> <li>\u94fe\u63a5\u5668\u901a\u8fc7\u628a\u6bcf\u4e2a\u7b26\u53f7\u5b9a\u4e49\u548c\u4e00\u4e2a\u5185\u5b58\u4f4d\u7f6e\u5173\u8054\uff0c\u5bf9\u8fd9\u4e9b\u8282\u8fdb\u884c\u91cd\u5b9a\u4f4d\uff1b\u4fee\u6539\u5f15\u7528\uff0c\u8ba9\u7b26\u53f7\u6307\u5411\u8fd9\u4e2a\u5185\u5b58\u4f4d\u7f6e</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#_2","title":"\u53ef\u91cd\u5b9a\u4f4d\u76ee\u6807\u6587\u4ef6","text":"<ul> <li>.rel.*\uff1a\u4e0d\u540c\u8282\u7684\u91cd\u5b9a\u4f4d\u4fe1\u606f</li> <li>.line\uff1a\u539f\u59cb C \u7a0b\u5e8f\u548c.text \u8282\u4e2d\u673a\u5668\u6307\u4ee4\u7684\u6620\u5c04\uff0c\"-g\"\u5f97\u5230</li> </ul> <ul> <li>.bss\uff1a\u672a\u521d\u59cb\u5316\u7684\u9759\u6001\u53d8\u91cf\uff0c\u4ee5\u53ca\u521d\u59cb\u5316\u4e3a 0 \u7684\u5168\u5c40\u6216\u9759\u6001\u53d8\u91cf</li> <li>COMMON\uff1a\u672a\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#_3","title":"\u89e3\u6790\u591a\u91cd\u5b9a\u4e49\u7b26\u53f7","text":"<ul> <li>\u4e0d\u5141\u8bb8\u6709\u591a\u4e2a\u540c\u540d\u7684\u5f3a\u7b26\u53f7\uff08\u5b9a\u4e49\u5e76\u521d\u59cb\u5316\uff09</li> <li>\u5f3a\u5f31\u540c\u5728\uff0c\u9009\u5f3a\u7b26\u53f7</li> <li>\u53ea\u6709\u5f31\u7b26\u53f7\uff0c\u968f\u4fbf\u9009\u4e00\u4e2a\u5f31\u7b26\u53f7</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#_4","title":"\u91cd\u5b9a\u4f4d","text":"<ul> <li>\u91cd\u5b9a\u4f4d\u8282\u548c\u7b26\u53f7\u5b9a\u4e49</li> <li>\u5c06\u76f8\u540c\u7c7b\u578b\u7684\u8282\u5408\u5e76\u4e3a\u540c\u4e00\u7c7b\u578b\u7684\u65b0\u7684\u805a\u5408\u8282</li> <li>\u6bcf\u6761\u6307\u4ee4\u548c\u5168\u5c40\u53d8\u91cf\u6709\u552f\u4e00\u7684\u8fd0\u884c\u65f6\u5185\u5b58\u5730\u5740</li> <li>\u91cd\u5b9a\u4f4d\u8282\u7684\u7b26\u53f7\u5f15\u7528</li> <li>\u4fee\u6539\u4ee3\u7801\u8282\u548c\u6570\u636e\u8282\u4e2d\u7684\u5bf9\u7b26\u53f7\u7684\u5f15\u7528\uff0c\u6307\u5411\u6b63\u786e\u7684\u8fd0\u884c\u65f6\u5730\u5740</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#_5","title":"\u91cd\u5b9a\u4f4d\u7b97\u6cd5","text":"C<pre><code>// relocation entry\ntypedef struct {\n    long offset;    // \u91cd\u5b9a\u4f4d\u7684\u504f\u79fb\n    long type:32,   // \u91cd\u5b9a\u4f4d\u7c7b\u578b\n        symbol:32;  // \u7b26\u53f7\u8868\u7d22\u5f15\n    long addend;    // \u6709\u7b26\u53f7\u5e38\u6570\uff0c\u7528\u4e8e\u504f\u79fb\u8c03\u6574\n};\n</code></pre>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#_6","title":"\u53ef\u6267\u884c\u76ee\u6807\u6587\u4ef6","text":"","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#_7","title":"\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801","text":"<ul> <li>\u52a0\u8f7d\u4f46\u662f\u4e0d\u9700\u8981\u91cd\u5b9a\u4f4d\u4ee3\u7801\u2014\u2014\u4f4d\u7f6e\u65e0\u5173\u4ee3\u7801\uff08PIC\uff09</li> <li>gcc -fpic\uff0c\u5171\u4eab\u5e93\u7f16\u8bd1\u9700\u8981\u4f7f\u7528</li> <li>\u57fa\u4e8e.text \u548c.data \u7684\u8ddd\u79bb\u603b\u662f\u4fdd\u6301\u4e0d\u53d8</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#pic","title":"PIC \u6570\u636e\u5f15\u7528","text":"<ul> <li>\u5728\u6570\u636e\u6bb5\u5f00\u59cb\u521b\u5efa\u4e00\u4e2a\u8868\uff0c\u5168\u5c40\u504f\u79fb\u91cf\u8868\uff08Global Offset Table\uff09</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#pic_1","title":"PIC \u51fd\u6570\u8c03\u7528","text":"<ul> <li>\u5ef6\u8fdf\u7ed1\u5b9a\uff0c\u5c06\u8fc7\u7a0b\u5730\u5740\u7684\u7ed1\u5b9a\u63a8\u8fdf\u5230\u7b2c\u4e00\u6b21\u8c03\u7528\u8be5\u8fc7\u7a0b\u65f6</li> <li>\u901a\u8fc7 GOT \u548c PLT\uff08\u8fc7\u7a0b\u94fe\u63a5\u8868\uff09\u6765\u5b9e\u73b0\uff1bPLT \u662f\u4ee3\u7801\u6bb5\u7684\u8868\uff0cGOT \u662f\u6570\u636e\u6bb5\u7684\u8868</li> <li>\u901a\u8fc7\u4e24\u4e2a\u8868\u7684\u8df3\u8f6c\uff0c\u5c06\u51fd\u6570\u7684 ID \u548c\u52a8\u6001\u94fe\u63a5\u5668\u7684\u53c2\u6570\u538b\u5165\u6808\u4e2d\uff0c\u8fdb\u5165\u52a8\u6001\u94fe\u63a5\u5668\u8fdb\u884c\u91cd\u5b9a\u4f4d\u548c\u4fee\u590d\u7b26\u53f7\u6267\u884c\u7684\u5730\u5740</li> <li>\u7b2c\u4e00\u6761 PLT \u6307\u4ee4\u901a\u8fc7 GOT[4]\u8fdb\u884c\u95f4\u63a5\u8df3\u8f6c\uff1b\u8df3\u8f6c\u53ea\u662f\u8df3\u5230\u4e0b\u4e00\u6761\u6307\u4ee4</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/7-%E9%93%BE%E6%8E%A5/#_8","title":"\u5e93\u6253\u6869\u673a\u5236","text":"<ul> <li>\u8fd0\u884c\u622a\u83b7\u5bf9\u5171\u4eab\u5e93\u51fd\u6570\u7684\u8c03\u7528\uff0c\u7528\u81ea\u5df1\u7684\u51fd\u6570\u8fdb\u884c\u53d6\u4ee3</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/8-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/","title":"csapp-8-\u5f02\u5e38\u63a7\u5236\u6d41","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CSAPP/8-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/#chapter-8","title":"Chapter 8 \u5f02\u5e38\u63a7\u5236\u6d41","text":"<p> \u7ea6 38 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CSAPP/%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F/","title":"csapp-\u5728\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7a0b\u5e8f","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CSAPP/%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F/#_1","title":"\u5728\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7a0b\u5e8f","text":"<p> \u7ea6 394 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CSAPP/%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F/#_2","title":"\u94fe\u63a5","text":"<ul> <li>gcc \u7f16\u8bd1\u94fe\u63a5\u7a0b\u5e8f\uff1acpp \u9884\u5904\u7406\u5668\u9884\u5904\u7406\u6e90\u6587\u4ef6\uff0ccc1 \u7f16\u8bd1\u5668\u7f16\u8bd1.i \u6587\u4ef6\u4e3a.S \u6587\u4ef6\uff0cas \u6c47\u7f16\u5668\u5c06.S \u6587\u4ef6\u53d8\u4e3a\u53ef\u91cd\u5b9a\u4f4d\u76ee\u6807\u6587\u4ef6.o\uff0c\u6700\u540e\u8fd0\u884c ld \u94fe\u63a5\u5668\uff0c\u521b\u5efa\u4e00\u4e2a\u53ef\u6267\u884c\u7a0b\u5e8f</li> <li>\u6267\u884c./a.out\uff0cshell \u8c03\u7528\u52a0\u8f7d\u5668\u51fd\u6570\uff0c\u5c06\u53ef\u6267\u884c\u6587\u4ef6\u7684.text \u548c.data \u590d\u5236\u5230\u5185\u5b58\u5e76\u8df3\u8f6c\u5230\u8be5\u7a0b\u5e8f\u5f00\u5934</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F/#_3","title":"\u89e3\u6790\u591a\u91cd\u5b9a\u4e49\u7684\u5168\u5c40\u7b26\u53f7","text":"<ul> <li>\u89c4\u5219   1. \u4e0d\u5141\u8bb8\u591a\u4e2a\u540c\u540d\u7684\u5f3a\u7b26\u53f7   2. \u5982\u679c\u6709\u4e00\u4e2a\u5f3a\u7b26\u53f7\u548c\u591a\u4e2a\u5f31\u7b26\u53f7\u540c\u540d\uff0c\u9009\u62e9\u5f31\u7b26\u53f7   3. \u5982\u679c\u6709\u591a\u4e2a\u5f31\u7b26\u53f7\u540c\u540d\uff0c\u9009\u62e9\u5176\u4e2d\u4efb\u610f\u4e00\u4e2a</li> <li>\u94fe\u63a5\u5668\u4e0d\u4f1a\u8868\u793a\u68c0\u6d4b\u5230\u7b26\u53f7\u7684\u591a\u91cd\u5b9a\u4e49</li> <li>\u672a\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\u4ea4\u7ed9 COMMON \u6bb5\uff0c\u5c06\u53ef\u80fd\u5b58\u5728\u591a\u91cd\u5b9a\u4e49\u7684\u53d8\u91cf\u4ea4\u7ed9\u94fe\u63a5\u5668\u8fdb\u884c\u88c1\u51b3</li> <li>\u672a\u521d\u59cb\u5316\u7684\u9759\u6001\u53d8\u91cf\uff0c\u521d\u59cb\u5316\u4e3a 0 \u7684\u9759\u6001\u6216\u5168\u5c40\u53d8\u91cf\u5728.bss \u6bb5\uff1b\u5168\u5c40\u53d8\u91cf\u521d\u59cb\u5316\u4e3a 0 \u662f\u4e00\u4e2a\u5f3a\u7b26\u53f7</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F/#_4","title":"\u4e0e\u9759\u6001\u94fe\u63a5\u5e93\u94fe\u63a5","text":"<ul> <li>\u94fe\u63a5\u5668\u5c06\u53ea\u590d\u5236\u88ab\u7a0b\u5e8f\u5f15\u7528\u7684\u76ee\u6807\u6a21\u5757</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F/#_5","title":"\u52a8\u6001\u94fe\u63a5\u5171\u4eab\u5e93","text":"<ul> <li>\u94fe\u63a5\u5668\u590d\u5236\u4e86.so \u6587\u4ef6\u7684\u91cd\u5b9a\u4f4d\u548c\u7b26\u53f7\u8868\u4fe1\u606f</li> <li>\u5728\u53ef\u6267\u884c\u6587\u4ef6\u52a0\u8f7d\u540e\uff0c\u5b58\u5728.interp \u8282\uff0c\u52a0\u8f7d\u52a8\u6001\u94fe\u63a5\u5668(ld-linux.so)\uff1b\u52a8\u6001\u94fe\u63a5\u5668\u672c\u8eab\u4e0d\u80fd\u4f9d\u8d56\u4efb\u4f55\u52a8\u6001\u5e93\uff0c\u6240\u6709\u5b83\u662f\u9759\u6001\u94fe\u63a5\u7684</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E6%89%A7%E8%A1%8C/","title":"csapp-\u7a0b\u5e8f\u7684\u7ed3\u6784\u548c\u6267\u884c","text":"<code>#System Arch</code>","tags":["System Arch"]},{"location":"notes/CSAPP/%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E6%89%A7%E8%A1%8C/#_1","title":"\u7a0b\u5e8f\u7684\u7ed3\u6784\u548c\u6267\u884c","text":"<p> \u7ea6 363 \u4e2a\u5b57  33 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["System Arch"]},{"location":"notes/CSAPP/%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E6%89%A7%E8%A1%8C/#_2","title":"\u7a0b\u5e8f\u7684\u673a\u5668\u7ea7\u8868\u793a","text":"<ul> <li>\u4f7f\u7528\u57fa\u4e8e\u6761\u4ef6\u7684\u6570\u636e\u4f20\u9001\u66ff\u4ee3\u57fa\u4e8e\u6761\u4ef6\u7684\u63a7\u5236\u8f6c\u79fb</li> </ul> C<pre><code>// \u57fa\u4e8e\u6761\u4ef6\u7684\u6570\u636e\u4f20\u9001\nint ntest = x &gt;= y;\nif (ntest) {\n    ...\n} else {\n    ...\n}\n\n// \u57fa\u4e8e\u6761\u4ef6\u7684\u63a7\u5236\u8f6c\u79fb\nif (x &gt;y) {\n\n} else {\n\n}\n</code></pre> <ul> <li> <p>while \u7684\u4e24\u79cd\u6c47\u7f16\u5f62\u5f0f</p> </li> <li> <p>jump to the middle</p> C<pre><code>    go to test;\nloop:\n    body\ntest:\n    t = test-expr;\n    if (t){\n        goto loop;\n    }\n</code></pre> </li> <li> <p>guarded-do</p> C<pre><code>t = test-expr;\nif(!t){\n    goto done;\n}\nloop:\n    body\n    t = test-expr;\n    if(t) {\n        goto loop;\n    }\ndone:\n</code></pre> </li> <li> <p>\u5bf9\u6297\u7f13\u51b2\u533a\u6ea2\u51fa\u653b\u51fb</p> </li> <li>\u5730\u5740\u7a7a\u95f4\u5e03\u5c40\u968f\u673a\u5316\uff1a\u6808\u968f\u673a\u5316\uff0c\u6bcf\u6b21\u5148\u5728\u6808\u4e0a\u968f\u673a\u5206\u914d\u4e00\u5927\u5757\u7a7a\u95f4\uff1b\u7a0b\u5e8f\u6bcf\u6b21\u52a0\u8f7d\u5730\u5740\u4e0d\u540c</li> <li>\u6808\u7834\u574f\u68c0\u6d4b\uff1a\u5728\u6808\u5e27\u4e0e\u6808\u72b6\u6001\u95f4\u5b58\u653e\u4e00\u4e2a\u7279\u6b8a\u7684<code>\u91d1\u4e1d\u96c0</code>\u503c</li> <li>\u9650\u5236\u53ef\u6267\u884c\u4ee3\u7801\u533a\u57df</li> </ul>","tags":["System Arch"]},{"location":"notes/CSAPP/%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E6%89%A7%E8%A1%8C/#_3","title":"\u4f18\u5316\u7a0b\u5e8f\u6027\u80fd","text":"<ul> <li>\u4f18\u5316\u7f16\u8bd1\u5668\u7684\u80fd\u529b\u548c\u5c40\u9650\u6027</li> <li>\u786e\u5b9a\u4e24\u4e2a\u6307\u9488\u662f\u5426\u6307\u5411\u4e0d\u540c\u7684\u5185\u5b58<code>restrict</code>\u5173\u952e\u5b57</li> <li>\u5185\u8054\u51fd\u6570\u66ff\u6362\u51fd\u6570\u8c03\u7528</li> <li>\u6d88\u9664\u5faa\u73af\u7684\u4f4e\u6548\u7387</li> <li>\u5c06\u67d0\u4e9b\u5b9a\u957f\u7684\u5e93\u51fd\u6570\u7ed3\u679c\u79fb\u9664\u5faa\u73af</li> <li>\u51cf\u5c11\u8fc7\u7a0b\u8c03\u7528</li> <li>\u6d88\u9664\u4e0d\u5fc5\u8981\u7684\u5185\u5b58\u5f15\u7528</li> <li>\u4f7f\u7528\u4e34\u65f6\u53d8\u91cf\u66ff\u4ee3\u6307\u9488</li> <li>\u5faa\u73af\u5c55\u5f00</li> <li>\u63d0\u9ad8\u7a0b\u5e8f\u5e76\u884c\u6027\uff1a\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 SIMD \u5411\u91cf\u6307\u4ee4</li> <li>\u5bf9 dst \u548c src \u5730\u5740\u76f8\u540c\u7684\u53d6\u503c\u64cd\u4f5c\uff0c\u9020\u6210\u5199/\u8bfb\u76f8\u5173\u95ee\u9898</li> <li>\u5b58\u50a8\u5355\u5143\u4e2d\u5b58\u5728\u5b58\u50a8\u7f13\u51b2\u533a\uff0c\u6bcf\u4e2a\u7f13\u5b58\u533a\u7531\u5730\u5740<code>s_addr</code>\u548c\u6570\u636e<code>s_data</code>\u7ec4\u6210\uff1b<code>src</code>\u548c<code>dst</code>\u4e0d\u540c\u65f6\uff0c\u6570\u636e\u548c\u5730\u5740\u53ef\u4ee5\u5e76\u884c\u53d6\u51fa\uff0c\u5982\u679c\u76f8\u540c\uff0c\u5fc5\u987b\u4fdd\u8bc1<code>s_addr</code>\u5728<code>s_data</code>\u524d\u5b8c\u6210</li> </ul>","tags":["System Arch"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/","title":"C++-\u6cdb\u578b\u7b97\u6cd5","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_1","title":"\u6cdb\u578b\u7b97\u6cd5","text":"<p> \u7ea6 948 \u4e2a\u5b57  24 \u884c\u4ee3\u7801  8 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_2","title":"\u6982\u8ff0","text":"<ul> <li>\u4e0d\u76f4\u63a5\u64cd\u4f5c\u5bb9\u5668\uff0c\u904d\u5386\u7531\u4e24\u4e2a\u8fed\u4ee3\u5668\u6307\u5b9a\u7684\u4e00\u4e2a\u5143\u7d20\u8303\u56f4\u8fdb\u884c\u64cd\u4f5c</li> <li>\u8fed\u4ee3\u5668\u4ee4\u7b97\u6cd5\u4e0d\u4f9d\u8d56\u4e8e\u5bb9\u5668</li> <li>\u7b97\u6cd5\u4f9d\u8d56\u4e8e\u5143\u7d20\u7c7b\u578b\u7684\u64cd\u4f5c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_3","title":"\u521d\u8bc6\u6cdb\u578b\u7b97\u6cd5","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_4","title":"\u53ea\u8bfb\u7b97\u6cd5","text":"<ul> <li> <p>find</p> </li> <li> <p>accumulate</p> </li> </ul> C++<pre><code>int sum = accumulate(vec.begin(),vec.end(), 0);   // \u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u548c\u7684\u521d\u503c\nstring sum = accumulate(v.cbegin(), v.cend(), string(\"\")); // string\u5b9a\u4e49\u4e86+\u8fd0\u7b97\u7b26\n</code></pre> <ul> <li> <p>count</p> </li> <li> <p>equal\uff1a\u786e\u5b9a\u4e24\u4e2a\u5e8f\u5217\u662f\u5426\u4fdd\u5b58\u76f8\u540c\u7684\u503c\uff0c\u63a5\u53d7\u4e09\u4e2a\u8fed\u4ee3\u5668\uff1b\u5047\u5b9a\u6bcf\u4e2a\u5143\u7d20\u5728\u7b2c\u4e8c\u4e2a\u5e8f\u5217\u4e2d\u90fd\u6709\u4e00\u4e2a\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5143\u7d20\uff08\u7b2c\u4e8c\u4e2a\u5e8f\u5217\u81f3\u5c11\u4e0e\u7b2c\u4e00\u4e2a\u5e8f\u5217\u4e00\u6837\u957f\uff09</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_5","title":"\u5199\u5bb9\u5668\u7b97\u6cd5","text":"<ul> <li>fill\uff1a\u63a5\u53d7\u4e00\u5bf9\u8fed\u4ee3\u5668\u8868\u793a\u4e00\u4e2a\u8303\u56f4\uff0c\u8fd8\u63a5\u6536\u4e00\u4e2a\u503c\u4f5c\u4e3a\u7b2c\u4e09\u4e2a\u53c2\u6570\uff1bfill\u5c06\u7b2c\u4e09\u4e2a\u503c\u8d4b\u4e88\u8f93\u5165\u5e8f\u5217\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20</li> </ul> C++<pre><code>fill(vec.begin(), vec.end(), 0);\n</code></pre> <ul> <li>\u4f7f\u7528\u63d2\u5165\u8fed\u4ee3\u5668\u6765\u4fdd\u8bc1\u7b97\u6cd5\u6709\u8db3\u591f\u5143\u7d20\u7a7a\u95f4\u6765\u5bb9\u7eb3\u8f93\u51fa\u6570\u636e\u7684\u65b9\u6cd5</li> </ul> C++<pre><code>vector&lt;int&gt; vec;\nfill_n(back_iterator(vec), 10, 0);\n// \u6bcf\u6b21\u8d4b\u503c\u5c06\u5728vec\u4e0a\u8c03\u7528push_back\uff0c\u6bcf\u4e2a\u5143\u7d20\u503c\u4e3a0\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_6","title":"\u62f7\u8d1d\u7b97\u6cd5","text":"<ul> <li>\u63a5\u53d7\u4e09\u4e2a\u53c2\u6570\uff0c\u524d\u4e24\u4e2a\u8868\u793a\u4e00\u4e2a\u8f93\u5165\u8303\u56f4\uff0c\u7b2c\u4e09\u4e2a\u8868\u793a\u76ee\u7684\u5e8f\u5217\u7684\u8d77\u59cb\u4f4d\u7f6e</li> </ul> C++<pre><code>int a1[] = {0,1,2,3,4,5,6,7,8,9};\nint a2[sizeof(a1) / sizeof(*a1)];\nauto ret = copy(begin(a1), end(a1), a2);\n// copy\u8fd4\u56de\u7684\u662f\u76ee\u7684\u4f4d\u7f6e\u8fed\u4ee3\u5668\uff08\u9012\u589e\u540e\uff09\u7684\u503c\uff1b\u5c3e\u5143\u7d20\u540e\u9762\u7684\u4f4d\u7f6e\n</code></pre> <ul> <li>replace(ilist.begin(), ilist.end(), 0, 42)\uff1a\u5c06\u6240\u67090\u7684\u5143\u7d20\u6539\u4e3a42</li> <li>replace_copy(ilist.cbegin(), ilist.cend(), back_iterator(ivec), 0, 42)\uff1a\u4e0d\u6539\u53d8\u539f\u6765\u7684\u5e8f\u5217\uff0c\u5728ivec\u4e2d\u4e3a0\u7684\u5143\u7d20\u6539\u4e3a42</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_7","title":"\u91cd\u6392\u5bb9\u5668\u5143\u7d20\u7684\u7b97\u6cd5","text":"<ul> <li>sort(words.begin(), words.end())</li> <li>unique\uff1a\u91cd\u6392\u8f93\u5165\u5e8f\u5217\uff0c\u5c06\u76f8\u90bb\u7684\u91cd\u590d\u9879\u201c\u6d88\u9664\u201d\uff1b\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u4e0d\u91cd\u590d\u503c\u8303\u56f4\u672b\u5c3e\u7684\u8fed\u4ee3\u5668\uff08\u6700\u540e\u4e00\u4e2a\u4e0d\u91cd\u590d\u5143\u7d20\u4e4b\u540e\u7684\u4f4d\u7f6e\uff09</li> </ul> <p>\u7b97\u6cd5\u6839\u672c\u4e0d\u77e5\u9053\u5bb9\u5668\u7684\u5b58\u5728\uff0c\u7b97\u6cd5\u5728\u8fed\u4ee3\u5668\u4e0a\u8fdb\u884c\u64cd\u4f5c\uff1bfill_n\u5bf9\u5bb9\u5668\u8fdb\u884c\u63d2\u5165\uff0c\u4e5f\u662f\u5728back_iterator\u4e0a\u8fdb\u884c\u7684\uff0c\u800c\u8be5\u8fed\u4ee3\u5668\u5411\u5bb9\u5668\u63d2\u5165\u5143\u7d20</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_8","title":"\u5b9a\u5236\u64cd\u4f5c","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_9","title":"\u5411\u7b97\u6cd5\u4f20\u9012\u53c2\u6570","text":"<ul> <li>\u8c13\u8bcd\uff1a\u4e00\u4e2a\u53ef\u8c03\u7528\u7684\u8868\u8fbe\u5f0f\uff0c\u8fd4\u56de\u7ed3\u679c\u662f\u4e00\u4e2a\u80fd\u7528\u4f5c\u6761\u4ef6\u7684\u503c\u3002\u6807\u51c6\u5e93\u6240\u7528\u7b97\u6cd5\u5206\u4e3a\u4e00\u5143\u8c13\u8bcd\u548c\u4e8c\u5143\u8c13\u8bcd</li> </ul> C++<pre><code>bool cmp(const string &amp;s1, const string &amp;s2) {\n    return s1.size() &lt; s2.size();\n}\nsort(words.begin(), words.end(), cmp);\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#lambda","title":"lambda\u8868\u8fbe\u5f0f","text":"<ul> <li>\u4e00\u4e2alambda\u53ea\u6709\u5728\u6355\u83b7\u5217\u8868\u4e2d\u6355\u83b7\u4e00\u4e2a\u5b83\u6240\u5728\u51fd\u6570\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u624d\u80fd\u5728\u51fd\u6570\u4f53\u4e2d\u4f7f\u7528\u8be5\u53d8\u91cf</li> <li>\u5c3d\u91cf\u4fdd\u6301lambda\u7684\u53d8\u91cf\u6355\u83b7\u7b80\u5355\u5316</li> <li>\u6355\u83b7\u4e00\u4e2a\u666e\u901a\u53d8\u91cf\uff0c\u5982int\uff0cstring\u6216\u5176\u4ed6\u975e\u6307\u9488\u7c7b\u578b\uff1b\u53ef\u4ee5\u91c7\u7528\u7b80\u5355\u7684\u503c\u6355\u83b7</li> <li>\u6355\u83b7\u4e00\u4e2a\u6307\u9488\u6216\u8fed\u4ee3\u5668\uff0c\u6216\u91c7\u7528\u5f15\u7528\u6355\u83b7\u65b9\u5f0f\uff0c\u5fc5\u987b\u786e\u4fdd\u5728lambda\u6267\u884c\u65f6\uff1b\u7ed1\u5b9a\u5230\u8fed\u4ee3\u5668\u3001\u6307\u9488\u6216\u5f15\u7528\u7684\u5bf9\u8c61\u4ecd\u7136\u5b58\u5728\u540c\u65f6\u4fdd\u8bc1\u5bf9\u8c61\u5177\u6709\u9884\u671f\u7684\u503c\uff1b\u5e94\u8be5\u907f\u514d\u6355\u83b7\u5f15\u7528\u548c\u6307\u9488</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#lambda_1","title":"\u53ef\u53d8lambda","text":"<ul> <li>\u5bf9\u4e8e\u4e00\u4e2a\u503c\u88ab\u62f7\u8d1d\u7684\u53d8\u91cf\uff0clambda\u4e0d\u4f1a\u6539\u53d8\u5176\u503c\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u6539\u53d8\u4e00\u4e2a\u88ab\u6355\u83b7\u7684\u53d8\u91cf\u7684\u503c\uff1b\u5fc5\u987b\u5728\u53c2\u6570\u5217\u8868\u9996\u52a0\u4e0amutable</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#lambda_2","title":"\u6307\u5b9alambda\u8fd4\u56de\u503c\u7c7b\u578b","text":"C++<pre><code>transform(vi.begin(), vi.end(), [](int i)-&gt;int {if(i &gt; 0) return -i; else return i;});\n    auto lambda = [&amp;ncref = n, n](auto a, auto b, auto /*unused*/)\n    {\n        f(b, 42, a, ncref, n);\n    };\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_10","title":"\u53c2\u6570\u7ed1\u5b9a","text":"<ul> <li>bind\u6807\u51c6\u5e93\u51fd\u6570\uff0c\u5b9a\u4e49\u5728\u5934\u6587\u4ef6functional\u4e2d\uff1b</li> <li>\u53ef\u4ee5\u770b\u4f5c\u901a\u7528\u7684\u51fd\u6570\u9002\u914d\u5668\uff1b\u63a5\u53d7\u4e00\u4e2a\u53ef\u8c03\u7528\u5bf9\u8c61\uff0c\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u53ef\u8c03\u7528\u5bf9\u8c61</li> </ul> C++<pre><code>auto newCallable = bind(callable, arg_list);\n</code></pre> <ul> <li>\u4f7f\u7528placeholders\u547d\u540d\u7a7a\u95f4\uff0c_1, _2..._n</li> <li>\u51fd\u6570\u6a21\u677f <code>std::mem_fn</code> \u751f\u6210\u6307\u5411\u6210\u5458\u6307\u9488\u7684\u5305\u88c5\u5bf9\u8c61\uff0c\u5b83\u53ef\u4ee5\u5b58\u50a8\u3001\u590d\u5236\u53ca\u8c03\u7528\u6307\u5411\u6210\u5458\u6307\u9488\u3002\u5230\u5bf9\u8c61\u7684\u5f15\u7528\u548c\u6307\u9488\uff08\u542b\u667a\u80fd\u6307\u9488\uff09\u53ef\u5728\u8c03\u7528 <code>std::mem_fn</code> \u65f6\u4f7f\u7528\u3002</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_11","title":"\u518d\u63a2\u8fed\u4ee3\u5668","text":"<ul> <li>\u63d2\u5165\u8fed\u4ee3\u5668</li> <li>\u6d41\u8fed\u4ee3\u5668\uff1a\u7ed1\u5b9a\u5230\u8f93\u5165\u6216\u8f93\u51fa\u6d41\u4e0a</li> <li>\u53cd\u5411\u8fed\u4ee3\u5668\uff1a\u5411\u540e\u79fb\u52a8</li> <li>\u79fb\u52a8\u8fed\u4ee3\u5668\uff1a\u4e0d\u62f7\u8d1d\u5143\u7d20\u800c\u662f\u79fb\u52a8\u5143\u7d20</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_12","title":"\u63d2\u5165\u8fed\u4ee3\u5668","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#iostream","title":"iostream\u8fed\u4ee3\u5668","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_13","title":"\u53cd\u5411\u8fed\u4ee3\u5668","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_14","title":"\u6cdb\u578b\u7b97\u6cd5\u7ed3\u6784","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_15","title":"\u7279\u5b9a\u5bb9\u5668\u7b97\u6cd5","text":"<ul> <li>\u5bf9\u4e8elist\u548cforward_list\uff0c\u5e94\u8be5\u4f18\u5148\u4f7f\u7528\u6210\u5458\u51fd\u6570\u7248\u672c\u7684\u7b97\u6cd5\u800c\u4e0d\u662f\u901a\u7528\u7b97\u6cd5</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#splice","title":"splice\u6210\u5458","text":"<ul> <li>\u94fe\u8868\u6570\u636e\u7ed3\u6784\u6240\u7279\u6709\u7684</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_16","title":"\u94fe\u8868\u7279\u6709\u64cd\u4f5c\u4f1a\u6539\u53d8\u5bb9\u5668","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/10_%E6%B3%9B%E5%9E%8B%E7%AE%97%E6%B3%95/#_17","title":"\u53ef\u53d8\u53c2\u6570\u6a21\u677f","text":"C++<pre><code>    template&lt;typename... Args&gt; int add_many(Args... args)\n    {\n        return data + (args + ...);\n    }\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/","title":"C++-\u5173\u8054\u5bb9\u5668","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_1","title":"\u5173\u8054\u5bb9\u5668","text":"<p> \u7ea6 560 \u4e2a\u5b57  60 \u884c\u4ee3\u7801  9 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <ul> <li>\u5173\u8054\u5bb9\u5668\u652f\u6301\u9ad8\u6548\u7684\u5173\u952e\u5b57\u67e5\u627e\u548c\u8bbf\u95ee\uff1b\u4e3b\u8981\u7684\u4e24\u4e2a\u5173\u8054\u5bb9\u5668\u662fmap\u548cset</li> </ul> <p></p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_2","title":"\u4f7f\u7528\u5173\u8054\u5bb9\u5668","text":"<ul> <li>set\u548cmap\u7684\u4f7f\u7528</li> </ul> C++<pre><code>map&lt;string, size_t&gt; word_cnt;\nset&lt;string&gt; exclude = {\"The\", \"But\"};\n\nstring word;\nwhile(cin &gt;&gt; word)\n    // \u53ea\u7edf\u8ba1\u4e0d\u5728exclude\u4e2d\u7684\u5355\u8bcd\n    if(exclude.find(word) == exclude.end())\n        ++word_cnt[word];\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_3","title":"\u6982\u8ff0","text":"<ul> <li>\u5173\u8054\u5bb9\u5668\u4e0d\u652f\u6301\u987a\u5e8f\u5bb9\u5668\u7684\u4f4d\u7f6e\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982push_front\u6216push_back\uff1b\u56e0\u4e3a\u5173\u8054\u5bb9\u5668\u662f\u901a\u8fc7\u5173\u952e\u5b57\u5b58\u50a8\u7684</li> <li>\u5173\u8054\u5bb9\u5668\u4e0d\u652f\u6301\u6784\u9020\u51fd\u6570\u6216\u63d2\u5165\u64cd\u4f5c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_4","title":"\u5173\u952e\u5b57\u7c7b\u578b\u8981\u6c42","text":"<ul> <li>\u6709\u5e8f\u5bb9\u5668\uff1a\u4e25\u683c\u5f31\u5e8f\uff1b\u53ef\u4ee5\u770b\u4f5c\u5c0f\u4e8e\u7b49\u4e8e</li> <li>\u4f7f\u7528\u81ea\u5df1\u7684\u5b9a\u4e49\u64cd\u4f5c\uff0c\u5b9a\u4e49\u65f6\u9700\u8981\u4f20\u9012\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff08\u4e00\u79cd\u51fd\u6570\u6307\u9488\uff09</li> </ul> C++<pre><code>bool cmp(const Sales_data &amp;lhs, const Sales_data &amp;rhs)\n{\n    return lhs.isbn() &lt; rhs.isbn();\n}\n// \u6216\u8005\u4f7f\u7528\u4e00\u4e2a\u4eff\u51fd\u6570\u8fdb\u884c\u6bd4\u8f83\u64cd\u4f5c(\u53c2\u6570\u548c\u8fd4\u56de\u503c\u90fd\u5fc5\u987b\u4f7f\u7528const\u4fee\u9970)\nstruct cmp {\n    bool operator()(const int a, const int b) const {\n        return a &gt; b;\n    }\n};\nset&lt;int, cmp&gt; st;\nmap&lt;int, int, cmp&gt; mp;\n\nmultiset&lt;Sales_data, decltype(cmp)*&gt; bookstore(cmp);\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#pair","title":"pair\u7c7b\u578b","text":"C++<pre><code>pair&lt;string, int&gt; process(vector&lt;string&gt; &amp;v)\n{\n    if(!v.empty())\n        return {v.back(), v.back().size()};\n    else \n        return pair&lt;string, int&gt;(); // \u9690\u5f0f\u6784\u9020\u8fd4\u56de\u503c\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_5","title":"\u5173\u8054\u5bb9\u5668\u64cd\u4f5c","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_6","title":"\u5173\u8054\u5bb9\u5668\u8fed\u4ee3\u5668","text":"<ul> <li>\u89e3\u5f15\u7528\u5f97\u5230\u4e00\u4e2avalue_type\u7684\u503c\u7684\u5f15\u7528\uff1b\u4e0d\u80fd\u6539\u53d8\u5173\u952e\u5b57\u6210\u5458</li> <li>set\u7684\u8fed\u4ee3\u5668\u662fconst\u7684</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_7","title":"\u904d\u5386\u5173\u8054\u5bb9\u5668","text":"C++<pre><code>// \u83b7\u5f97\u4e00\u4e2a\u6307\u5411\u9996\u5143\u7d20\u7684\u8fed\u4ee3\u5668\nauto map_it = word_cnt.cbegin();\nwhile(map_it != word_cnt.cend())\n{\n    cout &lt;&lt; map_it-&gt;first &lt;&lt; map_it-&gt;second &lt;&lt; endl;\n    ++map_it;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_8","title":"\u6dfb\u52a0\u5143\u7d20","text":"<p><sub>~</sub>c++ se vector ivec = {2,2,3,4}; set set2; set2.insert(ivec.cbegin(), ivec.cend());    // set2 has 3 elements set2.insert({1,1,2,3});                     // set2 has 4 elements</p> <p>// map\u64cd\u4f5c\uff0c\u6dfb\u52a0\u5143\u7d20\u7684\u7c7b\u578b\u662fpair word_count.insert({word, 1}); word_count.insert(make_pair(word, 1)); word_count.insert(pair(word, 1)); word_count.insert(map::value_type(word, 1)); Text Only<pre><code>![](https://github.com/tom-jerr/MyblogImg/raw/main/C++/IO/insert_related_iter.png)\n\n- insert\u8fd4\u56de\u503c\u662f\u4e00\u4e2apair\uff0c\u7b2c\u4e00\u4e2a\u503c\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u6307\u5411\u5177\u6709\u5173\u952e\u5b57\u7684\u5143\u7d20\uff1b\u7b2c\u4e8c\u4e2a\u662f\u4e00\u4e2abool\u503c\n\n~~~c++\npair&lt;map&lt;string, size_t&gt;::iterator, bool&gt; ret = word_cnt.insert(make_pair(word, 1));\n</code></pre></p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_9","title":"\u5220\u9664\u5143\u7d20","text":"<ul> <li>\u63a5\u53d7\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u4e00\u5bf9\u8fed\u4ee3\u5668\u548c\u4e00\u4e2akey_type\u7684\u53c2\u6570</li> <li>erase</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#map","title":"map\u7684\u4e0b\u6807\u64cd\u4f5c","text":"<ul> <li>\u63d0\u4f9b\u4e86\u4e0b\u6807\u8fd0\u7b97\u7b26\u548cat\u64cd\u4f5c</li> </ul> <ul> <li>map\u89e3\u5f15\u7528\u8fd4\u56devalue_type\u5bf9\u8c61\uff1b\u4e0b\u6807\u8fd4\u56demapped_type\u5bf9\u8c61</li> <li>\u7531\u4e8e\u4e0b\u6807\u8fd0\u7b97\u7b26\u53ef\u80fd\u4f1a\u63d2\u5165\u4e00\u4e2a\u65b0\u5143\u7d20\uff0c\u53ea\u80fd\u5bf9\u975econst\u7684map\u4f7f\u7528\u4e0b\u6807\u64cd\u4f5c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_10","title":"\u8bbf\u95ee\u5143\u7d20","text":"<ul> <li>\u5982\u679clower_bound\u548cupper_bound\u8fd4\u56de\u76f8\u540c\u7684\u8fed\u4ee3\u5668\uff0c\u7ed9\u5b9a\u5173\u952e\u5b57\u4e0d\u5728\u5bb9\u5668\u4e2d</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_11","title":"\u65e0\u5e8f\u5bb9\u5668","text":"<ul> <li>\u4e0d\u4f7f\u7528\u6bd4\u8f83\u8fd0\u7b97\u7b26\u7ec4\u7ec7\u5143\u7d20\uff0c\u800c\u662f\u4f7f\u7528\u4e00\u4e2a\u54c8\u5e0c\u51fd\u6570\u548c\u5173\u952e\u5b57\u7c7b\u578b\u7684==\u8fd0\u7b97\u7b26\u6765\u7ec4\u7ec7\u5143\u7d20</li> <li>\u5982\u679c\u5173\u952e\u5b57\u672c\u8eab\u65e0\u5e8f\uff0c\u53ef\u4ee5\u7528\u54c8\u5e0c\u89e3\u51b3\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u65e0\u5e8f\u5bb9\u5668</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_12","title":"\u7ba1\u7406\u6876","text":"<ul> <li>\u65e0\u5e8f\u5bb9\u5668\u5b58\u50a8\u4e0a\u7ec4\u7ec7\u4e3a\u4e00\u7ec4\u6876\uff0c\u6bcf\u4e2a\u6876\u4fdd\u5b580\u6216\u591a\u4e2a\u5143\u7d20</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_13","title":"\u65e0\u5e8f\u5bb9\u5668\u5bf9\u5173\u952e\u5b57\u7c7b\u578b\u7684\u8981\u6c42","text":"<ul> <li>\u4f7f\u7528\u4e00\u4e2ahash\u7c7b\u578b\u7684\u5bf9\u8c61\u6765\u751f\u6210\u6bcf\u4e2a\u5143\u7d20\u7684hash\u503c   </li> </ul> C++<pre><code>// \u9700\u8981\u63d0\u4f9b\u51fd\u6570\u66ff\u4ee3==\u8fd0\u7b97\u7b26\u548chash\u503c\u8ba1\u7b97\u51fd\u6570\nsize_t hasher(const Sales_data &amp;sd)\n{\n    return hash&lt;string&gt;() (sd.isbn());\n}\n\nbool eqOp(const Sales_data &amp;lhs, const Sales_data &amp;rhs)\n{\n    return lhs.isbn() == rhs.isbn();\n}\n\nusing SD_multiset = unordered_multiset&lt;Sales_data, decltype(hasher)*, decltype(eqOp)*&gt;;\nSD_multiset bookstore(42, hasher, eqOp);\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/11_%E5%85%B3%E8%81%94%E5%AE%B9%E5%99%A8/#_14","title":"\u65e0\u5e8f\u5bb9\u5668\u548c\u6709\u5e8f\u7248\u672c\u4f18\u52bf","text":"<ul> <li>\u65e0\u5e8f\u7248\u672c\u6027\u80fd\u66f4\u597d\uff0c\u4f7f\u7528\u66f4\u7b80\u5355</li> <li>\u6709\u5e8f\u7248\u672c\u7ef4\u62a4\u4e86\u5173\u952e\u5b57\u7684\u5e8f</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/","title":"C++-\u52a8\u6001\u5185\u5b58","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_1","title":"\u52a8\u6001\u5185\u5b58","text":"<p> \u7ea6 1803 \u4e2a\u5b57  270 \u884c\u4ee3\u7801  7 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <ul> <li>\u9759\u6001\u5185\u5b58\u4fdd\u5b58\u5c40\u90e8static\u5bf9\u8c61\uff0c\u7c7bstatic\u6570\u636e\u6210\u5458\u4ee5\u53ca\u4efb\u4f55\u5b9a\u4e49\u5728\u4efb\u4f55\u51fd\u6570\u4e4b\u5916\u7684\u53d8\u91cf</li> <li>\u5168\u5c40\u5bf9\u8c61\u7a0b\u5e8f\u542f\u52a8\u65f6\u5206\u914d\uff0c\u5728\u7a0b\u5e8f\u7ed3\u675f\u65f6\u9500\u6bc1</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_2","title":"\u52a8\u6001\u5185\u5b58\u4e0e\u667a\u80fd\u6307\u9488","text":"<ul> <li> <p>\u6bcf\u4e2a\u7a0b\u5e8f\u6709\u4e00\u4e2a\u5185\u5b58\u6c60\uff0c\u53eb\u505a\u81ea\u7531\u7a7a\u95f4\u6216\u5806</p> </li> <li> <p>\u52a8\u6001\u5bf9\u8c61\u7684\u751f\u5b58\u671f\u7531\u7a0b\u5e8f\u6765\u63a7\u5236</p> </li> <li> <p>\u667a\u80fd\u6307\u9488\u8d1f\u8d23\u81ea\u52a8\u91ca\u653e\u6240\u6307\u5411\u7684\u5bf9\u8c61</p> </li> <li>share_ptr\u5141\u8bb8\u591a\u4e2a\u6307\u9488\u6307\u5411\u540c\u4e00\u4e2a\u5bf9\u8c61</li> <li>unique_ptr\u5219\u201c\u72ec\u5360\u201d\u6240\u6307\u5411\u7684\u5bf9\u8c61</li> <li>weak_ptr\u662f\u4e00\u79cd\u5f31\u5f15\u7528\uff0c\u6307\u5411shared_ptr\u6240\u7ba1\u7406\u7684\u5bf9\u8c61</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#shared_ptr","title":"shared_ptr\u7c7b","text":"<ul> <li>\u662f\u4e00\u4e2a\u6a21\u677f\uff0c\u9ed8\u8ba4\u521d\u59cb\u5316\u7684\u667a\u80fd\u6307\u9488\u4e2d\u4fdd\u5b58\u7740\u4e00\u4e2a\u7a7a\u6307\u9488</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#make_shared","title":"make_shared","text":"<ul> <li>\u6700\u5b89\u5168\u7684\u5206\u914d\u548c\u4f7f\u7528\u52a8\u6001\u5185\u5b58\u7684\u65b9\u6cd5</li> <li>\u5728\u52a8\u6001\u5185\u5b58\u4e2d\u5206\u914d\u4e00\u4e2a\u5bf9\u8c61\u5e76\u521d\u59cb\u5316\u5b83\uff1b\u8fd4\u56de\u6307\u5411\u8be5\u5bf9\u8c61\u7684shared_ptr</li> </ul> C++<pre><code>shared_ptr&lt;int&gt; p3 = make_shared&lt;int&gt;(42);\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#shared_ptr_1","title":"shared_ptr\u7684\u62f7\u8d1d\u548c\u8d4b\u503c","text":"<ul> <li>\u8fdb\u884c\u62f7\u8d1d\u6216\u8d4b\u503c\u64cd\u4f5c\u65f6\uff0c\u6bcf\u4e2ashared_ptr\u4f1a\u8bb0\u5f55\u6709\u591a\u5c11\u4e2a\u5176\u4ed6shared_ptr\u6307\u5411\u76f8\u540c\u7684\u5bf9\u8c61</li> </ul> C++<pre><code>auto p = make_shared&lt;int&gt;(42);  // p\u6307\u5411\u7684\u5bf9\u8c61\u53ea\u6709p\u4e00\u4e2a\u5f15\u7528\u8005\nauto q(p);                      // p\u548cq\u6307\u5411\u76f8\u540c\u5bf9\u8c61\uff1b\u8be5\u5bf9\u8c61\u6709\u4e24\u4e2a\u5f15\u7528\u8005\n</code></pre> <ul> <li>\u7528\u4e00\u4e2ashared_ptr\u521d\u59cb\u5316\u53e6\u4e00\u4e2ashared_ptr\uff0c\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\uff0c\u4f5c\u4e3a\u8fd4\u56de\u503c\u8fd4\u56de\uff1b\u6240\u5173\u8054\u7684\u8ba1\u6570\u5668\u4f1a\u9012\u589e</li> <li>\u4e3ashared_ptr\u8d4b\u65b0\u503c\uff0cshared_ptr\u88ab\u9500\u6bc1\uff1b\u8ba1\u6570\u5668\u9012\u51cf\uff1b\u8ba1\u6570\u5668\u53d8\u4e3a0\uff0c\u6307\u9488\u81ea\u52a8\u91ca\u653e\u5bf9\u8c61</li> <li>shared_ptr\u81ea\u52a8\u9500\u6bc1\u7ba1\u7406\u7684\u5bf9\u8c61\uff1b\u81ea\u52a8\u91ca\u653e\u76f8\u5173\u8054\u7684\u5185\u5b58</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_3","title":"\u5f15\u7528\u8ba1\u6570\u589e\u52a0","text":"<ul> <li>\u4e00\u4e2ashared_ptr\u521d\u59cb\u5316\u53e6\u4e00\u4e2ashared_ptr\uff0c\u65b0\u7684shared_ptr\u589e\u52a0</li> <li>\u53c2\u6570\u4f20\u9012</li> <li>\u8fd4\u56de\u4e00\u4e2ashared_ptr</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_4","title":"\u5f15\u7528\u8ba1\u6570\u51cf\u5c11","text":"<ul> <li>\u4e00\u4e2ashared_ptr\u521d\u59cb\u5316\u53e6\u4e00\u4e2ashared_ptr\uff0c\u65e7\u7684shared_ptr\u8f83\u5c11</li> <li>\u88ab\u9500\u6bc1</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_5","title":"\u76f4\u63a5\u7ba1\u7406\u5185\u5b58","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#new","title":"new","text":"<ul> <li>\u52a8\u6001\u5206\u914dconst\u5bf9\u8c61\uff0c\u5fc5\u987b\u8fdb\u884c\u521d\u59cb\u5316\uff1b\u8fd4\u56de\u7684\u6307\u9488\u662f\u4e00\u4e2a\u6307\u5411\u5e38\u91cf\u7684\u6307\u9488</li> </ul> C++<pre><code>const int *pci = new const int(1024);\nconst string *pcs = new const string\uff1b\n</code></pre> <ul> <li>\u9700\u8981\u663e\u793a\u5730\u91ca\u653e\u5185\u5b58</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#share_ptrnew","title":"share_ptr\u4e0enew\u7ed3\u5408","text":"<ul> <li>\u4f7f\u7528\u4e00\u4e2a\u5185\u7f6e\u6307\u9488\u8bbf\u95ee\u4e00\u4e2a\u667a\u80fd\u6307\u9488\u6240\u8d1f\u8d23\u7684\u5bf9\u8c61\u662f\u5371\u9669\u7684</li> <li>\u4e0d\u8981\u4f7f\u7528get\u521d\u59cb\u5316\u53e6\u4e00\u4e2a\u667a\u80fd\u6307\u9488\u6216\u4e3a\u667a\u80fd\u6307\u9488\u8d4b\u503c</li> </ul> C++<pre><code>shared_ptr&lt;int&gt; p(new int(42));\nint *q = p.get();   // \u4e0d\u8981\u8ba9q\u7ba1\u7406\u7684\u6307\u9488\u88ab\u91ca\u653e\n{\n    shared_ptr&lt;int&gt; (q);    // \u4e24\u4e2a\u72ec\u7acb\u7684shared_ptr\u6307\u5411\u76f8\u540c\u7684\u5185\u5b58\n}   // \u7a0b\u5e8f\u5757\u7ed3\u675f\uff1bq\u6307\u5411\u7684\u5185\u5b58\u88ab\u91ca\u653e\nint foo = *p;   // p\u7684\u5185\u5b58\u5df2\u7ecf\u88ab\u91ca\u653e\u4e86\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_6","title":"\u667a\u80fd\u6307\u9488\u548c\u5f02\u5e38","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_7","title":"\u5220\u9664\u5668","text":"<ul> <li>\u5b8c\u6210\u5bf9share_ptr\u4e2d\u4fdd\u5b58\u7684\u6307\u9488\u8fdb\u884c\u91ca\u653e</li> </ul> C++<pre><code>void end_connection(connection *p) { disconnect(*p); }\nvoid f(destination &amp;d) \n{\n    connection c = connect(&amp;d);\n    share_ptr&lt;connection&gt; p(&amp;c, end_connection);\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_8","title":"\u667a\u80fd\u6307\u9488\u9677\u9631","text":"<ul> <li>\u4e0d\u4f7f\u7528\u76f8\u540c\u7684\u5185\u7f6e\u6307\u9488\u503c\u521d\u59cb\u5316\u6216reset\u591a\u4e2a\u667a\u80fd\u6307\u9488</li> <li>\u4e0d\u4f7f\u7528get\u521d\u59cb\u5316\u6216reset\u53e6\u4e00\u4e2a\u667a\u80fd\u6307\u9488</li> <li>\u4f7f\u7528get\u8fd4\u56de\u7684\u6307\u9488\uff0c\u6700\u540e\u4e00\u4e2a\u5bf9\u5e94\u7684\u667a\u80fd\u6307\u9488\u9500\u6bc1\u540e\uff0c\u6307\u9488\u53d8\u4e3a\u65e0\u6548</li> <li>\u4f7f\u7528\u667a\u80fd\u6307\u9488\u7ba1\u7406\u7684\u8d44\u6e90\u4e0d\u662fnew\u5206\u914d\u7684\u5185\u5b58\uff1b\u4f20\u9012\u4e00\u4e2a\u5220\u9664\u5668</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#unique_ptr","title":"unique_ptr","text":"<ul> <li>\u67d0\u4e2a\u65f6\u523b\u667a\u80fd\u6709\u4e00\u4e2aunique_ptr\u6307\u5411\u4e00\u4e2a\u7ed9\u5b9a\u5bf9\u8c61</li> </ul> C++<pre><code>unique_ptr&lt;double&gt; p1;\nunique_ptr&lt;int&gt; p2(new int(42));\n</code></pre> <ul> <li>unique_ptr\u4e0d\u652f\u6301\u62f7\u8d1d\u548c\u8d4b\u503c\uff1b\u53ea\u6307\u5411\u4e00\u4e2a\u5bf9\u8c61</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_9","title":"\u6240\u6709\u6743\u8f6c\u79fb","text":"C++<pre><code>// \u6240\u6709\u6743\u4ecep1\u8f6c\u7ed9p2\nunique_ptr&lt;string&gt; p2(p1.release());\nunique_ptr&lt;string&gt; p3(new string(\"Trex\"));\n// \u6240\u6709\u6743\u4ecep3\u8f6c\u7ed9p2\np2.reset(p3.release()); // reset\u91ca\u653e\u4e86p2\u539f\u6765\u6307\u5411\u7684\u5185\u5b58\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#unique_ptrunique_ptr","title":"\u4f20\u9012unique_ptr\u548c\u8fd4\u56deunique_ptr","text":"<ul> <li>\u6211\u4eec\u53ef\u4ee5\u62f7\u8d1d\u6216\u8d4b\u503c\u4e00\u4e2a\u5c06\u8981\u88ab\u9500\u6bc1\u7684unique_ptr</li> </ul> C++<pre><code>unique_ptr&lt;int&gt; clone(int p)\n{\n    return unique_ptr&lt;int&gt; (new int(p));\n}\n\n// \u8fd4\u56de\u5c40\u90e8\u5bf9\u8c61\u7684\u62f7\u8d1d\nunique_ptr&lt;int&gt; clone(int p)\n{\n    unique_ptr&lt;int&gt; ret(new int(p));\n    ...\n    return ret;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#unique_ptr_1","title":"\u5411unique_ptr\u4f20\u9012\u5220\u9664\u5668","text":"<ul> <li>\u4f7f\u7528\u4e86\u51fd\u6570\u6307\u9488\u7c7b\u578b</li> </ul> C++<pre><code>void f(destiation &amp;d)\n{\n    connection c = connect(&amp;d);\n    unique_ptr&lt;connection, decltype(end_connection)*&gt; p(&amp;c, end_connection);\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#weak_ptr","title":"weak_ptr","text":"<ul> <li> <p>\u786e\u5b9ashared_ptr\u662f\u5426\u4f1a\u88ab\u91ca\u653e\u6389\uff1b\u4f7f\u7528lock\u6765\u68c0\u6d4b</p> </li> <li> <p>\u4e0d\u63a7\u5236\u5bf9\u8c61\u751f\u5b58\u671f\uff1b\u6307\u5411\u4e00\u4e2ashared_ptr\u7ba1\u7406\u7684\u5bf9\u8c61</p> </li> </ul> <p></p> <ul> <li>\u521d\u59cb\u5316\u7528shared_ptr\u6765\u521d\u59cb\u5316\uff1bwp\u4e0d\u4f1a\u6539\u53d8p\u7684\u5f15\u7528\u8ba1\u6570\uff0cwp\u6307\u5411\u7684\u5bf9\u8c61\u53ef\u80fd\u88ab\u91ca\u653e\u6389</li> </ul> C++<pre><code>auto p = make_shared&lt;int&gt;(42);\nweak_ptr&lt;int&gt; wp(p);\n</code></pre> <ul> <li>\u4e0d\u80fd\u4f7f\u7528weak_ptr\u76f4\u63a5\u8bbf\u95ee\u5bf9\u8c61\uff1b\u8c03\u7528lock</li> <li>lock\u51fd\u6570\u68c0\u67e5weak_ptr\u6307\u5411\u7684\u5bf9\u8c61\u662f\u5426\u5b58\u5728</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_10","title":"\u8bbe\u8ba1\u4f18\u52bf","text":"<ul> <li> <p>\u65b9\u4fbf\u5224\u65ad\u67d0\u4e00\u65f6\u523b<code>shared_ptr</code>\u4e2d\u662f\u5426\u5df2\u7ecf\u91ca\u653e\u5bf9\u8c61\uff1b\u907f\u514d\u591a\u6b21\u91ca\u653e</p> </li> <li> <p>\u89e3\u51b3shared_ptr\u73af\u5f62\u5f15\u7528\u95ee\u9898</p> </li> <li>\u89e3\u51b3\u8fd9\u79cd\u72b6\u51b5\u7684\u529e\u6cd5\u5c31\u662f\u5c06\u4e24\u4e2a\u7c7b\u4e2d\u7684\u4e00\u4e2a\u6210\u5458\u53d8\u91cf\u6539\u4e3a<code>weak_ptr</code>\u5bf9\u8c61\uff0c\u56e0\u4e3a<code>weak_ptr</code>\u4e0d\u4f1a\u589e\u52a0\u5f15\u7528\u8ba1\u6570\uff0c\u4f7f\u5f97\u5f15\u7528\u5f62\u4e0d\u6210\u73af\uff0c\u6700\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u7684\u91ca\u653e\u5185\u90e8\u7684\u5bf9\u8c61\uff0c\u4e0d\u4f1a\u9020\u6210\u5185\u5b58\u6cc4\u6f0f\uff0c\u6bd4\u5982\u5c06<code>CB</code>\u4e2d\u7684\u6210\u5458\u53d8\u91cf\u6539\u4e3a<code>weak_ptr</code>\u5bf9</li> </ul> <p></p> C++<pre><code>#include &lt;memory&gt;\n#include &lt;iostream&gt;\n\nclass B;\nclass A {\npublic:\n    ~A() {\n        std::cout &lt;&lt; \"~A\" &lt;&lt; std::endl;\n    }\n\n    void setPtr(std::shared_ptr&lt;B&gt;&amp; b) {\n        bPtr_ = b;\n    }\n\nprivate:\n    std::shared_ptr&lt;B&gt; bPtr_;\n};\n\nclass B {\npublic:\n    ~B() {\n        std::cout &lt;&lt; \"~B\" &lt;&lt; std::endl;\n    }\n\n    void setPtr(std::shared_ptr&lt;A&gt;&amp; a) {\n        aPtr_ = a;\n    }\n\nprivate:\n    std::shared_ptr&lt;A&gt; aPtr_;\n};\n\n// \u89e3\u51b3\u65b9\u6848\n// \u5c06B\u4e2d\u7684\u667a\u80fd\u6307\u9488\u6362\u6210weak_ptr\nint main() {\n    std::shared_ptr&lt;A&gt; aShared = std::make_shared&lt;A&gt;();\n    std::shared_ptr&lt;B&gt; bShared = std::make_shared&lt;B&gt;();\n\n    aShared-&gt;setPtr(bShared);\n    bShared-&gt;setPtr(aShared);\n\n    return 0;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_11","title":"\u52a8\u6001\u6570\u7ec4","text":"<ul> <li>\u52a8\u6001\u5206\u914d\u4e00\u4e2a\u7a7a\u6570\u7ec4\u662f\u5408\u6cd5\u7684</li> <li>\u5f97\u5230\u7684\u662f\u4e00\u4e2a\u6307\u9488\uff1b\u4e0d\u80fd\u4f7f\u7528begin()\u6216end()</li> </ul> C++<pre><code>size_t n = get_size();\nint* p = new int[n];\nfor(int * q = p; q != p + n; ++q)\n    /* \u5904\u7406\u6570\u7ec4 */\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_12","title":"\u667a\u80fd\u6307\u9488\u548c\u52a8\u6001\u6570\u7ec4","text":"<ul> <li>\u4e0d\u80fd\u4f7f\u7528.\u6216-&gt;\uff0c\u4f7f\u7528\u4e0b\u6807\u6765\u8bbf\u95ee</li> </ul> C++<pre><code>unique_ptr&lt;int[]&gt; up(new int[10]);\nup.release(); // \u81ea\u52a8\u8c03\u7528delete []\nfor(size_t i = 0; i != 10; ++i)\n    up[i] = i;\n</code></pre> <ul> <li>shared_ptr\u4e0d\u76f4\u63a5\u652f\u6301\u52a8\u6001\u6570\u7ec4\u7ba1\u7406</li> <li>\u5fc5\u987b\u81ea\u5df1\u5b9a\u4e49\u5220\u9664\u5668\u6765\u64cd\u4f5c</li> </ul> C++<pre><code>shared_ptr&lt;int&gt; sp(new int[10], [](int *p){delete[] p;});   // \u5b9a\u4e49\u5220\u9664\u5668\nfor(size_t i = 0; i != 10; ++i)\n    *(sp.get() + i) = i;    // \u4f7f\u7528get\u83b7\u53d6\u4e00\u4e2a\u5185\u7f6e\u6307\u9488\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#allocator","title":"allocator\u7c7b","text":"<ul> <li>\u5206\u914d\u7684\u5185\u5b58\u662f\u539f\u59cb\u7684\uff0c\u672a\u6784\u9020\u7684</li> <li>\u6839\u636e\u7ed9\u5b9a\u7684\u5bf9\u8c61\u7c7b\u578b\u6765\u786e\u5b9a\u6070\u5f53\u7684\u5185\u5b58\u5927\u5c0f\u548c\u5bf9\u9f50\u4f4d\u7f6e</li> </ul> C++<pre><code>allocator&lt;string&gt; alloc;\nauto const p = alloc.allocate(n);\n</code></pre> C++<pre><code>auto q = p; // q\u6307\u5411\u6700\u540e\u6784\u9020\u7684\u5143\u7d20\u4e4b\u540e\u7684\u4f4d\u7f6e\nalloc.construct(q++);           // *q is \"\"\nalloc.construct(q++, 2, 'c');   // *q is \"cc\"\nalloc.construct(q++, \"hi!\");    // *q is \"hi!\"\n</code></pre> <ul> <li>\u4f7f\u7528allocate\u8fd4\u56de\u7684\u5185\u5b58\uff0c\u5fc5\u987b\u7528constuct\u6784\u9020\u5bf9\u8c61\uff1b\u4f7f\u7528\u672a\u6784\u9020\u7684\u5185\u5b58\uff0c\u884c\u4e3a\u662f\u672a\u5b9a\u4e49\u7684</li> </ul> C++<pre><code>while(q != p)\n    alloc.destroy(--q);\n</code></pre> <ul> <li>\u53ea\u80fd\u5bf9\u771f\u6b63\u6784\u9020\u7684\u5143\u7d20\u8fdb\u884cdestroy\u64cd\u4f5c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_13","title":"\u62f7\u8d1d\u548c\u586b\u5145\u672a\u521d\u59cb\u5316\u5185\u5b58\u7b97\u6cd5","text":"C++<pre><code>auto p = alloc.allocate(vi.size() * 2);\nauto q = uninitialized_copy(vi.begin(), vi.end(), p);\nauto q = uninitialized_fill_n(q, vi.size(), 42);\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_14","title":"\u6e90\u7801","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#unique_ptr_2","title":"unique_ptr","text":"<ul> <li>\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6307\u9488\u6240\u6307\u7684\u7c7b\u578b\uff1b\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u5220\u9664\u5668\uff0c\u89c4\u5b9a\u6307\u9488\u91ca\u653e\u65f6\u7684\u64cd\u4f5c</li> <li>\u7981\u6b62\u5de6\u503c\u8d4b\u503c\u548c\u62f7\u8d1d</li> <li>\u5b9a\u4e49\u7684\u53d8\u91cf\u7c7b\u578b\u4ee5\u53ca\u51fd\u6570\u5e94\u8be5\u5728<code>__uniq_ptr_impl</code>\u7c7b\u4e2d</li> </ul> C++<pre><code>// \u6210\u5458\u53d8\u91cf\n__uniq_ptr_impl&lt;_Tp, _Dp&gt; _M_t;\n\n// Disable copy from lvalue.\nunique_ptr(const unique_ptr&amp;) = delete;\nunique_ptr&amp; operator=(const unique_ptr&amp;) = delete;\n// \u53d8\u91cf\u7c7b\u578b\nusing pointer = typename __uniq_ptr_impl&lt;_Tp,_Dp&gt;::pointer;\nusing element_type  = _Tp;\nusing deleter_type  = _Dp;\n// \u6210\u5458\u51fd\u6570\n/// Return the stored pointer.\npointer get() const noexcept\n{ return _M_t._M_ptr(); }\n\n/// Return a reference to the stored deleter.\ndeleter_type&amp; get_deleter() noexcept\n{ return _M_t._M_deleter(); }\n\n/// Return a reference to the stored deleter.\nconst deleter_type&amp; get_deleter() const noexcept\n{ return _M_t._M_deleter(); }\n\n/// Return @c true if the stored pointer is not null.\nexplicit operator bool() const noexcept\n{ return get() == pointer() ? false : true; }\n\n/// Release ownership of any stored pointer.\npointer release() noexcept\n{\n    pointer __p = get();\n    _M_t._M_ptr() = pointer();\n    return __p;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#class-__uniq_ptr_impl","title":"class __uniq_ptr_impl","text":"<ul> <li>\u5b58\u653e\u6307\u9488\u548c\u5220\u9664\u5668\u7684\u4e00\u4e2a\u7ed3\u6784</li> </ul> C++<pre><code>  template &lt;typename _Tp, typename _Dp&gt;\n    class __uniq_ptr_impl\n    {\n      // \u7528\u6765\u5f97\u5230\u6307\u9488\u7c7b\u578b\n      template &lt;typename _Up, typename _Ep, typename = void&gt;\n    struct _Ptr\n    {\n      using type = _Up*;\n    };\n    public:\n      // Constructor\n      // \u83b7\u53d6tuple\u4e2d\u7684\u5143\u7d20\n      pointer&amp;   _M_ptr() { return std::get&lt;0&gt;(_M_t); }\n      pointer    _M_ptr() const { return std::get&lt;0&gt;(_M_t); }\n      _Dp&amp;       _M_deleter() { return std::get&lt;1&gt;(_M_t); }\n      const _Dp&amp; _M_deleter() const { return std::get&lt;1&gt;(_M_t); }\n    private:\n      tuple&lt;pointer, _Dp&gt; _M_t;\n    };\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#shared_ptr_2","title":"shared_ptr","text":"<ul> <li>\u6784\u9020\u51fd\u6570\u8c03\u7528\u7684__shared_ptr\u7684\u6784\u9020\u51fd\u6570</li> <li>\u8be5\u7c7b\u6ca1\u6709\u91cd\u8f7d<code>*</code>\u548c<code>-&gt;</code>\u8fd0\u7b97\u7b26\uff0c\u4ece\u8fd9\u70b9\u770b<code>shared_ptr</code>\u4f3c\u4e4e\u65e0\u6cd5\u5b9e\u73b0\u666e\u901a\u6307\u9488\u7684\u529f\u80fd</li> <li>\u8be5\u7c7b\u6ca1\u6709\u6790\u6784\u51fd\u6570</li> <li>\u53ea\u6709\u4e00\u4e2a\u53cb\u5143\u7c7bweak_ptr</li> </ul> C++<pre><code> class shared_ptr : public __shared_ptr&lt;_Tp&gt;\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#__shared_ptr__shared_ptr_access","title":"<code>__shared_ptr&amp;__shared_ptr_access</code>","text":"<ul> <li>\u6709\u4e24\u4e2a\u7c7b\u6210\u5458\uff1a<code>_M_ptr</code>(\u7531\u667a\u80fd\u6307\u9488\u63a5\u7ba1\u7684\u666e\u901a\u6307\u9488)\u3001<code>_M_refcount</code>(\u5f15\u7528\u8ba1\u6570\u5668\uff0c\u7c7b\u578b\u4e3a<code>__shared_count</code>)   \u4ece\u6784\u9020\u51fd\u6570\u770b\uff0c<code>_M_ptr</code>\u83b7\u5f97\u4e86\u63a5\u7ba1\u7684\u666e\u901a\u6307\u9488\u7684\u503c\uff0c\u800c<code>_M_refcount</code>\u7684\u6784\u9020\u4e5f\u540c\u6837\u9700\u8981\u8fd9\u4e2a\u503c</li> <li>\u91cd\u8f7d\u4e86*\u548c-&gt;\u8fd0\u7b97\u7b26\uff0c\u7531shared_ptr\u7ee7\u627f\u4f7f\u7528\uff0c\u4f7f\u5f97\u667a\u80fd\u6307\u9488\u6700\u7ec8\u80fd\u62e5\u6709\u548c\u666e\u901a\u6307\u9488\u4e00\u6837\u884c\u4e3a\uff0c\u5c3d\u7ba1\u667a\u80fd\u6307\u9488\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u5bf9\u8c61   \u4ece\u6790\u6784\u51fd\u6570\u6765\u770b\uff0c\u91cc\u9762\u5565\u4e5f\u6ca1\u505a\uff0c\u8bf4\u660e\u63a5\u7ba1\u7684\u666e\u901a\u6307\u9488\u4e5f\u4e0d\u662f\u5728\u8fd9\u91cc\u91ca\u653e\u7684\uff0c\u6240\u4ee5\u6709\u53ef\u80fd\u662f\u7531_M_refcount\u6765\u5b8c\u6210\u91ca\u653e\u5185\u5b58\u8fd9\u4e2a\u5de5\u4f5c\uff0c\u4e0b\u9762\u5206\u6790__shared_count\u7684\u5b9e\u73b0</li> <li>\u5c06weak_ptr\u4f5c\u4e3a\u53cb\u5143</li> </ul> C++<pre><code> // Define operator-&gt; for shared_ptr&lt;cv void&gt;.\n // __shared_ptr_access&lt;_Tp, _Lp, false, true&gt;\n      using element_type = _Tp;\n\n      element_type*\n      operator-&gt;() const noexcept\n      {\n    auto __ptr = static_cast&lt;const __shared_ptr&lt;_Tp, _Lp&gt;*&gt;(this)-&gt;get();\n    _GLIBCXX_DEBUG_PEDASSERT(__ptr != nullptr);\n    return __ptr;\n      }\n\n// __shared_ptr\nelement_type*      _M_ptr;         // Contained pointer.\n__shared_count&lt;_Lp&gt;  _M_refcount;    // Reference counter.\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#__shared_count","title":"__shared_count","text":"<ul> <li>\u5728<code>__Sp_counted_ptr</code>\u4e2d\u7ee7\u627f<code>__M_dispose</code>\u51fd\u6570\u548c<code>__M_destroy</code>\u51fd\u6570</li> <li><code>__shared_count</code>\u4e2d\u7684<code>_Sp_counted_base&lt;_Lp&gt;*  _M_pi</code>\u6210\u5458\u7531<code>__Sp_counted_ptr</code>\u6765\u521d\u59cb\u5316</li> </ul> C++<pre><code>// __Sp_counted_ptr\n// user_count = 0;\u5220\u9664\u6307\u9488\u4ee5\u53ca\u6574\u4e2a\u7a7a\u95f4\nvirtual void\n_M_dispose() noexcept\n{ delete _M_ptr; }\n// weak_count = 0;\u91ca\u653e__Sp_counted_ptr\u5bf9\u8c61\nvirtual void\n_M_destroy() noexcept\n{ delete this; }\n\n// __shared_count\n_M_pi = new _Sp_counted_ptr&lt;_Ptr, _Lp&gt;(__p);\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#__sp_counted_base__sp_counted_ptr","title":"__Sp_counted_base&amp;&amp;__Sp_counted_ptr","text":"<ul> <li>\u5b9e\u73b0\u8ba1\u6570\u5668\u7684\u589e\u51cf</li> <li>\u63d0\u4f9b\u4e86\u91ca\u653e\u6307\u9488\u548c\u91ca\u653e\u8ba1\u6570\u5668\u5bf9\u8c61\u7684\u865a\u51fd\u6570</li> </ul> C++<pre><code>// \u5b9e\u73b0\u8ba1\u6570\u5668\u7684\u589e\u51cf\u548c\u5bf9\u8c61\u7684\u9500\u6bc1(user_count)\n// user_count and weak_count\n\n      // Called when _M_use_count drops to zero, to release the resources\n      // managed by *this.\n      virtual void\n      _M_dispose() noexcept = 0;\n\n      // Called when _M_weak_count drops to zero.\n      virtual void\n      _M_destroy() noexcept\n      { delete this; }\n\n  template&lt;&gt;\n    inline void\n    _Sp_counted_base&lt;_S_single&gt;::_M_add_ref_copy()\n    { ++_M_use_count; }\n\n  template&lt;&gt;\n    inline void\n    _Sp_counted_base&lt;_S_single&gt;::_M_release() noexcept\n    {\n      if (--_M_use_count == 0)\n        {\n          _M_dispose();\n          if (--_M_weak_count == 0)\n            _M_destroy();\n        }\n    }\n\n  template&lt;&gt;\n    inline void\n    _Sp_counted_base&lt;_S_single&gt;::_M_weak_add_ref() noexcept\n    { ++_M_weak_count; }\n\n  template&lt;&gt;\n    inline void\n    _Sp_counted_base&lt;_S_single&gt;::_M_weak_release() noexcept\n    {\n      if (--_M_weak_count == 0)\n        _M_destroy();\n    }\n\n  template&lt;&gt;\n    inline long\n    _Sp_counted_base&lt;_S_single&gt;::_M_get_use_count() const noexcept\n    { return _M_use_count; }\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#weak_ptr_1","title":"weak_ptr","text":"<ul> <li>\u6709\u4e00\u4e2a__weak_count\u548c\u4e00\u4e2a\u6307\u9488</li> </ul> C++<pre><code>// \u6210\u5458\nelement_type*    _M_ptr;         // Contained pointer.\n__weak_count&lt;_Lp&gt;  _M_refcount;    // Reference counter.\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#__weak_count","title":"__weak_count","text":"<ul> <li>\u4e0eshared_count\u76f8\u4f3c\uff0c\u7ee7\u627f\u7236\u7c7b\u51fd\u6570\u8fdb\u884c\u5f15\u7528\u8ba1\u6570\u7684\u52a0\u51cf</li> </ul> C++<pre><code>_Sp_counted_base&lt;_Lp&gt;*  _M_pi;\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#__enable_shared_from_this","title":"__enable_shared_from_this","text":"<ul> <li>\u5c06weak_ptr\u8f6c\u5316\u4e3ashared_ptr</li> </ul> C++<pre><code>__shared_ptr&lt;_Tp, _Lp&gt;\nshared_from_this()\n{ return __shared_ptr&lt;_Tp, _Lp&gt;(this-&gt;_M_weak_this); }\n\n__shared_ptr&lt;const _Tp, _Lp&gt;\nshared_from_this() const\n{ return __shared_ptr&lt;const _Tp, _Lp&gt;(this-&gt;_M_weak_this); }\n\nfriend const __enable_shared_from_this*\n__enable_shared_from_this_base(const __shared_count&lt;_Lp&gt;&amp;,\nconst __enable_shared_from_this* __p)\n{ return __p; }\n\n// \u6210\u5458\u53d8\u91cf\nmutable __weak_ptr&lt;_Tp, _Lp&gt;  _M_weak_this;\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#enable_shared_from_this","title":"enable_shared_from_this","text":"C++<pre><code>shared_ptr&lt;_Tp&gt;\nshared_from_this()\n{ return shared_ptr&lt;_Tp&gt;(this-&gt;_M_weak_this); }\n\nshared_ptr&lt;const _Tp&gt;\nshared_from_this() const\n{ return shared_ptr&lt;const _Tp&gt;(this-&gt;_M_weak_this); }\n\nfriend const __enable_shared_from_this*\n__enable_shared_from_this_base(const __shared_count&lt;_Lp&gt;&amp;,\nconst __enable_shared_from_this* __p)\n{ return __p; }\n\n// \u6210\u5458\u53d8\u91cf\nmutable __weak_ptr&lt;_Tp, _Lp&gt;  _M_weak_this;\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#delete-this","title":"delete this","text":"<ul> <li>\u91ca\u653e\u7ba1\u7406\u7684\u5bf9\u8c61</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/12_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98/#_15","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u4f60\u5fc5\u987b100%\u7edd\u5bf9\u786e\u4fdd\u201dthis\u201d\u5bf9\u8c61\u662f\u901a\u8fc7new\u5206\u914d\u7684\uff08\u4e0d\u662f\u901a\u8fc7new[]\uff0c\u4e0d\u662fplacement new\uff0c\u4e0d\u662f\u6808\u4e0a\u7684\u5c40\u90e8\u5bf9\u8c61\uff0c\u4e0d\u662f\u5168\u5c40\u5bf9\u8c61\uff0c\u4e0d\u662f\u53e6\u4e00\u4e2a\u5bf9\u8c61\u7684\u6570\u636e\u6210\u5458\uff1b\u4ec5\u4ec5\u53ea\u662f\u901a\u8fc7\u539f\u59cb\u7684new\u8fd0\u7b97\u7b26\uff09</li> <li>\u4f60\u5fc5\u987b100%\u7edd\u5bf9\u786e\u4fdd\u8c03\u7528\u201ddelete this\u201d\u64cd\u4f5c\u7684\u6210\u5458\u51fd\u6570\u662f\u6700\u540e\u8c03\u7528\u7684\u6210\u5458\u51fd\u6570</li> <li>\u4f60\u5fc5\u987b100%\u7edd\u5bf9\u786e\u4fdd\u5728\u5f53\u524d\u51fd\u6570\u4e2d\u201ddelete this\u201d\u540e\uff0c\u8c03\u7528\u7684\u5176\u4ed6\u6210\u5458\u51fd\u6570\u4e0d\u4f1a\u8bfb\u53d6\u201dthis\u201d\u5bf9\u8c61\u3002</li> <li>\u4f60\u5fc5\u987b100%\u786e\u4fdd\u518d\u4e5f\u4e0d\u4f1a\u4f7f\u7528\u201dthis\u201d\u6307\u9488\u3002\u5373\u4f7f\u4f60\u4f7f\u7528this\u6307\u9488\u548c\u5176\u4ed6\u6307\u9488\u6bd4\u8f83\uff0c\u4f8b\u5982nullptr\uff0c\u6253\u5370this\u6307\u9488\uff0c\u8f6c\u6362this\u6307\u9488\u7b49\u7b49\u3002</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/","title":"C++-\u62f7\u8d1d\u63a7\u5236","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_1","title":"\u62f7\u8d1d\u63a7\u5236","text":"<p> \u7ea6 2093 \u4e2a\u5b57  140 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_2","title":"\u62f7\u8d1d\u3001\u8d4b\u503c\u4e0e\u9500\u6bc1","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_3","title":"\u62f7\u8d1d\u6784\u9020\u51fd\u6570","text":"<ul> <li> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u81ea\u8eab\u7c7b\u7c7b\u578b\u7684\u5f15\u7528\uff0c\u6240\u6709\u5176\u4ed6\u53c2\u6570\u5747\u6709\u9ed8\u8ba4\u503c</p> </li> <li> <p>\u9010\u4e2a\u62f7\u8d1d\u975estatic\u6210\u5458\uff1b\u5185\u7f6e\u7c7b\u578b\u6210\u5458\u76f4\u63a5\u5185\u5b58\u62f7\u8d1d\uff1b\u7c7b\u7c7b\u578b\u6210\u5458\uff0c\u8c03\u7528\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u62f7\u8d1d</p> </li> </ul> C++<pre><code>string dots(10, '.');   // \u76f4\u63a5\u521d\u59cb\u5316\nstring s(dots);         // \u76f4\u63a5\u521d\u59cb\u5316\nstring s2 = dots;       // \u62f7\u8d1d\u521d\u59cb\u5316\nstring null_book = \"99\" // \u62f7\u8d1d\u521d\u59cb\u5316 \n</code></pre> <ul> <li>\u62f7\u8d1d\u521d\u59cb\u5316</li> <li>\u201c=\u201d</li> <li>\u4e00\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u5b9e\u53c2\u4f20\u9012\u7ed9\u4e00\u4e2a\u975e\u5f15\u7528\u7c7b\u578b\u7684\u5f62\u53c2</li> <li>\u4ece\u4e00\u4e2a\u8fd4\u56de\u7c7b\u578b\u4e3a\u975e\u5f15\u7528\u7c7b\u578b\u7684\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61</li> <li>\u7528\u82b1\u62ec\u53f7\u5217\u8868\u521d\u59cb\u5316\u4e00\u4e2a\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u6216\u4e00\u4e2a\u805a\u5408\u7c7b\u7684\u6210\u5458</li> <li>\u5bb9\u5668\u8c03\u7528insert\u6216push\u64cd\u4f5c\u65f6</li> <li> <p>\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u7684\u5f62\u53c2\u5fc5\u987b\u662f\u5f15\u7528\u7c7b\u578b</p> </li> <li> <p>\u7f16\u8bd1\u5668\u53ef\u4ee5\u7ed5\u8fc7\u62f7\u8d1d\u6784\u9020\u51fd\u6570</p> </li> </ul> C++<pre><code>string null_book = \"9-99\";\n// \u6539\u5199\u4e3a\nstring null_book(\"9-99\"); // \u7f16\u8bd1\u5668\u7565\u8fc7\u4e86\u62f7\u8d1d\u6784\u9020\u51fd\u6570\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_4","title":"\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26","text":"<ul> <li>\u8d4b\u503c\u8fd0\u7b97\u7b26\u901a\u5e38\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u5176\u5de6\u4fa7\u8fd0\u7b97\u5bf9\u8c61\u7684\u5f15\u7528</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_5","title":"\u5408\u6210\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26","text":"<ul> <li>\u7c7b\u672a\u5b9a\u4e49\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26\uff0c\u7f16\u8bd1\u5668\u4f1a\u751f\u6210\u4e00\u4e2a\u5408\u6210\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26</li> <li>\u5c06\u53f3\u4fa7\u8fd0\u7b97\u5bf9\u8c61\u7684\u6bcf\u4e2a\u975estatic\u6210\u5458\u8d4b\u4e88\u5de6\u4fa7\u8fd0\u7b97\u5bf9\u8c61\u7684\u5bf9\u5e94\u6210\u5458</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_6","title":"\u6790\u6784\u51fd\u6570","text":"<ul> <li>\u91ca\u653e\u5bf9\u8c61\u4f7f\u7528\u7684\u8d44\u6e90\uff0c\u9500\u6bc1\u5bf9\u8c61\u7684\u975estatic\u6570\u636e\u6210\u5458</li> <li>\u4e0d\u63a5\u53d7\u53c2\u6570\uff0c\u4e0d\u80fd\u88ab\u91cd\u8f7d</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_7","title":"\u5b8c\u6210\u5de5\u4f5c","text":"<ul> <li>\u6267\u884c\u51fd\u6570\u4f53\uff1b\u9500\u6bc1\u6210\u5458\uff0c\u6309\u521d\u59cb\u5316\u987a\u5e8f\u7684\u9006\u5e8f\u9500\u6bc1</li> <li>\u9690\u5f0f\u9500\u6bc1\u4e00\u4e2a\u5185\u7f6e\u6307\u9488\u7c7b\u578b\u7684\u6210\u5458\u4e0d\u4f1adelete\u5b83\u6240\u6307\u5411\u7684\u5bf9\u8c61</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_8","title":"\u8c03\u7528\u65f6\u673a","text":"<ul> <li>\u5bf9\u8c61\u88ab\u9500\u6bc1\uff0c\u81ea\u52a8\u8c03\u7528\u5176\u6790\u6784\u51fd\u6570</li> <li>\u6307\u5411\u4e00\u4e2a\u5bf9\u8c61\u7684\u5f15\u7528\u6216\u6307\u9488\u79bb\u5f00\u4f5c\u7528\u57df\uff0c\u6790\u6784\u51fd\u6570\u4e0d\u4f1a\u6267\u884c\uff08delete \u5bf9\u8c61\u6307\u9488\uff09</li> </ul> C++<pre><code>bool fcn(const Sales_data *trans, Sales_data accum)\n{\n    Sales_data item(*trans), item2(accum);\n    return item1.isbn() != item2.isbn();\n}\n// \u8c03\u75283\u6b21\u6790\u6784\u51fd\u6570\n// item1, item2, accum\n// trans\u662f\u6307\u9488\uff0c\u4e0d\u6267\u884c\u6790\u6784\u51fd\u6570\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_9","title":"\u4e09/\u4e94\u6cd5\u5219","text":"<ul> <li>\u9700\u8981\u6790\u6784\u51fd\u6570\u7684\u7c7b\u4e5f\u9700\u8981\u62f7\u8d1d\u548c\u8d4b\u503c\u64cd\u4f5c</li> <li>\u9700\u8981\u62f7\u8d1d\u7684\u7c7b\u4e5f\u9700\u8981\u8d4b\u503c\u64cd\u4f5c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#default","title":"\u4f7f\u7528=default","text":"<ul> <li>\u663e\u793a\u8981\u6c42\u7f16\u8bd1\u5668\u751f\u6210\u5408\u6210\u7248\u672c\u7684\u51fd\u6570</li> </ul> C++<pre><code>class Sales_data\n{\npublic:\n    Sales_data()=default;\n    Sales_data(const Sales_data&amp;)=default;\n    Sales_data&amp; operator=(const Sales_data&amp;);\n    ~Sales_data()=default;\n};\nSales_data&amp; Sales_data::operator=(const Sales_data&amp;)=default;\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_10","title":"\u963b\u6b62\u62f7\u8d1d","text":"<ul> <li> <p>\u5b9a\u4e49\u5220\u9664\u7684\u51fd\u6570\uff1a=delete\uff1b\u6211\u4eec\u53ef\u4ee5\u5bf9\u4efb\u4f55\u51fd\u6570\u6307\u5b9a=delete</p> </li> <li> <p>\u4e0d\u80fd\u5220\u9664\u6790\u6784\u51fd\u6570</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_11","title":"\u5408\u6210\u7684\u62f7\u8d1d\u63a7\u5236\u6210\u5458\u53ef\u80fd\u662f\u5220\u9664\u7684","text":"<ul> <li>\u4e00\u4e2a\u7c7b\u6709\u6570\u636e\u6210\u5458\u4e0d\u80fd\u9ed8\u8ba4\u6784\u9020\u3001\u62f7\u8d1d\u3001\u590d\u5236\u6216\u9500\u6bc1\uff0c\u5bf9\u5e94\u7684\u6210\u5458\u51fd\u6570\u5c06\u88ab\u5b9a\u4e49\u4e3a\u5220\u9664\u7684</li> <li>\u4e00\u4e2a\u7c7b\u6709const\u6210\u5458\uff0c\u4e0d\u80fd\u4f7f\u7528\u5408\u6210\u7684\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26\uff1b\u5408\u6210\u7684\u8bd5\u56fe\u8d4b\u503c\u6240\u6709\u6210\u5458</li> <li>\u4e00\u4e2a\u7c7b\u6709\u5f15\u7528\u6210\u5458\uff0c\u4e0d\u4f7f\u7528\u5408\u6210\u7684\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26\uff1b\u5408\u6210\u7684\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26\u53ea\u662f\u4fee\u6539\u5f15\u7528\u6307\u5411\u7684\u5bf9\u8c61\u7684\u503c\uff0c\u6ca1\u6709\u6539\u53d8\u5f15\u7528\u5bf9\u8c61\uff1b</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#private","title":"private\u62f7\u8d1d\u63a7\u5236","text":"<ul> <li>\u963b\u6b62\u62f7\u8d1d\uff1a\u5c06\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26\uff0c\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u58f0\u660e\u4e3aprivate\u7684\uff1b</li> <li>\u4e3a\u4e86\u653e\u7f6e\u53cb\u5143\u4f7f\u7528\uff0c\u53ea\u58f0\u660e\u4f46\u4e0d\u5b9a\u4e49</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_12","title":"\u62f7\u8d1d\u63a7\u5236\u548c\u8d44\u6e90\u7ba1\u7406","text":"<ul> <li>\u5b9a\u4e49\u4e00\u4e2a\u7c7b\u7684\u62f7\u8d1d\u64cd\u4f5c\uff0c\u7c7b\u7684\u884c\u4e3a\u50cf\u4e00\u4e2a\u503c\u6216\u50cf\u4e00\u4e2a\u6307\u9488</li> <li>\u7c7b\u7684\u884c\u4e3a\u50cf\u4e00\u4e2a\u503c\uff1a</li> <li>\u62e5\u6709\u81ea\u5df1\u7684\u72b6\u6001\uff1b\u526f\u672c\u548c\u539f\u5bf9\u8c61\u662f\u5b8c\u5168\u72ec\u7acb\u7684\uff0c\u6539\u53d8\u526f\u672c\u4e0d\u4f1a\u5bf9\u539f\u5bf9\u8c61\u6709\u4efb\u4f55\u5f71\u54cd</li> <li>\u7c7b\u884c\u4e3a\u50cf\u6307\u9488\uff1a</li> <li>\u5171\u4eab\u72b6\u6001\uff1b\u526f\u672c\u548c\u539f\u5bf9\u8c61\u4f7f\u7528\u76f8\u540c\u7684\u5e95\u5c42\u6570\u636e</li> <li>string\u7c7b\u548c\u6807\u51c6\u5e93\u5bb9\u5668\u7c7b\u7684\u884c\u4e3a\u50cf\u4e00\u4e2a\u503c\uff1bshared_ptr\u7c7b\u63d0\u4f9b\u7c7b\u4f3c\u6307\u9488\u7684\u884c\u4e3a</li> <li>IO\u7c7b\u578b\u548cunique_ptr\u4e0d\u5141\u8bb8\u62f7\u8d1d\u548c\u8d4b\u503c\uff0c\u884c\u4e3a\u65e2\u4e0d\u50cf\u503c\u4e5f\u4e0d\u50cf\u6307\u9488</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_13","title":"\u884c\u4e3a\u50cf\u503c\u7684\u7c7b","text":"<ul> <li>\u5b9a\u4e49\u4e00\u4e2a\u62f7\u8d1d\u6784\u9020\u51fd\u6570\uff1b\u5b8c\u6210string\u7684\u62f7\u8d1d\uff1b\u800c\u4e0d\u662f\u6307\u9488\u7684\u62f7\u8d1d</li> <li>\u5b9a\u4e49\u4e00\u4e2a\u6790\u6784\u51fd\u6570\u91ca\u653estring</li> <li>\u5b9a\u4e49\u4e00\u4e2a\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26\u91ca\u653e\u5f53\u524dstring\uff0c\u5e76\u4ece\u53f3\u4fa7\u8fd0\u7b97\u5bf9\u8c61\u62f7\u8d1dstring</li> </ul> C++<pre><code>class HasPtr\n{\npublic:\n    HasPtr(const std::string &amp;s = std::string()): \\\n        ps(new std::string(s), i(0)){}\n    HasPtr(const HasPtr &amp;p) : ps(new std::string(*p.ps)), i(p.i){}\n    HasPtr&amp; operator=(const HasPtr &amp;);\n    ~HasPtr(){delete ps;}\nprivate:\n    std::string *ps;\n    int i;\n};\n\nHasPtr&amp; HasPtr::operator=(const HasPtr &amp;rhs)\n{\n    auto newp = new string(*rhs.ps);\n    delete ps;\n    ps = newp;\n    i = rhs.i;\n    return *this;\n}\n</code></pre> <ul> <li>\u8d4b\u503c\u8fd0\u7b97\u7b26\uff1a\u5148\u5c06\u53f3\u4fa7\u8fd0\u7b97\u5bf9\u8c61\u62f7\u8d1d\u5230\u4e00\u4e2a\u5c40\u90e8\u4e34\u65f6\u5bf9\u8c61\u4e2d\uff1b\u5c06\u4e34\u65f6\u5bf9\u8c61\u4e2d\u7684\u6210\u5458\u62f7\u8d1d\u5230\u5de6\u4fa7\u8fd0\u7b97\u5bf9\u8c61\u6210\u5458\u4e2d</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_14","title":"\u5b9a\u4e49\u884c\u4e3a\u4e0a\u50cf\u6307\u9488\u7684\u7c7b","text":"<ul> <li>\u6700\u597d\u65b9\u6cd5\u662f\u4f7f\u7528shared_ptr\u7ba1\u7406\u7c7b\u4e2d\u7684\u8d44\u6e90</li> <li>\u5e0c\u671b\u76f4\u63a5\u7ba1\u7406\u8d44\u6e90\uff0c\u4f7f\u7528\u5f15\u7528\u8ba1\u6570</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_15","title":"\u5f15\u7528\u8ba1\u6570","text":"<ul> <li>\u521d\u59cb\u5316\u5bf9\u8c61\u5916\uff0c\u6bcf\u4e2a\u6784\u9020\u51fd\u6570\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u5f15\u7528\u8ba1\u6570</li> <li>\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u4e0d\u5206\u914d\u65b0\u7684\u8ba1\u6570\u5668\uff1b\u9012\u589e\u5171\u4eab\u7684\u8ba1\u6570\u5668</li> <li>\u6790\u6784\u51fd\u6570\u9012\u51cf\u8ba1\u6570\u5668</li> <li>\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26\u9012\u589e\u53f3\u4fa7\u5bf9\u8c61\u8ba1\u6570\u5668\uff0c\u9012\u51cf\u5de6\u4fa7\u5bf9\u8c61\u8ba1\u6570\u5668</li> <li>\u5c06\u8ba1\u6570\u5668\u4fdd\u5b58\u5728\u52a8\u6001\u5185\u5b58\u4e2d\uff1b\u62f7\u8d1d\u6307\u5411\u8ba1\u6570\u5668\u7684\u6307\u9488</li> </ul> C++<pre><code>class HasPtr {\npublic:\n    HasPtr(const string&amp; s = string()) :\n        ps(new string(s)), i(0), use(new size_t(1)){}\n    HasPtr(const HasPtr&amp; p): ps(p.ps), i(p.i), use(++*use);\n    HasPtr&amp; operator=(const HasPtr&amp;);\n    ~HasPtr;\nprivate:\n    string *ps;\n    int i;\n    size_t *use;\n};\n\nHasPtr::~HasPtr() {\n    if(--*use == 0) {\n        delete ps;\n        delete use;\n    }\n}\n\nHasPtr&amp; HasPtr::operator=(const HasPtr&amp; rhs) {\n    ++*rhs.use;\n    if(--*use == 0) {\n        delete ps;\n        delete use;\n    }\n    ps = rhs.ps;\n    i = rhs.i;\n    use = rhs.use;\n    return *this;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_16","title":"\u4ea4\u6362\u64cd\u4f5c","text":"<ul> <li>\u9ed8\u8ba4swap\u4ea4\u6362\u4e24\u4e2a\u5bf9\u8c61\u7684\u975e\u9759\u6001\u6210\u5458\uff1bv1\u4e24\u6b21\u88ab\u62f7\u8d1d\uff0c\u8fd9\u4e9b\u62f7\u8d1d\u4e0d\u662f\u5fc5\u8981\u7684</li> </ul> C++<pre><code>HasPtr tmp = v1;\nv1 = v2;\nv2 = tmp;\n</code></pre> <ul> <li>\u6211\u4eec\u6709\u65f6\u5e0c\u671bswap\u4ea4\u6362\u6307\u9488\uff0c\u800c\u4e0d\u662f\u5206\u914d\u65b0\u526f\u672c\uff1b\u53ef\u4ee5\u7f16\u5199\u6211\u4eec\u81ea\u5df1\u7684swap\u51fd\u6570</li> </ul> C++<pre><code>friend void swap(HasPtr&amp;, HasPtr&amp;);\n\ninline void swap(HasPtr&amp; lhs, HasPtr&amp; rhs) {\n    using std::swap;\n    swap(lhs.ps, rhs.ps);\n    swap(lhs.i, rhs.i);\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#swap","title":"\u8d4b\u503c\u8fd0\u7b97\u7b26\u4e2d\u4f7f\u7528swap","text":"<ul> <li>\u62f7\u8d1d\u5e76\u4ea4\u6362\uff1a\uff08\u53c2\u6570\u6309\u503c\u4f20\u9012\uff0c\u8fdb\u884c\u62f7\u8d1d\uff09</li> <li>rhs\u662f\u53f3\u4fa7\u5bf9\u8c61\u7684\u4e00\u4e2a\u526f\u672c\uff1b\u4f7f\u7528swap\u4ea4\u6362*this\u548crhs\u7684\u6570\u636e\u6210\u5458\uff1b\u662f\u5f02\u5e38\u5b89\u5168\u7684\uff0c\u53ef\u4ee5\u6b63\u786e\u5904\u7406\u81ea\u8d4b\u503c </li> </ul> C++<pre><code>// rhs\u662f\u6309\u503c\u4f20\u9012\u7684\uff0cHasPtr\u7684\u62f7\u8d1d\u6784\u9020\u51fd\u6570\nHasPtr&amp; HasPtr::operator=(HasPtr rhs)\n{\n    swap(*this, rhs);\n    return *this; // rhs\u88ab\u9500\u6bc1\uff0cdelete\u4e86rhs\u4e2d\u7684\u6307\u9488\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_17","title":"\u62f7\u8d1d\u63a7\u5236\uff08\u89c1\u4e66\u4e2d\u4ee3\u7801\uff09","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_18","title":"\u52a8\u6001\u5185\u5b58\u7ba1\u7406\u7c7b","text":"<ul> <li>\u67d0\u4e9b\u7c7b\u9700\u8981\u81ea\u5df1\u8fdb\u884c\u5185\u5b58\u5206\u914d\uff1b\u4e00\u822c\u5b9a\u4e49\u81ea\u5df1\u7684\u62f7\u8d1d\u63a7\u5236\u6210\u5458\u6765\u7ba1\u7406\u5206\u914d\u7684\u5185\u5b58</li> <li>\u91cd\u65b0\u5206\u914d\u5185\u5b58\u7684\u8fc7\u7a0b\u4e2d\u79fb\u52a8\u800c\u4e0d\u662f\u62f7\u8d1d\u5143\u7d20</li> <li>\u4f7f\u7528allocator\u83b7\u5f97\u539f\u59cb\u5185\u5b58</li> <li>\u4e09\u4e2a\u6307\u9488\u6210\u5458\u6307\u5411\u5143\u7d20\u4f7f\u7528\u7684\u5185\u5b58</li> <li>elements\uff1a\u5206\u914d\u5185\u5b58\u4e2d\u7684\u9996\u5143\u7d20</li> <li>first_free\uff1a\u6700\u540e\u4e00\u4e2a\u5b9e\u9645\u5143\u7d20\u7684\u4f4d\u7f6e</li> <li>cap\uff1a\u5206\u914d\u5185\u5b58\u672b\u5c3e\u7684\u4f4d\u7f6e</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#stdmove","title":"\u79fb\u52a8\u6784\u9020\u548cstd::move","text":"<ul> <li>\u4f7f\u7528\u79fb\u52a8\u6784\u9020\u51fd\u6570\uff0cstring\u7ba1\u7406\u7684\u5185\u5b58\u4e0d\u4f1a\u88ab\u62f7\u8d1d\uff1b\u4f1a\u88ab\u6784\u9020\u7684\u65b0\u7684\u5143\u7d20\u63a5\u7ba1\u5185\u5b58\u7684\u6240\u6709\u6743</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_19","title":"\u5bf9\u8c61\u79fb\u52a8","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_20","title":"\u53f3\u503c\u5f15\u7528","text":"<ul> <li>\u5fc5\u987b\u7ed1\u5b9a\u5230\u53f3\u503c\u7684\u5f15\u7528\uff1b\u53ea\u80fd\u7ed1\u5b9a\u5230\u5c06\u8981\u9500\u6bc1\u7684\u5bf9\u8c61</li> <li>const\u5de6\u503c\u5f15\u7528\u53ef\u4ee5\u7ed1\u5b9a\u5230\u53f3\u503c\u4e0a</li> <li>\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u5c06\u8981\u88ab\u9500\u6bc1\uff1b\u5bf9\u8c61\u6ca1\u6709\u5176\u4ed6\u7528\u6237</li> <li>\u4f7f\u7528noexcept\u544a\u77e5\u6807\u51c6\u5e93\u6211\u4eec\u7684\u79fb\u52a8\u6784\u9020\u51fd\u6570\u53ef\u4ee5\u5b89\u5168\u4f7f\u7528</li> <li>\u79fb\u52a8\u540e\u6e90\u5bf9\u8c61\u5fc5\u987b\u53ef\u6790\u6784\uff1a\u5c06\u79fb\u540e\u6e90\u5bf9\u8c61\u6307\u9488\u8d4b\u503cnullptr</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#move","title":"move\u51fd\u6570","text":"<ul> <li> <p>\u5c06\u4e00\u4e2a\u5de6\u503c\u8f6c\u6362\u4e3a\u76f8\u5e94\u7684\u53f3\u503c\u5f15\u7528\u7c7b\u578b</p> </li> <li> <p>\u5185\u90e8\u5b9e\u73b0\uff1a\u4f7f\u7528\u5f15\u7528\u6298\u53e0\u548cstatic_cast\u5f3a\u5236\u8f6c\u6362\u6210\u53f3\u503c\u5f15\u7528\u7c7b\u578b</p> </li> <li> <p>\u4f7f\u7528remove_reference</p> C++<pre><code>template&lt;typename _Tp&gt;\nstruct remove_reference\n{ typedef _Tp   type; };\n\n// \u7279\u5316\u7248\u672c\ntemplate&lt;typename _Tp&gt;\nstruct remove_reference&lt;_Tp&amp;&gt;\n{ typedef _Tp   type; };\n\ntemplate&lt;typename _Tp&gt;\nstruct remove_reference&lt;_Tp&amp;&amp;&gt;\n{ typedef _Tp   type; };\n</code></pre> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_21","title":"\u79fb\u52a8\u6784\u9020\u51fd\u6570\u548c\u79fb\u52a8\u8d4b\u503c\u8fd0\u7b97\u7b26","text":"<ul> <li>\u5b8c\u6210\u8d44\u6e90\u79fb\u52a8\u540e\uff0c\u4ee5\u54e6\u5bf9\u90a3\u4e2a\u6784\u9020\u51fd\u6570\u786e\u4fdd\u79fb\u52a8\u540e\u6e90\u5bf9\u8c61\u4e0d\u518d\u6307\u5411\u88ab\u79fb\u52a8\u7684\u8d44\u6e90</li> </ul> C++<pre><code>StrVec::StrVec(StrVec &amp;&amp;s) noexcept \\\n: elements(s.elements), first_free(s.first_free), cap(s.cap)\n{\n    s.elements = s.first_free = s.cap = nullptr;\n}\n\nStrVec&amp; StrVec::operator=(StrVec &amp;&amp;rhs) noexcept \\\n{\n    if(this != &amp;rhs)\n    {\n        free(); // \u91ca\u653e\u5df2\u6709\u5143\u7d20\n        elements = rhs.elements;\n        first_free = rhs.first_free;\n        cap = rhs.cap;\n        rhs.elements = rhs.first_free = rhs.cap = nullptr;\n    }\n    return *this;\n}\n</code></pre> <ul> <li>\u79fb\u52a8\u540e\u6e90\u5bf9\u8c61\u5fc5\u987b\u53ef\u6790\u6784\uff1b\u5c06\u6e90\u5bf9\u8c61\u7684\u6307\u9488\u7f6e\u4e3a\u7a7a</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_22","title":"\u5408\u6210\u79fb\u52a8\u64cd\u4f5c","text":"<ul> <li>\u53ea\u6709\u4e00\u4e2a\u7c7b\u6ca1\u6709\u5b9a\u4e49\u4efb\u4f55\u81ea\u5df1\u7248\u672c\u7684\u62f7\u8d1d\u63a7\u5236\u6210\u5458\uff1b\u4e14\u6bcf\u4e2a\u975estatic\u6210\u5458\u90fd\u53ef\u4ee5\u79fb\u52a8\u65f6\u624d\u5408\u6210\u79fb\u52a8\u6784\u9020\u51fd\u6570\u548c\u79fb\u52a8\u8d4b\u503c\u8fd0\u7b97\u7b26</li> <li>\u5982\u679c\u7528\u6237=default\uff0c\u4f46\u662f\u6709\u6210\u5458\u4e0d\u80fd\u79fb\u52a8\uff0c\u7f16\u8bd1\u5668\u5c06\u79fb\u52a8\u64cd\u4f5c\u5b9a\u4e49\u4e3a=delete</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_23","title":"\u5408\u6210\u79fb\u52a8\u64cd\u4f5c\u5b9a\u4e49\u4e3a\u5220\u9664","text":"<ul> <li>\u5b9a\u4e49\u4e86\u79fb\u52a8\u6784\u9020\u6216\u79fb\u52a8\u8d4b\u503c\u8fd0\u7b97\u7b26\u7684\u7c7b\u5fc5\u987b\u5b9a\u4e49\u81ea\u5df1\u7684\u62f7\u8d1d\u64cd\u4f5c\uff0c\u5426\u5219\u8fd9\u4e9b\u6210\u5458\u9ed8\u8ba4=delete</li> <li>\u7c7b\u6210\u5458\u6709const\u6216\u5f15\u7528\uff0c\u5b9a\u4e49\u4e3adelete</li> <li>\u6790\u6784=delete\u6216\u4e0d\u80fd\u8bbf\u95ee\uff0c\u5b9a\u4e49\u4e3adelete</li> <li>\u79fb\u52a8\u6784\u9020\u6216\u79fb\u52a8\u8d4b\u503c\u8fd0\u7b97\u7b26\u5b9a\u4e49\u4e3a\u5220\u9664\u6216\u4e0d\u53ef\u8bbf\u95ee</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_24","title":"\u62f7\u8d1d\u5e76\u4ea4\u6362\u8d4b\u503c\u8fd0\u7b97\u7b26\u548c\u79fb\u52a8\u64cd\u4f5c","text":"C++<pre><code>HasPtr(HasPtr&amp;&amp; p) noexcept:ps(p.ps), i(p.i) {p.ps = 0;}\n// \u65e2\u662f\u79fb\u52a8\u8d4b\u503c\u53c8\u662f\u62f7\u8d1d\u8d4b\u503c\nHasPtr&amp; operator=(HasPtr rhs) {\n    swap(*this, rhs);\n    return *this;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_25","title":"\u79fb\u52a8\u8fed\u4ee3\u5668","text":"<ul> <li>make_move_iteraotr\uff1a\u5c06\u4e00\u4e2a\u666e\u901a\u8fed\u4ee3\u5668\u8f6c\u6362\u4e3a\u4e00\u4e2a\u79fb\u52a8\u8fed\u4ee3\u5668</li> <li>\u4e0d\u8981\u968f\u610f\u4f7f\u7528\u79fb\u52a8\u64cd\u4f5c</li> <li>\u53ea\u6709\u5728\u786e\u4fe1\u7b97\u6cd5\u5728\u4e3a\u4e00\u4e2a\u5143\u7d20\u8d4b\u503c\u6216\u5c06\u5176\u4f20\u9012\u7ed9\u4e00\u4e2a\u7528\u6237\u5b9a\u4e49\u7684\u51fd\u6570\u540e\u4e0d\u518d\u8bbf\u95ee\uff0c\u624d\u80fd\u5c06\u79fb\u52a8\u8fed\u4ee3\u5668\u4f20\u9012</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_26","title":"\u53f3\u503c\u5f15\u7528\u548c\u6210\u5458\u51fd\u6570","text":"C++<pre><code>void push_back(const X&amp;); // \u7ed1\u5b9a\u5230\u4efb\u610f\u7c7b\u578b\u7684X\nvoid push_back(X&amp;&amp;);      // \u7ed1\u5b9a\u5230\u7c7b\u578bX\u7684\u53ef\u4fee\u6539\u53f3\u503c\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#_27","title":"\u53f3\u503c\u548c\u5de6\u503c\u5f15\u7528\u6210\u5458\u51fd\u6570","text":"<ul> <li> <p>\u5728\u53c2\u6570\u5217\u8868\u540e\u9762\u653e\u7f6e\u4e00\u4e2a\u5f15\u7528\u9650\u5b9a\u7b26\uff1a</p> </li> <li> <p>\u9650\u5236\u67d0\u4e9b\u65b9\u6cd5\u53ea\u80fd\u5de6\u503c\u5bf9\u8c61\u8c03\uff0c\u6216\u8005\u53ea\u80fd\u53f3\u503c\u5bf9\u8c61\u8c03</p> </li> </ul> C++<pre><code>// \u5bf9\u8c61\u662f\u53f3\u503c\uff0c\u8bf4\u660e\u6ca1\u6709\u5176\u4ed6\u7528\u6237\uff0c\u53ef\u4ee5\u6539\u53d8\u5bf9\u8c61\nFoo Foo:sorted() &amp;&amp; {\n    sort(data.begin(), data.end());\n    return *this;\n}\n</code></pre> <ul> <li> <p>\u8868\u793athis\u6307\u5411\u4e00\u4e2a\u5de6\u503c\u6216\u53f3\u503c</p> </li> <li> <p>\u5f15\u7528\u9650\u5b9a\u7b26\u5fc5\u987b\u8ddf\u968f\u5728const\u9650\u5b9a\u7b26\u4e4b\u540e</p> </li> <li> <p>\u5982\u679c\u4e00\u4e2a\u6210\u5458\u51fd\u6570\u6709\u5f15\u7528\u9650\u5b9a\u7b26\uff0c\u5177\u6709\u76f8\u540c\u53c2\u6570\u5217\u8868\u7684\u6240\u6709\u7248\u672c\u5fc5\u987b\u6709\u5f15\u7528\u9650\u5b9a\u7b26</p> </li> </ul> C++<pre><code>Foo Foo::sorted() const &amp; {\n    Foo ret(*this);\n    return ret.sorted();\n    // \u5bfc\u81f4\u9012\u5f52\u8c03\u7528\u5de6\u503csorted()\uff1b\u4ea7\u751f\u9012\u5f52\u5faa\u73af\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/13_%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6/#or","title":"\u5de6\u503cOR\u53f3\u503c","text":"<ul> <li>have identity and cannot be moved from are called lvalue expressions;</li> <li>have identity and can be moved from are called xvalue expressions;</li> <li>do not have identity and can be moved from are called prvalue (\"pure rvalue\") expressions;</li> <li>do not have identity and cannot be moved from are not used[6].</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/","title":"C++-\u91cd\u8f7d\u8fd0\u7b97\u548c\u7c7b\u578b\u8f6c\u6362","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_1","title":"\u91cd\u8f7d\u8fd0\u7b97\u548c\u7c7b\u578b\u8f6c\u6362","text":"<p> \u7ea6 1027 \u4e2a\u5b57  108 \u884c\u4ee3\u7801  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_2","title":"\u57fa\u672c\u6982\u5ff5","text":"<ul> <li> <p>\u91cd\u8f7d\u7684\u8fd0\u7b97\u7b26\u662f\u6210\u5458\u51fd\u6570\u65f6\uff0cthis\u7ed1\u5b9a\u5230\u5de6\u4fa7\u8fd0\u7b97\u5bf9\u8c61\uff1b\u6210\u5458\u8fd0\u7b97\u7b26\u51fd\u6570\u7684\u663e\u5f0f\u53c2\u6570\u6570\u91cf\u6bd4\u8fd0\u7b97\u5bf9\u8c61\u7684\u6570\u91cf\u5c11\u4e00\u4e2a</p> </li> <li> <p>\u5bf9\u4e8e\u4e00\u4e2a\u8fd0\u7b97\u7b26\u51fd\u6570\u6765\u8bf4\uff0c\u5b83\u6216\u8005\u662f\u7c7b\u7684\u6210\u5458\u6216\u8005\u81f3\u5c11\u542b\u6709\u4e00\u4e2a\u7c7b\u7c7b\u578b\u7684\u53c2\u6570</p> </li> </ul> <p></p> C++<pre><code>// \u8c03\u7528\u4e86\u975e\u6210\u5458\u51fd\u6570\ndata + data2;\noperator+(data, data2);\n\n// \u8c03\u7528\u4e86\u6210\u5458\u51fd\u6570\ndata1 += data2;\ndata1.operator+=(data2);\n</code></pre> <ul> <li>\u4f7f\u7528\u4e0e\u5185\u7f6e\u7c7b\u578b\u4e00\u81f4\u7684\u542b\u4e49</li> <li>IO\u7c7b\u578b\u4fdd\u6301\u4e00\u81f4</li> <li>\u5982\u679c\u5b9a\u4e49\u4e86operator==\uff0c\u5e94\u8be5\u5b9a\u4e49operator!=</li> <li>\u5305\u542b\u4e00\u4e2a\u5185\u5728\u7684\u5355\u5e8f\u6bd4\u8f83\uff0c\u5b9a\u4e49operator &lt;, operator&gt;...</li> <li>\u903b\u8f91\u8fd0\u7b97\u7b26\u8fd4\u56debool\uff1b\u7b97\u672f\u8fd0\u7b97\u7b26\u8fd4\u56de\u4e00\u4e2a\u7c7b\u7c7b\u578b\u7684\u503c\uff1b\u8d4b\u503c\u8fd0\u7b97\u7b26\u8fd4\u56de\u5de6\u4fa7\u8fd0\u7b97\u5bf9\u8c61\u7684\u4e00\u4e2a\u5f15\u7528</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_3","title":"\u9009\u62e9\u4f5c\u4e3a\u6210\u5458\u6216\u975e\u6210\u5458","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_4","title":"\u8f93\u5165\u548c\u8f93\u51fa\u8fd0\u7b97\u7b26","text":"C++<pre><code>ostream&amp; operator&lt;&lt;(ostream&amp; os, const Sales_data &amp;item)\n{\n    os &lt;&lt; item.isbn();\n    return os;\n}\n</code></pre> <ul> <li>\u5c3d\u91cf\u51cf\u5c11\u683c\u5f0f\u5316\u64cd\u4f5c</li> <li> <p>\u8f93\u5165\u8f93\u51fa\u8fd0\u7b97\u7b26\u5fc5\u987b\u662f\u975e\u6210\u5458\u51fd\u6570\uff1b\u4e00\u822c\u58f0\u660e\u4e3a\u7c7b\u7684\u53cb\u5143</p> </li> <li> <p>\u8bfb\u53d6\u64cd\u4f5c\u53d1\u751f\u9519\u8bef\u65f6\uff0c\u8f93\u5165\u8fd0\u7b97\u7b26\u8d1f\u8d23\u4ece\u9519\u8bef\u4e2d\u6062\u590d</p> </li> <li>IO\u6807\u51c6\u5e93\u6807\u8bc6\u9519\u8bef</li> <li>failbit</li> <li>eofbit\u8868\u793a\u6587\u4ef6\u8017\u5c3d</li> <li>badbit\u8868\u793a\u6d41\u88ab\u7834\u574f</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_5","title":"\u7b97\u672f\u548c\u5173\u7cfb\u8fd0\u7b97\u7b26","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_6","title":"\u8d4b\u503c\u8fd0\u7b97\u7b26","text":"<ul> <li>\u53ef\u4ee5\u5b9a\u4e49\u5176\u4ed6\u8d4b\u503c\u8fd0\u7b97\u7b26\u4f7f\u7528\u522b\u7684\u7c7b\u578b\u4f5c\u4e3a\u53f3\u4fa7\u8fd0\u7b97\u7b26\u5bf9\u8c61</li> </ul> C++<pre><code>StrVec&amp; StrVec::operator=(initializer_list&lt;string&gt; il)\n{\n    auto data = alloc_n_copy(il.begin(), il.end());\n    free();\n    elements = data.first;\n    first_free = data.second;\n    return *this;\n}\n</code></pre> <ul> <li>\u590d\u5408\u8d4b\u503c\u8fd0\u7b97\u7b26\uff1a\u53ef\u4ee5\u4e0d\u5b9a\u4e49\u5728\u7c7b\u5185\uff1b\u4f46\u6700\u597d\u5b9a\u4e49\u5728\u7c7b\u5185\uff0c\u8fd4\u56de\u7c7b\u578b\u4e0e\u8d4b\u503c\u8fd0\u7b97\u7b26\u76f8\u540c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_7","title":"\u4e0b\u6807\u8fd0\u7b97\u7b26","text":"<ul> <li>\u5fc5\u987b\u4e3a\u6210\u5458\u51fd\u6570</li> <li>\u4ee5\u6240\u8bbf\u95ee\u5143\u7d20\u7684\u5f15\u7528\u4f5c\u4e3a\u8fd4\u56de\u503c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_8","title":"\u9012\u589e\u548c\u9012\u51cf\u8fd0\u7b97\u7b26","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_9","title":"\u6210\u5458\u8bbf\u95ee\u8fd0\u7b97\u7b26","text":"C++<pre><code>class StrBlobPtr {\npublic:\n    std::string&amp; operator*() const\n    {\n        auto p = check(curr, \"end\");\n        return (*p)[curr];\n    }\n\n    std::string* operator-&gt;() const\n    {\n        return &amp;this-&gt;operator*();\n    }\n};\n</code></pre> <ul> <li>\u91cd\u8f7d\u7684\u7bad\u5934\u8fd0\u7b97\u7b26\u5fc5\u987b\u8fd4\u56de\u7c7b\u7684\u6307\u9488\u6216\u8005\u81ea\u5b9a\u4e49\u4e86\u7bad\u5934\u8fd0\u7b97\u7b26\u7684\u67d0\u4e2a\u7c7b\u7684\u5bf9\u8c61</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_10","title":"\u51fd\u6570\u8c03\u7528\u8fd0\u7b97\u7b26","text":"C++<pre><code>struct absInt {\n    int operator()(int val) const {\n        return val &lt; 0 ? -val : val;\n    }\n};\n</code></pre> <ul> <li>\u5fc5\u987b\u662f\u6210\u5458\u51fd\u6570\uff1b\u8be5\u7c7b\u7684\u5bf9\u8c61\u4e58\u5750\u51fd\u6570\u5bf9\u8c61</li> <li>\u51fd\u6570\u5bf9\u8c61\u5e38\u5e38\u4f5c\u4e3a\u6cdb\u578b\u7b97\u6cd5\u7684\u5b9e\u53c2</li> </ul> C++<pre><code>class PrintString {\npublic:\n    PrintString(ostream&amp; o = cout, char c = ' '):os(o),sep(c) {}\n    void operator()(const string&amp; s) const {os &lt;&lt; s &lt;&lt; sep;}\nprivate:\n    ostream &amp;os;\n    char sep;\n};\n// \u5148\u521d\u59cb\u5316\u4e34\u65f6\u5bf9\u8c61\uff1b\u8c03\u7528operator()\nfor_each(vs.begin(), vs.end(), PrintString(cerr, '\\n'));\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#lambda","title":"lambda\u662f\u51fd\u6570\u5bf9\u8c61","text":"C++<pre><code>[](const string &amp; a, const string &amp;b){return a.size() &lt; b.size();}\n// is equal to\n\nclass ShorterString {\npublic:\n    bool operator()(const string&amp; a, const string&amp; b) const{\n        return a.size() &lt; b.size();\n    }\n};\n</code></pre> <ul> <li>\u901a\u8fc7\u5f15\u7528\u6355\u83b7\u53d8\u91cf\uff0c\u7a0b\u5e8f\u4fdd\u8bc1\u5bf9\u8c61\u5b58\u5728\uff1b\u7f16\u8bd1\u5668\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8be5\u5f15\u7528</li> <li>\u901a\u8fc7\u503c\u6355\u83b7\uff0c\u9700\u8981\u5efa\u7acb\u6355\u83b7\u53d8\u91cf\u7684\u6570\u636e\u6210\u5458\uff0c\u540c\u65f6\u521b\u5efa\u6784\u9020\u51fd\u6570</li> </ul> C++<pre><code>[sz](const string &amp;a){return a.size() &lt; sz;}\n// is equal to\nclass SizeComp {\nprivate:\n    size_t sz;\npublic:\n    SizeComp(size_t n):sz(n){}\n    bool operator()(const string &amp;a) const }{return a.size() &lt; sz;}\n};\n</code></pre> <p>### \u6807\u51c6\u5e93\u51fd\u6570\u5bf9\u8c61</p> <p></p> C++<pre><code>// bind1st, bind2nd\u5c06\u4e00\u4e2a\u4e8c\u5143\u51fd\u6570\u53d8\u4e3a\u4e00\u5143\u51fd\u6570\ncount_if(vec.begin(), vec.end(), bind2nd(greater&lt;int&gt;(), 1024));\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#function","title":"\u53ef\u8c03\u7528\u51fd\u6570\u4e0efunction","text":"<ul> <li>\u4e0d\u540c\u7c7b\u578b\u53ef\u80fd\u5177\u6709\u76f8\u540c\u7684\u8c03\u7528\u5f62\u5f0f</li> <li>\u4f46\u6bcf\u4e2alambda\u6709\u81ea\u5df1\u7684\u7c7b\u7c7b\u578b\uff0c\u4e0e\u51fd\u6570\u6307\u9488\u7c7b\u578b\u4e0d\u76f8\u540c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#function_1","title":"\u6807\u51c6\u5e93function\u7c7b\u578b","text":"C++<pre><code>function&lt;int(int,int)&gt; f1 = add;        // \u51fd\u6570\u6307\u9488\nfunction&lt;int(int,int)&gt; f2 = divide();   // \u51fd\u6570\u5bf9\u8c61\u7c7b\u7684\u5bf9\u8c61\nfunction&lt;int(int,int)&gt; f3 = [](int i, int j){return i*j;}   // lambda\n</code></pre> <ul> <li>\u4e0d\u80fd\u5c06\u91cd\u8f7d\u51fd\u6570\u540d\u5b57\u5b58\u50a8\u5728function\u7c7b\u578b\u5bf9\u8c61\u4e2d\uff1b\u4f7f\u7528\u51fd\u6570\u6307\u9488</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_11","title":"\u91cd\u8f7d\u7c7b\u578b\u8f6c\u6362\u4e0e\u8fd0\u7b97\u7b26","text":"<ul> <li> <p><code>operator type() const;</code></p> </li> <li> <p>\u7c7b\u578b\u8f6c\u6362\u7b26\u65f6\u9690\u5f0f\u6267\u884c\u7684\uff0c\u65e0\u6cd5\u7ed9\u51fd\u6570\u4f20\u9012\u5b9e\u53c2\uff1b\u4e0d\u80fd\u5728\u5b9a\u4e49\u4e2d\u4f7f\u7528\u4efb\u4f55\u5f62\u53c2\uff1b\u4f46\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5bf9\u5e94\u7c7b\u578b\u7684\u503c</p> </li> <li>\u4e0d\u6307\u5b9a\u8fd4\u56de\u7c7b\u578b</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_12","title":"\u663e\u793a\u7684\u7c7b\u578b\u8f6c\u6362\u8fd0\u7b97\u7b26","text":"<ul> <li>\u9690\u5f0f\u8f6c\u6362\u53ef\u80fd\u56e0\u4e3a\u6574\u578b\u63d0\u5347\u9020\u6210\u610f\u6599\u4e4b\u5916\u7684\u7ed3\u679c</li> </ul> C++<pre><code>class SmallInt {\n    public:\n    explicit operator int() const {return val;}\n};\n\nstatic_cast&lt;int&gt;(si) + 3; // \u5fc5\u987b\u663e\u793a\u5730\u8bf7\u6c42\u7c7b\u578b\u8f6c\u6362\n</code></pre> <ul> <li>IO\u6807\u51c6\u5e93\u5b9a\u4e49\u4e00\u4e2a\u5411bool\u7684\u663e\u793a\u8f6c\u6362\uff08<code>while (std::cin &gt;&gt; value)</code>\uff09</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_13","title":"\u907f\u514d\u4e8c\u4e49\u6027\u7684\u7c7b\u578b\u8f6c\u6362","text":"<ul> <li>\u4e0d\u8981\u4e3a\u7c7b\u5b9a\u4e49\u76f8\u540c\u7684\u7c7b\u578b\u8f6c\u6362\uff1b\u4e0d\u8981\u5b9a\u4e49\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u8f6c\u6362\u76ee\u6807\u662f\u7b97\u672f\u7c7b\u578b\u7684\u8f6c\u6362</li> <li>\u4e0d\u8981\u5728\u4e24\u4e2a\u7c7b\u4e4b\u95f4\u6784\u5efa\u76f8\u540c\u7684\u7c7b\u578b\u8f6c\u6362</li> <li>\u5982\u679c\u7c7b\u5b9a\u4e49\u4e86\u4e00\u7ec4\u7c7b\u578b\u8f6c\u6362\uff0c\u4ed6\u4eec\u7684\u8f6c\u6362\u6e90\u6216\u8005\u8f6c\u6362\u76ee\u6807\u7c7b\u578b\u672c\u8eab\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u7c7b\u578b\u8f6c\u6362\u8054\u7cfb\u5728\u4e00\u8d77\u4f1a\u9020\u6210\u4e8c\u4e49\u6027\u95ee\u9898</li> </ul> C++<pre><code>struct A {\n    A(int i = 0);\n    A(double);\n};\nlong lg;\nA a2(lg);   // \u4e8c\u4e49\u6027\u9519\u8bef\uff1blong-&gt;double or long-&gt;int\n</code></pre> <ul> <li>\u4f7f\u7528\u4e24\u4e2a\u7528\u6237\u5b9a\u4e49\u7684\u7c7b\u578b\u8f6c\u6362\u65f6\uff0c\u5982\u679c\u8f6c\u6362\u51fd\u6570\u4e4b\u524d\u6216\u4e4b\u540e\u5b58\u5728\u6807\u51c6\u7c7b\u578b\u8f6c\u6362\uff0c\u6807\u51c6\u7c7b\u578b\u8f6c\u6362\u51b3\u5b9a\u6700\u4f73\u5339\u914d</li> <li>\u5982\u679c\u4e24\u4e2a\u7c7b\u578b\u8f6c\u6362\u63d0\u4f9b\u4e86\u540c\u4e00\u79cd\u53ef\u884c\u5339\u914d\uff0c\u7c7b\u578b\u8f6c\u6362\u4e00\u6837\u597d</li> </ul> C++<pre><code>struct C {C(int);};\nstruct D {D(int);};\n\nvoid manip(const C&amp; c);\nvoid manip(const D&amp; e);\nmanip(10);  // \u4e8c\u4e49\u6027\u9519\u8bef\n</code></pre> <ul> <li>\u5982\u679c\u4e24\u4e2a\u7528\u6237\u5b9a\u4e49\u7684\u7c7b\u578b\u8f6c\u6362\u90fd\u63d0\u4f9b\u4e86\u53ef\u884c\u5339\u914d\uff1b\u4e0d\u8003\u8651\u6807\u51c6\u7c7b\u578b\u8f6c\u6362\u7ea7\u522b</li> </ul> C++<pre><code>struct C {C(int);};\nstruct E {E(double);};\n\nvoid manip(const C&amp; c);\nvoid manip(const E&amp; e);\nmanip(10);  // \u4e8c\u4e49\u6027\u9519\u8bef\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/14_%E9%87%8D%E8%BD%BD%E8%BF%90%E7%AE%97%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/#_14","title":"\u51fd\u6570\u5339\u914d\u4e0e\u91cd\u8f7d\u8fd0\u7b97\u7b26","text":"<ul> <li>\u4e0d\u80fd\u901a\u8fc7\u8c03\u7528\u7684\u5f62\u5f0f\u6765\u533a\u5206\u6210\u5458\u51fd\u6570\u6216\u975e\u6210\u5458\u51fd\u6570</li> <li>\u540c\u4e00\u540d\u5b57\u7684\u6210\u5458\u51fd\u6570\u548c\u975e\u6210\u5458\u51fd\u6570\u4e0d\u4f1a\u5f7c\u6b64\u91cd\u8f7d\uff0c\u8fd0\u7b97\u7b26\u7684\u5019\u9009\u51fd\u6570\u96c6\u9700\u8981\u5305\u542b\u4e8c\u8005</li> </ul> C++<pre><code>class SmallInt {\nfriend SmallInt operator+(const SmallInt&amp;, const SmallInt&amp;);\npublic:\n    SmallInt(int i = 0);\n    operator int() const {return val;}\nprivate:\n    std::size_t val;\n};\nSmallInt s1,s2;\nSmallInt s3 = s1 + s2;\nint i = s3 + 0; // \u4e8c\u4e49\u6027\u9519\u8bef\n// \u53ef\u4ee5\u628a0\u8f6c\u5316\u4e3aSmallInt\u4f7f\u7528operator+\uff1b\n// \u4e5f\u53ef\u4ee5\u628as3\u8f6c\u5316\u4e3aint\uff0c\u6267\u884c\u5185\u7f6e\u7684\u52a0\u6cd5\u8fd0\u7b97\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/15_%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/","title":"15_\u9762\u5411\u5bf9\u8c61\u7a0b\u5e8f\u8bbe\u8ba1","text":""},{"location":"notes/c%2B%2Bprimer/15_%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/#oop","title":"OOP","text":"<p> \u7ea6 1 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p>"},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/","title":"C++-\u53d8\u91cf\u548c\u57fa\u672c\u7c7b\u578b","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#_1","title":"\u53d8\u91cf\u548c\u57fa\u672c\u7c7b\u578b","text":"<p> \u7ea6 802 \u4e2a\u5b57  16 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#1","title":"1.\u57fa\u672c\u5185\u7f6e\u7c7b\u578b","text":"<ul> <li>\u7b97\u6570\u7c7b\u578b\u548c\u7a7a\u7c7b\u578b</li> <li><code>bool, char, wchar_t, char16_t, char32_t, short, int, long, long  long, fliat, double, long double</code></li> <li>w_char_t\u786e\u4fdd\u53ef\u4ee5\u5b58\u653e\u673a\u5668\u6700\u5927\u6269\u5c55\u5b57\u7b26\u96c6\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26</li> <li>char16_t\uff0cchar32_t\u4e3aUnicode\u5b57\u7b26\u96c6\u670d\u52a1</li> <li>\u4e00\u822cfloat 32bit\uff0cdouble 64bit\uff0clong double 96/128bit</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#_2","title":"\u5e26\u7b26\u53f7\u7c7b\u578b\u548c\u65e0\u7b26\u53f7\u7c7b\u578b","text":"<ul> <li>int, short, long, long long\u524d\u76f4\u63a5\u52a0unsigned</li> <li>signed char\u548cunsigned char\uff1bchar\u8868\u73b0\u4e3a\u4e0a\u8ff0\u4e24\u79cd\u4e4b\u4e00</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#_3","title":"\u5982\u4f55\u9009\u62e9\u7c7b\u578b","text":"<ul> <li>\u6570\u503c\u4e0d\u4e3a\u8d1f\u65f6\uff0c\u9009\u7528\u65e0\u7b26\u53f7\u7c7b\u578b</li> <li>int\u6267\u884c\u6574\u6570\u8fd0\u7b97\uff1b\u5982\u679c\u8d85\u8fc7int\uff0c\u4f7f\u7528long long</li> <li>\u7b97\u672f\u8868\u8fbe\u5f0f\u4e2d\u4e0d\u8981\u4f7f\u7528char\u548cbool\uff0cchar\u53ef\u80fd\u6709\u7b26\u53f7\uff1b\u660e\u786e\u6307\u660esigned char\u6216unsigned char</li> <li>\u6d6e\u70b9\u6570\u8fd0\u7b97\u9009\u7528double\u7c7b\u578b</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#_4","title":"\u7c7b\u578b\u8f6c\u6362","text":"<ul> <li>\u542b\u6709\u65e0\u7b26\u53f7\u53d8\u91cf\u65f6\u8981\u5341\u5206\u6ce8\u610f\uff0c\u6709\u7b26\u53f7\u53d8\u91cf\u4f1a\u81ea\u52a8\u5730\u8f6c\u6362\u6210\u65e0\u7b26\u53f7\u6570</li> <li>\u524d\u7f00\uff08\u5b57\u7b26\uff09\u548c\u540e\u7f00\uff08\u6574\u6570\u6216\u6d6e\u70b9\u6570\uff09</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#2","title":"2.\u53d8\u91cf","text":"<ul> <li><code>initializer_list&lt;string&gt;</code>\uff1a\u5141\u8bb8\u8fdb\u884c\u5217\u8868\u521d\u59cb\u5316</li> </ul> C++<pre><code>struct myclass {\n  myclass (int,int);\n  myclass (initializer_list&lt;int&gt;);\n};\n\nmyclass foo {10,20};  // calls initializer_list ctor\nmyclass bar (10,20);\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#_5","title":"\u521d\u59cb\u503c","text":"<ul> <li>\u521d\u59cb\u5316\u4e0d\u662f\u8d4b\u503c\uff0c\u53ea\u662f\u521b\u5efa\u5bf9\u8c61\u662f\u8d4b\u4e00\u4e2a\u521d\u59cb\u503c\uff1b\u8d4b\u503c\u662f\u5c06\u5f53\u524d\u503c\u64e6\u9664\uff0c\u7528\u4e00\u4e2a\u65b0\u503c\u4ee3\u66ff</li> <li>\u4f7f\u7528\u82b1\u62ec\u53f7\u8fdb\u884c\u5217\u8868\u521d\u59cb\u5316\uff0c\u5b58\u5728\u4e22\u5931\u4fe1\u606f\u7684\u98ce\u9669\uff0c\u7f16\u8bd1\u5668\u62a5\u9519</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#_6","title":"\u590d\u5408\u7c7b\u578b","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#_7","title":"\u5f15\u7528","text":"<ul> <li>\u5f15\u7528\u5fc5\u987b\u88ab\u521d\u59cb\u5316\uff1b\u6307\u5411\u53d8\u91cf\uff08\u662f\u53d8\u91cf\u7684\u53e6\u4e00\u4e2a\u540d\u5b57\uff09</li> <li>\u5c06\u5f15\u7528\u548c\u521d\u59cb\u503c\u7ed1\u5b9a\uff08bind\uff09\u5728\u4e00\u8d77</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#_8","title":"\u6307\u9488","text":"<ul> <li>\u7a7a\u6307\u9488\uff1anullptr, 0, NULL\uff08\u9884\u5904\u7406\u53d8\u91cf\uff0c\u503c\u5c31\u662f0\uff09</li> <li>\u4e0d\u80fd\u628aint\u53d8\u91cf\u76f4\u63a5\u8d4b\u7ed9\u6307\u9488\uff0c\u5373\u4f7f\u662f0\u4e5f\u4e0d\u884c</li> <li>int *&amp;r\uff1b\u4ece\u53f3\u5411\u5de6\u7406\u89e3r\u7684\u5b9a\u4e49\uff0c\u662f\u4e00\u4e2a\u5f15\u7528\uff0c\u5f15\u7528\u7684\u5bf9\u8c61\u662f\u4e00\u4e2a\u6307\u9488</li> <li>(void*)obj\uff1a\u7c7b\u4f3c\u8fd4\u56dep-&gt;next</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#const","title":"const\u4fee\u9970\u7b26","text":"<ul> <li>\u7528\u4e00\u4e2a\u5bf9\u8c61\u53bb\u521d\u59cb\u5316\u53e6\u4e00\u4e2a\u5bf9\u8c61\uff0c\u662f\u4e0d\u662fconst\u90fd\u65e0\u5173\u7d27\u8981</li> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cconst\u5bf9\u8c61\u4ec5\u5728\u6587\u4ef6\u4e2d\u6709\u6548</li> <li>\u5982\u679c\u60f3\u5728\u591a\u4e2a\u6587\u4ef6\u4e4b\u95f4\u5171\u4eabconst\u5bf9\u8c61\uff0c\u4f7f\u7528extern</li> </ul> C++<pre><code>double dval = 3.14;\nconst int &amp;ri = dval;\n\n// \u7f16\u8bd1\u5668\u5c06ri\u7ed1\u5b9a\u5728\u4e00\u4e2a\u4e34\u65f6\u5bf9\u8c61\u4e0a\nconst int tmp = dval;\nconst int &amp;ri = tmp;\n</code></pre> <ul> <li> <p>\u5bf9const\u7684\u5f15\u7528\u53ef\u80fd\u5f15\u7528\u4e00\u4e2a\u5e76\u975econst\u7684\u5bf9\u8c61</p> </li> <li> <p>\u5e38\u91cf\u6307\u9488\u5fc5\u987b\u521d\u59cb\u5316\uff08int* const p = &amp;ri;\uff09\uff0c\u521d\u59cb\u5316\u540e\u4e0d\u80fd\u88ab\u8d4b\u503c\uff1b\u5e38\u91cf\u5fc5\u987b\u521d\u59cb\u5316\uff08const int i = 3;\uff09</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#const_1","title":"\u9876\u5c42const","text":"<ul> <li>\u9876\u5c42const\u8868\u793a\u6307\u9488\u672c\u8eab\u662f\u4e2a\u5e38\u91cf\uff0c\u5e95\u5c42const\u8868\u793a\u6307\u9488\u6240\u6307\u7684\u5bf9\u8c61\u662f\u4e00\u4e2a\u5e38\u91cf</li> <li>\u6267\u884c\u5bf9\u8c61\u7684\u62f7\u8d1d\u64cd\u4f5c\u65f6\uff0c\u5982\u679c\u662f\u9876\u5c42const\uff0c\u4e0d\u53d7\u5f71\u54cd</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#constexpr","title":"constexpr\u548c\u5e38\u91cf\u8868\u8fbe\u5f0f","text":"<ul> <li>constexpr\u7f16\u8bd1\u5668\u9a8c\u8bc1\u53d8\u91cf\u7684\u503c\u662f\u5426\u662f\u4e00\u4e2a\u5e38\u91cf\u8868\u8fbe\u5f0f</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#_9","title":"\u5904\u7406\u7c7b\u578b","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#auto","title":"auto","text":"<ul> <li>\u53ea\u4fdd\u7559\u5e95\u5c42const\uff0c\u5ffd\u7565\u9876\u5c42const</li> </ul> C++<pre><code>const auto f = ci;\nauto &amp;g = ci;\nconst auto &amp;j = 32;\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#decltype","title":"decltype","text":"<ul> <li>\u7f16\u8bd1\u5668\u5206\u6790\u8868\u8fbe\u5f0f\u5f97\u5230\u7c7b\u578b\uff0c\u4f46\u4e0d\u8ba1\u7b97\u8868\u8fbe\u5f0f\u7684\u503c</li> <li>\u8fd4\u56de\u8be5\u53d8\u91cf\u7684\u7c7b\u578b\uff08\u5305\u62ec\u9876\u5c42const\u548c\u5f15\u7528\uff09</li> <li>\u8868\u8fbe\u5f0f\u5185\u5bb9\u662f\u89e3\u5f15\u7528\u64cd\u4f5c\uff0c\u8fd4\u56de\u7684\u662f\u5f15\u7528\u7c7b\u578b</li> <li>\u5982\u679c\u7ed9\u53d8\u91cf\u52a0\u4e0a\u591a\u5c42\u62ec\u53f7\uff0c\u4f1a\u5f97\u5230\u5f15\u7528\u7c7b\u578b</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/2_%E5%8F%98%E9%87%8F%E5%92%8C%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/#autodecltype","title":"auto\u4e0edecltype\u533a\u522b","text":"<ul> <li>auto\u8ba1\u7b97\u53d8\u91cf\u7684\u521d\u59cb\u503c\u6765\u63a8\u65ad\u7c7b\u578b\uff1bdecltype\u5206\u6790\u8868\u8fbe\u5f0f\u4f46\u4e0d\u8ba1\u7b97\u5b9e\u9645\u8868\u8fbe\u5f0f\u7684\u503c</li> <li>auto\u7c7b\u578b\u548c\u521d\u59cb\u503c\u4e0d\u5b8c\u5168\u4e00\u81f4\uff0c</li> <li>decltype\u7684\u7ed3\u679c\u7c7b\u578b\u548c\u8868\u8fbe\u5f0f\u5f62\u5f0f\u5bc6\u5207\u76f8\u5173\uff0c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/","title":"C++-\u5b57\u7b26\u4e32\u3001\u5411\u91cf\u3001\u6570\u7ec4","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/#_1","title":"\u5b57\u7b26\u4e32\u3001\u5411\u91cf\u3001\u6570\u7ec4","text":"<p> \u7ea6 400 \u4e2a\u5b57  1 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/#using","title":"using\u58f0\u660e","text":"<ul> <li>\u4e00\u822c\u5934\u6587\u4ef6\u4e0d\u5e94\u8be5\u5305\u542busing\u58f0\u660e</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/#string","title":"String","text":"<ul> <li>\u76f4\u63a5\u521d\u59cb\u5316\u548c\u62f7\u8d1d\u521d\u59cb\u5316</li> <li>\u7b49\u6027\u5224\u65ad\u5bf9\u5b57\u6bcd\u7684\u5927\u5c0f\u5199\u654f\u611f</li> <li> <p>\u5982\u679c\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528size()\uff08\u8fd4\u56de\u4e00\u4e2a\u65e0\u7b26\u53f7\u6574\u6570\uff09\uff0c\u907f\u514d\u4f7f\u7528int</p> </li> <li> <p>\u5b57\u9762\u503c\u548c\u5bf9\u8c61\u76f8\u52a0\u81f3\u5c11+\u53f7\u4e24\u8fb9\u6709\u4e00\u4e2a\u662fstring\u5bf9\u8c61</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/#vector","title":"Vector","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/#_2","title":"\u8fed\u4ee3\u5668","text":"<ul> <li>begin()\uff1a\u8868\u793a\u7b2c\u4e00\u4e2a\u5143\u7d20, end()\uff1a\u8868\u793a\u5c3e\u5143\u7d20\u7684\u4e0b\u4e00\u4e2a\u5143\u7d20\uff0c\u6307\u793a\u7684\u662f\u6839\u672c\u4e0d\u5b58\u5728\u7684\u5c3e\u540e\u5143\u7d20</li> <li>==, !=\u5982\u679c\u4e24\u4e2a\u8fed\u4ee3\u5668\u6307\u5411\u76f8\u540c\u7684\u5143\u7d20\u6216\u8005\u90fd\u662f\u540c\u4e00\u4e2a\u5bb9\u5668\u7684\u5c3e\u540e\u8fed\u4ee3\u5668\u5219\u76f8\u7b49</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/#_3","title":"\u8fed\u4ee3\u5668\u7c7b\u578b","text":"<ul> <li>iterator\u662f\u53ef\u4ee5\u64cd\u7eb5\u7684\u7c7b\u578b</li> <li>const_iterator\u80fd\u8bfb\u53d6\u4f46\u4e0d\u80fd\u4fee\u6539\u8be5\u8fed\u4ee3\u5668\u6307\u5411\u7684\u5143\u7d20\u503c</li> <li> <p>\u4efb\u4f55\u6539\u53d8vector\u5bb9\u91cf\u7684\u64cd\u4f5c\u4f1a\u4f7f\u5f97\u8fed\u4ee3\u5668\u5931\u6548</p> </li> <li> <p><code>begin();end()</code>\u6b63\u5e8f\u8fed\u4ee3\u5668</p> </li> <li><code>cbegin();cend()</code> \u8fd4\u56de <code>const</code> \u7684<code>begin();end()</code></li> <li><code>rbegin();rend()</code> \u9006\u5e8f\u8fed\u4ee3\u5668</li> <li><code>crbegin();crend()</code> \u8fd4\u56de <code>const</code> \u7684 <code>rbegin();rend()</code></li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/#_4","title":"\u8fed\u4ee3\u5668\u8fd0\u7b97","text":"<ul> <li>iter - n</li> <li>iter + n</li> <li>iter1 += n</li> <li>iter1 -= n</li> <li>iter1 - iter2</li> <li>\u6bd4\u8f83\u5927\u5c0f</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/3_%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%91%E9%87%8F%E6%95%B0%E7%BB%84/#_5","title":"\u6570\u7ec4","text":"<ul> <li>\u4e0d\u5141\u8bb8\u62f7\u8d1d\u548c\u8d4b\u503c</li> <li> <p>string\u9ed8\u8ba4\u521d\u59cb\u5316\u4e3a\u7a7a\u4e32</p> </li> <li> <p>\u5185\u7f6e\u7c7b\u578bint\uff0c\u5b9a\u4e49\u4e3a\u5168\u5c40\u9ed8\u8ba4\u4e3a0\uff0c\u5b9a\u4e49\u5728main\u51fd\u6570\u5185\u90e8\uff0c\uff0c\u4e0d\u88ab\u521d\u59cb\u5316\uff0c\u53ef\u80fd\u9047\u5230\u672a\u5b9a\u4e49\u7684\u5947\u5f02\u503c</p> </li> <li> <p>\u5b57\u7b26\u6570\u7ec4\u521d\u59cb\u5316\uff1a\u5217\u8868\u521d\u59cb\u5316\u65b9\u5f0f\u8d4b\u503c\u7684C\u98ce\u683c\u5b57\u7b26\u4e32\u672b\u5c3e\u65e0'\\0'\uff0c\u5b57\u7b26\u4e32\u5b57\u9762\u503c\u8d4b\u503c\u6709'\\0'</p> </li> <li>\u53ef\u4ee5\u7528\u6570\u7ec4\u76f4\u63a5\u521d\u59cb\u5316vector</li> </ul> C++<pre><code>vector&lt;int&gt; vInt(begin(a), end(a));\n</code></pre> <ul> <li>strcpy, strcmp, strcat</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/","title":"C++-\u8868\u8fbe\u5f0f","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_1","title":"\u8868\u8fbe\u5f0f","text":"<p> \u7ea6 1381 \u4e2a\u5b57  25 \u884c\u4ee3\u7801  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_2","title":"\u5de6\u503c\u548c\u53f3\u503c","text":"<ul> <li>C++\u8868\u8fbe\u5f0f\u8981\u4e48\u4e3a\u5de6\u503c\u8981\u4e48\u4e3a\u53f3\u503c</li> <li>\u8d4b\u503c\u8fd0\u7b97\u7b26\u9700\u8981\u4e00\u4e2a\u5de6\u503c\u4f5c\u4e3a\u5de6\u4fa7\u8fd0\u7b97\u5bf9\u8c61\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4ecd\u7136\u662f\u4e00\u4e2a\u5de6\u503c</li> <li>\u53d6\u5730\u5740\u7b26\uff1a\u5f97\u5230\u7684\u6307\u9488\u662f\u4e00\u4e2a\u53f3\u503c</li> <li>\u5185\u7f6e\u89e3\u5f15\u7528\u7b26\u548c\u4e0b\u6807\u8fd0\u7b97\u7b26\uff0c\u8fed\u4ee3\u5668\u89e3\u5f15\u7528\u7b26\uff0cstring &amp; vector\u7684\u4e0b\u6807\u8fd0\u7b97\u7b26\u5747\u662f\u5de6\u503c</li> <li>\u5185\u7f6e\u7c7b\u578b\u548c\u8fed\u4ee3\u5668\u7684\u9012\u589e\u9012\u51cf\u8fd0\u7b97\u7b26\u4f5c\u7528\u4e8e\u5de6\u503c\u8fd0\u7b97\u5bf9\u8c61</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_3","title":"\u9012\u589e\u548c\u9012\u51cf\u8fd0\u7b97\u7b26","text":"<ul> <li>\u4f5c\u7528\u4e8e\u5de6\u503c\u8fd0\u7b97\u5bf9\u8c61\uff0c\u524d\u7f6e\u7248\u672c\u5c06\u5bf9\u8c61\u672c\u8eab\u4f5c\u4e3a\u5de6\u503c\u8fd4\u56de\uff1b\u540e\u7f6e\u7248\u672c\u4f5c\u4e3a\u53f3\u503c\u8fd4\u56de</li> <li>\u4e0d\u5efa\u8bae\u4f7f\u7528\u540e\u7f6e\u7248\u672c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_4","title":"\u7c7b\u578b\u8f6c\u6362","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_5","title":"\u7b97\u6570\u8f6c\u6362","text":"<ul> <li>\u6574\u578b\u63d0\u5347\uff1a\u628a\u5c0f\u6574\u6570\u7c7b\u578b\u8f6c\u6362\u6210\u8f83\u5927\u7684\u6574\u6570\u7c7b\u578b</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_6","title":"\u5176\u4ed6\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362","text":"<ul> <li> <p>\u6570\u7ec4\u8f6c\u6362\u6210\u6307\u9488</p> </li> <li> <p>\u6307\u9488\u7684\u8f6c\u6362\u8f6c\u6362\u6210bool</p> </li> <li> <p>\u8f6c\u6362\u6210\u5e38\u91cf</p> </li> <li> <p>\u7c7b\u7c7b\u578b\u5b9a\u4e49\u7684\u8f6c\u6362</p> </li> </ul> C++<pre><code>string s,t = \"a value\";   // \u5b57\u7b26\u4e32\u5b57\u9762\u503c\u8f6c\u5316\u4e3astring\u7c7b\u578b\nwhile(cin &gt;&gt; s)           // while\u628acin\u8f6c\u5316\u4e3aBool\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_7","title":"\u7c7b\u578b\u8f6c\u6362\u7b26","text":"<ul> <li>const_cast</li> <li>const_cast\u53ea\u9488\u5bf9\u6307\u9488\u3001\u5f15\u7528\uff0c\u5f53\u7136\uff0cthis\u6307\u9488\u4e5f\u662f\u5176\u4e2d\u4e4b\u4e00</li> <li>const_cast\u7684\u5927\u90e8\u5206\u4f7f\u7528\u4e3b\u8981\u662f\u5c06\u5e38\u91cf\u6307\u9488\u8f6c\u6362\u4e3a\u5e38\u6307\u9488\u3002\u5e38\u91cf\u6307\u9488\u6307\u5411\u7684\u7a7a\u95f4\u7684\u5185\u5bb9\u4e0d\u5141\u8bb8\u88ab\u4fee\u6539\uff0c\u4f46\u662f\u4f7f\u7528const_cast\u8fdb\u884c\u5f3a\u5236\u8f6c\u6362\u5c31\u53ef\u4ee5\u4fee\u6539\u3002</li> <li> <p>const_cast\u53ea\u80fd\u8c03\u8282\u7c7b\u578b\u9650\u5b9a\u7b26\uff0c\u4e0d\u80fd\u4fee\u6539\u57fa\u672c\u7c7b\u578b\u3002</p> </li> <li> <p>static_cast</p> </li> <li>static_cast\u7684\u4f7f\u7528\u57fa\u672c\u7b49\u4ef7\u4e8e\u9690\u5f0f\u8f6c\u6362\u7684\u4e00\u79cd\u7c7b\u578b\u8f6c\u5316\u8fd0\u7b97\u7b26\uff0c\u53ef\u4f7f\u7528\u4e8e\u9700\u8981\u660e\u786e\u9690\u5f0f\u8f6c\u6362\u7684\u5730\u65b9\u3002\u5c31\u76f8\u5f53\u4e8e\u628a\u9690\u5f0f\u8f6c\u6362\u7ed9\u660e\u786e\u5199\u4e86\u51fa\u6765\u800c\u5df2</li> <li> <p>\u53ef\u7528\u4e8e\u4f4e\u98ce\u9669\u8f6c\u6362\uff0c\u9ad8\u98ce\u9669\u8f6c\u6362\u4e0d\u884c</p> </li> <li> <p>dynamic_cast</p> </li> <li>\u7528\u4e8e\u5177\u6709\u865a\u51fd\u6570\u7684\u57fa\u7c7b\u4e0e\u6d3e\u751f\u7c7b\u4e4b\u95f4\u7684\u6307\u9488\u6216\u5f15\u7528\u7684\u8f6c\u6362\u3002</li> <li>\u57fa\u7c7b\u5fc5\u987b\u5177\u6709\u865a\u51fd\u6570\u3002dynamic_cast\u662f\u8fd0\u884c\u65f6\u7c7b\u578b\u4fe1\u606f\uff08RTTI\uff09\uff0c\u800c\u8fd9\u4e2a\u4fe1\u606f\u662f\u5b58\u50a8\u4e0e\u7c7b\u7684\u865a\u51fd\u6570\u8868\u5173\u7cfb\u7d27\u5bc6\u7684\u4fe1\u606f\uff0c\u53ea\u6709\u4e00\u4e2a\u7c7b\u5b9a\u4e49\u4e86\u865a\u51fd\u6570\uff0c\u624d\u4f1a\u6709\u865a\u51fd\u6570\u8868\u3002\u8fd0\u884c\u65f6\u68c0\u67e5\uff0c\u8f6c\u578b\u4e0d\u6210\u529f\u5219\u8fd4\u56de\u4e00\u4e2a\u7a7a\u6307\u9488,\u975e\u5fc5\u8981\u4e0d\u4f7f\u7528dynamic_cast\uff0c\u56e0\u4e3a\u6709\u989d\u5916\u7684\u5f00\u9500\u3002</li> <li>\u5e38\u7528\u7684\u8f6c\u6362\u65b9\u5f0f     \u57fa\u7c7b\u6307\u9488\u6216\u5f15\u7528\u8f6c\u6d3e\u751f\u7c7b\u6307\u9488\uff08\u5fc5\u987b\u4f7f\u7528dynamic_cast\uff09     \u6d3e\u751f\u7c7b\u6307\u9488\u6216\u5f15\u7528\u8f6c\u57fa\u7c7b\u6307\u9488\uff08\u53ef\u4ee5\u4f7f\u7528dynamic_cast,\u4f46\u662f\u66f4\u63a8\u8350\u7528static_cast\uff09</li> </ul> C++<pre><code>B *pb; // B is base class\nD *pd, md; // D is \u6d3e\u751f class\npb=&amp;md; \npd=dynamic&lt;D*&gt;(pb);\n</code></pre> <ul> <li> <p>reinterpret_cast</p> </li> <li> <p>\u5f3a\u5236\u8f6c\u6362</p> </li> </ul> C++<pre><code>const std::string&amp; StrVector::at(size_t index) const {\n return static_cast&lt;const\nstd::string&amp;&gt;(const_cast&lt;StrVector*&gt;(this)-&gt;at(index));\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#rtti","title":"RTTI","text":"<ul> <li>Run Time Type Identification\uff1a\u8fd0\u884c\u65f6\u7c7b\u578b\u8bc6\u522b\uff1b\u7a0b\u5e8f\u4f7f\u7528\u57fa\u7c7b\u7684\u6307\u9488\u6216\u5f15\u7528\u68c0\u67e5\u8fd9\u4e9b\u6307\u9488\u6216\u5f15\u7528\u6240\u6307\u5bf9\u8c61\u7684\u5b9e\u9645\u6d3e\u751f\u7c7b\u578b</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#typeid","title":"typeid\u8fd0\u7b97\u7b26","text":"<ul> <li> <p>typeid\u8fd0\u7b97\u7b26\uff0c\u540e\u63a5\u4e00\u4e2a\u7c7b\u578b\u540d\u6216\u4e00\u4e2a\u8868\u8fbe\u5f0f\uff0c\u8be5\u8fd0\u7b97\u7b26\u8fd4\u56de\u4e00\u4e2a\u7c7b\u578b\u4e3astd::tpeinfo\u7684\u5bf9\u8c61\u7684const\u5f15\u7528\u3002type_info\u662fstd\u4e2d\u7684\u4e00\u4e2a\u7c7b\uff0c\u5b83\u7528\u4e8e\u8bb0\u5f55\u4e0e\u7c7b\u578b\u76f8\u5173\u7684\u4fe1\u606f\u3002</p> </li> <li> <p>typeid\u8bc6\u522b\u9759\u6001\u7c7b\u578b</p> </li> </ul> <p>\u5f53typeid\u4e2d\u7684\u64cd\u4f5c\u6570\u662f\u5982\u4e0b\u60c5\u51b5\u4e4b\u4e00\u65f6\uff0ctypeid\u8fd0\u7b97\u7b26\u6307\u51fa\u64cd\u4f5c\u6570\u7684\u9759\u6001\u7c7b\u578b\uff0c\u5373\u7f16\u8bd1\u65f6\u7684\u7c7b\u578b\u3002</p> <p>\uff081\uff09\u7c7b\u578b\u540d</p> <p>\uff082\uff09\u4e00\u4e2a\u57fa\u672c\u7c7b\u578b\u7684\u53d8\u91cf</p> <p>\uff083\uff09\u4e00\u4e2a\u5177\u4f53\u7684\u5bf9\u8c61</p> <p>\uff084\uff09\u4e00\u4e2a\u6307\u5411\u4e0d\u542b\u6709virtual\u51fd\u6570\u7684\u7c7b\u5bf9\u8c61\u7684\u6307\u9488\u7684\u89e3\u5f15\u7528</p> <p>\uff085\uff09\u4e00\u4e2a\u6307\u5411\u4e0d\u542b\u6709virtual\u51fd\u6570\u7684\u7c7b\u5bf9\u8c61\u7684\u5f15\u7528</p> <p>\u9759\u6001\u7c7b\u578b\u5728\u7a0b\u5e8f\u7684\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u5e76\u4e0d\u4f1a\u6539\u53d8\uff0c\u6240\u4ee5\u5e76\u4e0d\u9700\u8981\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u8ba1\u7b97\u7c7b\u578b\uff0c\u5728\u7f16\u8bd1\u65f6\u5c31\u80fd\u6839\u636e\u64cd\u4f5c\u6570\u7684\u9759\u6001\u7c7b\u578b\uff0c\u63a8\u5bfc\u51fa\u5176\u7c7b\u578b\u4fe1\u606f\u3002</p> <ul> <li>typeid\u8bc6\u522b\u591a\u6001\u7c7b\u578b</li> </ul> <p>\u5f53typeid\u4e2d\u7684\u64cd\u4f5c\u6570\u662f\u5982\u4e0b\u60c5\u51b5\u4e4b\u4e00\u65f6\uff0ctypeid\u8fd0\u7b97\u7b26\u9700\u8981\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u8ba1\u7b97\u7c7b\u578b\uff0c\u56e0\u4e3a\u5176\u5176\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u5728\u7f16\u8bd1\u65f6\u671f\u662f\u4e0d\u80fd\u88ab\u786e\u5b9a\u7684\u3002</p> <p>\uff081\uff09\u4e00\u4e2a\u6307\u5411\u4e0d\u542b\u6709virtual\u51fd\u6570\u7684\u7c7b\u5bf9\u8c61\u7684\u6307\u9488\u7684\u89e3\u5f15\u7528</p> <p>\uff082\uff09\u4e00\u4e2a\u6307\u5411\u4e0d\u542b\u6709virtual\u51fd\u6570\u7684\u7c7b\u5bf9\u8c61\u7684\u5f15\u7528</p> <p>\u591a\u6001\u7684\u7c7b\u578b\u662f\u53ef\u4ee5\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u88ab\u6539\u53d8\u7684\uff0c\u4f8b\u5982\uff0c\u4e00\u4e2a\u57fa\u7c7b\u7684\u6307\u9488\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5b83\u53ef\u4ee5\u6307\u5411\u4e00\u4e2a\u57fa\u7c7b\u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u6307\u5411\u8be5\u57fa\u7c7b\u7684\u6d3e\u751f\u7c7b\u7684\u5bf9\u8c61\uff0c\u800ctypeid\u8fd0\u7b97\u7b26\u9700\u8981\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u8bc6\u522b\u51fa\u8be5\u57fa\u7c7b\u6307\u9488\u6240\u6307\u5411\u7684\u5bf9\u8c61\u7684\u5b9e\u9645\u7c7b\u578b\uff0c\u8fd9\u5c31\u9700\u8981typeid\u8fd0\u7b97\u7b26\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u8ba1\u7b97\u5176\u6307\u5411\u7684\u5bf9\u8c61\u7684\u5b9e\u9645\u7c7b\u578b\u3002</p> <ul> <li> <p>\u5173\u4e8e\u591a\u6001\u7c7b\u578b\u7684\u8ba1\u7b97\u662f\u901a\u8fc7\u57fa\u7c7b\u6307\u9488\u6216\u5f15\u7528\u6307\u5411\u7684\u5bf9\u8c61\uff08\u5b50\u5bf9\u8c61\uff09\u7684\u865a\u51fd\u6570\u8868\u83b7\u5f97\u7684</p> </li> <li> <p>\u7136\u800c\u5728C++\u4e2d\u5373\u4f7f\u4e00\u4e2a\u7c7b\u4e0d\u5177\u6709\u591a\u6001\u7684\u6027\u8d28\uff0c\u4ecd\u7136\u5141\u8bb8\u628a\u4e00\u4e2a\u6d3e\u751f\u7c7b\u7684\u6307\u9488\u8d4b\u503c\u7ed9\u4e00\u4e2a\u57fa\u7c7b\u7684\u6307\u9488\uff0c\u6240\u4ee5\u8fd9\u4e2a\u9519\u8bef\u6bd4\u8f83\u9690\u6666\u3002</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#_8","title":"\u524d\u5411\u58f0\u660e","text":"<ul> <li>A forward declaration allows us to tell the compiler about the existence of an identifier before actually defining the identifier.</li> </ul> C++<pre><code>#include &lt;iostream&gt;\n\nint add(int x, int y); // forward declaration of add() (using a function declaration)\n\nint main()\n{\n    std::cout &lt;&lt; \"The sum of 3 and 4 is: \" &lt;&lt; add(3, 4) &lt;&lt; '\\n'; // this works because we forward declared add() above\n    return 0;\n}\n\nint add(int x, int y) // even though the body of add() isn't defined until here\n{\n    return x + y;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#declarations-vs-definitions","title":"Declarations vs. definitions","text":"<ul> <li>A declaration is a statement that tells the compiler about the existence of an identifier and its associated type information. Here are some examples of declarations:</li> </ul> C++<pre><code>int add(int x, int y); // tells the compiler about a function named \"add\" that takes two int parameters and returns an int.  No body!\nint x;                 // tells the compiler about an integer variable named x\n</code></pre> <ul> <li>In C++, all definitions also serve as declarations</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/4_%E8%A1%A8%E8%BE%BE%E5%BC%8F/#the-one-definition-ruleodr","title":"The one definition rule(ODR)","text":"<ul> <li> <p>The one definition rule (or ODR for short) is a well-known rule in C++. The ODR has three parts:</p> </li> <li> <p>Within a given file, a function, variable, type, or template can only have one definition.</p> </li> <li> <p>Within a given program, a variable or normal function can only have one definition. This distinction is made because programs can have more than one file (we\u2019ll cover this in the next lesson).</p> </li> <li> <p>Types, templates, inline functions, and inline variables are allowed to have identical definitions in different files. We haven\u2019t covered what most of these things are yet, so don\u2019t worry about this for now -- we\u2019ll bring it back up when it\u2019s relevant.</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/5_%E8%AF%AD%E5%8F%A5/","title":"C++-\u8bed\u53e5","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/5_%E8%AF%AD%E5%8F%A5/#_1","title":"\u8bed\u53e5","text":"<p> \u7ea6 503 \u4e2a\u5b57  20 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/5_%E8%AF%AD%E5%8F%A5/#switch","title":"switch","text":"<ul> <li>\u5185\u90e8\u53d8\u91cf\u5b9a\u4e49\uff0c\u4f7f\u7528\u82b1\u62ec\u53f7\uff1b\u53ea\u5b9a\u4e49\u5728\u8be5\u5757\u5185</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/5_%E8%AF%AD%E5%8F%A5/#try","title":"try\u8bed\u53e5\u5757\u548c\u5f02\u5e38\u5904\u7406","text":"<ul> <li>throw\u8868\u8fbe\u5f0f</li> <li>try{...}catch(runtime_error e){...}</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/5_%E8%AF%AD%E5%8F%A5/#_2","title":"\u6807\u51c6\u5f02\u5e38","text":"<ul> <li>excception\uff1a\u5934\u6587\u4ef6\u4e2d\u5b9a\u4e49\u4e86\u901a\u7528\u7684\u5f02\u5e38\u7c7bexception\u3002\u53ea\u62a5\u544a\u5f02\u5e38\u7684\u53d1\u751f\uff0c\u4e0d\u63d0\u4f9b\u989d\u5916\u7684\u4fe1\u606f</li> <li>stdexcept\uff1a\u5b9a\u4e49\u4e86\u96c6\u4e2d\u5e38\u7528\u7684\u5f02\u5e38\u7c7b</li> <li>new\u5934\u6587\u4ef6\u5b9a\u4e49\u4e86bad_alloc</li> <li> <p>type_info\u5934\u6587\u4ef6\u5b9a\u4e49\u4e86bad_cast\u5f02\u5e38\u7c7b\u578b</p> </li> <li> <p>\u5f02\u5e38\u7c7b\u578b\u53ea\u6709\u4e00\u4e2awhat\u6210\u5458\u51fd\u6570\uff0c\u8fd4\u56de\u503c\u662f\u4e00\u4e2aC\u98ce\u683c\u5b57\u7b26\u4e32</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/5_%E8%AF%AD%E5%8F%A5/#header-guardsinclude-guard","title":"Header guards(include guard)","text":"<ul> <li>\u907f\u514d\u4e00\u4e2a\u5934\u6587\u4ef6\u88ab\u591a\u6b21\u5f15\u7528</li> </ul> C++<pre><code>int getSquareSides()  // from square.h\n{\n    return 4;\n}\n\nint getSquareSides() // from wave.h (via square.h)\n{\n    return 4;\n}\n\nint main()\n{\n    return 0;\n}\n</code></pre> C++<pre><code>#ifndef SOME_UNIQUE_NAME_HERE\n#define SOME_UNIQUE_NAME_HERE\n\n// your declarations (and certain types of definitions) here\n\n#endif\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/5_%E8%AF%AD%E5%8F%A5/#header-guards-do-not-prevent-a-header-from-being-included-once-into-different-code-files","title":"Header guards do not prevent a header from being included once into different code files","text":"<ul> <li>\u5982\u679c\u5728\u5934\u6587\u4ef6\u8fdb\u884c\u51fd\u6570\u5b9a\u4e49\uff0c\u5982\u679c\u6709\u591a\u4e2a\u6e90\u6587\u4ef6\u53ef\u80fd\u9020\u6210\u94fe\u63a5\u5931\u8d25\uff0c\u591a\u6b21\u5b9a\u4e49\u540c\u4e00\u4e2a\u51fd\u6570</li> <li> <p>The best way to work around this issue is simply to put the function definition in one of the .cpp files so that the header just contains a forward declaration:</p> </li> <li> <p>Now when the program is compiled, function getSquareSides will have just one definition (via square.cpp), so the linker is happy. File main.cpp is able to call this function (even though it lives in square.cpp) because it includes square.h, which has a forward declaration for the function (the linker will connect the call to getSquareSides from main.cpp to the definition of getSquareSides in square.cpp).</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/5_%E8%AF%AD%E5%8F%A5/#pragma-once","title":"#pragma once","text":"<ul> <li> <p>\u4e3a\u4e86\u907f\u514d\u540c\u4e00\u4e2a\u5934\u6587\u4ef6\u88abInclude\u591a\u6b21</p> </li> <li> <p>#pragma once \u5e76\u4e0d\u662fC++\u7684\u539f\u751f\u8bed\u6cd5\uff0c\u800c\u662f\u7f16\u8bd1\u5668\u7684\u4e00\u79cd\u652f\u6301\uff0c\u6240\u4ee5\u5e76\u4e0d\u662f\u6240\u6709\u7684\u7f16\u8bd1\u5668\u90fd\u80fd\u591f\u652f\u6301\u3002#ifndef \u5219\u4e3aC++\u7684\u6807\u51c6</p> </li> <li> <p>#ifndef \u4f9d\u8d56\u4e8e\u4e0d\u91cd\u590d\u7684\u5b8f\u540d\u79f0\uff0c\u4fdd\u8bc1\u4e86\u5305\u542b\u5728 #endif \u7684\u5185\u5bb9\u4e0d\u4f1a\u88ab\u91cd\u590d\u5305\u542b\uff0c\u8fd9\u4e2a\u5185\u5bb9\u53ef\u4ee5\u662f\u4e00\u4e2a\u6587\u4ef6\u7684\u6240\u6709\u5185\u5bb9\uff0c\u6216\u8005\u4ec5\u4ec5\u662f\u4e00\u6bb5\u4ee3\u7801\u3002\u800c #pragma once \u5219\u662f\u9488\u5bf9\u7269\u7406\u6587\u4ef6\u7684\u4e00\u4e2a\u6807\u8bb0\uff0c\u6807\u8bb0\u8be5\u6587\u4ef6\u4e0d\u4f1a\u88ab #include \u591a\u6b21\uff0c\u4e0d\u80fd\u53ea\u9488\u5bf9\u6587\u4ef6\u4e2d\u67d0\u6bb5\u4ee3\u7801\u8fdb\u884c\u6807\u8bb0\u3002\u800c\u4e14\uff0c#pragma once \u4e0d\u80fd\u4fdd\u8bc1\u591a\u4e2a\u6587\u4ef6\u7684\u62f7\u8d1d\u4e0d\u4f1a\u88ab\u91cd\u590d\u5305\u542b</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/","title":"C++-\u51fd\u6570","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_1","title":"\u51fd\u6570","text":"<p> \u7ea6 666 \u4e2a\u5b57  39 \u884c\u4ee3\u7801  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_2","title":"\u53c2\u6570\u4f20\u9012","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_3","title":"\u4f20\u503c\u53c2\u6570","text":"<ul> <li>\u5b9e\u53c2\u7684\u503c\u4e0d\u53d8</li> <li>\u521d\u59cb\u503c\u88ab\u62f7\u8d1d\u7ed9\u53d8\u91cf</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_4","title":"\u4f20\u6307\u9488","text":"<ul> <li> <p>\u62f7\u8d1d\u7684\u662f\u6307\u9488\uff0c\u4e24\u4e2a\u6307\u9488\u4e0d\u540c\uff0c\u4f46\u6307\u5411\u76f8\u540c\u7684\u5bf9\u8c61</p> </li> <li> <p>\u53ef\u4ee5\u6539\u53d8\u5b9e\u53c2\u7684\u503c</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_5","title":"\u4f20\u5f15\u7528\u53c2\u6570","text":"<ul> <li>\u7ed1\u5b9a\u4e86\u521d\u59cb\u5316\u5b83\u7684\u5bf9\u8c61</li> <li>\u907f\u514d\u62f7\u8d1d</li> <li>\u51fd\u6570\u4e0d\u9700\u8981\u6539\u53d8\u5f15\u7528\u5f62\u53c2\u7684\u503c\uff0c\u58f0\u660e\u6210\u5e38\u91cf\u5f15\u7528</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#const","title":"const\u5f62\u53c2\u548c\u5b9e\u53c2","text":"<ul> <li>\u5b9e\u53c2\u521d\u59cb\u5316\u5f62\u53c2\u65f6\u4f1a\u5ffd\u7565\u6389\u9876\u5c42const</li> <li>\u5c3d\u53ef\u80fd\u4f7f\u7528\u5e38\u91cf\u5f15\u7528</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_6","title":"\u6570\u7ec4\u5f62\u53c2","text":"C++<pre><code>void print(const char *cp);\nvoid print(const int *beg, const int *end); // \u4f20\u9012\u6307\u5411\u6570\u7ec4\u9996\u90e8\u548c\u5c3e\u90e8\u7684\u6307\u9488\nvoid print(const int ia[], size_t size);\nvoid print(int (&amp;arr)[10]);\nvoid print(int (*arr)[10]); // \u4f20\u9012\u591a\u7ef4\u6570\u7ec4\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_7","title":"\u53ef\u53d8\u5f62\u53c2","text":"<ul> <li>initializer_list\u5f62\u53c2\uff1a\u53c2\u6570\u6570\u91cf\u672a\u77e5\u4f46\u5168\u90e8\u5b9e\u53c2\u7c7b\u578b\u76f8\u540c</li> <li>\u8be5\u5bf9\u8c61\u4e2d\u7684\u5143\u7d20\u6c38\u8fdc\u662f\u5e38\u91cf\u503c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_8","title":"\u7701\u7565\u7b26\u5f62\u53c2","text":"<ul> <li>\u4f7f\u7528\u4e86varargs\u7684C\u6807\u51c6\u5e93\u529f\u80fd</li> <li>\u7701\u7565\u7b26\u5f62\u53c2\u53ea\u80fd\u51fa\u73b0\u5728\u5f62\u53c2\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_9","title":"\u8fd4\u56de\u503c","text":"<ul> <li>\u53d8\u91cf\u7684\u9012\u51cf\u64cd\u4f5c\u548c\u8bfb\u53d6\u53d8\u91cf\u503c\u7684\u64cd\u4f5c\u5171\u5b58\u4e8e\u540c\u4e00\u6761\u8868\u8fbe\u5f0f\u4e2d\uff0c\u53ef\u80fd\u4ea7\u751f\u672a\u5b9a\u4e49\u7684\u503c</li> </ul> C++<pre><code>int &amp;get(int *array, int index) {return array[index];}  //\u83b7\u53d6\u6570\u7ec4\u4e2dIndex\u5143\u7d20\u7684\u7d22\u5f15\nint main()\n{\n    int ia[10];\n    for(int i = 0; i != 10; ++i)\n        get(ia, i) = i;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_10","title":"\u8fd4\u56de\u4e00\u4e2a\u503c","text":"<ul> <li>\u62f7\u8d1d\u8c03\u7528\u70b9\u7684\u4e00\u4e2a\u4e34\u65f6\u5bf9\u8c61\uff0c\u8be5\u4e34\u65f6\u5bf9\u8c61\u5373\u4e3a\u8fd4\u56de\u7ed3\u679c</li> <li> <p>\u4e0d\u8981\u8fd4\u56de\u5c40\u90e8\u5bf9\u8c61\u7684\u6307\u9488\u6216\u5f15\u7528</p> </li> <li> <p>\u5f15\u7528\u8fd4\u56de\u5de6\u503c\uff1b\u5176\u4ed6\u7c7b\u578b\u8fd4\u56de\u53f3\u503c</p> </li> <li>\u5217\u8868\u521d\u59cb\u5316\u8fd4\u56de\u503c\uff1a\u5bf9\u8fd4\u56de\u7684\u4e34\u65f6\u91cf\u8fdb\u884c\u521d\u59cb\u5316</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_11","title":"\u58f0\u660e\u4e00\u4e2a\u8fd4\u56de\u6570\u7ec4\u6307\u9488\u7684\u51fd\u6570","text":"C++<pre><code>int (*func(int i))[10];\n// \u5c3e\u7f6e\u7c7b\u578b\nauto func(int i) -&gt; int(*)[10];\n// decltype\nint odd[] = {1,3,5,7,9};\nint even[] = {2,4,6,8,10};\ndecltype(odd) *arrPtr(int i) {\n    return (i % 2) ? &amp;odd : &amp;even;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_12","title":"\u51fd\u6570\u91cd\u8f7d","text":"<ul> <li>\u4e0d\u533a\u5206\u9876\u5c42const\u7684\u5f62\u53c2</li> <li>\u6ce8\u610f\u91cd\u8f7d\u51fd\u6570\u7684\u4f5c\u7528\u57df</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_13","title":"\u9ed8\u8ba4\u5b9e\u53c2","text":"<ul> <li>\u51fd\u6570\u58f0\u660e\u4e2d\u6307\u5b9a\u9ed8\u8ba4\u5b9e\u53c2\uff0c\u5e76\u5c06\u58f0\u660e\u653e\u5728\u5408\u9002\u7684\u5934\u6587\u4ef6\u4e2d</li> <li>\u5c40\u90e8\u53d8\u91cf\u4e0d\u80fd\u4f5c\u4e3a\u9ed8\u8ba4\u5b9e\u53c2</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_14","title":"\u5185\u8054\u51fd\u6570","text":"<ul> <li>\u5728\u6bcf\u4e2a\u8c03\u7528\u70b9\u201c\u5185\u8054\u5730\u201d\u5c55\u5f00</li> <li>\u5185\u8054\u673a\u5236\u7528\u4e8e\u4f18\u5316\u89c4\u6a21\u8f83\u5c0f\uff0c\u6d41\u7a0b\u76f4\u63a5\uff0c\u9891\u7e41\u8c03\u7528\u7684\u51fd\u6570</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#constexpr","title":"constexpr\u51fd\u6570","text":"<ul> <li>\u5e38\u91cf\u8868\u8fbe\u5f0f\u7684\u51fd\u6570</li> <li>\u8fd4\u56de\u7c7b\u578b\u548c\u6240\u6709\u5f62\u53c2\u7684\u7c7b\u578b\u5747\u662f\u5b57\u9762\u503c\u7c7b\u578b\uff0c\u51fd\u6570\u4f53\u6709\u4e14\u53ea\u6709\u4e00\u6761return\u8bed\u53e5</li> </ul> C++<pre><code>constexpr int new_sz(){return 42;}\nconstexpr int foo = new_sz();\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_15","title":"\u5b9e\u53c2\u7c7b\u578b\u8f6c\u6362","text":"<ul> <li>\u7cbe\u786e\u5339\u914d</li> <li>\u5f62\u53c2\u548c\u5b9e\u53c2\u7c7b\u578b\u76f8\u540c</li> <li>\u5b9e\u53c2\u7531\u6570\u7ec4\u6216\u51fd\u6570\u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u6307\u9488</li> <li>\u5411\u5b9e\u53c2\u4e2d\u6dfb\u52a0/\u5220\u9664\u9876\u5c42const</li> <li>const\u8f6c\u6362\u5b9e\u73b0\u7684\u5339\u914d\uff08\u975e\u5e38\u91cf\u7684\u5730\u5740\u8f6c\u6362\u6210const\u7684\u5730\u5740\uff09</li> <li>\u7c7b\u578b\u63d0\u5347\uff08\u5c0f\u6574\u6570\u7c7b\u578b\u8f6c\u6362\u4e3a\u5927\u6574\u6570\u7c7b\u578b\uff09</li> <li>\u7b97\u6570\u7c7b\u578b\u8f6c\u6362\u6216\u6307\u9488\u8f6c\u6362\uff08\u5728\u8fd0\u7b97\u4e2d\u7c7b\u578b\u6539\u53d8\uff09</li> <li>\u5373\u4f7f\u5f88\u5c0f\u7684\u6574\u6570\u503c\u4e5f\u4f1a\u76f4\u63a5\u63d0\u5347\u6210int\u7c7b\u578b</li> </ul> C++<pre><code>void ff(int);\nvoid ff(short);\nff('a');    // char\u63d0\u5347\u6210int\uff0c\u8c03\u7528ff(int);\n</code></pre> <ul> <li>\u7c7b\u7c7b\u578b\u8f6c\u6362\u5b9e\u73b0\u7684\u5339\u914d</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_16","title":"\u4e8c\u4e49\u6027","text":"<ul> <li>\u6240\u6709\u7684\u7b97\u6570\u7c7b\u578b\u8f6c\u6362\u7ea7\u522b\u90fd\u76f8\u540c</li> </ul> C++<pre><code>void manip(long);\nvoid manip(float);\nmanip(3.14);\n// \u65e2\u53ef\u4ee5\u8f6c\u6362\u6210float\u4e5f\u80fd\u8f6c\u6362\u6210long\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#_17","title":"\u51fd\u6570\u6307\u9488","text":"C++<pre><code>bool (*pr)(const string&amp;, const string&amp;);\npr = lengthCompare;\npr = &amp;lengthCompare;\n\nbool b1 = pr(\"hello\", \"goodbye\");\nbool b2 = (*pr)(\"hello\", \"goodbye\");\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/6_%E5%87%BD%E6%95%B0/#autodecltype","title":"\u5c06auto\u548cdecltype\u7528\u4e8e\u51fd\u6570\u6307\u9488\u7c7b\u578b","text":"C++<pre><code>auto f1(int) -&gt; int(*)(int*, int);\nstring::size_type sumLength(const string&amp;, const string &amp;);\ndecltype(sumLength) *getFcn(const string &amp;);    // \u4f7f\u7528decltype\u4f5c\u7528\u67d0\u4e2a\u51fd\u6570\u65f6\uff0c\u8fd4\u56de\u51fd\u6570\u672c\u8eab\u7c7b\u578b\u800c\u975e\u6307\u9488\u7c7b\u578b\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/","title":"C++-\u7c7b","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_1","title":"\u7c7b","text":"<p> \u7ea6 840 \u4e2a\u5b57  66 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#this","title":"this\u6307\u9488","text":"<ul> <li>\u6210\u5458\u51fd\u6570\u901a\u8fc7this\u6307\u9488\u8bbf\u95ee\u8c03\u7528\u5b83\u7684\u90a3\u4e2a\u5bf9\u8c61</li> <li>this\u5f62\u53c2\u662f\u9690\u5f0f\u5b9a\u4e49\u7684\uff1bthis\u662f\u4e00\u4e2a\u5e38\u91cf\u6307\u9488</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#const","title":"const\u6210\u5458\u51fd\u6570","text":"<ul> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cthis\u7684\u7c7b\u578b\u662f\u6307\u5411\u7c7b\u7c7b\u578b\u975e\u5e38\u91cf\u7248\u672c\u7684\u5e38\u91cf\u6307\u9488</li> <li>\u9700\u8981\u5c06this\u58f0\u660e\u4e3a\u6307\u5411\u5e38\u91cf\u7684\u6307\u9488</li> </ul> C++<pre><code>std::string isbn() const {return this-&gt;bookNo;}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_2","title":"\u6784\u9020\u51fd\u6570","text":"<ul> <li>\u53ea\u6709\u7c7b\u6ca1\u6709\u58f0\u660e\u4efb\u4f55\u6784\u9020\u51fd\u6570\u65f6\uff0c\u7f16\u8bd1\u5668\u624d\u4f1a\u81ea\u52a8\u751f\u6210\u9ed8\u8ba4\u6784\u9020\u51fd\u6570</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#default","title":"=default\u542b\u4e49","text":"<ul> <li>\u4f5c\u7528\u5b8c\u5168\u7b49\u540c\u4e8e\u4e4b\u524d\u4f7f\u7528\u7684\u5408\u6210\u9ed8\u8ba4\u6784\u9020\u51fd\u6570</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#classstruct","title":"class\u548cstruct","text":"<ul> <li>\u5e0c\u671b\u5b9a\u4e49\u7684\u7c7b\u7684\u6240\u6709\u6210\u5458\u662fpublic\u65f6\uff0c\u4f7f\u7528struct</li> <li>\u5e0c\u671b\u6210\u5458\u662fprivate\u7684\uff0c\u4f7f\u7528class</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_3","title":"\u53cb\u5143","text":"<ul> <li>\u7c7b\u5141\u8bb8\u5176\u4ed6\u7c7b\u6216\u8005\u51fd\u6570\u8bbf\u95ee\u5b83\u7684\u975e\u516c\u6709\u6210\u5458</li> <li>\u53cb\u5143\u51fd\u6570\u53ea\u80fd\u51fa\u73b0\u5728\u7c7b\u5b9a\u4e49\u7684\u5185\u90e8</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_4","title":"\u7c7b\u7684\u5176\u5b83\u7279\u6027","text":"<ul> <li>\u6210\u5458\u51fd\u6570\u4f5c\u4e3a\u5185\u8054\u51fd\u6570</li> <li>\u91cd\u8f7d\u6210\u5458\u51fd\u6570</li> <li>\u53ef\u53d8\u6570\u636e\u6210\u5458\uff1a\u5373\u4f7f\u662fconst\u5bf9\u8c61\u6210\u5458\uff0c\u8be5\u503c\u4ecd\u53ef\u6539\u53d8</li> </ul> C++<pre><code>class Screen {\npublic:\n    void some_member() const;\nprivate:\n    mutable size_t access_ctr;\n};\nvoid Screen::some_member() const\n{\n    ++access_ctr;\n}\n</code></pre> <ul> <li> <p>\u4ececonst\u6210\u5458\u51fd\u6570\u8fd4\u56de*this\uff1a\u662f\u4e00\u4e2aconst\u5bf9\u8c61</p> </li> <li> <p>\u57fa\u4e8econst\u7684\u91cd\u8f7d</p> </li> </ul> C++<pre><code>class Screen {\npublic:\n    Screen &amp;display(std::ostream &amp;os)\n            {do_display(os); return *this;}\n    const Screen &amp;display(std::ostream &amp;os) const       \n            {do_display(os); return *this;} // \u5e38\u91cf\u5bf9\u8c61\u8c03\u7528\u7684\u51fd\u6570\nprivate:\n    void do_display(std::ostream &amp;os) const {os &lt;&lt; contents;}\n};\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_5","title":"\u53cb\u5143\u6df1\u5165","text":"<ul> <li>\u7c7b\u4e4b\u95f4\u7684\u53cb\u5143</li> <li>\u4ee4\u6210\u5458\u51fd\u6570\u4f5c\u4e3a\u53cb\u5143</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_6","title":"\u53cb\u5143\u58f0\u660e","text":"<ul> <li>\u5728\u7c7b\u5185\u90e8\u5b9a\u4e49\u8be5\u51fd\u6570\uff0c\u5fc5\u987b\u5728\u7c7b\u5916\u90e8\u63d0\u4f9b\u76f8\u5e94\u7684\u58f0\u660e\u4f7f\u5f97\u51fd\u6570\u53ef\u89c1</li> </ul> C++<pre><code>struct X {\n  friend void f() {}\n  X() {f();}    // error: f is not be declared\n  void g();\n  void h();\n};\n\nvoid X::g() {return f();}   // error: f is not be declared\nvoid f();\nvoid X::h() {return f();}   // right!\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_7","title":"\u540d\u5b57\u67e5\u627e\u548c\u7c7b\u7684\u4f5c\u7528\u57df","text":"<ul> <li>\u7f16\u8bd1\u5668\u5904\u7406\u5b8c\u7c7b\u4e2d\u7684\u5168\u90e8\u58f0\u660e\u624d\u5904\u7406\u6210\u5458\u51fd\u6570\u7684\u5b9a\u4e49\uff08\u5982\u679c\u5728\u7c7b\u4e2d\u4e3a\u67e5\u627e\u5230\u540d\u5b57\uff0c\u5230\u7c7b\u4f5c\u7528\u57df\u5916\u5c42\u7ee7\u7eed\u5bfb\u627e\uff09</li> <li>\u7c7b\u578b\u540d\u4e00\u822c\u5b9a\u4e49\u5728\u7c7b\u5f00\u59cb\u5904</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_8","title":"\u6784\u9020\u51fd\u6570\u518d\u63a2","text":"<ul> <li>\u4f7f\u7528\u6784\u9020\u51fd\u6570\u521d\u59cb\u503c\uff1a\u6548\u7387\u95ee\u9898\uff0c\u6709\u4e9b\u6570\u636e\u6210\u5458\u5fc5\u987b\u88ab\u521d\u59cb\u5316</li> <li>\u5c3d\u53ef\u80fd\u907f\u514d\u7528\u67d0\u4e9b\u6210\u5458\u521d\u59cb\u5316\u5176\u5b83\u6210\u5458</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_9","title":"\u9690\u5f0f\u7684\u7c7b\u7c7b\u578b\u8f6c\u6362","text":"<ul> <li>\u53ea\u5141\u8bb8\u4e00\u6b65\u8f6c\u6362\uff0c\u5c06\u5b57\u9762\u503c\u8f6c\u6362\u4e3astring\uff0c\u7c7b\u7684\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u5c06\u751f\u6210string\u7c7b\u578b\u7684\u7c7b</li> <li>\u6291\u5236\u6784\u9020\u51fd\u6570\u5b9a\u4e49\u7684\u9690\u5f0f\u8f6c\u6362\uff1aexplicit\u53ea\u7528\u4e8e\u76f4\u63a5\u521d\u59cb\u5316</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_10","title":"\u805a\u5408\u7c7b","text":"<ul> <li>\u6210\u5458\u5747\u4e3apublic</li> <li>\u6ca1\u6709\u4efb\u4f55\u6784\u9020\u51fd\u6570</li> <li>\u6ca1\u6709\u7c7b\u5185\u521d\u59cb\u503c</li> <li>\u6ca1\u6709\u57fa\u7c7b\u548c\u865a\u51fd\u6570</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_11","title":"\u5b57\u9762\u503c\u5e38\u91cf\u7c7b","text":"<ul> <li>\u6570\u636e\u6210\u5458\u5747\u662f\u5b57\u9762\u503c\u7684\u805a\u5408\u7c7b</li> <li>\u53e6\u4e00\u79cd</li> <li>\u6570\u636e\u6210\u5458\u662f\u5b57\u9762\u503c</li> <li>\u7c7b\u4e2d\u81f3\u5c11\u5305\u542b\u4e00\u4e2aconstexpr\u6784\u9020\u51fd\u6570</li> <li>\u7c7b\u5185\u521d\u59cb\u503c\u662f\u4e00\u4e2a\u5e38\u91cf\u8868\u8fbe\u5f0f</li> <li>\u5fc5\u987b\u4f7f\u7528\u6790\u6784\u51fd\u6570\u7684\u9ed8\u8ba4\u5b9a\u4e49\uff0c\u8be5\u6210\u5458\u8d1f\u8d23\u9500\u6bc1\u7c7b\u7684\u5bf9\u8c61</li> </ul> C++<pre><code>class Debeg {\npublic:\n    constexpr Debug(bool b = true): hw(b), io(b), other(b){}\n    constexpr bool any() {return hw || io || other;}\n    ...\nprivate:\n    bool hw;\n    bool io;\n    bool other;\n};\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#_12","title":"\u7c7b\u7684\u9759\u6001\u6210\u5458","text":"<ul> <li> <p>\u4e0d\u5305\u542bthis\u6307\u9488\uff0c\u4e5f\u4e0d\u80fd\u58f0\u660e\u6210const\uff0c\u4e5f\u4e0d\u80fd\u518d\u5185\u90e8\u4f7f\u7528this\u6307\u9488</p> </li> <li> <p>\u5fc5\u987b\u5728\u7c7b\u7684\u5916\u90e8\u5b9a\u4e49\u548c\u521d\u59cb\u5316\u6bcf\u4e2a\u9759\u6001\u6210\u5458</p> </li> <li> <p>\uff08\u9759\u6001\u5e38\u91cf\u6210\u5458\uff09\u7c7b\u7684\u5185\u90e8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u521d\u59cb\u503c\uff0c\u7c7b\u5916\u6210\u5458\u7684\u5b9a\u4e49\u4e0d\u80fd\u5728\u6307\u5b9a\u4e00\u4e2a\u521d\u59cb\u503c\u4e86</p> </li> <li> <p>\u9759\u6001\u6210\u5458\u53ef\u4ee5\u4f5c\u4e3a\u9ed8\u8ba4\u5b9e\u53c2\uff1b\u800c\u975e\u9759\u6001\u6570\u636e\u6210\u5458\u672c\u8eab\u662f\u5bf9\u8c61\u7684\u4e00\u90e8\u5206\uff0c\u4e0d\u80fd\u4f5c\u4e3a\u9ed8\u8ba4\u5b9e\u53c2</p> </li> <li> <p>\u53ef\u4ee5\u8bbf\u95ee\u7c7b\u7684\u79c1\u6709\u6210\u5458</p> </li> </ul> C++<pre><code>class Account {\npublic:\n    void calculate() {amount += amount*interestRate;}\nprivate:\n    static double interrestRate;\n    void initRate(double newRate);\n};\n\ndouble Account::interestRate = initRate();\n</code></pre> <ul> <li>\u5b9a\u4e49\u9759\u6001\u6210\u5458\u51fd\u6570\u53ef\u4ee5\u5728\u7c7b\u5185\u4e5f\u53ef\u4ee5\u5728\u7c7b\u5916\uff1bstatic\u5173\u952e\u5b57\u53ea\u51fa\u73b0\u5728\u7c7b\u5185</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/7_%E7%B1%BB/#inline","title":"inline\uff08\u5185\u8054\uff09\u51fd\u6570","text":"<ul> <li>\u5728\u7c7b\u5185\u5b9a\u4e49\u7684\u51fd\u6570\u81ea\u52a8\u6210\u4e3a\u5185\u8054\u51fd\u6570</li> </ul> C++<pre><code>// ctors\u653e\u5728private\n// \u5355\u4f8b\u6a21\u5f0f\nclass A {\npublic:\n    static A&amp; getInstance();\n    setup(){}\nprivate:\n    A();\n    A(const A&amp; rhs);\n};\n\nA&amp; A::getInstance()\n{\n    static A a;\n    return a;\n}\n</code></pre> <ul> <li>class with pointer members\u5fc5\u987b\u6709\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u548c\u62f7\u8d1d\u8d4b\u503c\u8fd0\u7b97\u7b26</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/8_IO%E5%BA%93/","title":"C++-IO\u5e93","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/8_IO%E5%BA%93/#io","title":"IO\u5e93","text":"<p> \u7ea6 337 \u4e2a\u5b57  2 \u884c\u4ee3\u7801  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/8_IO%E5%BA%93/#io-class","title":"IO class","text":"<ul> <li>IO\u5bf9\u8c61\u65e0\u62f7\u8d1d\uff0c\u65e0\u8d4b\u503c\uff1a\u4e0d\u80fd\u4f5c\u4e3a\u53c2\u6570\u548c\u8fd4\u56de\u503c</li> <li>\u8bfb\u5199\u4e00\u4e2aIO\u5bf9\u8c61\u4f1a\u6539\u53d8\u5176\u72b6\u6001\uff0c\u4f20\u9012\u548c\u8fd4\u56de\u7684\u5f15\u7528\u4e0d\u80fd\u662fconst</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/8_IO%E5%BA%93/#_1","title":"\u6761\u4ef6\u72b6\u6001","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/8_IO%E5%BA%93/#_2","title":"\u7ba1\u7406\u8f93\u51fa\u7f13\u51b2","text":"<ul> <li> <p>\u7a0b\u5e8f\u5d29\u6e83\uff0c\u8f93\u51fa\u7f13\u51b2\u533a\u4e0d\u4f1a\u88ab\u5237\u65b0</p> </li> <li> <p>\u6bcf\u4e2a\u8f93\u51fa\u6d41\u90fd\u7ba1\u7406\u4e00\u4e2a\u7f13\u51b2\u533a</p> </li> <li> <p>\u7f13\u51b2\u5237\u65b0</p> </li> <li> <p>\u7a0b\u5e8f\u6b63\u5e38\u7ed3\u675f\uff0c\u4f5c\u4e3amain\u51fd\u6570\u7684return\u64cd\u4f5c\u4e00\u90e8\u5206\uff0c\u7f13\u51b2\u88ab\u6267\u884c</p> </li> <li>\u7f13\u51b2\u533a\u6ee1\u65f6\uff0c\u9700\u8981\u5237\u65b0\u7f13\u51b2</li> <li>endl\u7b49\u64cd\u7eb5\u7b26\uff0c\u663e\u793a\u5237\u65b0\u7f13\u51b2\u533a</li> <li>\u8bbe\u7f6eunitbuf\u6765\u6e05\u7a7a\u7f13\u51b2\u533a</li> <li> <p>\u4e00\u4e2a\u8f93\u51fa\u6d41\u53ef\u80fd\u88ab\u5173\u8054\u5230\u53e6\u4e00\u4e2a\u6d41\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8bfb\u5199\u88ab\u5173\u8054\u7684\u6d41\u65f6\uff0c\u5173\u8054\u5230\u7684\u6d41\u7684\u7f13\u51b2\u533a\u4f1a\u88ab\u5237\u65b0</p> </li> <li> <p>endl\uff1a\u8f93\u51fa\u6362\u884c\u7b26\uff0c\u5237\u65b0\u7f13\u51b2\u533a</p> </li> <li> <p>flush\uff1a\u5237\u65b0\u7f13\u51b2\u533a\uff0c\u4e0d\u9644\u52a0\u4efb\u4f55\u989d\u5916\u5b57\u7b26</p> </li> <li> <p>ends\uff1a\u8f93\u51fa\u4e00\u4e2a\u7a7a\u5b57\u7b26\uff0c\u5237\u65b0\u7f13\u51b2\u533a</p> </li> </ul> C++<pre><code>cout &lt;&lt; unitbuf;  // \u6240\u6709\u8f93\u51fa\u64cd\u4f5c\u7acb\u5373\u5237\u65b0\u7f13\u51b2\u533a\ncout &lt;&lt; nounitbuf;    // \u56de\u5230\u6b63\u5e38\u7684\u7f13\u51b2\u65b9\u5f0f\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/8_IO%E5%BA%93/#_3","title":"\u6587\u4ef6\u8f93\u5165\u8f93\u51fa","text":"<ul> <li>\u81ea\u52a8\u6784\u9020\u548c\u6790\u6784\uff1a\u51fa\u4f5c\u7528\u57df\uff0c\u7acb\u5373\u9500\u6bc1</li> <li>\u5f53\u4e00\u4e2afstream\u5bf9\u8c61\u88ab\u9500\u6bc1\u65f6\uff0cclose\u81ea\u52a8\u8c03\u7528</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/8_IO%E5%BA%93/#_4","title":"\u6587\u4ef6\u6a21\u5f0f","text":"<ul> <li>\u4ee5out\u6a21\u5f0f\u6253\u5f00\u6587\u4ef6\u4e22\u5f03\u5df2\u6709\u6570\u636e\uff1b\u907f\u514d\u6e05\u7a7a\u540c\u65f6\u6307\u5b9aapp</li> <li>\u6bcf\u6b21\u8c03\u7528open\u786e\u5b9a\u6587\u4ef6\u6a21\u5f0f\uff08\u663e\u793a\u6216\u9690\u5f0f\uff08out | trunc\uff09\uff09</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/8_IO%E5%BA%93/#string","title":"string\u6d41","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/","title":"C++-\u987a\u5e8f\u5bb9\u5668","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_1","title":"\u987a\u5e8f\u5bb9\u5668","text":"<p> \u7ea6 1048 \u4e2a\u5b57  27 \u884c\u4ee3\u7801  17 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_2","title":"\u6982\u8ff0","text":"<ul> <li>vector, deque\u5728\u5185\u5b58\u4e2d\u8fde\u7eed\u4fdd\u5b58\uff1blist\u4e0d\u652f\u6301&lt;\u8fd0\u7b97</li> <li>\u901a\u5e38\uff0c\u4f7f\u7528vector\u662f\u6700\u597d\u7684\u9009\u62e9</li> <li>\u968f\u673a\u8bbf\u95ee\u5143\u7d20\uff0c\u7528vector\u6216deque</li> <li>\u5bb9\u5668\u4e2d\u95f4\u63d2\u5165\u6216\u5220\u9664\uff0c\u7528list\u6216forward_list</li> <li>\u5934\u5c3e\u63d2\u5165\u6216\u5220\u9664\uff0c\u7528deque</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_3","title":"\u5bb9\u5668\u5e93","text":"<ul> <li>\u987a\u5e8f\u5bb9\u5668\u51e0\u4e4e\u53ef\u4ee5\u4fdd\u5b58\u4efb\u610f\u7c7b\u578b\u7684\u5143\u7d20\uff1b\u4e5f\u53ef\u4ee5\u4fdd\u5b58\u5bb9\u5668\u7684\u5bb9\u5668</li> </ul> C++<pre><code>// noDefault\u662f\u4e00\u4e2a\u6ca1\u6709\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u7684\u7c7b\u578b\nvector&lt;noDefault&gt; v1(20, init);   // \u63d0\u4f9b\u5143\u7d20\u521d\u59cb\u5316\u5668\nvector&lt;noDefault&gt; v2(10);     // \u5fc5\u987b\u63d0\u4f9b\u4e00\u4e2a\u5143\u7d20\u521d\u59cb\u5316\u5668\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_4","title":"\u5bb9\u5668\u64cd\u4f5c","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_5","title":"\u8fed\u4ee3\u5668","text":"<ul> <li>\u8fed\u4ee3\u5668\u8303\u56f4\u7531\u4e00\u5bf9\u8fed\u4ee3\u5668\u8868\u793a\uff0c\u4e24\u4e2a\u8fed\u4ee3\u5668\u5206\u522b\u6307\u5411\u540c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u7684\u5143\u7d20\u6216\u8005\u662f\u5c3e\u5143\u7d20\u4e4b\u540e\u7684\u4f4d\u7f6e\uff1b\u5de6\u95ed\u5408\u533a\u95f4</li> </ul> Text Only<pre><code>[begin, end)\n</code></pre> <ul> <li>str.size()\u7684\u7c7b\u578b\u5c31\u662fsize_type</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#begin-end","title":"begin &amp; end","text":"<ul> <li> <p>begin, end\u6210\u5458\u90fd\u88ab\u91cd\u8f7d\u8fc7\uff1b\u4e00\u4e2a\u662fconst\u6210\u5458\uff0c\u8fd4\u56de\u5bb9\u5668\u7684const_iterator\u7c7b\u578b\uff0c\u53e6\u4e00\u4e2a\u662f\u975e\u5e38\u91cf\u6210\u5458\uff0c\u8fd4\u56de\u5bb9\u5668\u7684iterator\u7c7b\u578b</p> </li> <li> <p>\u4e0d\u9700\u8981\u5199\u8bbf\u95ee\u65f6\uff0c\u4f7f\u7528cbegin\u548ccend</p> </li> </ul> C++<pre><code>auto it7 = a.begin();   // if a is const, it7 is const_iterator\nauto it8 = a.cbegin();  // it8 is const_iterator\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_6","title":"\u5bb9\u5668\u5b9a\u4e49\u548c\u521d\u59cb\u5316","text":"<ul> <li>\u5bb9\u5668\u521d\u59cb\u5316\u4e3a\u53e6\u4e00\u4e2a\u5bb9\u5668\u7684\u62f7\u8d1d\uff1a\u76f4\u63a5\u62f7\u8d1d\u6574\u4e2a\u5bb9\u5668\uff1b\u62f7\u8d1d\u7531\u4e00\u4e2a\u8fed\u4ee3\u5668\u5bf9\u6307\u5b9a\u7684\u5143\u7d20\u8303\u56f4\uff08\u7c7b\u578b\u76f8\u5bb9\u5373\u53ef\uff09</li> <li> <p>\u62f7\u8d1d\u65f6\uff0c\u4e24\u4e2a\u5bb9\u5668\u7684\u5bb9\u5668\u7c7b\u578b\u548c\u5143\u7d20\u7c7b\u578b\u5fc5\u987b\u76f8\u540c\uff08const char*\u53ef\u4ee5\u8f6c\u6362\u6210string\uff09</p> </li> <li> <p>\u53ea\u6709\u987a\u5e8f\u5bb9\u5668\u7684\u6784\u9020\u51fd\u6570\u63a5\u6536\u5927\u5c0f\u53c2\u6570\uff0c\u5173\u8054\u5bb9\u5668\u4e0d\u652f\u6301</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#array","title":"array\u5177\u6709\u56fa\u5b9a\u5927\u5c0f","text":"C++<pre><code>array&lt;int, 42&gt;\narray&lt;string, 10&gt;\n</code></pre> <ul> <li>\u5185\u7f6e\u6570\u7ec4\u4e0d\u5141\u8bb8\u8fdb\u884c\u62f7\u8d1d\u6216\u5bf9\u8c61\u8d4b\u503c\u64cd\u4f5c\uff0c\u4f46\u662farray\u53ef\u4ee5</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#swap","title":"\u8d4b\u503c\u548cswap","text":"<ul> <li>array\u53f3\u8fb9\u8fd0\u7b97\u5bf9\u8c61\u7684\u5927\u5c0f\u53ef\u80fd\u548c\u5de6\u8fb9\u5927\u5c0f\u4e0d\u540c\uff0carray\u4e0d\u652f\u6301assign\uff0c\u4e5f\u4e0d\u5141\u8bb8\u7528\u82b1\u62ec\u53f7\u5305\u56f4\u7684\u503c\u5217\u8868\u8fdb\u884c\u8d4b\u503c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#assign","title":"assign","text":"<ul> <li>\u8d4b\u503c\u8981\u6c42\u8fd0\u7b97\u5bf9\u8c61\u6709\u76f8\u540c\u7684\u7c7b\u578b\uff1bassign\u5141\u8bb8\u4ece\u4e00\u4e2a\u4e0d\u540c\u4f46\u76f8\u5bb9\u7684\u7c7b\u578b\u8d4b\u503c</li> <li>\u65e7\u5143\u7d20\u88ab\u66ff\u6362\uff0c\u4f20\u9012\u7ed9assign\u7684\u8fed\u4ee3\u5668\u4e0d\u80fd\u6307\u5411\u8c03\u7528assign\u7684\u5bb9\u5668</li> </ul> C++<pre><code>list&lt;string&gt; names;\nvector&lt;const char*&gt; oldstyle;\nnames = oldstyle;   // \u9519\u8bef\uff0c\u5bb9\u5668\u7c7b\u578b\u4e0d\u5339\u914d\nnames.assign(oldsyle.cbegin(), oldstyle.cend());\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#swap_1","title":"swap","text":"<ul> <li>swap\u64cd\u4f5c\u4ea4\u6362\u4e24\u4e2a\u76f8\u540c\u7c7b\u578b\u5bb9\u5668\u7684\u5185\u5bb9\uff1b\u4e24\u4e2a\u5bb9\u5668\u7684\u5143\u7d20\u4f1a\u4ea4\u6362</li> <li>\u9664array\u5916\uff0c\u5143\u7d20\u672c\u8eab\u672a\u4ea4\u6362\uff0c\u53ea\u662f\u4ea4\u6362\u4e86\u4e24\u4e2a\u5bb9\u5668\u7684\u5185\u90e8\u6570\u636e\u7ed3\u6784</li> <li>\u9664string\u5916\uff0citerator, reference, pointer\u5747\u4e0d\u4f1a\u5931\u6548</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_7","title":"\u5bb9\u5668\u5927\u5c0f\u64cd\u4f5c","text":"<ul> <li>\u5173\u7cfb\u8fd0\u7b97\u7b26\u4e24\u8fb9\u7684\u8fd0\u7b97\u5bf9\u8c61\u5fc5\u987b\u662f\u76f8\u540c\u7c7b\u578b\u7684\u5bb9\u5668\uff0c\u4e14\u5fc5\u987b\u4fdd\u5b58\u76f8\u540c\u7c7b\u578b\u7684\u5143\u7d20</li> <li>\u6bd4\u8f83\u4e24\u4e2a\u5bb9\u5668\u5b9e\u9645\u4e0a\u662f\u8fdb\u884c\u5143\u7d20\u7684\u9010\u5bf9\u6bd4\u8f83</li> <li>\u76f8\u540c\u5927\u5c0f\u4e14\u5143\u7d20\u76f8\u7b49\uff0c\u5219\u76f8\u7b49</li> <li>\u4e24\u4e2a\u5bb9\u5668\u5927\u5c0f\u4e0d\u540c\uff0c\u4f46\u8f83\u5c0f\u5bb9\u5668\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u7b49\u4e8e\u8f83\u5927\u5bb9\u5668\u7684\u5143\u7d20\uff0c\u8f83\u5c0f\u5bb9\u5668\u5c0f\u4e8e\u8f83\u5927\u5bb9\u5668</li> <li>\u4e24\u4e2a\u5bb9\u5668\u90fd\u4e0d\u662f\u53e6\u4e00\u4e2a\u5bb9\u5668\u7684\u524d\u7f00\u5b50\u5e8f\u5217\uff0c\u6bd4\u8f83\u7ed3\u679c\u53d6\u51b3\u4e8e\u7b2c\u4e00\u4e2a\u4e0d\u76f8\u7b49\u5143\u7d20\u7684\u6bd4\u8f83\u7ed3\u679c</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_8","title":"\u987a\u5e8f\u5bb9\u5668\u64cd\u4f5c","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_9","title":"\u6dfb\u52a0\u5143\u7d20","text":"<ul> <li>\u5bb9\u5668\u5143\u7d20\u662f\u62f7\u8d1d\uff1b\u7528\u4e00\u4e2a\u5bf9\u8c61\u521d\u59cb\u5316\u5bb9\u5668\u6216\u63d2\u5165\u5bb9\u5668\u65f6\uff0c\u5b9e\u9645\u4e0a\u653e\u5165\u5230\u5bb9\u5668\u4e2d\u7684\u662f\u5bf9\u8c61\u503c\u7684\u4e00\u4e2a\u62f7\u8d1d</li> </ul> C++<pre><code>vector&lt;string&gt; svec;\nlist&lt;string&gt; slist;\n\n// euqal to slist.push_front(\"Hello!\")\nslist.insert(slist.begin(), \"Hello!\");\n\n// \u63d2\u5165\u5230vector\u672b\u5c3e\u4e4b\u5916\u7684\u4efb\u4f55\u4f4d\u7f6e\u90fd\u53ef\u80fd\u5f88\u6162\nsvec.insert(svec.begin(), \"Hello!\");\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#emplace","title":"emplace","text":"<ul> <li>\u4e0d\u62f7\u8d1d\u5143\u7d20\u800c\u662f\u76f4\u63a5\u5c06\u5143\u7d20\u653e\u7f6e\u5728\u5bb9\u5668\u5934\u90e8\uff0c\u4efb\u610f\u4f4d\u7f6e\uff0c\u5c3e\u90e8</li> <li>\u5c06\u5143\u7d20\u4f20\u9012\u7ed9\u5143\u7d20\u7c7b\u578b\u7684\u6784\u9020\u51fd\u6570\uff1b\u5728\u5bb9\u5668\u7ba1\u7406\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u76f4\u63a5\u6784\u9020\u51fd\u6570</li> </ul> C++<pre><code>c.emplace_back();   // default constructor\nc.emplace(iter, \"999\"); // Sales_data(string)\nc.emplace_front(\"999\", 25, 15.99);\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_10","title":"\u8bbf\u95ee\u5143\u7d20","text":"<ul> <li>\u8bbf\u95ee\u5143\u7d20\u8fd4\u56de\u7684\u662f\u5f15\u7528</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_11","title":"\u5220\u9664\u5143\u7d20","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#forward_list","title":"\u7279\u6b8a\u7684forward_list\u64cd\u4f5c","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_12","title":"\u6539\u53d8\u5bb9\u5668\u5927\u5c0f","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_13","title":"\u5bb9\u5668\u64cd\u4f5c\u53ef\u80fd\u4f7f\u8fed\u4ee3\u5668\u5931\u6548","text":"<ul> <li>\u4fdd\u8bc1\u6bcf\u6b21\u6539\u53d8\u5bb9\u5668\u7684\u64cd\u4f5c\u4e4b\u540e\u90fd\u6b63\u786e\u5730\u91cd\u65b0\u5b9a\u4f4d\u8fed\u4ee3\u5668</li> </ul> C++<pre><code>while(begin != v.end()) {   // after adding or deleting, recompute end of vector\n    ++begin;\n    begin = v.insert(begin, 42);\n    ++begin;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#vector","title":"vector\u5bf9\u8c61\u589e\u957f","text":"<ul> <li>\u5bb9\u5668\u4e2d\u5143\u7d20\u8fde\u7eed\u5b58\u50a8\uff0c\u4e14\u5bb9\u5668\u5927\u5c0f\u53ef\u53d8</li> <li>\u5f53\u4e0d\u5f97\u4e0d\u83b7\u53d6\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\u65f6\uff0cvector\u548cstring\u7684\u5b9e\u73b0\u901a\u5e38\u4f1a\u5206\u914d\u6bd4\u65b0\u7684\u7a7a\u95f4\u9700\u6c42\u66f4\u5927\u7684\u5185\u5b58\u7a7a\u95f4</li> </ul> <ul> <li>reverse\u4ec5\u4ec5\u5f71\u54cdvector\u9884\u5148\u5206\u914d\u591a\u5927\u7684\u5185\u5b58\u7a7a\u95f4</li> <li>size\u662f\u5bb9\u5668\u4e2d\u5b9e\u9645\u5143\u7d20\u4e2a\u6570\uff1bcapacity\u662f\u5bb9\u5668\u6700\u591a\u5bb9\u7eb3\u4e2a\u6570</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#string","title":"\u989d\u5916\u7684string\u64cd\u4f5c","text":"<ul> <li>substr(pos, n)\uff1a\u8fd4\u56de\u4e00\u4e2astring\uff0c\u5305\u542bs\u4e2d\u4ecepos\u5f00\u59cb\u7684n\u4e2a\u5b57\u7b26\u62f7\u8d1d</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#string_1","title":"\u4fee\u6539string","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#string_2","title":"string\u641c\u7d22\u64cd\u4f5c","text":"<ul> <li>find\u51fd\u6570\u5b8c\u6210\u6700\u7b80\u5355\u7684\u641c\u7d22\uff1b\u82e5\u627e\u5230\uff0c\u8fd4\u56de\u7b2c\u4e00\u4e2a\u5339\u914d\u4f4d\u7f6e\u7684\u4e0b\u6807\uff0c\u5426\u5219\u8fd4\u56denpos</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#compare","title":"compare","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_14","title":"\u6570\u503c\u8f6c\u6362","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/9_%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/#_15","title":"\u5bb9\u5668\u9002\u914d\u5668","text":"<ul> <li>stack, queue, priority_queue</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/","title":"C++-Makefile\u8bed\u6cd5\u5b66\u4e60","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#makefile","title":"Makefile","text":"<p> \u7ea6 538 \u4e2a\u5b57  183 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#_1","title":"\u4f7f\u7528\u6761\u4ef6\u5224\u65ad","text":"Makefile<pre><code>libs_for_gcc = -lgnu\nnormal_libs =\nfoo: $(objects)\nifeq ($(CC),gcc)\n    $(CC) -o foo $(objects) $(libs_for_gcc)\nelse\n    $(CC) -o foo $(objects) $(normal_libs)\nendif\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#_2","title":"\u4f7f\u7528\u51fd\u6570","text":"","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#_3","title":"\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570","text":"Makefile<pre><code>$(subst &lt;from&gt;,&lt;to&gt;,&lt;text&gt;)\n\u2022 \u540d\u79f0\uff1a\u5b57\u7b26\u4e32\u66ff\u6362\u51fd\u6570\n\u2022 \u529f\u80fd\uff1a\u628a\u5b57\u4e32 &lt;text&gt; \u4e2d\u7684 &lt;from&gt; \u5b57\u7b26\u4e32\u66ff\u6362\u6210 &lt;to&gt; \u3002\n\u2022 \u8fd4\u56de\uff1a\u51fd\u6570\u8fd4\u56de\u88ab\u66ff\u6362\u8fc7\u540e\u7684\u5b57\u7b26\u4e32\u3002\n\n$(patsubst &lt;pattern&gt;,&lt;replacement&gt;,&lt;text&gt;)\n\u2022 \u540d\u79f0\uff1a\u6a21\u5f0f\u5b57\u7b26\u4e32\u66ff\u6362\u51fd\u6570\u3002\n\u2022 \u529f\u80fd\uff1a\u67e5\u627e &lt;text&gt; \u4e2d\u7684\u5355\u8bcd\uff08\u5355\u8bcd\u4ee5\u201c\u7a7a\u683c\u201d\u3001\u201cTab\u201d\u6216\u201c\u56de\u8f66\u201d\u201c\u6362\u884c\u201d\u5206\u9694\uff09\u662f\u5426\u7b26\u5408\u6a21\u5f0f\n&lt;pattern&gt; \uff0c\u5982\u679c\u5339\u914d\u7684\u8bdd\uff0c\u5219\u4ee5 &lt;replacement&gt; \u66ff\u6362\u3002\u8fd9\u91cc\uff0c&lt;pattern&gt; \u53ef\u4ee5\u5305\u62ec\u901a\u914d\u7b26 % \uff0c\n\u8868\u793a\u4efb\u610f\u957f\u5ea6\u7684\u5b57\u4e32\u3002\u5982\u679c &lt;replacement&gt; \u4e2d\u4e5f\u5305\u542b % \uff0c\u90a3\u4e48\uff0c&lt;replacement&gt; \u4e2d\u7684\u8fd9\u4e2a % \u5c06\u662f\n&lt;pattern&gt; \u4e2d\u7684\u90a3\u4e2a % \u6240\u4ee3\u8868\u7684\u5b57\u4e32\u3002\uff08\u53ef\u4ee5\u7528 \\ \u6765\u8f6c\u4e49\uff0c\u4ee5 \\% \u6765\u8868\u793a\u771f\u5b9e\u542b\u4e49\u7684 % \u5b57\u7b26\uff09\n\u2022 \u8fd4\u56de\uff1a\u51fd\u6570\u8fd4\u56de\u88ab\u66ff\u6362\u8fc7\u540e\u7684\u5b57\u7b26\u4e32\u3002\n$(objects:.o=.c) \u548c $(patsubst %.o,%.c,$(objects)) \u662f\u4e00\u6837\u7684\n\n$(strip &lt;string&gt;)\n\u2022 \u540d\u79f0\uff1a\u53bb\u7a7a\u683c\u51fd\u6570\u3002\n\u2022 \u529f\u80fd\uff1a\u53bb\u6389 &lt;string&gt; \u5b57\u4e32\u4e2d\u5f00\u5934\u548c\u7ed3\u5c3e\u7684\u7a7a\u5b57\u7b26\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u88ab\u53bb\u6389\u7a7a\u683c\u7684\u5b57\u7b26\u4e32\u503c\u3002\n\n$(findstring &lt;find&gt;,&lt;in&gt;)\n\u2022 \u540d\u79f0\uff1a\u67e5\u627e\u5b57\u7b26\u4e32\u51fd\u6570\n\u2022 \u529f\u80fd\uff1a\u5728\u5b57\u4e32 &lt;in&gt; \u4e2d\u67e5\u627e &lt;find&gt; \u5b57\u4e32\u3002\n\u2022 \u8fd4\u56de\uff1a\u5982\u679c\u627e\u5230\uff0c\u90a3\u4e48\u8fd4\u56de &lt;find&gt; \uff0c\u5426\u5219\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u3002\n\n$(filter &lt;pattern...&gt;,&lt;text&gt;)\n\u2022 \u540d\u79f0\uff1a\u8fc7\u6ee4\u51fd\u6570\n\u2022 \u529f\u80fd\uff1a\u4ee5 &lt;pattern&gt; \u6a21\u5f0f\u8fc7\u6ee4 &lt;text&gt; \u5b57\u7b26\u4e32\u4e2d\u7684\u5355\u8bcd\uff0c\u4fdd\u7559\u7b26\u5408\u6a21\u5f0f &lt;pattern&gt; \u7684\u5355\u8bcd\u3002\u53ef\u4ee5\n\u6709\u591a\u4e2a\u6a21\u5f0f\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u7b26\u5408\u6a21\u5f0f &lt;pattern&gt; \u7684\u5b57\u4e32\u3002\n\n$(filter-out &lt;pattern...&gt;,&lt;text&gt;)\n\u2022 \u540d\u79f0\uff1a\u53cd\u8fc7\u6ee4\u51fd\u6570\n\u2022 \u529f\u80fd\uff1a\u4ee5 &lt;pattern&gt; \u6a21\u5f0f\u8fc7\u6ee4 &lt;text&gt; \u5b57\u7b26\u4e32\u4e2d\u7684\u5355\u8bcd\uff0c\u53bb\u9664\u7b26\u5408\u6a21\u5f0f &lt;pattern&gt; \u7684\u5355\u8bcd\u3002\u53ef\u4ee5\n\u6709\u591a\u4e2a\u6a21\u5f0f\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u4e0d\u7b26\u5408\u6a21\u5f0f &lt;pattern&gt; \u7684\u5b57\u4e32\u3002\n\n$(sort &lt;list&gt;)\n\u2022 \u540d\u79f0\uff1a\u6392\u5e8f\u51fd\u6570\n\u2022 \u529f\u80fd\uff1a\u7ed9\u5b57\u7b26\u4e32 &lt;list&gt; \u4e2d\u7684\u5355\u8bcd\u6392\u5e8f\uff08\u5347\u5e8f\uff09\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u6392\u5e8f\u540e\u7684\u5b57\u7b26\u4e32\u3002\n\u2022 \u793a\u4f8b\uff1a$(sort foo bar lose) \u8fd4\u56de bar foo lose \u3002\n\u2022 \u5907\u6ce8\uff1asort \u51fd\u6570\u4f1a\u53bb\u6389 &lt;list&gt; \u4e2d\u76f8\u540c\u7684\u5355\u8bcd\u3002\n\n$(word &lt;n&gt;,&lt;text&gt;)\n\u2022 \u540d\u79f0\uff1a\u53d6\u5355\u8bcd\u51fd\u6570\n\u2022 \u529f\u80fd\uff1a\u53d6\u5b57\u7b26\u4e32 &lt;text&gt; \u4e2d\u7b2c &lt;n&gt; \u4e2a\u5355\u8bcd\u3002\uff08\u4ece\u4e00\u5f00\u59cb\uff09\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u5b57\u7b26\u4e32 &lt;text&gt; \u4e2d\u7b2c &lt;n&gt; \u4e2a\u5355\u8bcd\u3002\u5982\u679c &lt;n&gt; \u6bd4 &lt;text&gt; \u4e2d\u7684\u5355\u8bcd\u6570\u8981\u5927\uff0c\u90a3\u4e48\u8fd4\u56de\u7a7a\u5b57\n\u7b26\u4e32\u3002\n\n$(wordlist &lt;ss&gt;,&lt;e&gt;,&lt;text&gt;)\n\u2022 \u540d\u79f0\uff1a\u53d6\u5355\u8bcd\u4e32\u51fd\u6570\n\u2022 \u529f\u80fd\uff1a\u4ece\u5b57\u7b26\u4e32 &lt;text&gt; \u4e2d\u53d6\u4ece &lt;ss&gt; \u5f00\u59cb\u5230 &lt;e&gt; \u7684\u5355\u8bcd\u4e32\u3002&lt;ss&gt; \u548c &lt;e&gt; \u662f\u4e00\u4e2a\u6570\u5b57\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u5b57\u7b26\u4e32 &lt;text&gt; \u4e2d\u4ece &lt;ss&gt; \u5230 &lt;e&gt; \u7684\u5355\u8bcd\u5b57\u4e32\u3002\u5982\u679c &lt;ss&gt; \u6bd4 &lt;text&gt; \u4e2d\u7684\u5355\u8bcd\u6570\u8981\u5927\uff0c\n\u90a3\u4e48\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u3002\u5982\u679c &lt;e&gt; \u5927\u4e8e &lt;text&gt; \u7684\u5355\u8bcd\u6570\uff0c\u90a3\u4e48\u8fd4\u56de\u4ece &lt;ss&gt; \u5f00\u59cb\uff0c\u5230 &lt;text&gt; \u7ed3\u675f\u7684\n\u5355\u8bcd\u4e32\u3002\n\n$(words &lt;text&gt;)\n\u2022 \u540d\u79f0\uff1a\u5355\u8bcd\u4e2a\u6570\u7edf\u8ba1\u51fd\u6570\n\u2022 \u529f\u80fd\uff1a\u7edf\u8ba1 &lt;text&gt; \u4e2d\u5b57\u7b26\u4e32\u4e2d\u7684\u5355\u8bcd\u4e2a\u6570\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de &lt;text&gt; \u4e2d\u7684\u5355\u8bcd\u6570\u3002\n\n$(firstword &lt;text&gt;)\n\u2022 \u540d\u79f0\uff1a\u9996\u5355\u8bcd\u51fd\u6570\u2014\u2014firstword\u3002\n\u2022 \u529f\u80fd\uff1a\u53d6\u5b57\u7b26\u4e32 &lt;text&gt; \u4e2d\u7684\u7b2c\u4e00\u4e2a\u5355\u8bcd\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u5b57\u7b26\u4e32 &lt;text&gt; \u7684\u7b2c\u4e00\u4e2a\u5355\u8bcd\u3002\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#_4","title":"\u6587\u4ef6\u540d\u64cd\u4f5c\u51fd\u6570","text":"Makefile<pre><code>$(dir &lt;names...&gt;)\n\u2022 \u540d\u79f0\uff1a\u53d6\u76ee\u5f55\u51fd\u6570\u2014\u2014dir\u3002\n\u2022 \u529f\u80fd\uff1a\u4ece\u6587\u4ef6\u540d\u5e8f\u5217 &lt;names&gt; \u4e2d\u53d6\u51fa\u76ee\u5f55\u90e8\u5206\u3002\u76ee\u5f55\u90e8\u5206\u662f\u6307\u6700\u540e\u4e00\u4e2a\u53cd\u659c\u6760\uff08/ \uff09\u4e4b\u524d\u7684\u90e8\u5206\u3002\n\u5982\u679c\u6ca1\u6709\u53cd\u659c\u6760\uff0c\u90a3\u4e48\u8fd4\u56de ./ \u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u6587\u4ef6\u540d\u5e8f\u5217 &lt;names&gt; \u7684\u76ee\u5f55\u90e8\u5206\u3002\n\n$(notdir &lt;names...&gt;)\n\u2022 \u540d\u79f0\uff1a\u53d6\u6587\u4ef6\u51fd\u6570\u2014\u2014notdir\u3002\n\u2022 \u529f\u80fd\uff1a\u4ece\u6587\u4ef6\u540d\u5e8f\u5217 &lt;names&gt; \u4e2d\u53d6\u51fa\u975e\u76ee\u5f55\u90e8\u5206\u3002\u975e\u76ee\u5f55\u90e8\u5206\u662f\u6307\u6700\u5f8c\u4e00\u4e2a\u53cd\u659c\u6760\uff08/ \uff09\u4e4b\u540e\u7684\u90e8\n\u5206\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u6587\u4ef6\u540d\u5e8f\u5217 &lt;names&gt; \u7684\u975e\u76ee\u5f55\u90e8\u5206\u3002\n\n$(basename &lt;names...&gt;)\n\u2022 \u540d\u79f0\uff1a\u53d6\u524d\u7f00\u51fd\u6570\u2014\u2014basename\u3002\n\u2022 \u529f\u80fd\uff1a\u4ece\u6587\u4ef6\u540d\u5e8f\u5217 &lt;names&gt; \u4e2d\u53d6\u51fa\u5404\u4e2a\u6587\u4ef6\u540d\u7684\u524d\u7f00\u90e8\u5206\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u6587\u4ef6\u540d\u5e8f\u5217 &lt;names&gt; \u7684\u524d\u7f00\u5e8f\u5217\uff0c\u5982\u679c\u6587\u4ef6\u6ca1\u6709\u524d\u7f00\uff0c\u5219\u8fd4\u56de\u7a7a\u5b57\u4e32\u3002\n\n$(addsuffix &lt;suffix&gt;,&lt;names...&gt;)\n\u2022 \u540d\u79f0\uff1a\u52a0\u540e\u7f00\u51fd\u6570\u2014\u2014addsuffix\u3002\n\u2022 \u529f\u80fd\uff1a\u628a\u540e\u7f00 &lt;suffix&gt; \u52a0\u5230 &lt;names&gt; \u4e2d\u7684\u6bcf\u4e2a\u5355\u8bcd\u540e\u9762\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u52a0\u8fc7\u540e\u7f00\u7684\u6587\u4ef6\u540d\u5e8f\u5217\u3002\n\n$(addprefix &lt;prefix&gt;,&lt;names...&gt;)\n\u2022 \u540d\u79f0\uff1a\u52a0\u524d\u7f00\u51fd\u6570\u2014\u2014addprefix\u3002\n\u2022 \u529f\u80fd\uff1a\u628a\u524d\u7f00 &lt;prefix&gt; \u52a0\u5230 &lt;names&gt; \u4e2d\u7684\u6bcf\u4e2a\u5355\u8bcd\u540e\u9762\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u52a0\u8fc7\u524d\u7f00\u7684\u6587\u4ef6\u540d\u5e8f\u5217\u3002\n\n$(join &lt;list1&gt;,&lt;list2&gt;)\n\u2022 \u540d\u79f0\uff1a\u8fde\u63a5\u51fd\u6570\u2014\u2014join\u3002\n\u2022 \u529f\u80fd\uff1a\u628a &lt;list2&gt; \u4e2d\u7684\u5355\u8bcd\u5bf9\u5e94\u5730\u52a0\u5230 &lt;list1&gt; \u7684\u5355\u8bcd\u540e\u9762\u3002\u5982\u679c &lt;list1&gt; \u7684\u5355\u8bcd\u4e2a\u6570\u8981\u6bd4\n&lt;list2&gt; \u7684\u591a\uff0c\u90a3\u4e48\uff0c&lt;list1&gt; \u4e2d\u7684\u591a\u51fa\u6765\u7684\u5355\u8bcd\u5c06\u4fdd\u6301\u539f\u6837\u3002\u5982\u679c &lt;list2&gt; \u7684\u5355\u8bcd\u4e2a\u6570\u8981\u6bd4\n&lt;list1&gt; \u591a\uff0c\u90a3\u4e48\uff0c&lt;list2&gt; \u591a\u51fa\u6765\u7684\u5355\u8bcd\u5c06\u88ab\u590d\u5236\u5230 &lt;list1&gt; \u4e2d\u3002\n\u2022 \u8fd4\u56de\uff1a\u8fd4\u56de\u8fde\u63a5\u8fc7\u540e\u7684\u5b57\u7b26\u4e32\u3002\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#vpath","title":"vpath","text":"<ul> <li>vpath %.h include    //\u6307\u5b9a.h\u7c7b\u578b\u6587\u4ef6\u7684\u641c\u7d22\u8def\u5f84\u662finclude</li> </ul> <p>vpath %.cpp src      //\u6307\u5b9a.cpp\u7c7b\u578b\u6587\u4ef6\u7684\u641c\u7d22\u8def\u5f84\u662fsrc</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#foreach","title":"foreach\u51fd\u6570","text":"Makefile<pre><code>names := a b c d\nfiles := $(foreach n,$(names),$(n).o)\n$(files) \u7684\u503c\u662f a.o b.o c.o d.o\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#call","title":"call\u51fd\u6570","text":"Makefile<pre><code>reverse = $(1) $(2)\nfoo = $(call reverse,a,b)\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#origin","title":"origin\u51fd\u6570","text":"<ul> <li>origin \u51fd\u6570\u4e0d\u50cf\u5176\u5b83\u7684\u51fd\u6570\uff0c\u4ed6\u5e76\u4e0d\u64cd\u4f5c\u53d8\u91cf\u7684\u503c\uff0c\u4ed6\u53ea\u662f\u544a\u8bc9\u4f60\u4f60\u7684\u8fd9\u4e2a\u53d8\u91cf\u662f\u54ea\u91cc\u6765\u7684\uff1f\u5176\u8bed\u6cd5\u662f\uff1a<code>$(origin &lt;variable&gt;)</code></li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#shell","title":"shell\u51fd\u6570","text":"Makefile<pre><code>contents := $(shell cat foo)\nfiles := $(shell echo *.c)\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#make","title":"\u63a7\u5236make\u7684\u51fd\u6570","text":"Makefile<pre><code>$(error &lt;text...&gt;)\n\n$(warning &lt;text...&gt;)\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#_5","title":"\u4f2a\u76ee\u6807","text":"Makefile<pre><code>.PHONY: all\nall: prog1 prog2 prog3\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#_6","title":"\u9690\u542b\u89c4\u5219","text":"<ul> <li>\u9690\u542b\u89c4\u5219\u5c31\u4f1a\u751f\u6548\u3002\u9ed8\u8ba4\u7684\u540e\u7f00\u5217\u8868\u662f\uff1a.out,.a, .ln, .o, .c, .cc, .C, .p, .f, .F, .r, .y, .l, .s, .S, .mod, .sym, .def, .h, .info, .dvi, .tex, .texinfo, .texi, .txinfo, .w, .ch .web, .sh, .elc, .el</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#_7","title":"\u5e38\u7528\u9690\u542b\u89c4\u5219","text":"<ul> <li>\u7f16\u8bd1C\u7a0b\u5e8f\u7684\u9690\u542b\u89c4\u5219\u3002   \u201c.o\u201d\u7684\u76ee\u6807\u7684\u4f9d\u8d56\u76ee\u6807\u4f1a\u81ea\u52a8\u63a8\u5bfc\u4e3a\u201c.c\u201d\uff0c\u5e76\u4e14\u5176\u751f\u6210\u547d\u4ee4\u662f<code>\u201c$(CC) \u2013c $(CPPFLAGS) $(CFLAGS)\u201d</code></li> <li>\u7f16\u8bd1C++\u7a0b\u5e8f\u7684\u9690\u542b\u89c4\u5219\u3002   \u201c.o\u201d \u7684\u76ee\u6807\u7684\u4f9d\u8d56\u76ee\u6807\u4f1a\u81ea\u52a8\u63a8\u5bfc\u4e3a\u201c.cc\u201d\u6216\u662f\u201c.C\u201d\uff0c\u5e76\u4e14\u5176\u751f\u6210\u547d\u4ee4\u662f<code>\u201c$(CXX) \u2013c $(CPPFLAGS) $(CFLAGS)\u201d</code>\u3002\uff08\u5efa\u8bae\u4f7f\u7528\u201c.cc\u201d\u4f5c\u4e3aC++\u6e90\u6587\u4ef6\u7684\u540e\u7f00\uff0c\u800c\u4e0d\u662f\u201c.C\u201d\uff09</li> <li>\u6c47\u7f16\u548c\u6c47\u7f16\u9884\u5904\u7406\u7684\u9690\u542b\u89c4\u5219\u3002   \u201c.o\u201d \u7684\u76ee\u6807\u7684\u4f9d\u8d56\u76ee\u6807\u4f1a\u81ea\u52a8\u63a8\u5bfc\u4e3a\u201c.s\u201d\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7f16\u8bd1\u54c1\u201cas\u201d\uff0c\u5e76\u4e14\u5176\u751f\u6210\u547d\u4ee4\u662f\uff1a<code>\u201c$(AS) $(ASFLAGS)\u201d</code>\u3002\u201c.s\u201d \u7684\u76ee\u6807\u7684\u4f9d\u8d56\u76ee\u6807\u4f1a\u81ea\u52a8\u63a8\u5bfc\u4e3a\u201c.S\u201d\uff0c\u9ed8\u8ba4\u4f7f\u7528C\u9884\u7f16\u8bd1\u5668\u201ccpp\u201d\uff0c\u5e76\u4e14\u5176\u751f\u6210\u547d\u4ee4\u662f\uff1a<code>\u201c$(AS) $(ASFLAGS)\u201d</code>\u3002</li> <li>\u201c\u201d \u76ee\u6807\u4f9d\u8d56\u4e8e\u201c.o\u201d\uff0c\u901a\u8fc7\u8fd0\u884cC\u7684\u7f16\u8bd1\u5668\u6765\u8fd0\u884c\u94fe\u63a5\u7a0b\u5e8f\u751f\u6210\uff08\u4e00\u822c\u662f\u201cld\u201d\uff09\uff0c\u5176\u751f\u6210\u547d\u4ee4\u662f\uff1a<code>\u201c$(CC) $(LDFLAGS) &lt;n&gt;.o $(LOADLIBES) $(LDLIBS)\u201d</code>\u3002</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#_8","title":"\u81ea\u52a8\u5316\u53d8\u91cf","text":"Makefile<pre><code>\u2022 $@ : \u8868\u793a\u89c4\u5219\u4e2d\u7684\u76ee\u6807\u6587\u4ef6\u96c6\u3002\u5728\u6a21\u5f0f\u89c4\u5219\u4e2d\uff0c\u5982\u679c\u6709\u591a\u4e2a\u76ee\u6807\uff0c\u90a3\u4e48\uff0c$@ \u5c31\u662f\u5339\u914d\u4e8e\u76ee\u6807\u4e2d\u6a21\n\u5f0f\u5b9a\u4e49\u7684\u96c6\u5408\u3002\n\n\u2022 $% : \u4ec5\u5f53\u76ee\u6807\u662f\u51fd\u6570\u5e93\u6587\u4ef6\u4e2d\uff0c\u8868\u793a\u89c4\u5219\u4e2d\u7684\u76ee\u6807\u6210\u5458\u540d\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u4e2a\u76ee\u6807\u662f foo.a(bar.o)\n\uff0c\u90a3\u4e48\uff0c$% \u5c31\u662f bar.o \uff0c$@ \u5c31\u662f foo.a \u3002\u5982\u679c\u76ee\u6807\u4e0d\u662f\u51fd\u6570\u5e93\u6587\u4ef6\uff08Unix \u4e0b\u662f .a \uff0cWindows\n\u4e0b\u662f .lib \uff09\uff0c\u90a3\u4e48\uff0c\u5176\u503c\u4e3a\u7a7a\u3002\n\n\u2022 $&lt; : \u4f9d\u8d56\u76ee\u6807\u4e2d\u7684\u7b2c\u4e00\u4e2a\u76ee\u6807\u540d\u5b57\u3002\u5982\u679c\u4f9d\u8d56\u76ee\u6807\u662f\u4ee5\u6a21\u5f0f\uff08\u5373 % \uff09\u5b9a\u4e49\u7684\uff0c\u90a3\u4e48 $&lt; \u5c06\u662f\u7b26\u5408\u6a21\n\u5f0f\u7684\u4e00\u7cfb\u5217\u7684\u6587\u4ef6\u96c6\u3002\u6ce8\u610f\uff0c\u5176\u662f\u4e00\u4e2a\u4e00\u4e2a\u53d6\u51fa\u6765\u7684\u3002\n\n\u2022 $? : \u6240\u6709\u6bd4\u76ee\u6807\u65b0\u7684\u4f9d\u8d56\u76ee\u6807\u7684\u96c6\u5408\u3002\u4ee5\u7a7a\u683c\u5206\u9694\u3002\n\n\u2022 $^ : \u6240\u6709\u7684\u4f9d\u8d56\u76ee\u6807\u7684\u96c6\u5408\u3002\u4ee5\u7a7a\u683c\u5206\u9694\u3002\u5982\u679c\u5728\u4f9d\u8d56\u76ee\u6807\u4e2d\u6709\u591a\u4e2a\u91cd\u590d\u7684\uff0c\u90a3\u4e48\u8fd9\u4e2a\u53d8\u91cf\u4f1a\u53bb\u9664\n\u91cd\u590d\u7684\u4f9d\u8d56\u76ee\u6807\uff0c\u53ea\u4fdd\u7559\u4e00\u4efd\u3002\n\n\u2022 $+ : \u8fd9\u4e2a\u53d8\u91cf\u5f88\u50cf $^ \uff0c\u4e5f\u662f\u6240\u6709\u4f9d\u8d56\u76ee\u6807\u7684\u96c6\u5408\u3002\u53ea\u662f\u5b83\u4e0d\u53bb\u9664\u91cd\u590d\u7684\u4f9d\u8d56\u76ee\u6807\u3002\n\n\u2022 $* : \u8fd9\u4e2a\u53d8\u91cf\u8868\u793a\u76ee\u6807\u6a21\u5f0f\u4e2d % \u53ca\u5176\u4e4b\u524d\u7684\u90e8\u5206\u3002\u5982\u679c\u76ee\u6807\u662f dir/a.foo.b \uff0c\u5e76\u4e14\u76ee\u6807\u7684\u6a21\u5f0f\u662f\na.%.b \uff0c\u90a3\u4e48\uff0c$* \u7684\u503c\u5c31\u662f dir/a.foo \u3002\u8fd9\u4e2a\u53d8\u91cf\u5bf9\u4e8e\u6784\u9020\u6709\u5173\u8054\u7684\u6587\u4ef6\u540d\u662f\u6bd4\u8f83\u6709\u8f83\u3002\u5982\u679c\u76ee\n\u6807\u4e2d\u6ca1\u6709\u6a21\u5f0f\u7684\u5b9a\u4e49\uff0c\u90a3\u4e48 $* \u4e5f\u5c31\u4e0d\u80fd\u88ab\u63a8\u5bfc\u51fa\uff0c\u4f46\u662f\uff0c\u5982\u679c\u76ee\u6807\u6587\u4ef6\u7684\u540e\u7f00\u662f make \u6240\u8bc6\u522b\u7684\uff0c\n\u90a3\u4e48 $* \u5c31\u662f\u9664\u4e86\u540e\u7f00\u7684\u90a3\u4e00\u90e8\u5206\u3002\u4f8b\u5982\uff1a\u5982\u679c\u76ee\u6807\u662f foo.c \uff0c\u56e0\u4e3a .c \u662f make \u6240\u80fd\u8bc6\u522b\u7684\u540e\u7f00\n\u540d\uff0c\u6240\u4ee5\uff0c$* \u7684\u503c\u5c31\u662f foo \u3002\u8fd9\u4e2a\u7279\u6027\u662f GNU make \u7684\uff0c\u5f88\u6709\u53ef\u80fd\u4e0d\u517c\u5bb9\u4e8e\u5176\u5b83\u7248\u672c\u7684 make\uff0c\u6240\n\u4ee5\uff0c\u4f60\u5e94\u8be5\u5c3d\u91cf\u907f\u514d\u4f7f\u7528 $* \uff0c\u9664\u975e\u662f\u5728\u9690\u542b\u89c4\u5219\u6216\u662f\u9759\u6001\u6a21\u5f0f\u4e2d\u3002\u5982\u679c\u76ee\u6807\u4e2d\u7684\u540e\u7f00\u662f make \u6240\n\u4e0d\u80fd\u8bc6\u522b\u7684\uff0c\u90a3\u4e48 $* \u5c31\u662f\u7a7a\u503c\u3002\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#-nostdlib","title":"-nostdlib","text":"<ul> <li>\u4e0d\u8fde\u63a5\u7cfb\u7edf\u6807\u51c6\u542f\u52a8\u6587\u4ef6\u548c\u6807\u51c6\u5e93\u6587\u4ef6\uff0c\u53ea\u628a\u6307\u5b9a\u7684\u6587\u4ef6\u4f20\u9012\u7ed9\u8fde\u63a5\u5668\u3002\u8fd9\u4e2a\u9009\u9879\u5e38\u7528\u4e8e\u7f16\u8bd1\u5185\u6838\u3001bootloader\u7b49\u7a0b\u5e8f\uff0c\u5b83\u4eec\u4e0d\u9700\u8981\u542f\u52a8\u6587\u4ef6\u3001\u6807\u51c6\u5e93\u6587\u4ef6\u3002</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#-fno-builtin","title":"-fno-builtin","text":"<ul> <li> <p>-fno-builtin\u8fd9\u4e2a\u9009\u9879\u3002\u5b83\u7684\u542b\u4e49\u5373\u4e0d\u4f7f\u7528C\u8bed\u8a00\u7684\u5185\u5efa\u51fd\u6570</p> </li> <li> <p>-fno-builtin-function\uff08\u5176\u4e2dfunction\u4e3a\u8981\u51b2\u7a81\u7684\u51fd\u6570\u540d\uff09</p> </li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#ld-e","title":"ld -e","text":"<ul> <li>\u8bbe\u7f6e\u5165\u53e3\u51fd\u6570</li> <li>_entry</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/Makefile%E5%AD%A6%E4%B9%A0/#_9","title":"\u4f8b\u5b50","text":"Makefile<pre><code>CC=gcc\nCFLAGS=-Wall -Wformat=0\nODIR=obj\nIDIR=../include\nLDIR=../lib\nPROGRAM=client server\n\n_DEPS = error_functions.o get_num.o inet_sockets.o become_daemon.o\nDEPS = $(patsubst %, $(ODIR)/%,$(_DEPS))\n\nall: $(PROGRAM)\n\n# compile\n$(ODIR)/%.o: $(LDIR)/%.c\n    $(CC) -c -o $@ $&lt;\n\n$(ODIR)/%.o: %.c\n    $(CC) -c -o $@ $&lt;\n\n# link\n$(PROGRAM): $(patsubst %, $(ODIR)/%,$(addsuffix .o,$(PROGRAM))) $(DEPS)\n    $(CC) -o $@ $(ODIR)/$@.o $(DEPS) \n\n.PHONY: clean\nclean: \n    rm $(ODIR)/*.o $(PROGRAM)\n</code></pre> Makefile<pre><code> CC = gcc\n TARGET = prog\n SOURCE = $(wildcard ./src/*.c)      #\u83b7\u53d6src\u76ee\u5f55\u4e0b\u6240\u6709.c\u6587\u4ef6\n OBJS = $(patsubst %.c, %.o, $(SOURCE))\n INCLUDE = -I./include\n $(TARGET):$(OBJS)  \n     $(CC) $(OBJS) -o $(TARGET)     #\u53e6\u4e00\u79cd\u5199\u6cd5\uff1a $(CC) -o $(TARGET) $(OBJS)\n %.o:%.c\n     $(CC) $(INCLUDE) -c $^ -o $@   #\u53e6\u4e00\u79cd\u5199\u6cd5\uff1a  $(CC) $(INCLUDE) -c -o $@ $^                                                                       \n .PHONY:clean\n clean:\n     rm $(OBJS) $(TARGET) \n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/","title":"C++-\u5e76\u53d1\u4e0e\u591a\u7ebf\u7a0b\u7f16\u7a0b","text":"<code>#C++</code>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/#_1","title":"\u5e76\u53d1\u4e0e\u591a\u7ebf\u7a0b\u7f16\u7a0b","text":"<p> \u7ea6 397 \u4e2a\u5b57  63 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/#_2","title":"\u7ebf\u7a0b\u4f20\u503c","text":"<ul> <li>\u4f7f\u7528 <code>detach()</code> \u5206\u79bb\u4e24\u4e2a\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u5728\u5b50\u7ebf\u7a0b\u7ed3\u675f\u524d\u5c31\u8dd1\u5b8c\u4e86</li> <li>char*\u53d8\u91cf\u5728\u7ebf\u7a0b\u4e2d\u5730\u5740\u76f8\u540c\uff1b\u4f7f\u7528string\u7c7b\u578b\u5f15\u7528\u6765\u89e3\u51b3\uff1b\u521b\u5efa <code>m_thread</code> \u5bf9\u8c61\u7684\u65f6\u5019\u590d\u5236\u4e00\u4efd\u4e34\u65f6\u53d8\u91cf</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/#_3","title":"\u9690\u5f0f\u8f6c\u6362\u548c\u663e\u793a\u8f6c\u6362","text":"<ul> <li>\u9690\u5f0f\u8f6c\u6362\uff0c\u5bf9\u8c61\u5728\u5b50\u7ebf\u7a0b\u8fdb\u884c\u6784\u9020\uff1b\u5982\u679cdetach\u540emain\u7ebf\u7a0b\u5148\u7ed3\u675f\uff1b\u76f4\u63a5\u5931\u8d25</li> <li> <p>\u663e\u793a\u8f6c\u6362\uff0c\u5bf9\u8c61\u7684\u6784\u5efa\u8fc7\u7a0b\u548c\u62f7\u8d1d\u8fc7\u7a0b\u90fd\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u5b8c\u6210\u7684\uff0c\u8fd9\u5c31\u786e\u4fdd\u4e86\u5b50\u7ebf\u7a0b\u5728\u4f7f\u7528\u8be5\u53c2\u6570\u65f6\u662f\u5b89\u5168\u7684</p> </li> <li> <p>\u4e34\u65f6\u53d8\u91cf\u4f20\u53c2</p> </li> <li>\u5982\u679c\u4f20\u9012int\u8fd9\u79cd\u7b80\u5355\u7c7b\u578b\uff0c\u63a8\u8350\u4f7f\u7528\u503c\u4f20\u9012\uff0c\u4e0d\u8981\u7528\u5f15\u7528\uff1b</li> <li>\u5982\u679c\u4f20\u9012\u7c7b\u5bf9\u8c61\uff0c\u8981\u907f\u514d\u4f7f\u7528\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff0c\u5fc5\u987b\u5728\u4ee3\u7801\u4e2d\u663e\u5f0f\u8f6c\u6362\uff08\u76f8\u5f53\u4e8e\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u53d8\u91cf\uff09\uff0c\u7136\u540e\u5728\u51fd\u6570\u53c2\u6570\u91cc\uff0c\u7528\u5f15\u7528\u6765\u63a5\uff08\uff09\uff0c\u867d\u7136\u8be5\u65b9\u6cd5\u5b89\u5168\uff0c\u4f46\u4e0d\u6613\u7406\u89e3\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c</li> <li>\u4e0d\u5efa\u8bae\u4f7f\u7528 detach()\uff0c\u7528\u4e86\u975e\u5e38\u5bb9\u6613\u51fa\u95ee\u9898</li> </ul>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/#_4","title":"\u4f20\u9012\u7c7b\u5bf9\u8c61\uff0c\u667a\u80fd\u6307\u9488","text":"<ul> <li>\u53c2\u6570\u662f\u4e00\u4e2a\u62f7\u8d1d\u51fa\u6765\u7684\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u5b50\u7ebf\u7a0b\u4e2d\u4fee\u6539\u8be5\u5bf9\u8c61\u4e2d\u7684\u6210\u5458\uff0c\u662f\u4e0d\u4f1a\u4f20\u56de\u7ed9\u4e3b\u7ebf\u7a0b\u7684</li> <li>\u5c06\u201c\u5047\u201d\u5f15\u7528\u53d8\u4e3a\u771f\u5f15\u7528\uff1b\u4f7f\u7528std::ref()</li> </ul> C++<pre><code>class A {\n public:\n  mutable int m_i; /* \u6dfb\u52a0mutable\u4fee\u9970\uff0c\u8ba9m_i\u80fd\u88ab\u4fee\u6539 */\n  /* \u6784\u9020\u51fd\u6570\uff0c\u6b64\u5904\u5b9e\u9645\u4e0a\u662f\u628a\u4e00\u4e2aint\u8f6c\u6210\u7c7b\u578bA\u7684\u5bf9\u8c61\uff0c\u53c8\u79f0\u4e3a\u7c7b\u578b\u8f6c\u6362\u6784\u9020\u51fd\u6570 */\n  A(int a) : m_i(a) { cout &lt;&lt; \"[A::A(int a) exec]\" &lt;&lt; endl; }\n  /* \u62f7\u8d1d\u6784\u9020\u51fd\u6570 */\n  A(const A &amp;a) : m_i(a.m_i) { cout &lt;&lt; \"[A::A(const A &amp;a) exec]\" &lt;&lt; endl; }\n  /* \u6790\u6784\u51fd\u6570 */\n  ~A() { cout &lt;&lt; \"[A::~A() exec]\" &lt;&lt; endl; }\n};\n\nvoid my_print(const A &amp;pbuf) {\n  pbuf.m_i = 66;\n  cout &lt;&lt; \"my_print pbuf.m_i = \" &lt;&lt; pbuf.m_i &lt;&lt; endl;\n  return;\n}\n\nint main() {\n  A obj(10);\n  thread m_thread(my_print, ref(obj));\n  m_thread.join();\n\n  cout &lt;&lt; \"main obj.m_i = \" &lt;&lt; obj.m_i &lt;&lt; endl;\n  cout &lt;&lt; \"Hello World!\" &lt;&lt; endl;\n  return 0;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/c%2B%2Bprimer/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/#_5","title":"\u7528\u6210\u5458\u51fd\u6570\u6307\u9488\u505a\u7ebf\u7a0b\u51fd\u6570","text":"<ul> <li>thread(argv[])</li> <li>argv[0]\uff1a\u6210\u5458\u51fd\u6570\u6307\u9488</li> <li>argv[1]\uff1aA\u7c7b\u5bf9\u8c61</li> <li>argv[2]\uff1a\u56de\u8c03\u51fd\u6570\u53c2\u6570</li> </ul> C++<pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\nusing namespace std;\n\nclass A\n{\npublic:\n    int m_i;\n    /* \u6784\u9020\u51fd\u6570\uff0c\u6b64\u5904\u5b9e\u9645\u4e0a\u662f\u628a\u4e00\u4e2aint\u8f6c\u6210\u7c7b\u578bA\u7684\u5bf9\u8c61\uff0c\u53c8\u79f0\u4e3a\u7c7b\u578b\u8f6c\u6362\u6784\u9020\u51fd\u6570 */\n    A(int a) : m_i(a) { cout &lt;&lt; \"[A::A(int a) exec]\" &lt;&lt; endl; }\n    /* \u62f7\u8d1d\u6784\u9020\u51fd\u6570 */\n    A(const A &amp;a) : m_i(a.m_i) { cout &lt;&lt; \"[A::A(const A &amp;a) exec]\" &lt;&lt; endl; }\n    /* \u6790\u6784\u51fd\u6570 */\n    ~A() { cout &lt;&lt; \"[A::~A() exec]\" &lt;&lt; endl; }\n    /* \u6210\u5458\u51fd\u6570\u505a\u7ebf\u7a0b\u56de\u8c03\u51fd\u6570 */\n    void thread_work(int num)\n    {\n        cout &lt;&lt; \"thread_work exec\" &lt;&lt; endl;\n    }\n};\n\nint main()\n{\n    A obj(10);\n    int var = 15;\n    /* \u53c2\u6570\u4e00\uff1a\u6210\u5458\u51fd\u6570\u6307\u9488 */\n    /* \u53c2\u6570\u4e8c\uff1aA\u7c7b\u5bf9\u8c61 */\n    /* \u53c2\u6570\u4e09\uff1a\u56de\u8c03\u51fd\u6570\u53c2\u6570 */\n    /* \u53c2\u6570..\uff1a\u56de\u8c03\u51fd\u6570\u53c2\u6570 */\n    thread m_thread(&amp;A::thread_work, obj, var);         /* obj\u5bf9\u8c61\u4f1a\u88ab\u62f7\u8d1d\u4e00\u4efd\u4f20\u5165\u5b50\u7ebf\u7a0b */\n    // thread m_thread(&amp;A::thread_work, ref(obj), var); /* obj\u5bf9\u8c61\u76f4\u63a5\u4f20\u5165\u5b50\u7ebf\u7a0b */\n    // thread m_thread(&amp;A::thread_work, &amp;obj, var);     /* \u4e0estd::ref()\u4e00\u6837\uff0cobj\u5bf9\u8c61\u4e5f\u662f\u76f4\u63a5\u4f20\u5165\u5b50\u7ebf\u7a0b(&amp;obj\u4e3a\u53d6\u5730\u5740) */\n    m_thread.join();\n\n    cout &lt;&lt; \"Hello World!\" &lt;&lt; endl;\n    return 0;\n}\n</code></pre>","tags":["C++"]},{"location":"notes/linux%20tools/1-grep/","title":"3.1 grep","text":""},{"location":"notes/linux%20tools/1-grep/#31-grep","title":"3.1 grep","text":"<p> \u7ea6 74 \u4e2a\u5b57  59 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <ul> <li>\u5168\u9762\u641c\u7d22\u6b63\u5219\u8868\u8fbe\u5f0f\u5e76\u628a\u884c\u6253\u5370\u51fa\u6765\uff09\u662f\u4e00\u79cd\u5f3a\u5927\u7684\u6587\u672c\u641c\u7d22\u5de5\u5177\uff0c\u5b83\u80fd\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u641c\u7d22\u6587\u672c\uff0c\u5e76\u628a\u5339\u914d\u7684\u884c\u6253\u5370\u51fa\u6765\u3002\u7528\u4e8e\u8fc7\u6ee4/\u641c\u7d22\u7684\u7279\u5b9a\u5b57\u7b26\u3002</li> </ul>"},{"location":"notes/linux%20tools/1-grep/#311","title":"3.1.1 \u57fa\u672c\u547d\u4ee4\u9009\u9879","text":"Bash<pre><code>-a --text  # \u4e0d\u8981\u5ffd\u7565\u4e8c\u8fdb\u5236\u6570\u636e\u3002\n-A &lt;\u663e\u793a\u884c\u6570&gt;   --after-context=&lt;\u663e\u793a\u884c\u6570&gt;   # \u9664\u4e86\u663e\u793a\u7b26\u5408\u8303\u672c\u6837\u5f0f\u7684\u90a3\u4e00\u884c\u4e4b\u5916\uff0c\u5e76\u663e\u793a\u8be5\u884c\u4e4b\u540e\u7684\u5185\u5bb9\u3002\n-b --byte-offset                           # \u5728\u663e\u793a\u7b26\u5408\u8303\u672c\u6837\u5f0f\u7684\u90a3\u4e00\u884c\u4e4b\u5916\uff0c\u5e76\u663e\u793a\u8be5\u884c\u4e4b\u524d\u7684\u5185\u5bb9\u3002\n-B&lt;\u663e\u793a\u884c\u6570&gt;   --before-context=&lt;\u663e\u793a\u884c\u6570&gt;   # \u9664\u4e86\u663e\u793a\u7b26\u5408\u6837\u5f0f\u7684\u90a3\u4e00\u884c\u4e4b\u5916\uff0c\u5e76\u663e\u793a\u8be5\u884c\u4e4b\u524d\u7684\u5185\u5bb9\u3002\n-c --count    # \u8ba1\u7b97\u7b26\u5408\u8303\u672c\u6837\u5f0f\u7684\u5217\u6570\u3002\n-C&lt;\u663e\u793a\u884c\u6570&gt; --context=&lt;\u663e\u793a\u884c\u6570&gt;\u6216-&lt;\u663e\u793a\u884c\u6570&gt; # \u9664\u4e86\u663e\u793a\u7b26\u5408\u8303\u672c\u6837\u5f0f\u7684\u90a3\u4e00\u5217\u4e4b\u5916\uff0c\u5e76\u663e\u793a\u8be5\u5217\u4e4b\u524d\u540e\u7684\u5185\u5bb9\u3002\n-d&lt;\u8fdb\u884c\u52a8\u4f5c&gt; --directories=&lt;\u52a8\u4f5c&gt;  # \u5f53\u6307\u5b9a\u8981\u67e5\u627e\u7684\u662f\u76ee\u5f55\u800c\u975e\u6587\u4ef6\u65f6\uff0c\u5fc5\u987b\u4f7f\u7528\u8fd9\u9879\u53c2\u6570\uff0c\u5426\u5219grep\u547d\u4ee4\u5c06\u56de\u62a5\u4fe1\u606f\u5e76\u505c\u6b62\u52a8\u4f5c\u3002\n-e&lt;\u8303\u672c\u6837\u5f0f&gt; --regexp=&lt;\u8303\u672c\u6837\u5f0f&gt;   # \u6307\u5b9a\u5b57\u7b26\u4e32\u4f5c\u4e3a\u67e5\u627e\u6587\u4ef6\u5185\u5bb9\u7684\u8303\u672c\u6837\u5f0f\u3002\n-E --extended-regexp             # \u5c06\u8303\u672c\u6837\u5f0f\u4e3a\u5ef6\u4f38\u7684\u666e\u901a\u8868\u793a\u6cd5\u6765\u4f7f\u7528\uff0c\u610f\u5473\u7740\u4f7f\u7528\u80fd\u4f7f\u7528\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\n-f&lt;\u8303\u672c\u6587\u4ef6&gt; --file=&lt;\u89c4\u5219\u6587\u4ef6&gt;     # \u6307\u5b9a\u8303\u672c\u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u8303\u672c\u6837\u5f0f\uff0c\u8ba9grep\u67e5\u627e\u7b26\u5408\u8303\u672c\u6761\u4ef6\u7684\u6587\u4ef6\u5185\u5bb9\uff0c\u683c\u5f0f\u4e3a\u6bcf\u4e00\u5217\u7684\u8303\u672c\u6837\u5f0f\u3002\n-F --fixed-regexp   # \u5c06\u8303\u672c\u6837\u5f0f\u89c6\u4e3a\u56fa\u5b9a\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002\n-G --basic-regexp   # \u5c06\u8303\u672c\u6837\u5f0f\u89c6\u4e3a\u666e\u901a\u7684\u8868\u793a\u6cd5\u6765\u4f7f\u7528\u3002\n-h --no-filename    # \u5728\u663e\u793a\u7b26\u5408\u8303\u672c\u6837\u5f0f\u7684\u90a3\u4e00\u5217\u4e4b\u524d\uff0c\u4e0d\u6807\u793a\u8be5\u5217\u6240\u5c5e\u7684\u6587\u4ef6\u540d\u79f0\u3002\n-H --with-filename  # \u5728\u663e\u793a\u7b26\u5408\u8303\u672c\u6837\u5f0f\u7684\u90a3\u4e00\u5217\u4e4b\u524d\uff0c\u6807\u793a\u8be5\u5217\u7684\u6587\u4ef6\u540d\u79f0\u3002\n-i --ignore-case    # \u5ffd\u7565\u5b57\u7b26\u5927\u5c0f\u5199\u7684\u5dee\u522b\u3002\n-l --file-with-matches   # \u5217\u51fa\u6587\u4ef6\u5185\u5bb9\u7b26\u5408\u6307\u5b9a\u7684\u8303\u672c\u6837\u5f0f\u7684\u6587\u4ef6\u540d\u79f0\u3002\n-L --files-without-match # \u5217\u51fa\u6587\u4ef6\u5185\u5bb9\u4e0d\u7b26\u5408\u6307\u5b9a\u7684\u8303\u672c\u6837\u5f0f\u7684\u6587\u4ef6\u540d\u79f0\u3002\n-n --line-number         # \u5728\u663e\u793a\u7b26\u5408\u8303\u672c\u6837\u5f0f\u7684\u90a3\u4e00\u5217\u4e4b\u524d\uff0c\u6807\u793a\u51fa\u8be5\u5217\u7684\u7f16\u53f7\u3002\n-P --perl-regexp         # PATTERN \u662f\u4e00\u4e2a Perl \u6b63\u5219\u8868\u8fbe\u5f0f\n-q --quiet\u6216--silent     # \u4e0d\u663e\u793a\u4efb\u4f55\u4fe1\u606f\u3002\n-R/-r  --recursive       # \u6b64\u53c2\u6570\u7684\u6548\u679c\u548c\u6307\u5b9a\u201c-d recurse\u201d\u53c2\u6570\u76f8\u540c\u3002\n-s --no-messages  # \u4e0d\u663e\u793a\u9519\u8bef\u4fe1\u606f\u3002\n-v --revert-match # \u53cd\u8f6c\u67e5\u627e\u3002\n-V --version      # \u663e\u793a\u7248\u672c\u4fe1\u606f\u3002   \n-w --word-regexp  # \u53ea\u663e\u793a\u5168\u5b57\u7b26\u5408\u7684\u5217\u3002\n-x --line-regexp  # \u53ea\u663e\u793a\u5168\u5217\u7b26\u5408\u7684\u5217\u3002\n-y # \u6b64\u53c2\u6570\u6548\u679c\u8ddf\u201c-i\u201d\u76f8\u540c\u3002\n-o # \u53ea\u8f93\u51fa\u6587\u4ef6\u4e2d\u5339\u914d\u5230\u7684\u90e8\u5206\u3002\n-m &lt;num&gt; --max-count=&lt;num&gt; # \u627e\u5230num\u884c\u7ed3\u679c\u540e\u505c\u6b62\u67e5\u627e\uff0c\u7528\u6765\u9650\u5236\u5339\u914d\u884c\u6570\n</code></pre>"},{"location":"notes/linux%20tools/1-grep/#312","title":"3.1.2 \u793a\u4f8b","text":"Bash<pre><code>grep -E \"[1-9]+\"\n# \u53ea\u8f93\u51fa\u6587\u4ef6\u4e2d\u5339\u914d\u5230\u7684\u90e8\u5206 -o \u9009\u9879\necho this is a test line. | grep -o -E \"[a-z]+\\.\"\nline.\n# \u7edf\u8ba1\u6587\u4ef6\u6216\u8005\u6587\u672c\u4e2d\u5305\u542b\u5339\u914d\u5b57\u7b26\u4e32\u7684\u884c\u6570 -c \u9009\u9879\uff1a\ngrep -c \"text\" file_name\n# \u8f93\u51fa\u5305\u542b\u5339\u914d\u5b57\u7b26\u4e32\u7684\u884c\u6570 -n \u9009\u9879\ngrep \"text\" -n file_1 file_2\n# \u6253\u5370\u6837\u5f0f\u5339\u914d\u6240\u4f4d\u4e8e\u7684\u5b57\u7b26\u6216\u5b57\u8282\u504f\u79fb\n#\u4e00\u884c\u4e2d\u5b57\u7b26\u4e32\u7684\u5b57\u7b26\u504f\u79fb\u662f\u4ece\u8be5\u884c\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5f00\u59cb\u8ba1\u7b97\uff0c\u8d77\u59cb\u503c\u4e3a0\u3002\u9009\u9879  **-b -o**  \u4e00\u822c\u603b\u662f\u914d\u5408\u4f7f\u7528\u3002\necho gun is not unix | grep -b -o \"not\"\n7:not\n# \u591a\u7ea7\u76ee\u5f55\u4e0b\u9012\u5f52\u641c\u7d22\ngrep \"text\" . -r -n\n# -e \u5339\u914d\u591a\u4e2a\u6837\u5f0f\necho this is a text line | grep -e \"is\" -e \"line\" -o\nis\nis\nline\n# \u53ea\u5728\u76ee\u5f55\u4e2d\u6240\u6709\u7684.php\u548c.html\u6587\u4ef6\u4e2d\u9012\u5f52\u641c\u7d22\u5b57\u7b26\"main()\"\ngrep \"main()\" . -r --include *.{php,html}\n\n# \u5728\u641c\u7d22\u7ed3\u679c\u4e2d\u6392\u9664\u6240\u6709README\u6587\u4ef6\ngrep \"main()\" . -r --exclude \"README\"\n\n# \u5728\u641c\u7d22\u7ed3\u679c\u4e2d\u6392\u9664filelist\u6587\u4ef6\u5217\u8868\u91cc\u7684\u6587\u4ef6\ngrep \"main()\" . -r --exclude-from filelist\n</code></pre>"},{"location":"notes/linux%20tools/2-sed/","title":"3.2 sed","text":""},{"location":"notes/linux%20tools/2-sed/#32-sed","title":"3.2 sed","text":"<p> \u7ea6 598 \u4e2a\u5b57  44 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p>"},{"location":"notes/linux%20tools/2-sed/#321","title":"3.2.1 \u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"notes/linux%20tools/2-sed/#_1","title":"\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<ul> <li> <p>.\uff0c\u8868\u793a\u5339\u914d\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff0c\u9664\u4e86\u6362\u884c\u7b26\uff0c\u7c7b\u4f3c Shell \u901a\u914d\u7b26\u4e2d\u7684 ?\uff1b</p> </li> <li> <p>*\uff0c\u8868\u793a\u524d\u8fb9\u5b57\u7b26\u6709 0 \u4e2a\u6216\u591a\u4e2a\uff1b</p> </li> <li> <p>.*\uff0c\u8868\u793a\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u6709 0 \u4e2a\u6216\u591a\u4e2a\uff0c\u4e5f\u5c31\u662f\u80fd\u5339\u914d\u4efb\u610f\u7684\u5b57\u7b26\uff1b</p> </li> <li> <p><sup>\uff0c\u8868\u793a\u884c\u9996\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e00\u884c\u7684\u5f00\u59cb\u4f4d\u7f6e\uff0c</sup>abc \u5339\u914d\u4ee5 abc \u5f00\u5934\u7684\u5b57\u7b26\u4e32\uff1b</p> </li> <li> <p>\\(\uff0c\u8868\u793a\u884c\u5c3e\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e00\u884c\u7684\u7ed3\u5c3e\u4f4d\u7f6e\uff0c}\\) \u5339\u914d\u4ee5\u5927\u62ec\u53f7\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\uff1b</p> </li> <li> <p>{}\uff0c\u8868\u793a\u524d\u8fb9\u5b57\u7b26\u7684\u6570\u91cf\u8303\u56f4\uff0c{2}\uff0c\u8868\u793a\u91cd\u590d 2 \u6b21\uff0c{2,}\u91cd\u590d\u81f3\u5c11 2 \u6b21\uff0c{2,4} \u91cd\u590d 2-4 \u6b21\uff1b</p> </li> <li> <p>[]\uff0c\u62ec\u53f7\u4e2d\u53ef\u4ee5\u5305\u542b\u8868\u793a\u5b57\u7b26\u96c6\u7684\u8868\u8fbe\u5f0f</p> </li> </ul>"},{"location":"notes/linux%20tools/2-sed/#_2","title":"\uff08\u4e8c\uff09\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u4f7f\u7528\u9891\u7387\u4e0a\u6ca1\u6709\u57fa\u672c\u8868\u8fbe\u5f0f\u90a3\u4e48\u9ad8\uff0c\u4f46\u4f9d\u7136\u5f88\u91cd\u8981\uff0c\u5f88\u591a\u60c5\u51b5\u4e0b\u6ca1\u6709\u6269\u5c55\u6b63\u5219\u662f\u641e\u4e0d\u5b9a\u7684\uff0csed \u547d\u4ee4\u4f7f\u7528\u6269\u5c55\u6b63\u5219\u65f6\u9700\u8981\u52a0\u4e0a\u9009\u9879 -r\u3002</p> <ul> <li> <p>?\uff1a\u8868\u793a\u524d\u7f6e\u5b57\u7b26\u6709 0 \u4e2a\u6216 1 \u4e2a\uff1b</p> </li> <li> <p>+\uff1a\u8868\u793a\u524d\u7f6e\u5b57\u7b26\u6709 1 \u4e2a\u6216\u591a\u4e2a\uff1b</p> </li> <li> <p>|\uff1a\u8868\u793a\u5339\u914d\u5176\u4e2d\u7684\u4e00\u9879\u5373\u53ef\uff1b</p> </li> <li> <p>()\uff1a\u8868\u793a\u5206\u7ec4\uff0c(a|b)b \u8868\u793a\u53ef\u4ee5\u5339\u914d ab \u6216 bb \u5b50\u4e32\uff0c\u4e14\u547d\u4ee4\u8868\u8fbe\u5f0f\u4e2d\u53ef\u4ee5\u901a\u8fc7 \\1\u3001\\2 \u6765\u8868\u793a\u5339\u914d\u7684\u53d8\u91cf</p> </li> <li> <p>{}\uff1a\u548c\u57fa\u672c\u6b63\u5219\u4e2d\u7684\u5927\u62ec\u53f7\u4e2d\u610f\u4e49\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u4f7f\u7528\u65f6\u4e0d\u7528\u52a0\u8f6c\u4e49\u7b26\u53f7\uff1b</p> </li> </ul>"},{"location":"notes/linux%20tools/2-sed/#322","title":"3.2.2 \u8bed\u6cd5","text":"Bash<pre><code>sed [option] 'command' filename\n</code></pre>"},{"location":"notes/linux%20tools/2-sed/#command","title":"command","text":"<p>command \u5b50\u547d\u4ee4\u683c\u5f0f\uff1a</p> <p>[\u5730\u57401, \u5730\u57402] [\u51fd\u6570] [\u53c2\u6570(\u6807\u8bb0)]</p>"},{"location":"notes/linux%20tools/2-sed/#_3","title":"\u57fa\u672c\u5b50\u547d\u4ee4","text":"<ol> <li> <p>\u66ff\u6362\u5b50\u547d\u4ee4 s </p>Bash<pre><code># \u5c06\u6bcf\u884c\u7684hello\u66ff\u6362\u4e3aHELLO\uff0c\u53ea\u66ff\u6362\u5339\u914d\u5230\u7684\u7b2c\u4e00\u4e2a\n$ sed 's/hello/HELLO/' file.txt\n\n# \u5c06\u5339\u914d\u5230\u7684hello\u5168\u90e8\u66ff\u6362\u4e3aHELLO\uff0cg\u8868\u793a\u66ff\u6362\u4e00\u884c\u6240\u6709\u5339\u914d\u5230\u7684\n$ sed 's/hello/HELLO/g' file.txt\n\n# \u5c06\u7b2c2\u6b21\u5339\u914d\u5230\u7684hello\u66ff\u6362\n$ sed 's/hello/A/2' file.txt\n\n# \u5c06\u7b2c2\u6b21\u540e\u5339\u914d\u5230\u7684\u6240\u6709\u90fd\u66ff\u6362\n$ sed 's/hello/A/2g' file.txt\n\n# \u5728\u884c\u9996\u52a0#\u53f7\n$ sed 's/^/#/g' file.txt\n\n# \u5728\u884c\u5c3e\u52a0\u4e1c\u897f\n$ sed 's/$/xxx/g' file.txt\n</code></pre> <ul> <li>\u591a\u4e2a\u5339\u914d Bash<pre><code># \u5c061-3\u884c\u7684my\u66ff\u6362\u4e3ayour\uff0c\u4e143\u884c\u4ee5\u540e\u7684This\u66ff\u6362\u4e3aThat\n$ sed '1,3s/my/your/g; 3,$s/This/That/g' my.txt\n\n# \u7b49\u4ef7\u4e8e\n$ sed -e '1,3s/my/your/g' -e '3,$s/This/That/g' my.txt\n</code></pre></li> </ul> </li> <li> <p>\u8ffd\u52a0\u5b50\u547d\u4ee4 a </p>Bash<pre><code> # \u5c06\u6240\u6709\u884c\u4e0b\u8fb9\u90fd\u6dfb\u52a0\u4e00\u884c\u5185\u5bb9A\n $ sed 'a A' file.txt\n\n # \u5c06\u6587\u4ef6\u4e2d1-2\u884c\u4e0b\u8fb9\u90fd\u6dfb\u52a0\u4e00\u884c\u5185\u5bb9A\n $ sed '1,2a A' file.txt\n</code></pre> </li> <li>\u63d2\u5165\u5b50\u547d\u4ee4 i</li> <li>\u66ff\u6362\u5b50\u547d\u4ee4 c</li> <li>\u5220\u9664\u5b50\u547d\u4ee4 d</li> </ol>"},{"location":"notes/linux%20tools/2-sed/#option","title":"option","text":"<ul> <li> <p>-n\uff0c\u8868\u793a\u5b89\u9759\u6a21\u5f0f\u3002\u9ed8\u8ba4 sed \u4f1a\u628a\u6bcf\u884c\u5185\u5bb9\u5904\u7406\u5b8c\u6bd5\u540e\u6253\u5370\u5230\u5c4f\u5e55\u4e0a\uff0c\u52a0\u4e0a\u9009\u9879\u540e\u5c31\u4e0d\u4f1a\u8f93\u51fa\u5230\u5c4f\u5e55\u4e0a\u3002</p> </li> <li> <p>-e\uff0c\u5982\u679c\u9700\u8981\u7528 sed \u5bf9\u6587\u672c\u5185\u5bb9\u8fdb\u884c\u591a\u79cd\u64cd\u4f5c\uff0c\u5219\u9700\u8981\u6267\u884c\u591a\u6761\u5b50\u547d\u4ee4\u6765\u8fdb\u884c\u64cd\u4f5c\uff1b</p> </li> <li> <p>-i\uff0c\u9ed8\u8ba4 sed \u53ea\u4f1a\u5904\u7406\u6a21\u5f0f\u7a7a\u95f4\u7684\u526f\u672c\u5185\u5bb9\uff0c\u4e0d\u4f1a\u76f4\u63a5\u4fee\u6539\u6587\u4ef6\uff0c\u5982\u679c\u9700\u8981\u4fee\u6539\u6587\u4ef6\uff0c\u5c31\u8981\u6307\u5b9a -i \u9009\u9879\uff1b</p> </li> <li> <p>-f\uff0c\u5982\u679c\u547d\u4ee4\u64cd\u4f5c\u6bd4\u8f83\u591a\u65f6\uff0c\u7528 -e \u4f1a\u6709\u70b9\u529b\u4e0d\u4ece\u5fc3\uff0c\u8fd9\u65f6\u9700\u8981\u628a\u591a\u4e2a\u5b50\u547d\u4ee4\u5199\u5165\u811a\u672c\u6587\u4ef6\uff0c\u4f7f\u7528 -f \u9009\u9879\u6307\u5b9a\u6267\u884c\u8be5\u811a\u672c\uff1b</p> </li> <li> <p>-r\uff1a\u5982\u679c\u9700\u8981\u652f\u6301\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u90a3\u4e48\u9700\u8981\u6dfb\u52a0 -r \u9009\u9879\uff1b</p> </li> </ul>"},{"location":"notes/linux%20tools/2-sed/#323","title":"3.2.3 \u6570\u5b57\u5b9a\u5740\u548c\u6b63\u5219\u5b9a\u5740","text":""},{"location":"notes/linux%20tools/2-sed/#_4","title":"\u6570\u5b57\u5b9a\u5740","text":"Bash<pre><code># \u53ea\u5c06\u7b2c4\u884c\u4e2dhello\u66ff\u6362\u4e3aA\n$ sed '4s/hello/A/g' file.txt\n# \u5c06\u7b2c2-4\u884c\u4e2dhello\u66ff\u6362\u4e3aA\n$ sed '2,4s/hello/A/g' file.txt\n# \u4ece\u7b2c2\u884c\u5f00\u59cb\uff0c\u5f80\u4e0b\u65704\u884c\uff0c\u4e5f\u5c31\u662f2-6\u884c\n$ sed '2,+4s/hello/A/g' file.txt\n# \u5c06\u6700\u540e1\u884c\u4e2dhello\u66ff\u6362\u4e3aA\n$ sed '$s/hello/A/g' file.txt\n# \u9664\u4e86\u7b2c1\u884c\uff0c\u5176\u5b83\u884c\u5c06hello\u66ff\u6362\u4e3aA\n$ sed '1!s/hello/A/g' file.txt\n</code></pre>"},{"location":"notes/linux%20tools/2-sed/#_5","title":"\u6b63\u5219\u5b9a\u5740","text":"Bash<pre><code># \u5c06\u5339\u914d\u5230hello\u7684\u884c\u6267\u884c\u5220\u9664\u64cd\u4f5c\uff0cd \u8868\u793a\u5220\u9664\n$ sed '/hello/d' file.txt\n# \u5220\u9664\u7a7a\u884c\uff0c\"^$\" \u8868\u793a\u7a7a\u884c\n$ sed '/^$/d' file.txt\n# \u5c06\u5339\u914d\u5230\u4ee5ts\u5f00\u5934\u7684\u884c\u5230\u4ee5te\u5f00\u5934\u7684\u884c\u4e4b\u95f4\u6240\u6709\u884c\u8fdb\u884c\u5220\u9664\n$ sed '/^ts/,/^te/d' file.txt\n</code></pre>"},{"location":"notes/linux%20tools/3-awk/","title":"3.3 awk","text":""},{"location":"notes/linux%20tools/3-awk/#33-awk","title":"3.3 awk","text":"<p> \u7ea6 167 \u4e2a\u5b57  19 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <ul> <li>awk\u4f1a\u6839\u636e\u7a7a\u683c\u548c\u5236\u8868\u7b26\uff0c\u5c06\u6bcf\u4e00\u884c\u5206\u6210\u82e5\u5e72\u5b57\u6bb5\uff0c\u4f9d\u6b21\u7528\\(1\u3001\\)2\u3001$3\u4ee3\u8868\u7b2c\u4e00\u4e2a\u5b57\u6bb5\u3001\u7b2c\u4e8c\u4e2a\u5b57\u6bb5\u3001\u7b2c\u4e09\u4e2a\u5b57\u6bb5\u7b49\u7b49</li> <li>print\u547d\u4ee4\u91cc\u9762\uff0c\u5982\u679c\u539f\u6837\u8f93\u51fa\u5b57\u7b26\uff0c\u8981\u653e\u5728\u53cc\u5f15\u53f7\u91cc\u9762\u3002</li> </ul>"},{"location":"notes/linux%20tools/3-awk/#331","title":"3.3.1 \u57fa\u672c\u7528\u6cd5","text":"Bash<pre><code>awk action filename\nawk '{print $0}' demo.txt\n</code></pre>"},{"location":"notes/linux%20tools/3-awk/#332","title":"3.3.2 \u5185\u7f6e\u51fd\u6570","text":"<p>\u53d8\u91cfNF\u8868\u793a\u5f53\u524d\u884c\u6709\u591a\u5c11\u4e2a\u5b57\u6bb5\uff0c\u56e0\u6b64$NF\u5c31\u4ee3\u8868\u6700\u540e\u4e00\u4e2a\u5b57\u6bb5 \u53d8\u91cfNR\u8868\u793a\u5f53\u524d\u5904\u7406\u7684\u662f\u7b2c\u51e0\u884c toupper()\u7528\u4e8e\u5c06\u5b57\u7b26\u8f6c\u4e3a\u5927\u5199 tolower()\uff1a\u5b57\u7b26\u8f6c\u4e3a\u5c0f\u5199\u3002 length()\uff1a\u8fd4\u56de\u5b57\u7b26\u4e32\u957f\u5ea6\u3002 substr()\uff1a\u8fd4\u56de\u5b50\u5b57\u7b26\u4e32\u3002 sin()\uff1a\u6b63\u5f26\u3002 cos()\uff1a\u4f59\u5f26\u3002 sqrt()\uff1a\u5e73\u65b9\u6839\u3002 rand()\uff1a\u968f\u673a\u6570\u3002  </p>"},{"location":"notes/linux%20tools/3-awk/#333","title":"3.3.3 \u793a\u4f8b","text":"Bash<pre><code># \u8f93\u51fa\u5947\u6570\u884c\n$ awk -F ':' 'NR % 2 == 1 {print $1}' demo.txt\nroot\nbin\nsync\n\n# \u8f93\u51fa\u7b2c\u4e09\u884c\u4ee5\u540e\u7684\u884c\n$ awk -F ':' 'NR &gt;3 {print $1}' demo.txt\nsys\nsync\n\n$ awk -F ':' '$1 == \"root\" {print $1}' demo.txt\nroot\n\n$ awk -F ':' '$1 == \"root\" || $1 == \"bin\" {print $1}' demo.txt\nroot\nbin\n</code></pre>"},{"location":"notes/linux%20tools/4-find/","title":"3.4 find","text":""},{"location":"notes/linux%20tools/4-find/#34-find","title":"3.4 find","text":"<p> \u7ea6 280 \u4e2a\u5b57  11 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p> <ul> <li>\u4ece\u6bcf\u4e2a\u6307\u5b9a\u7684\u8d77\u59cb\u70b9 (\u76ee\u5f55) \u5f00\u59cb\uff0c\u641c\u7d22\u4ee5\u8be5\u70b9\u4e3a\u6839\u7684\u76ee\u5f55\u6811\uff0c\u5e76\u6309\u7167\u8fd0\u7b97\u7b26\u4f18\u5148\u7ea7\u89c4\u5219\u4ece\u5de6\u81f3\u53f3\u8bc4\u4f30\u7ed9\u5b9a\u7684\u8868\u8fbe\u5f0f\uff0c\u76f4\u5230\u7ed3\u679c\u786e\u5b9a\uff0c\u6b64\u65f6find\u4f1a\u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u4e2a\u6587\u4ef6\u540d\u3002</li> </ul>"},{"location":"notes/linux%20tools/4-find/#341","title":"3.4.1 \u8bed\u6cd5","text":"Bash<pre><code>find [-H] [-L] [-P] [-D debugopts] [-Olevel] [\u8d77\u59cb\u70b9...] [\u8868\u8fbe\u5f0f]\n</code></pre> - -name pattern\uff1a\u6309\u6587\u4ef6\u540d\u67e5\u627e\uff0c\u652f\u6301\u4f7f\u7528\u901a\u914d\u7b26 * \u548c ?\u3002 - -type type\uff1a\u6309\u6587\u4ef6\u7c7b\u578b\u67e5\u627e\uff0c\u53ef\u4ee5\u662f f\uff08\u666e\u901a\u6587\u4ef6\uff09\u3001d\uff08\u76ee\u5f55\uff09\u3001l\uff08\u7b26\u53f7\u94fe\u63a5\uff09\u7b49\u3002  <p>f \u666e\u901a\u6587\u4ef6 l \u7b26\u53f7\u8fde\u63a5 d \u76ee\u5f55 c \u5b57\u7b26\u8bbe\u5907 b \u5757\u8bbe\u5907 s \u5957\u63a5\u5b57 p Fifo - -size [+-]size[cwbkMG]\uff1a\u6309\u6587\u4ef6\u5927\u5c0f\u67e5\u627e\uff0c\u652f\u6301\u4f7f\u7528 + \u6216 - \u8868\u793a\u5927\u4e8e\u6216\u5c0f\u4e8e\u6307\u5b9a\u5927\u5c0f\uff0c\u5355\u4f4d\u53ef\u4ee5\u662f c\uff08\u5b57\u8282\uff09\u3001w\uff08\u5b57\u6570\uff09\u3001b\uff08\u5757\u6570\uff09\u3001k\uff08KB\uff09\u3001M\uff08MB\uff09\u6216 G\uff08GB\uff09\u3002 - -mtime days\uff1a\u6309\u4fee\u6539\u65f6\u95f4\u67e5\u627e\uff0c\u652f\u6301\u4f7f\u7528 + \u6216 - \u8868\u793a\u5728\u6307\u5b9a\u5929\u6570\u524d\u6216\u540e\uff0cdays \u662f\u4e00\u4e2a\u6574\u6570\u8868\u793a\u5929\u6570\u3002 - -user username\uff1a\u6309\u6587\u4ef6\u6240\u6709\u8005\u67e5\u627e\u3002 - -group groupname\uff1a\u6309\u6587\u4ef6\u6240\u5c5e\u7ec4\u67e5\u627e - -depth: \u8ba9 find \u4ee5\u6df1\u5ea6\u4f18\u5148\u7684\u65b9\u5f0f\u904d\u5386\u76ee\u5f55\u6811\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b find \u4ee5\u5e7f\u5ea6\u4f18\u5148\u65b9\u5f0f\u5904\u7406\u76ee\u5f55\u6811</p>"},{"location":"notes/linux%20tools/4-find/#342","title":"3.4.2 \u793a\u4f8b","text":"Bash<pre><code># \u5f53\u524d\u76ee\u5f55\u641c\u7d22\u6240\u6709\u6587\u4ef6\uff0c\u4e14\u6587\u4ef6\u5185\u5bb9\u5305\u542b \u201c140.206.111.111\u201d\nfind . -type f -name \"*\" | xargs grep \"140.206.111.111\"\n# \u5728/home\u76ee\u5f55\u4e0b\u67e5\u627e\u4ee5.txt\u7ed3\u5c3e\u7684\u6587\u4ef6\u540d\uff0c\u5ffd\u7565\u5927\u5c0f\u5199\nfind /home -iname \"*.txt\"\n# \u5f53\u524d\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55\u4e0b\u67e5\u627e\u6240\u6709\u4ee5.txt\u548c.pdf\u7ed3\u5c3e\u7684\u6587\u4ef6\nfind . -name \"*.txt\" -o -name \"*.pdf\"\n# \u57fa\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u6587\u4ef6\u8def\u5f84\nfind . -regex \".*\\(\\.txt\\|\\.pdf\\)$\"\n# \u5411\u4e0b\u6700\u5927\u6df1\u5ea6\u9650\u5236\u4e3a3\nfind . -maxdepth 3 -type f\n</code></pre>"},{"location":"notes/minilsm/week1-day1/","title":"Memtables","text":"<code>#MiniLSM</code> <code>#rust</code>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#memtables","title":"Memtables","text":"<p> \u7ea6 1430 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <ul> <li>\u5c06 KV \u5bf9\u9996\u5148\u63d2\u5165\u5230 Memtable \u4e2d\uff0c\u8be5 Memtable \u5728\u5185\u5b58\u4e2d\u53ea\u6709\u4e00\u4e2a</li> </ul> <p></p> <ul> <li>\u5982\u679c Memtable \u5df2\u7ecf\u88c5\u6ee1\uff0c\u4f1a\u89e6\u53d1 frozen\uff0c\u5c06 memtable \u8f6c\u53d8\u4e3a immemtable\uff0c\u91cd\u65b0\u521b\u5efa\u65b0\u7684 memtable \u6765\u7ed9 KV \u5bf9\u63d2\u5165</li> </ul> <p></p>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#understanding-of-memtable-implement","title":"Understanding of Memtable Implement","text":"","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#1-why-doesnt-the-memtable-provide-a-delete-api","title":"1. Why doesn't the memtable provide a delete API?","text":"<ul> <li>lsm-tree \u662f append-only \u7ed3\u6784\uff0cdelete \u64cd\u4f5c\u662f\u628a\u4e00\u4e2a\u5893\u7891\u6807\u8bb0\u63d2\u5165 memtable</li> <li>\u8fd9\u79cd\u65b9\u5f0f\u5c06 delete \u7684\u968f\u673a\u5199\u8f6c\u53d8\u4e3a\u987a\u5e8f\u5199\uff0c\u66f4\u6709\u5229\u4e8e\u5199</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#2-does-it-make-sense-for-the-memtable-to-store-all-write-operations-instead-of-only-the-latest-version-of-a-key-for-example-the-user-puts-a-1-a-2-and-a-3-into-the-same-memtable","title":"2. Does it make sense for the memtable to store all write operations instead of only the latest version of a key? For example, the user puts a-&gt;1, a-&gt;2, and a-&gt;3 into the same memtable.","text":"<ul> <li>\u6709\u9053\u7406\u7684\uff0c\u5982\u679c\u9700\u8981\u66f4\u65b0\u6700\u65b0\u503c\uff0c\u65e0\u6cd5\u53d1\u6325\u987a\u5e8f\u5199\u7684\u4f18\u52bf\uff0c\u540e\u7eed\u7684 write_batch \u4e5f\u5c31\u65e0\u4ece\u8c08\u8d77\u4e86</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#3-is-it-possible-to-use-other-data-structures-as-the-memtable-in-lsm-what-are-the-proscons-of-using-the-skiplist","title":"3. Is it possible to use other data structures as the memtable in LSM? What are the pros/cons of using the skiplist?","text":"<ul> <li>SLM-DB \u8bba\u6587\u4e2d\u63d0\u51fa\u53ef\u4ee5\u7528 B+\u6811\u4f5c\u4e3a\u5185\u5b58\u7d22\u5f15\uff1bOceanbase \u4f7f\u7528\u7684\u5b58\u50a8\u5f15\u64ce\u4e5f\u662f lsm-tree based\uff0c\u5b83\u7684 memtable \u4f7f\u7528 B+tree \u6216\u8005 hash index</li> <li>\u4f7f\u7528\u8df3\u8868\u4f18\u70b9 <p>\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u627e\u90fd\u662f O(logn)\u7ea7\u522b\uff0c\u5b9e\u73b0\u7b80\u5355 \u5929\u7136\u6709\u5e8f \u5e76\u53d1\u63a7\u5236\u7b80\u5355</p> </li> <li>\u8df3\u8868\u7f3a\u70b9 <p>\u5199\u653e\u5927 \u5220\u9664\u64cd\u4f5c\u53ef\u80fd\u7ea7\u8054\u64cd\u4f5c\u591a\u7ea7\u6307\u9488</p> </li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#4-why-do-we-need-a-combination-of-state-and-state_lock-can-we-only-use-stateread-and-statewrite","title":"4. Why do we need a combination of state and state_lock? Can we only use state.read() and state.write()?","text":"<ul> <li>\u5fc5\u987b\u7528\u7ec4\u5408\u624d\u80fd\u4fdd\u8bc1\u771f\u6b63\u7684\u5e76\u53d1\u5b89\u5168</li> <li>\u5728 force_freeze_memtable \u4e2d\uff0c\u8003\u8651\u591a\u4e2a\u7ebf\u7a0b\u901a\u8fc7 ReadGuard \u5e76\u53d1 put \u6216\u8005 flush\uff0c\u5224\u65ad memtable \u6ee1\u4e86\u8fdb\u884c frozen\uff1b\u8fd9\u4e2a\u903b\u8f91\u5982\u679c\u6ca1\u6709\u4e00\u628a mutex \u6765\u4fdd\u62a4\uff0c\u4f1a\u51fa\u73b0\u95ee\u9898 <p>\u53ef\u80fd memtable \u5df2\u7ecf\u88ab\u5176\u4ed6\u7ebf\u7a0b\u7ed9 frozen \u4e86\uff0c\u53c8\u518d\u6b21 frozen\uff0c\u540e frozen \u7684 memtable \u6ca1\u6709\u8fbe\u5230\u5927\u5c0f\u9650\u5236</p> </li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#5-why-does-the-order-to-store-and-to-probe-the-memtables-matter-if-a-key-appears-in-multiple-memtables-which-version-should-you-return-to-the-user","title":"5. Why does the order to store and to probe the memtables matter? If a key appears in multiple memtables, which version should you return to the user?","text":"<ul> <li>\u56e0\u4e3a\u6211\u4eec\u59cb\u7ec8\u9700\u8981\u4fdd\u8bc1\u540e Put \u7684\u6570\u636e\u53ef\u4ee5\u9996\u5148\u88ab Get \u5230\uff0c\u4fdd\u8bc1\u7528\u6237\u53ef\u4ee5\u770b\u5230\u6700\u65b0\u7684\u6570\u636e</li> <li>\u5982\u679c\u5b58\u5728\u6700\u65b0\u7684\u7248\u672c\uff0c\u6211\u4eec\u5e94\u8be5\u8fd4\u56de\u5728\u8be5\u4e8b\u52a1\u63d0\u4ea4\u524d\u7684\u6700\u65b0\u7684\u6570\u636e</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#6-is-the-memory-layout-of-the-memtable-efficient-does-it-have-good-data-locality-think-of-how-byte-is-implemented-and-stored-in-the-skiplist-what-are-the-possible-optimizations-to-make-the-memtable-more-efficient","title":"6. Is the memory layout of the memtable efficient / does it have good data locality? (Think of how Byte is implemented and stored in the skiplist...) What are the possible optimizations to make the memtable more efficient?","text":"<ul> <li>\u5982\u679c\u662f\u77ed\u6570\u636e\uff0cByte \u4f1a\u5185\u8054\u5b58\u50a8\u5728\u7ed3\u6784\u4f53\u4e2d\uff0c\u5185\u5b58\u8fde\u7eed\uff1b\u5bf9\u5927\u503c\uff08\u5982\u8d85\u8fc7 1KB \u7684 Blob\uff09\uff0cBytes \u901a\u8fc7\u5f15\u7528\u8ba1\u6570\u5171\u4eab\u5e95\u5c42 Vec\uff0c\u907f\u514d\u590d\u5236</li> <li>\u95f4\u63a5\u6307\u9488\u8bbf\u95ee\u4f1a\u589e\u52a0\u5185\u5b58\u95f4\u63a5\u6027\uff0c\u5f71\u54cd\u9884\u53d6\u6548\u7387</li> <li>Byte \u5143\u6570\u636e\u5360\u7528\u989d\u5916\u5185\u5b58\uff0c\u5982\u679c\u4f7f\u7528\u5185\u90e8\u5185\u5b58\u5206\u914d\uff0c\u53ef\u80fd\u9020\u6210\u5185\u5b58\u4e0d\u8fde\u7eed</li> <li>\u4f18\u5316</li> </ul> <p>\u6784\u9020\u7edf\u4e00\u7684\u5185\u5b58\u5206\u914d\u5668\uff0c\u540c\u4e00\u5206\u914d\u5185\u5b58 \u5c06 key \u548c value \u5206\u5f00\u5b58\u50a8</p>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#7-so-we-are-using-parking_lot-locks-in-this-course-is-its-read-write-lock-a-fair-lock-what-might-happen-to-the-readers-trying-to-acquire-the-lock-if-there-is-one-writer-waiting-for-existing-readers-to-stop","title":"7. So we are using parking_lot locks in this course. Is its read-write lock a fair lock? What might happen to the readers trying to acquire the lock if there is one writer waiting for existing readers to stop?","text":"<ul> <li>\u5bf9\u5199\u8005\u5e76\u4e0d\u516c\u5e73\uff0c\u5982\u679c\u591a\u4e2a\u8bfb\u8005\u4e00\u76f4\u5728\u8bfb\uff0c\u5199\u8005\u4f1a\u4e00\u76f4\u963b\u585e</li> <li>\u5982\u679c\u6709\u4e00\u4e2a\u5199\u8005\u5728\u5199\uff0c\u5c31\u4f1a\u963b\u585e\u6240\u6709\u8bfb\u8005\u7684\u8bfb\u64cd\u4f5c</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#8-after-freezing-the-memtable-is-it-possible-that-some-threads-still-hold-the-old-lsm-state-and-wrote-into-these-immutable-memtables-how-does-your-solution-prevent-it-from-happening","title":"8. After freezing the memtable, is it possible that some threads still hold the old LSM state and wrote into these immutable memtables? How does your solution prevent it from happening?","text":"<ul> <li>\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5728 put\uff0c\u90fd\u53d1\u73b0\u4e86\u5f53\u524d\u8d85\u8fc7\u9650\u5236\uff0c\u9700\u8981\u5f3a\u5236 frozen</li> <li>\u6211\u4eec\u7684\u89e3\u51b3\u65b9\u6848\u662f\uff1a\u83b7\u53d6\u5230 state_lock \u540e\uff0c\u518d\u6b21\u5224\u65ad\u662f\u5426\u8d85\u8fc7\u5927\u5c0f\u9650\u5236\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u6ca1\u62ff\u5230\u9501\u7684\u7ebf\u7a0b\u4e00\u5b9a\u4f1a\u5728\u65b0\u7684 memtable \u4e2d\u8fdb\u884c\u66f4\u65b0</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#9-there-are-several-places-that-you-might-first-acquire-a-read-lock-on-state-then-drop-it-and-acquire-a-write-lock-these-two-operations-might-be-in-different-functions-but-they-happened-sequentially-due-to-one-function-calls-the-other-how-does-it-differ-from-directly-upgrading-the-read-lock-to-a-write-lock-is-it-necessary-to-upgrade-instead-of-acquiring-and-dropping-and-what-is-the-cost-of-doing-the-upgrade","title":"9. There are several places that you might first acquire a read lock on state, then drop it and acquire a write lock (these two operations might be in different functions but they happened sequentially due to one function calls the other). How does it differ from directly upgrading the read lock to a write lock? Is it necessary to upgrade instead of acquiring and dropping and what is the cost of doing the upgrade?","text":"<ul> <li>\u7ed3\u8bba\uff1a\u9700\u8981\u6839\u636e\u4e0d\u540c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6765\u786e\u5b9a\uff0c\u8bfb\u591a\u5199\u5c11\u7684\u8d1f\u8f7d\u5c31\u53ef\u4ee5\u91c7\u7528\u5206\u6b65\u9501\uff0c\u5199\u5c11\u8bfb\u591a\u7684\u8d1f\u8f7d\u53ef\u4ee5\u91c7\u7528\u9501\u5347\u7ea7</li> <li>\u200b \u5148\u91ca\u653e\u8bfb\u9501\u518d\u83b7\u53d6\u5199\u9501\uff1a</li> </ul> <p>\u5728\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u95f4\uff0c\u5176\u4ed6\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u4fee\u6539\u72b6\u6001\uff0c\u5bfc\u81f4\u4e4b\u524d\u8bfb\u53d6\u7684\u4fe1\u606f\u5931\u6548\u3002\u4f8b\u5982\uff0c\u7ebf\u7a0b A \u8bfb\u53d6 memtable \u672a\u6ee1\uff0c\u91ca\u653e\u8bfb\u9501\uff0c\u6b64\u65f6\u7ebf\u7a0b B \u53ef\u80fd\u83b7\u53d6\u5199\u9501\u5e76\u586b\u6ee1 memtable\uff0c\u5bfc\u81f4\u7ebf\u7a0b A \u518d\u6b21\u83b7\u53d6\u5199\u9501\u65f6\u53d1\u73b0\u9700\u8981 flush\uff0c\u4f46\u6b64\u65f6\u53ef\u80fd\u5df2\u7ecf\u88ab\u5904\u7406\u8fc7\u4e86\uff0c\u6216\u8005\u9700\u8981\u91cd\u65b0\u68c0\u67e5\u6761\u4ef6\u3002</p> <p>\u8fd9\u53ef\u80fd\u5bfc\u81f4\u7ade\u4e89\u6761\u4ef6\u6216\u9700\u8981\u989d\u5916\u7684\u68c0\u67e5\uff0c\u6bd4\u5982\u5728\u83b7\u53d6\u5199\u9501\u540e\u518d\u6b21\u9a8c\u8bc1\u6761\u4ef6\u662f\u5426\u4ecd\u7136\u6ee1\u8db3\uff08\u5373\u201c\u53cc\u91cd\u68c0\u67e5\u201d\uff09\u3002</p> <ul> <li>\u200b \u76f4\u63a5\u5347\u7ea7\u8bfb\u9501\u5230\u5199\u9501\uff1a</li> </ul> <p>\u5347\u7ea7\u9501\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8bfb\u9501\u4e0d\u4f1a\u88ab\u91ca\u653e\uff0c\u56e0\u6b64\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u5728\u4e2d\u95f4\u63d2\u5165\u4fee\u6539\uff0c\u4fdd\u8bc1\u4e86\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002\u8fd9\u6837\uff0c\u5728\u8bfb\u53d6\u72b6\u6001\u540e\u5230\u5199\u5165\u7684\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u72b6\u6001\u4e0d\u4f1a\u88ab\u5176\u4ed6\u7ebf\u7a0b\u6539\u53d8\u3002</p> <p>\u4f46\u662f\uff0c\u9501\u5347\u7ea7\u53ef\u80fd\u5e26\u6765\u6f5c\u5728\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u6b7b\u9501\u3002\u4f8b\u5982\uff0c\u5f53\u591a\u4e2a\u7ebf\u7a0b\u5c1d\u8bd5\u5347\u7ea7\u8bfb\u9501\u65f6\uff0c\u53ef\u80fd\u5f62\u6210\u5faa\u73af\u7b49\u5f85\u3002\u6b64\u5916\uff0c\u67d0\u4e9b\u9501\u5b9e\u73b0\u53ef\u80fd\u4e0d\u652f\u6301\u5347\u7ea7\uff0c\u6216\u8005\u5347\u7ea7\u64cd\u4f5c\u672c\u8eab\u9700\u8981\u4e00\u5b9a\u7684\u6210\u672c\u3002</p>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day1/#_1","title":"\u5e76\u53d1\u6027\u4e0e\u6027\u80fd","text":"<ul> <li>acquire read -&gt; drop read -&gt; acquire write</li> </ul> <p>\u200b \u4f18\u52bf\uff1a\u91ca\u653e\u8bfb\u9501\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u83b7\u53d6\u8bfb\u9501\uff0c\u63d0\u9ad8\u5e76\u53d1\u8bfb\u53d6\u6027\u80fd\u3002 \u52a3\u52bf\uff1a\u5199\u5165\u7ebf\u7a0b\u53ef\u80fd\u9700\u8981\u7b49\u5f85\u66f4\u957f\u65f6\u95f4\u83b7\u53d6\u5199\u9501\uff08\u56e0\u4e2d\u95f4\u5b58\u5728\u5176\u4ed6\u7ade\u4e89\uff09\u3002</p> <ul> <li>\u200b \u9501\u5347\u7ea7 <p>\u200b \u4f18\u52bf\uff1a\u51cf\u5c11\u5199\u9501\u7ade\u4e89\uff0c\u56e0\u4e3a\u5347\u7ea7\u65f6\u5df2\u6301\u6709\u8bfb\u9501\uff0c\u53ef\u80fd\u66f4\u5feb\u83b7\u5f97\u5199\u9501\u3002 \u52a3\u52bf\uff1a\u82e5\u5176\u4ed6\u7ebf\u7a0b\u6301\u6709\u8bfb\u9501\uff0c\u5347\u7ea7\u4f1a\u963b\u585e\u76f4\u5230\u6240\u6709\u8bfb\u9501\u91ca\u653e\uff08\u7c7b\u4f3c\u76f4\u63a5\u83b7\u53d6\u5199\u9501\uff09\u3002\u5728\u9ad8\u5e76\u53d1\u8bfb\u573a\u666f\u4e0b\uff0c\u53ef\u80fd\u5bfc\u81f4\u957f\u65f6\u95f4\u963b\u585e\u3002</p> </li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/","title":"Merge Iterator","text":"<code>#MiniLSM</code> <code>#rust</code>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#merge-iterator","title":"Merge Iterator","text":"<p> \u7ea6 1137 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <ul> <li>\u4e00\u4e2a lsm-tree \u4f1a\u6709\u4e00\u4e2a memtable \u548c\u591a\u4e2a immumemtable\uff0c\u5728\u6267\u884c get \u6216\u8005 scan \u65f6\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u6240\u6709\u7684 memtable \u8fdb\u884c\u67e5\u8be2</li> <li>\u4e00\u822c\u6211\u4eec\u4f1a\u4f7f\u7528\u8fed\u4ee3\u5668\u8fdb\u884c scan\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5bf9\u6240\u6709\u7684 memtable \u8fdb\u884c merge \u7684 iterator</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#understanding-of-merge-iterator-implement","title":"Understanding of Merge Iterator Implement","text":"","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#1-what-is-the-timespace-complexity-of-using-your-merge-iterator","title":"1. What is the time/space complexity of using your merge iterator?","text":"<ul> <li>\u521b\u5efa\u7684\u65f6\u5019 O(n)\uff0c\u904d\u5386\u6240\u6709\u7684 iterator\uff0c\u7136\u540e store</li> <li>next \u7684\u65f6\u5019\u662f O(Clogn)\uff0c\u6bcf\u6b21\u4e0e\u5806\u4e0a\u7684\u6700\u5c0f\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u5411\u540e\u8fed\u4ee3</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#2-why-do-we-need-a-self-referential-structure-for-memtable-iterator","title":"2. Why do we need a self-referential structure for memtable iterator?","text":"<ul> <li>\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u5904\u7406\u751f\u547d\u5468\u671f\u7684\u95ee\u9898\uff0c\u4f7f\u7528\u7b2c\u4e09\u65b9\u5e93\u7684\u8df3\u8868\uff0c\u91cc\u9762\u7684\u8fed\u4ee3\u5668\u5468\u671f\u6211\u4eec\u5f88\u96be\u5904\u7406\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u81ea\u5f15\u7528\u7ed3\u6784\uff0c\u89c4\u907f\u8fd9\u4e2a\u95ee\u9898</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#3-if-a-key-is-removed-there-is-a-delete-tombstone-do-you-need-to-return-it-to-the-user-where-did-you-handle-this-logic","title":"3. If a key is removed (there is a delete tombstone), do you need to return it to the user? Where did you handle this logic?","text":"<ul> <li>\u4e0d\u5e94\u8be5\uff0c\u5982\u679c\u662f scan \u7684\u8bdd\uff0c\u5e94\u8be5\u76f4\u63a5\u8df3\u8f6c\u5230\u4e0b\u4e00\u4e2a\u672a\u88ab\u5220\u9664\u7684 key \u8fdb\u884c\u67e5\u8be2</li> <li>\u5728<code>lsm_iterator</code>\u6267\u884c next \u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u8fd8\u6709\u521a\u521a\u521b\u5efa\u8fed\u4ee3\u5668\u8fdb\u884c\u5904\u7406 <p>\u53ef\u80fd\u626b\u63cf\u7684\u7b2c\u4e00\u4e2a key \u5c31\u662f\u5df2\u7ecf\u88ab\u5220\u9664\u7684 key</p> </li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#4-if-a-key-has-multiple-versions-will-the-user-see-all-of-them-where-did-you-handle-this-logic","title":"4. If a key has multiple versions, will the user see all of them? Where did you handle this logic?","text":"<ul> <li>\u4e0d\u4f1a\uff0c\u53ea\u4f1a\u770b\u5230\u6700\u65b0\u7684\u4e00\u4e2a</li> <li>\u5728<code>lsm_iterator</code>\u7684 next \u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u6700\u524d\u9762\u7684 iterator \u4e2d\u7684\u8bb0\u5f55\u662f lastest \u7684\uff0c\u4f1a\u8986\u76d6\u5176\u4ed6 iterator \u7684\u67e5\u8be2\u7ed3\u679c</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#5-if-we-want-to-get-rid-of-self-referential-structure-and-have-a-lifetime-on-the-memtable-iterator-ie-memtableiteratora-where-a-memtable-or-lsmstorageinner-lifetime-is-it-still-possible-to-implement-the-scan-functionality","title":"5. if we want to get rid of self-referential structure and have a lifetime on the memtable iterator (i.e., MemtableIterator&lt;'a&gt;, where 'a = memtable or LsmStorageInner lifetime), is it still possible to implement the scan functionality?","text":"<ul> <li>\u6211\u5bf9\u8fd9\u4e2a\u4e0d\u662f\u5f88\u719f\u6089\uff0c\u4f46\u662f\u6211\u7684\u770b\u6cd5\u662f memtable \u88ab\u5237\u5199\u5230\u78c1\u76d8\u540e\uff0citerator \u4ecd\u7136\u4fdd\u5b58\u7740\u5bf9 memtable \u7684\u5f15\u7528\uff1b\u8fd9\u662f memtable \u7684\u751f\u547d\u5468\u671f\u5df2\u7ecf\u7ed3\u675f\uff0c\u8be5 iterator \u5931\u6548\uff0c\u4f46\u662f scan \u6b63\u5728\u8fdb\u884c\u8fed\u4ee3\uff0c\u51fa\u73b0\u610f\u6599\u4e4b\u5916\u7684\u9519\u8bef</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#6-what-happens-if-1-we-create-an-iterator-on-the-skiplist-memtable-2-someone-inserts-new-keys-into-the-memtable-3-will-the-iterator-see-the-new-key","title":"6. What happens if (1) we create an iterator on the skiplist memtable (2) someone inserts new keys into the memtable (3) will the iterator see the new key?","text":"<ul> <li>\u4f7f\u7528\u7684\u662f Arc\uff0c\u6240\u6709\u7684 clone \u6307\u5411\u540c\u4e00\u4efd\u539f\u59cb\u6570\u636e\uff0c\u6240\u4ee5\u4f1a\u770b\u5230\u65b0\u63d2\u5165\u7684\u6570\u636e</li> <li>\u5982\u679c\u9700\u8981\u9694\u79bb\uff0c\u5e94\u8be5\u4f7f\u7528\u9501\uff0c\u6216\u8005\u63d0\u4f9b\u7248\u672c\u673a\u5236</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#7-what-happens-if-your-key-comparator-cannot-give-the-binary-heap-implementation-a-stable-order","title":"7. What happens if your key comparator cannot give the binary heap implementation a stable order?","text":"<ul> <li>\u5bf9\u540c\u4e00\u4e2a key \u8fdb\u884c\u63d2\u5165\u3001\u5220\u9664\u3001\u518d\u63d2\u5165\uff1b\u53ef\u80fd\u987a\u5e8f\u4f1a\u88ab\u641e\u6df7\uff0c\u9020\u6210\u770b\u5230\u5df2\u7ecf\u5220\u9664\u7684 key\uff0c\u6216\u8005\u770b\u5230\u65e7\u7248\u672c\u6570\u636e</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#8-why-do-we-need-to-ensure-the-merge-iterator-returns-data-in-the-iterator-construction-order","title":"8. Why do we need to ensure the merge iterator returns data in the iterator construction order?","text":"<ul> <li>\u5c06\u591a\u4e2a\u6709\u5e8f\u6570\u636e\u6e90\uff08\u5982\u5185\u5b58\u4e2d\u7684 MemTable \u548c\u78c1\u76d8\u4e0a\u7684 SSTable\uff09\u5408\u5e76\u6210\u4e00\u4e2a\u5168\u5c40\u6709\u5e8f\u7684\u89c6\u56fe\u3002\u4e3a\u4e86\u6b63\u786e\u6027\u548c\u6027\u80fd\uff0c\u5408\u5e76\u8fed\u4ee3\u5668\u5fc5\u987b\u9075\u5faa \u200b\u200b \u8fed\u4ee3\u5668\u7684\u6784\u9020\u987a\u5e8f \u200b\u200b\uff08\u5373\u6570\u636e\u6e90\u7684\u4f18\u5148\u7ea7\u987a\u5e8f\uff09\u6765\u51b3\u5b9a\u76f8\u540c\u952e\uff08Key\uff09\u7684\u8fd4\u56de\u987a\u5e8f</li> <li>\u907f\u514d\u65e7\u6570\u636e\u8986\u76d6\u65b0\u6570\u636e\uff0c\u4fdd\u8bc1\u8bfb\u53d6\u64cd\u4f5c\u8fd4\u56de\u6700\u65b0\u503c\u3002</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#9-is-it-possible-to-implement-a-rust-style-iterator-ie-nextself-key-value-for-lsm-iterators-what-are-the-proscons","title":"9. Is it possible to implement a Rust-style iterator (i.e., next(&amp;self) -&gt; (Key, Value)) for LSM iterators? What are the pros/cons?","text":"<ul> <li>\u53ef\u884c\uff0c\u4f46\u662f\u72b6\u6001\u53d8\u66f4\u5fc5\u987b\u901a\u8fc7 \u200b \u5171\u4eab\u4e14\u53ef\u53d8\u7684\u5185\u5b58\u5b9e\u73b0\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4fee\u6539 self <p>single thread: \u4f7f\u7528 Cell/RefCell multi thread: \u4f7f\u7528 Mutex/RwLock</p> </li> <li>\u4f18\u70b9 <p>\u5171\u4eab\u8fed\u4ee3\u5668\u72b6\u6001: &amp;self \u5141\u8bb8\u8fed\u4ee3\u5668\u88ab\u591a\u4e2a\u7ebf\u7a0b\u6216\u4e0a\u4e0b\u6587\u5171\u4eab\uff08\u4f8b\u5982\u901a\u8fc7 Arc\uff09 lazy init: \u8fed\u4ee3\u5668\u72b6\u6001\u53ef\u4ee5\u6309\u9700\u521d\u59cb\u5316</p> </li> <li>\u7f3a\u70b9 <p>\u6027\u80fd\u5f00\u9500\uff1a\u5185\u90e8\u53ef\u53d8\u6027\u6210\u672c\uff0cRefCell \u5728\u8fd0\u884c\u65f6\u68c0\u67e5\u501f\u7528\u89c4\u5219\uff08\u53ef\u80fd\u5bfc\u81f4 panic\uff09\uff1bMutex \u5f15\u5165\u7ebf\u7a0b\u540c\u6b65\u5f00\u9500\uff08\u9501\u7ade\u4e89\uff09 \u53ef\u80fd\u5b58\u5728\u60ac\u5782\u5f15\u7528\uff1a\u82e5\u5916\u90e8\u6570\u636e\uff08\u5982 SSTable \u6587\u4ef6\uff09\u5728\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\u88ab\u5220\u9664\uff0c\u53ef\u80fd\u5f15\u53d1\u672a\u5b9a\u4e49\u884c\u4e3a\u3002</p> </li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#10-the-scan-interface-is-like-fn-scanself-lower-boundu8-upper-boundu8-how-to-make-this-api-compatible-with-rust-style-range-ie-key_akey_b-if-you-implement-this-try-to-pass-a-full-range-to-the-interface-and-see-what-will-happen","title":"10. The scan interface is like fn scan(&amp;self, lower: Bound&lt;&amp;[u8]&gt;, upper: Bound&lt;&amp;[u8]&gt;). How to make this API compatible with Rust-style range (i.e., key_a..key_b)? If you implement this, try to pass a full range .. to the interface and see what will happen.","text":"<ul> <li>\u5b9e\u73b0\u4e86\uff0c\u9700\u8981\u6211\u4eec\u63d0\u4f9b\u65b0\u7684 trait\uff0c\u8f6c\u6362\u4e3a Bound</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#11-the-starter-code-provides-the-merge-iterator-interface-to-store-box-instead-of-i-what-might-be-the-reason-behind-that","title":"11. The starter code provides the merge iterator interface to store Box instead of I. What might be the reason behind that?","text":"","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#_1","title":"\u751f\u547d\u5468\u671f","text":"<ul> <li>\u5b50\u8fed\u4ee3\u5668\u7684\u751f\u547d\u5468\u671f\u53ef\u80fd\u4f9d\u8d56\u4e8e\u5176\u6765\u6e90\uff08\u4f8b\u5982\uff0c\u4ece MemTable \u6216 SSTable \u4e2d\u501f\u7528\u7684\u8fed\u4ee3\u5668\uff09\u3002\u82e5\u76f4\u63a5\u5b58\u50a8\u5f15\u7528\uff08\u5982 &amp;'a mut I\uff09\uff0c\u9700\u8981\u4e3a MergeIterator \u6dfb\u52a0\u590d\u6742\u7684\u751f\u547d\u5468\u671f\u53c2\u6570\u3002</li> <li>\u4f7f\u7528 Box \u5c06\u5b50\u8fed\u4ee3\u5668\u7684\u6240\u6709\u6743\u8f6c\u79fb\u5230 MergeIterator \u4e2d\uff0c\u786e\u4fdd\u8fed\u4ee3\u5668\u5728\u5408\u5e76\u8fc7\u7a0b\u4e2d\u59cb\u7ec8\u6709\u6548\uff0c\u65e0\u9700\u7ed1\u5b9a\u5916\u90e8\u751f\u547d\u5468\u671f\u3002</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day2/#_2","title":"\u5806\u5206\u914d","text":"<ul> <li>trait \u5bf9\u8c61\uff08\u5982 dyn Iterator\uff09\u7684\u5927\u5c0f\u5728\u7f16\u8bd1\u65f6\u65e0\u6cd5\u786e\u5b9a\uff0c\u65e0\u6cd5\u76f4\u63a5\u5b58\u50a8\u5728\u6808\u4e0a\u3002</li> <li>\u4f7f\u7528 Box \u5c06 Trait \u5bf9\u8c61\u5206\u914d\u5230\u5806\u4e0a\uff0c\u901a\u8fc7\u6307\u9488\u95f4\u63a5\u5f15\u7528\u3002</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/","title":"Block","text":"<code>#MiniLSM</code> <code>#rust</code>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#block","title":"Block","text":"<p> \u7ea6 798 \u4e2a\u5b57  18 \u884c\u4ee3\u7801  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <ul> <li>\u8fd9\u91cc\u6211\u4eec\u5b9e\u73b0\u4e86 SST Block \u7684 encode \u548c decode \u4ee5\u53ca block iterator </li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#block-encoding-format","title":"Block encoding format","text":"Bash<pre><code>----------------------------------------------------------------------------------------------------\n|             Data Section             |              Offset Section             |      Extra      |\n----------------------------------------------------------------------------------------------------\n| Entry #1 | Entry #2 | ... | Entry #N | Offset #1 | Offset #2 | ... | Offset #N | num_of_elements |\n----------------------------------------------------------------------------------------------------\n</code></pre>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#entry-format","title":"Entry format","text":"<ul> <li>\u91c7\u7528\u4e0e first key \u516c\u7528\u524d\u7f00\u7684\u65b9\u5f0f</li> </ul> Bash<pre><code>-----------------------------------------------------------------------\n|                           Entry #1                            | ... |\n-----------------------------------------------------------------------\n| overlap_with_first_key (2B) | key_len (2B) | key (keylen) | value_len (2B) | value (varlen) | ... |\n-----------------------------------------------------------------------\n</code></pre>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#the-end-of-block","title":"The end of block","text":"<ul> <li>store the offsets of each entry and the total number of entries</li> </ul> Bash<pre><code>-------------------------------\n|offset|offset|num_of_elements|\n-------------------------------\n|   0  |  12  |       2       |\n-------------------------------\n</code></pre>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#test-understanding-of-block-implement","title":"Test Understanding of Block implement","text":"","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#1-what-is-the-time-complexity-of-seeking-a-key-in-the-block","title":"1. What is the time complexity of seeking a key in the block?","text":"<ul> <li>\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\uff0cO(logn)</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#2-where-does-the-cursor-stop-when-you-seek-a-non-existent-key-in-your-implementation","title":"2. Where does the cursor stop when you seek a non-existent key in your implementation?","text":"<ul> <li>cursor \u4f1a\u505c\u5728 block.offsets.len()\u5904\uff0c\u6b64\u65f6\u8fd4\u56de\u7684 key \u662f\u7a7a\u7684\uff0cvalue_range \u662f(0, 0)</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#3-so-block-is-simply-a-vector-of-raw-data-and-a-vector-of-offsets-can-we-change-them-to-byte-and-arcu16-and-change-all-the-iterator-interfaces-to-return-byte-instead-of-u8-assume-that-we-use-byteslice-to-return-a-slice-of-the-block-without-copying-what-are-the-proscons","title":"3. So Block is simply a vector of raw data and a vector of offsets. Can we change them to Byte and Arc&lt;[u16]&gt;, and change all the iterator interfaces to return Byte instead of &amp;[u8]? (Assume that we use Byte::slice to return a slice of the block without copying.) What are the pros/cons?","text":"","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#_1","title":"\u4f18\u70b9 \u200b\u200b","text":"<ul> <li> <p>\u96f6\u62f7\u8d1d\u64cd\u4f5c \u200b\uff1aBytes \u7c7b\u578b\u5929\u7136\u652f\u6301\u96f6\u62f7\u8d1d\u5207\u7247\uff08\u901a\u8fc7 Bytes::slice\uff09\uff0c\u907f\u514d\u6570\u636e\u590d\u5236\uff0c\u5c24\u5176\u9002\u7528\u4e8e\u5927\u5757\u6570\u636e\u6216\u591a\u5904\u5171\u4eab\u7684\u573a\u666f\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u5b89\u5168 \u200b\u200b\uff1aArc&lt;[u16]&gt; \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u4e0d\u53ef\u53d8\u7ed3\u6784\uff0c\u5141\u8bb8\u591a\u7ebf\u7a0b\u5b89\u5168\u5171\u4eab\u504f\u79fb\u91cf\u6570\u7ec4\uff0c\u65e0\u9700\u989d\u5916\u540c\u6b65\u3002Bytes \u5185\u90e8\u901a\u8fc7\u539f\u5b50\u5f15\u7528\u8ba1\u6570\u7ba1\u7406\u6570\u636e\uff0c\u652f\u6301\u8de8\u7ebf\u7a0b\u5b89\u5168\u5171\u4eab\u3002</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316 \u200b\u200b\uff1a\u504f\u79fb\u91cf\u6570\u7ec4 Arc&lt;[u16]&gt; \u5728\u591a\u6b21\u5f15\u7528\u65f6\u5171\u4eab\u540c\u4e00\u5185\u5b58\uff0c\u6bd4 Vec \u7684\u72ec\u7acb\u5b58\u50a8\u66f4\u8282\u7701\u5185\u5b58\u3002   \u200b</p> </li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#_2","title":"\u7f3a\u70b9 \u200b\u200b","text":"<ul> <li>\u5185\u5b58\u788e\u7247\u5316 \u200b\u200b\uff1aArc&lt;[u16]&gt; \u7684\u6bcf\u4e2a\u5b9e\u4f8b\u72ec\u7acb\u5206\u914d\u5185\u5b58\uff0c\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u788e\u7247\uff08\u5c24\u5176\u662f\u5927\u91cf\u5c0f Block \u65f6\uff09\u3002\u5bf9\u6bd4 Vec \u7684\u8fde\u7eed\u5185\u5b58\u5e03\u5c40\uff0cArc&lt;[u16]&gt; \u7684\u968f\u673a\u5206\u914d\u53ef\u80fd\u964d\u4f4e\u7f13\u5b58\u5c40\u90e8\u6027\u3002</li> <li>\u5f15\u7528\u8ba1\u6570\u5f00\u9500 \u200b\u200b\uff1aArc \u548c Bytes \u7684\u539f\u5b50\u64cd\u4f5c\uff08\u589e\u51cf\u5f15\u7528\u8ba1\u6570\uff09\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u6709\u8f7b\u5fae\u6027\u80fd\u635f\u8017\u3002\u9891\u7e41\u521b\u5efa/\u9500\u6bc1 Block \u65f6\uff0c\u539f\u5b50\u64cd\u4f5c\u7684\u5f00\u9500\u53ef\u80fd\u7d2f\u79ef\u3002</li> <li>\u7075\u6d3b\u6027\u964d\u4f4e \u200b\u200b\uff1a\u4e0d\u53ef\u53d8\u8bbe\u8ba1\u4f7f\u5f97\u65e0\u6cd5\u52a8\u6001\u4fee\u6539 Block \u7684\u6570\u636e\u6216\u504f\u79fb\u91cf\uff0c\u82e5\u9700\u539f\u5730\u66f4\u65b0\u5219\u9700\u91cd\u5efa\u6574\u4e2a Block\u3002\u82e5\u7cfb\u7edf\u9700\u8981\u52a8\u6001\u8c03\u6574\u504f\u79fb\u91cf\uff08\u5982\u5408\u5e76 Block\uff09\uff0c\u9700\u989d\u5916\u7684\u6570\u636e\u62f7\u8d1d\u3002</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#4-what-is-the-endian-of-the-numbers-written-into-the-blocks-in-your-implementation","title":"4. What is the endian of the numbers written into the blocks in your implementation?","text":"<ul> <li>\u5927\u7aef\u5b58\u50a8</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#5-is-your-implementation-prune-to-a-maliciously-built-block-will-there-be-invalid-memory-access-or-ooms-if-a-user-deliberately-construct-an-invalid-block","title":"5. Is your implementation prune to a maliciously-built block? Will there be invalid memory access, or OOMs, if a user deliberately construct an invalid block?","text":"<ul> <li>\u5728\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u65f6\u8fdb\u884c\u68c0\u67e5</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#6-can-a-block-contain-duplicated-keys","title":"6. Can a block contain duplicated keys?","text":"<ul> <li>\u53ef\u4ee5\u7684\uff0c\u5408\u5e76\u76f8\u540c\u7684 key \u5728 compaction \u4e2d\u8fdb\u884c</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#7-what-happens-if-the-user-adds-a-key-larger-than-the-target-block-size","title":"7. What happens if the user adds a key larger than the target block size?","text":"<ul> <li>\u4f1a\u76f4\u63a5\u8fd4\u56de\u5931\u8d25\uff0c\u4e00\u822c\u5e94\u8be5\u538b\u7f29\u540e\u5b58\u5165</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day3/#8-consider-the-case-that-the-lsm-engine-is-built-on-object-store-services-s3-how-would-you-optimizechange-the-block-format-and-parameters-to-make-it-suitable-for-such-services","title":"8. Consider the case that the LSM engine is built on object store services (S3). How would you optimize/change the block format and parameters to make it suitable for such services?","text":"<p>\u9ad8\u5ef6\u8fdf\u3001\u4f4e\u968f\u673a\u8bbf\u95ee\u6027\u80fd\u3001\u6309\u8bf7\u6c42\u8ba1\u8d39\uff08PUT/GET\uff09\u7b49\u7279\u70b9\u8fdb\u884c\u4f18\u5316</p> <ul> <li>\u589e\u5927\u5757\u5927\u5c0f</li> <li>\u5143\u6570\u636e\u5916\u7f6e \u200b\u200b <p>\u8bbe\u8ba1 \u200b\u200b\uff1a\u5c06\u5757\u7d22\u5f15\u3001\u5e03\u9686\u8fc7\u6ee4\u5668\u7b49\u5143\u6570\u636e\u5355\u72ec\u5b58\u50a8\u4e3a\u5c0f\u6587\u4ef6\uff0c\u6216\u5185\u8054\u5728\u5757\u5934\u90e8\u3002 \u4f18\u70b9 \u200b\u200b\uff1a\u51cf\u5c11\u6bcf\u6b21 GET \u64cd\u4f5c\u4f20\u8f93\u7684\u6570\u636e\u91cf\uff08\u5148\u62c9\u53d6\u5143\u6570\u636e\uff0c\u518d\u6309\u9700\u62c9\u53d6\u6570\u636e\u5757\uff09\u3002\u652f\u6301\u5feb\u901f\u8fc7\u6ee4\u65e0\u6548\u67e5\u8be2\uff08\u5982\u5e03\u9686\u8fc7\u6ee4\u5668\u5224\u65ad\u952e\u4e0d\u5b58\u5728\uff09\u3002- \u5217\u5f0f\u5b58\u50a8\u5e03\u5c40</p> </li> <li>\u5c3d\u53ef\u80fd\u538b\u7f29\u66f4\u591a\u7684 KV \u5230\u4e00\u4e2a block \u4e2d</li> <li>\u5982\u679c\u662f scan\uff0c\u4f7f\u7528\u9884\u53d6\uff0c\u5c06\u591a\u4e2a block \u7684\u6570\u636e\u4e00\u6b21\u53d6\u51fa\u6765</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/","title":"SST","text":"<code>#MiniLSM</code> <code>#rust</code>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#block","title":"Block","text":"<p> \u7ea6 800 \u4e2a\u5b57  30 \u884c\u4ee3\u7801  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <ul> <li>\u8fd9\u91cc\u6211\u4eec\u5b9e\u73b0\u4e86 Sorted String Table \u7684 encode \u548c decode \u4ee5\u53ca block iterator </li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#sorted-string-table-format","title":"Sorted String Table format","text":"Bash<pre><code>-------------------------------------------------------------------------------------------\n|         Block Section         |          Meta Section         |          Extra          |\n-------------------------------------------------------------------------------------------\n| data block | ... | data block |            metadata           | meta block offset (u32) |\n-------------------------------------------------------------------------------------------\n\n-------------------------------------\n|           Block Meta              |\n-------------------------------------\n| num of metas| Meta1 | Meta2 | ... |\n-------------------------------------\n\n---------------------------------\n|           Meta i              |\n---------------------------------\n| offset | first key | last key |\n---------------------------------\n</code></pre>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#entry-format","title":"Entry format","text":"<ul> <li>\u91c7\u7528\u4e0e first key \u516c\u7528\u524d\u7f00\u7684\u65b9\u5f0f</li> </ul> Bash<pre><code>-----------------------------------------------------------------------\n|                           Entry #1                            | ... |\n-----------------------------------------------------------------------\n| overlap_with_first_key (2B) | key_len (2B) | key (keylen) | value_len (2B) | value (varlen) | ... |\n-----------------------------------------------------------------------\n</code></pre>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#the-end-of-block","title":"The end of block","text":"<ul> <li>store the offsets of each entry and the total number of entries</li> </ul> Bash<pre><code>-------------------------------\n|offset|offset|num_of_elements|\n-------------------------------\n|   0  |  12  |       2       |\n-------------------------------\n</code></pre>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#test-understanding-of-block-implement","title":"Test Understanding of Block implement","text":"","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#1-what-is-the-time-complexity-of-seeking-a-key-in-the-block","title":"1. What is the time complexity of seeking a key in the block?","text":"<ul> <li>\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\uff0cO(logn)</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#2-where-does-the-cursor-stop-when-you-seek-a-non-existent-key-in-your-implementation","title":"2. Where does the cursor stop when you seek a non-existent key in your implementation?","text":"<ul> <li>cursor \u4f1a\u505c\u5728 block.offsets.len()\u5904\uff0c\u6b64\u65f6\u8fd4\u56de\u7684 key \u662f\u7a7a\u7684\uff0cvalue_range \u662f(0, 0)</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#3-so-block-is-simply-a-vector-of-raw-data-and-a-vector-of-offsets-can-we-change-them-to-byte-and-arcu16-and-change-all-the-iterator-interfaces-to-return-byte-instead-of-u8-assume-that-we-use-byteslice-to-return-a-slice-of-the-block-without-copying-what-are-the-proscons","title":"3. So Block is simply a vector of raw data and a vector of offsets. Can we change them to Byte and Arc&lt;[u16]&gt;, and change all the iterator interfaces to return Byte instead of &amp;[u8]? (Assume that we use Byte::slice to return a slice of the block without copying.) What are the pros/cons?","text":"","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#_1","title":"\u4f18\u70b9 \u200b\u200b","text":"<ul> <li> <p>\u96f6\u62f7\u8d1d\u64cd\u4f5c \u200b\uff1aBytes \u7c7b\u578b\u5929\u7136\u652f\u6301\u96f6\u62f7\u8d1d\u5207\u7247\uff08\u901a\u8fc7 Bytes::slice\uff09\uff0c\u907f\u514d\u6570\u636e\u590d\u5236\uff0c\u5c24\u5176\u9002\u7528\u4e8e\u5927\u5757\u6570\u636e\u6216\u591a\u5904\u5171\u4eab\u7684\u573a\u666f\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u5b89\u5168 \u200b\u200b\uff1aArc&lt;[u16]&gt; \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u4e0d\u53ef\u53d8\u7ed3\u6784\uff0c\u5141\u8bb8\u591a\u7ebf\u7a0b\u5b89\u5168\u5171\u4eab\u504f\u79fb\u91cf\u6570\u7ec4\uff0c\u65e0\u9700\u989d\u5916\u540c\u6b65\u3002Bytes \u5185\u90e8\u901a\u8fc7\u539f\u5b50\u5f15\u7528\u8ba1\u6570\u7ba1\u7406\u6570\u636e\uff0c\u652f\u6301\u8de8\u7ebf\u7a0b\u5b89\u5168\u5171\u4eab\u3002</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316 \u200b\u200b\uff1a\u504f\u79fb\u91cf\u6570\u7ec4 Arc&lt;[u16]&gt; \u5728\u591a\u6b21\u5f15\u7528\u65f6\u5171\u4eab\u540c\u4e00\u5185\u5b58\uff0c\u6bd4 Vec \u7684\u72ec\u7acb\u5b58\u50a8\u66f4\u8282\u7701\u5185\u5b58\u3002   \u200b</p> </li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#_2","title":"\u7f3a\u70b9 \u200b\u200b","text":"<ul> <li>\u5185\u5b58\u788e\u7247\u5316 \u200b\u200b\uff1aArc&lt;[u16]&gt; \u7684\u6bcf\u4e2a\u5b9e\u4f8b\u72ec\u7acb\u5206\u914d\u5185\u5b58\uff0c\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u788e\u7247\uff08\u5c24\u5176\u662f\u5927\u91cf\u5c0f Block \u65f6\uff09\u3002\u5bf9\u6bd4 Vec \u7684\u8fde\u7eed\u5185\u5b58\u5e03\u5c40\uff0cArc&lt;[u16]&gt; \u7684\u968f\u673a\u5206\u914d\u53ef\u80fd\u964d\u4f4e\u7f13\u5b58\u5c40\u90e8\u6027\u3002</li> <li>\u5f15\u7528\u8ba1\u6570\u5f00\u9500 \u200b\u200b\uff1aArc \u548c Bytes \u7684\u539f\u5b50\u64cd\u4f5c\uff08\u589e\u51cf\u5f15\u7528\u8ba1\u6570\uff09\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u6709\u8f7b\u5fae\u6027\u80fd\u635f\u8017\u3002\u9891\u7e41\u521b\u5efa/\u9500\u6bc1 Block \u65f6\uff0c\u539f\u5b50\u64cd\u4f5c\u7684\u5f00\u9500\u53ef\u80fd\u7d2f\u79ef\u3002</li> <li>\u7075\u6d3b\u6027\u964d\u4f4e \u200b\u200b\uff1a\u4e0d\u53ef\u53d8\u8bbe\u8ba1\u4f7f\u5f97\u65e0\u6cd5\u52a8\u6001\u4fee\u6539 Block \u7684\u6570\u636e\u6216\u504f\u79fb\u91cf\uff0c\u82e5\u9700\u539f\u5730\u66f4\u65b0\u5219\u9700\u91cd\u5efa\u6574\u4e2a Block\u3002\u82e5\u7cfb\u7edf\u9700\u8981\u52a8\u6001\u8c03\u6574\u504f\u79fb\u91cf\uff08\u5982\u5408\u5e76 Block\uff09\uff0c\u9700\u989d\u5916\u7684\u6570\u636e\u62f7\u8d1d\u3002</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#4-what-is-the-endian-of-the-numbers-written-into-the-blocks-in-your-implementation","title":"4. What is the endian of the numbers written into the blocks in your implementation?","text":"<ul> <li>\u5927\u7aef\u5b58\u50a8</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#5-is-your-implementation-prune-to-a-maliciously-built-block-will-there-be-invalid-memory-access-or-ooms-if-a-user-deliberately-construct-an-invalid-block","title":"5. Is your implementation prune to a maliciously-built block? Will there be invalid memory access, or OOMs, if a user deliberately construct an invalid block?","text":"<ul> <li>\u5728\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u65f6\u8fdb\u884c\u68c0\u67e5</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#6-can-a-block-contain-duplicated-keys","title":"6. Can a block contain duplicated keys?","text":"<ul> <li>\u53ef\u4ee5\u7684\uff0c\u5408\u5e76\u76f8\u540c\u7684 key \u5728 compaction \u4e2d\u8fdb\u884c</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#7-what-happens-if-the-user-adds-a-key-larger-than-the-target-block-size","title":"7. What happens if the user adds a key larger than the target block size?","text":"<ul> <li>\u4f1a\u76f4\u63a5\u8fd4\u56de\u5931\u8d25\uff0c\u4e00\u822c\u5e94\u8be5\u538b\u7f29\u540e\u5b58\u5165</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/minilsm/week1-day4/#8-consider-the-case-that-the-lsm-engine-is-built-on-object-store-services-s3-how-would-you-optimizechange-the-block-format-and-parameters-to-make-it-suitable-for-such-services","title":"8. Consider the case that the LSM engine is built on object store services (S3). How would you optimize/change the block format and parameters to make it suitable for such services?","text":"<p>\u9ad8\u5ef6\u8fdf\u3001\u4f4e\u968f\u673a\u8bbf\u95ee\u6027\u80fd\u3001\u6309\u8bf7\u6c42\u8ba1\u8d39\uff08PUT/GET\uff09\u7b49\u7279\u70b9\u8fdb\u884c\u4f18\u5316</p> <ul> <li>\u589e\u5927\u5757\u5927\u5c0f</li> <li>\u5143\u6570\u636e\u5916\u7f6e \u200b\u200b <p>\u8bbe\u8ba1 \u200b\u200b\uff1a\u5c06\u5757\u7d22\u5f15\u3001\u5e03\u9686\u8fc7\u6ee4\u5668\u7b49\u5143\u6570\u636e\u5355\u72ec\u5b58\u50a8\u4e3a\u5c0f\u6587\u4ef6\uff0c\u6216\u5185\u8054\u5728\u5757\u5934\u90e8\u3002 \u4f18\u70b9 \u200b\u200b\uff1a\u51cf\u5c11\u6bcf\u6b21 GET \u64cd\u4f5c\u4f20\u8f93\u7684\u6570\u636e\u91cf\uff08\u5148\u62c9\u53d6\u5143\u6570\u636e\uff0c\u518d\u6309\u9700\u62c9\u53d6\u6570\u636e\u5757\uff09\u3002\u652f\u6301\u5feb\u901f\u8fc7\u6ee4\u65e0\u6548\u67e5\u8be2\uff08\u5982\u5e03\u9686\u8fc7\u6ee4\u5668\u5224\u65ad\u952e\u4e0d\u5b58\u5728\uff09\u3002- \u5217\u5f0f\u5b58\u50a8\u5e03\u5c40</p> </li> <li>\u5c3d\u53ef\u80fd\u538b\u7f29\u66f4\u591a\u7684 KV \u5230\u4e00\u4e2a block \u4e2d</li> <li>\u5982\u679c\u662f scan\uff0c\u4f7f\u7528\u9884\u53d6\uff0c\u5c06\u591a\u4e2a block \u7684\u6570\u636e\u4e00\u6b21\u53d6\u51fa\u6765</li> </ul>","tags":["MiniLSM","rust"]},{"location":"notes/nebula/1.visitor%20pattern/","title":"Visitor Pattern","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/nebula/1.visitor%20pattern/#_1","title":"\u89c2\u5bdf\u8005\u8bbe\u8ba1\u6a21\u5f0f","text":"<p> \u7ea6 587 \u4e2a\u5b57  102 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>\u8fd9\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u5141\u8bb8\u4f60\u5728\u4e0d\u4fee\u6539\u73b0\u6709\u5bf9\u8c61\u7ed3\u6784\uff08\u7c7b\uff09\u7684\u524d\u63d0\u4e0b\uff0c\u5411\u8fd9\u4e9b\u7c7b\u6dfb\u52a0\u65b0\u7684\u64cd\u4f5c\u3002\u5b83\u901a\u8fc7\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u201c\u8bbf\u95ee\u8005\u201d\u7c7b\u6765\u5c01\u88c5\u8fd9\u4e9b\u65b0\u64cd\u4f5c\uff0c\u7136\u540e\u8ba9\u5bf9\u8c61\u7ed3\u6784\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u201c\u63a5\u53d7\u201d\uff08accept\uff09\u8fd9\u4e2a\u8bbf\u95ee\u8005\uff0c\u4ece\u800c\u6267\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\u3002</p>","tags":["Database"]},{"location":"notes/nebula/1.visitor%20pattern/#_2","title":"\u4e3b\u8981\u7ec4\u6210\u90e8\u5206","text":"<ul> <li>\u8bbf\u95ee\u8005 (Visitor) \u63a5\u53e3/\u62bd\u8c61\u7c7b\uff1a\u5b9a\u4e49\u4e86\u4e00\u7cfb\u5217 visit \u65b9\u6cd5\uff0c\u6bcf\u4e2a\u65b9\u6cd5\u5bf9\u5e94\u4e00\u4e2a\u5177\u4f53\u5143\u7d20\uff08ConcreteElement\uff09\u7c7b\u578b\u3002 <p>\u4f8b\u5982\uff1avisitConcreteElementA(elementA: ConcreteElementA)\uff0cvisitConcreteElementB(elementB: ConcreteElementB)\u3002\u8fd9\u4e2a\u63a5\u53e3\u7684\u5b9e\u73b0\u8005\uff08\u5177\u4f53\u8bbf\u95ee\u8005\uff09\u5c06\u5305\u542b\u5bf9\u4e0d\u540c\u7c7b\u578b\u5143\u7d20\u7684\u5177\u4f53\u64cd\u4f5c\u903b\u8f91\u3002</p> </li> <li>\u5177\u4f53\u8bbf\u95ee\u8005 (ConcreteVisitor)\uff1a\u5b9e\u73b0 Visitor \u63a5\u53e3\u3002\u6bcf\u4e00\u4e2a visit \u65b9\u6cd5\u90fd\u5b9e\u73b0\u4e86\u5bf9\u76f8\u5e94\u5177\u4f53\u5143\u7d20\u7c7b\u578b\u7684\u7279\u5b9a\u64cd\u4f5c\u3002\u4e00\u4e2a\u5177\u4f53\u8bbf\u95ee\u8005\u901a\u5e38\u4ee3\u8868\u4e00\u4e2a\u7279\u5b9a\u7684\u7b97\u6cd5\u6216\u4e00\u7ec4\u76f8\u5173\u7684\u64cd\u4f5c\u3002</li> <li>\u5143\u7d20 (Element) \u63a5\u53e3/\u62bd\u8c61\u7c7b\uff1a\u5b9a\u4e49\u4e86\u4e00\u4e2a accept(visitor: Visitor) \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4ee5\u4e00\u4e2a\u8bbf\u95ee\u8005\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u3002\u8fd9\u4e2a\u65b9\u6cd5\u662f\u8fde\u63a5\u5143\u7d20\u548c\u8bbf\u95ee\u8005\u7684\u6865\u6881\u3002</li> <li>\u5177\u4f53\u5143\u7d20 (ConcreteElement)\uff1a\u5b9e\u73b0 Element \u63a5\u53e3\u3002\u5728\u5176 accept \u65b9\u6cd5\u4e2d\uff0c\u901a\u5e38\u4f1a\u8c03\u7528\u8bbf\u95ee\u8005\uff08visitor\uff09\u7684\u76f8\u5e94 visit \u65b9\u6cd5\uff0c\u5e76\u5c06\u81ea\u8eab\uff08this\uff09\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u8fc7\u53bb\u3002\u4f8b\u5982\uff1avisitor.visitConcreteElementA(this)\u3002\u5b83\u4eec\u901a\u5e38\u5305\u542b\u4e00\u4e9b\u6570\u636e\uff0c\u8bbf\u95ee\u8005\u4f1a\u4f7f\u7528\u8fd9\u4e9b\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u3002</li> </ul>","tags":["Database"]},{"location":"notes/nebula/1.visitor%20pattern/#double-dispatch","title":"\u5de5\u4f5c\u6d41\u7a0b (Double Dispatch)","text":"<ol> <li>\u5ba2\u6237\u7aef\u521b\u5efa\u4e00\u4e2a\u5177\u4f53\u8bbf\u95ee\u8005\u5bf9\u8c61\uff0c\u5e76\u5c06\u5176\u4f20\u9012\u7ed9\u5bf9\u8c61\u7ed3\u6784\u4e2d\u7684\u67d0\u4e2a\u5143\u7d20\uff08\u6216\u6574\u4e2a\u5bf9\u8c61\u7ed3\u6784\uff09\u3002</li> <li>\u5143\u7d20\u8c03\u7528\u5176 accept(visitor) \u65b9\u6cd5\uff0c\u5c06\u81ea\u8eab\u4f20\u9012\u7ed9\u8bbf\u95ee\u8005\u3002</li> <li>\u5728 accept \u65b9\u6cd5\u5185\u90e8\uff0c\u5143\u7d20\u4f1a\u56de\u8c03\u8bbf\u95ee\u8005\u7684 visitConcreteElementX(this) \u65b9\u6cd5\u3002</li> <li>\u7b2c\u4e00\u6b21\u5206\u6d3e\uff1a\u8c03\u7528 element.accept(visitor)\u3002\u8fd9\u4e2a\u8c03\u7528\u4f1a\u6839\u636e element \u7684\u5b9e\u9645\u7c7b\u578b\uff08ConcreteElementA, ConcreteElementB \u7b49\uff09\u6765\u786e\u5b9a\u6267\u884c\u54ea\u4e2a accept \u65b9\u6cd5\u3002</li> <li>\u7b2c\u4e8c\u6b21\u5206\u6d3e\uff1a\u5728\u5177\u4f53\u5143\u7d20\u7684 accept \u65b9\u6cd5\u5185\u90e8\uff0c\u8c03\u7528 visitor.visitConcreteElementX(this)\u3002\u8fd9\u4e2a\u8c03\u7528\u4f1a\u6839\u636e visitor \u7684\u5b9e\u9645\u7c7b\u578b\uff08ConcreteVisitor1, ConcreteVisitor2 \u7b49\uff09\u4ee5\u53ca this \uff08\u5373\u5177\u4f53\u5143\u7d20\uff09\u7684\u7c7b\u578b\u6765\u786e\u5b9a\u6267\u884c\u54ea\u4e2a visit \u65b9\u6cd5\u3002</li> </ol>","tags":["Database"]},{"location":"notes/nebula/1.visitor%20pattern/#_3","title":"\u793a\u4f8b","text":"C++<pre><code>// \u5143\u7d20\u63a5\u53e3\ninterface Shape {\n    accept(visitor: visitor);\n}\n\n// \u5177\u4f53\u5143\u7d20\nclass Circle implements Shape {\n    radius: number;\n    constructor(radius: number) { this.radius = radius; }\n    accept(visitor: visitor) {\n        visitor.visitCircle(this);\n    }\n}\n\nclass Square implements Shape {\n    side: number;\n    constructor(side: number) { this.side = side; }\n    accept(visitor: visitor) {\n        visitor.visitSquare(this);\n    }\n}\n\n// \u8bbf\u95ee\u8005\u63a5\u53e3\ninterface visitor {\n    visitCircle(circle: Circle);\n    visitSquare(square: Square);\n}\n\n// \u5177\u4f53\u8bbf\u95ee\u8005\uff1a\u8ba1\u7b97\u9762\u79ef\nclass AreaCalculatorVisitor implements visitor {\n    visitCircle(circle: Circle) {\n        const area = Math.PI * circle.radius * circle.radius;\n        console.log(`Area of Circle: ${area}`);\n    }\n    visitSquare(square: Square) {\n        const area = square.side * square.side;\n        console.log(`Area of Square: ${area}`);\n    }\n}\n\n// \u5177\u4f53\u8bbf\u95ee\u8005\uff1a\u5bfc\u51fa\u4e3aXML\nclass XMLExportVisitor implements visitor {\n    visitCircle(circle: Circle) {\n        console.log(`&lt;circle radius=\"${circle.radius}\"/&gt;`);\n    }\n    visitSquare(square: Square) {\n        console.log(`&lt;square side=\"${square.side}\"/&gt;`);\n    }\n}\n\n// \u5bf9\u8c61\u7ed3\u6784 (\u7b80\u5355\u5217\u8868)\nconst shapes: Shape[] = [\n    new Circle(5),\n    new Square(4)\n];\n\n// \u4f7f\u7528\nconst areaCalculator = new AreaCalculatorVisitor();\nconst xmlExporter = new XMLExportVisitor();\n\nconsole.log(\"Calculating areas:\");\nfor (const shape of shapes) {\n    shape.accept(areaCalculator);\n}\n\nconsole.log(\"\\nExporting to XML:\");\nfor (const shape of shapes) {\n    shape.accept(xmlExporter);\n}\n\n// \u8f93\u51fa:\n// Calculating areas:\n// Area of Circle: 78.53981633974483\n// Area of Square: 16\n//\n// Exporting to XML:\n// &lt;circle radius=\"5\"/&gt;\n// &lt;square side=\"4\"/&gt;\n</code></pre>","tags":["Database"]},{"location":"notes/nebula/1.visitor%20pattern/#nebula-visitor-pattern","title":"nebula \u4e2d\u7684 visitor pattern","text":"<ul> <li>nebula \u5c06 Expression \u7c7b\u4f5c\u4e3a element\uff0c\u5c06 find\uff0cevaluate \u7b49\u529f\u80fd\u53d8\u6210 visitor \u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\uff0c\u5b9e\u73b0\u4e86 visitor pattern\u3002</li> </ul> C++<pre><code>// interface\nclass ExprVisitorImpl : public ExprVisitor {\n public:\n  // leaf expression nodes\n  void visit(ConstantExpression *) override {}\n};\n\n// implement interface\nclass EvaluableExprVisitor : public ExprVisitorImpl {\n  using ExprVisitorImpl::visit;\n\n  void visit(ConstantExpression *) override;\n\n  bool isEvaluable_{true};\n  const QueryContext *qctx_{nullptr};\n};\n\n// element\nclass ConstantExpression : public Expression {\n  friend class Expression;\n  void accept(ExprVisitor* visitor) override;\n private:\n  Value val_;\n};\n</code></pre>","tags":["Database"]},{"location":"notes/nebula/2.memory%20management/","title":"Memory Management in nebula","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/nebula/2.memory%20management/#_1","title":"\u603b\u4f53\u6846\u67b6","text":"<p> \u7ea6 188 \u4e2a\u5b57  7 \u884c\u4ee3\u7801  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <p>nebula \u5185\u90e8\u7684\u5185\u5b58\u7ba1\u7406\u7531 ObjectPool \u8d1f\u8d23\uff0c\u4f7f\u7528\u6a21\u677f\u5316\u7f16\u7a0b\u65b9\u5f0f\u3002ObjectPool \u4e2d\u5b9e\u9645\u8d1f\u8d23\u5185\u5b58\u5206\u914d\u7684\u662f Arena \u7c7b\uff0c\u53e6\u5916\u8fd8\u4fdd\u5b58\u6240\u6709\u5c0f\u5bf9\u8c61\u7684\u8d77\u59cb\u5730\u5740\u3002</p> <p></p>","tags":["Database"]},{"location":"notes/nebula/2.memory%20management/#arena","title":"Arena","text":"<p>Arena \u662f\u5b9e\u9645\u4e0a\u662f\u5185\u5b58\u6c60\u5206\u914d\u5668\uff0c\u8be5\u5206\u914d\u5668\u7684\u6700\u5c0f\u5355\u5143\u662f chunk\uff0c\u7cfb\u7edf\u5185\u53ea\u4f1a\u5b58\u5728\u4e00\u4e2a current chunk\uff0c\u5f85\u5206\u914d\u6ee1\u6216\u8005\u4e0d\u591f\u5206\u914d\u65f6\u5c31\u4f1a\u7533\u8bf7\u65b0\u7684 chunk\uff0c\u7136\u540e\u5c06\u524d\u9762\u7684 chunk \u548c\u65b0\u7684 chunk \u901a\u8fc7\u94fe\u8868\u8fde\u63a5\u8d77\u6765\uff0c\u65b9\u4fbf\u540e\u7eed\u56de\u6536\u3002</p>","tags":["Database"]},{"location":"notes/nebula/2.memory%20management/#chunk","title":"Chunk","text":"<p>\u5185\u5b58\u6c60\u5206\u914d\u7684\u6700\u5c0f\u5355\u5143\uff0c\u5206\u914d\u4f7f\u7528 new \u6765\u5206\u914d\u56fa\u5b9a\u5b57\u8282\u7684\u5185\u5b58\u3002</p> C++<pre><code>void newChunk(std::size_t size) {\n  DCHECK_NE(size, 0);\n  std::byte *ptr = new std::byte[size + sizeof(Chunk)];\n  currentChunk_ = new (ptr) Chunk(currentChunk_);\n  availableSize_ = size;\n  currentPtr_ = (ptr + sizeof(Chunk));\n}\n</code></pre>","tags":["Database"]},{"location":"notes/nebula/3.concurrent%20lru%20cache/","title":"Concurrent LRU Cache","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/nebula/3.concurrent%20lru%20cache/#concurrent-lru-cache","title":"Concurrent LRU Cache","text":"<p> \u7ea6 200 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <p>\u5b9e\u9645\u4e0a\u5e76\u53d1 LRU Cache \u662f\u7531\u591a\u4e2a LRU Cache \u7ec4\u6210\u7684\uff0c\u6bcf\u4e2a LRU Cache \u548c\u4e00\u628a lock \u7ec4\u6210\u4e00\u4e2a Bucket\uff0cConcurrent LRU Cache \u5b9e\u9645\u4e0a\u5c31\u662f Bucket \u6570\u7ec4\u3002\u6bcf\u4e2a LRU Cache \u7531\u81ea\u5df1\u7684\u9501\u4fdd\u62a4\uff0c\u4f7f\u7528 hash \u6765\u5b9e\u73b0 bucket \u5e76\u53d1\uff0c\u9501\u53ea\u5728 bucket \u8fd9\u4e2a\u7c92\u5ea6\u4e0a\u3002</p> <p></p>","tags":["Database"]},{"location":"notes/nebula/3.concurrent%20lru%20cache/#lru-cache","title":"LRU Cache","text":"<p>\u76f8\u8f83\u4e8e\u6807\u51c6\u7684 map + \u94fe\u8868\u5b9e\u73b0\uff0cnebula \u7528 <code>std::unordered_map&lt;K, std::pair&lt;V, typename std::list&lt;K&gt;::iterator&gt;&gt;</code> \u66ff\u4ee3<code>std::map</code>\uff0c\u901a\u8fc7\u4e00\u4e2a\u6307\u5411\u5728\u94fe\u8868\u4e2d\u5bf9\u5e94\u952e\u7684\u8fed\u4ee3\u5668\u5b9e\u73b0 O(1)\u65f6\u95f4\u590d\u6742\u5ea6\u66f4\u65b0\u3002std::unordered_map \u66ff\u6362\u4e86 std::map\uff0c\u610f\u5473\u7740\u67e5\u627e\u3001\u63d2\u5165\u3001\u5220\u9664\u7684\u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\u4ece O(log N)\u63d0\u5347\u5230\u4e86 O(1)\uff0c\u4f46\u727a\u7272\u4e86\u952e\u7684\u6709\u5e8f\u6027\uff08LRU \u7f13\u5b58\u901a\u5e38\u4e0d\u9700\u8981\uff09\u3002</p> <p></p>","tags":["Database"]},{"location":"notes/nebula/4.folly%20future%20promise/","title":"Folly \u5f02\u6b65\u7f16\u7a0b\u6846\u67b6","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/nebula/4.folly%20future%20promise/#folly","title":"Folly \u5f02\u6b65\u7f16\u7a0b\u6846\u67b6","text":"<p> \u7ea6 1028 \u4e2a\u5b57  27 \u884c\u4ee3\u7801  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>Folly \u7684\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b\u56f4\u7ed5 Futures\u3001Promises \u548c EventBase \u5c55\u5f00\u3002\u8be5\u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e00\u79cd\u5f3a\u5927\u7684\u65b9\u5f0f\u6765\u7f16\u5199\u975e\u963b\u585e\u4ee3\u7801\uff0c\u9ad8\u6548\u5904\u7406\u5e76\u53d1\u3002</p> <p></p> <ol> <li>\u975e\u963b\u585e\u8c03\u7528\uff1astorageClient-&gt;getProps() \u662f\u975e\u963b\u585e\u7684\u3002\u5b83\u542f\u52a8\u5f02\u6b65\u64cd\u4f5c\u5e76\u7acb\u5373\u8fd4\u56de\u4e00\u4e2a Future\u3002\u8c03\u7528 getProps \u7684\u7ebf\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u5176\u4ed6\u4efb\u52a1\uff0c\u800c\u4e0d\u7528\u7b49\u5f85\u7f51\u7edc I/O \u548c\u5b58\u50a8\u5c42\u5904\u7406\u5b8c\u6210\u3002</li> <li>Future \u4f5c\u4e3a\u5360\u4f4d\u7b26\uff1afolly::Future \u662f\u4e00\u4e2a\u5360\u4f4d\u7b26\uff0c\u4ee3\u8868\u7c7b\u578b\u4e3a T \u7684\u64cd\u4f5c\u6700\u7ec8\u7684\u7ed3\u679c\u3002</li> <li>Promise (\u9690\u85cf\u7684)\uff1a\u5728 StorageClient::getProps \u5185\u90e8\uff0c\u5f53\u5f02\u6b65\u64cd\u4f5c\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\u53d1\u9001\uff09\u88ab\u53d1\u8d77\u540e\uff0c\u5b83\u4f1a\u4e0e\u4e00\u4e2a folly::Promise \u76f8\u5173\u8054\u3002\u5f53\u5b58\u50a8\u5c42\u7684\u54cd\u5e94\u5230\u8fbe\u65f6\uff0c\u67d0\u4e2a\u7ec4\u4ef6\u4f1a\u8d1f\u8d23\u8c03\u7528\u8fd9\u4e2a Promise \u7684 setValue(response) \u6216 setException(error) \u65b9\u6cd5\u3002\u8fd9\u4f1a\u4f7f\u5bf9\u5e94\u7684 Future \u5b8c\u6210\u3002</li> <li>\u94fe\u5f0f\u56de\u8c03 (.via().thenValue())\uff1a    - .via(executor) \u63a7\u5236\u56de\u8c03\u5728\u54ea\u4e2a\u7ebf\u7a0b\u6267\u884c\u3002    - .thenValue(callback) \u6ce8\u518c\u4e00\u4e2a\u5f53 Future \u6210\u529f\u5b8c\u6210\u65f6\u8981\u6267\u884c\u7684\u51fd\u6570\u3002\u5982\u679c Future \u5931\u8d25\uff08\u5373 Promise \u88ab setException\uff09\uff0c.thenValue \u7684\u56de\u8c03\u5c06\u88ab\u8df3\u8fc7\uff0cFolly \u4f1a\u5bfb\u627e\u94fe\u4e2d\u7684\u9519\u8bef\u5904\u7406\u5668\uff08\u5982 .thenError()\uff09\u3002    - \u56de\u8c03\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u666e\u901a\u503c\uff08\u4f1a\u88ab\u5305\u88c5\u6210\u65b0\u7684 Future\uff09\u6216\u53e6\u4e00\u4e2a Future\uff08Folly \u4f1a\u81ea\u52a8\u201c\u6241\u5e73\u5316\u201d\u5b83\uff0c\u5373 Future&gt; \u53d8\u6210 Future\uff09\u3002</li> <li>\u6570\u636e\u6d41\u548c\u63a7\u5236\u6d41\u5206\u79bb\uff1a\u4ee3\u7801\u7684\u7ed3\u6784\u6e05\u6670\u5730\u5206\u79bb\u4e86\u201c\u53d1\u8d77\u8bf7\u6c42\u201d\u548c\u201c\u5904\u7406\u7ed3\u679c\u201d\u3002\u5904\u7406\u7ed3\u679c\u7684\u903b\u8f91\uff08handlePropResp\uff09\u88ab\u5c01\u88c5\u5728\u56de\u8c03\u4e2d\uff0c\u53ea\u6709\u5f53\u6570\u636e\u5b9e\u9645\u53ef\u7528\u65f6\u624d\u6267\u884c\u3002</li> <li>\u9519\u8bef\u5904\u7406 (\u9690\u5f0f)\uff1a\u5982\u679c storageClient-&gt;getProps() \u5185\u90e8\u53d1\u751f\u9519\u8bef\uff0c\u6216\u8005 Promise \u88ab setException\uff0c\u90a3\u4e48 getProps \u8fd4\u56de\u7684 Future \u5c06\u4f1a\u5931\u8d25\u3002.thenValue \u7684\u56de\u8c03\u4e0d\u4f1a\u6267\u884c\u3002\u5982\u679c\u8c03\u7528\u8005\u5728 getProps \u8fd4\u56de\u7684 Future \u4e0a\u94fe\u63a5\u4e86 .thenError()\uff0c\u90a3\u4e48\u9519\u8bef\u5904\u7406\u56de\u8c03\u4f1a\u88ab\u89e6\u53d1\u3002\u5982\u679c handlePropResp \u5185\u90e8\u629b\u51fa\u5f02\u5e38\uff0c\u90a3\u4e48\u7531 .thenValue \u8fd4\u56de\u7684 Future&gt; \u5c06\u4f1a\u5931\u8d25\uff0c\u5e76\u643a\u5e26\u8fd9\u4e2a\u5f02\u5e38\u3002</li> </ol>","tags":["Database"]},{"location":"notes/nebula/4.folly%20future%20promise/#nebula","title":"nebula \u4e2d\u7684\u793a\u4f8b","text":"<p>graphd \u8282\u70b9\u901a\u8fc7 rpc \u5411 stroaged \u8282\u70b9\u8bf7\u6c42\u670d\u52a1\uff0c\u6574\u4e2a\u8fc7\u7a0b\u4e3a\u4e86\u4e0d\u963b\u788d\u5176\u4ed6\u670d\u52a1\u8fc7\u7a0b\uff0c\u90fd\u662f\u5f02\u6b65\u5316\u7684\u3002 stroaged \u8282\u70b9\u4e2d\u7684 executor \u4e2d\u5b58\u5728\u5982\u4e0b\u65b9\u6cd5:</p> <ul> <li>getFuture: \u8fd4\u56de promise \u5bf9\u5e94\u7684 Future</li> <li>onFinished: \u4e3b\u8981\u662f\u5bf9 promise \u8fdb\u884c setvalue \u64cd\u4f5c</li> </ul> C++<pre><code>folly::Future&lt;RESP&gt; getFuture() {\n  return promise_.getFuture();\n}\n\nthis-&gt;promise_.setValue(std::move(this-&gt;resp_));\n</code></pre> <p>graphd \u5bf9\u5e94\u7aef\u5b58\u5728\u76f8\u5e94\u7684 executor\uff0c\u8d1f\u8d23\u5411 storaged \u8282\u70b9\u53d1\u9001\u8bf7\u6c42\u5e76\u8fd4\u56de Future\uff0c\u5b9e\u73b0\u5f02\u6b65\u6267\u884c\u3002\u3001 Future \u7684\u6267\u884c\u5668\u662f\u5728 request context \u4e2d\u8bbe\u7f6e\u7684\u3002</p> C++<pre><code>folly::Future&lt;std::vector&lt;Value&gt;&gt; StorageAccessExecutor::getProps(\n    const std::vector&lt;Value&gt; &amp;vids, const std::vector&lt;VertexProp&gt; *vertexPropPtr) {\n  nebula::DataSet vertices({kVid});\n  vertices.rows.reserve(vids.size());\n  for (auto &amp;vid : vids) {\n    vertices.emplace_back(Row({vid}));\n  }\n  StorageClient *storageClient = qctx_-&gt;getStorageClient();\n  StorageClient::CommonRequestParam param(qctx_-&gt;rctx()-&gt;session()-&gt;space().id,\n                                          qctx_-&gt;rctx()-&gt;session()-&gt;id(),\n                                          qctx_-&gt;plan()-&gt;id(),\n                                          qctx_-&gt;plan()-&gt;isProfileEnabled());\n  return DCHECK_NOTNULL(storageClient)\n      -&gt;getProps(\n          param, std::move(vertices), vertexPropPtr, nullptr, nullptr, false, {}, -1, nullptr)\n      .via(runner())\n      .thenValue([this](PropRpcResponse &amp;&amp;resp) {\n        memory::MemoryCheckGuard guard;\n        addStats(resp);\n        return handlePropResp(std::move(resp));\n      });\n}\n</code></pre>","tags":["Database"]},{"location":"notes/nebula/4.folly%20future%20promise/#_1","title":"\u8be6\u7ec6\u6d41\u7a0b","text":"<ol> <li>storageClient-&gt;getProps(...): \u8fd9\u662f\u5173\u952e\u7684\u5f02\u6b65\u8c03\u7528\u3002</li> </ol> <ul> <li>\u8fd9\u4e2a\u65b9\u6cd5\u5e76\u4e0d\u76f4\u63a5\u8fd4\u56de\u5c5e\u6027\u6570\u636e\u3002\u76f8\u53cd\uff0c\u5b83\u7acb\u5373\u8fd4\u56de\u4e00\u4e2a folly::Future\u3002</li> <li>\u8fd9\u4e2a Future \u4ee3\u8868\u4e00\u4e2a\u201c\u627f\u8bfa\u201d\u2014\u2014\u5728\u672a\u6765\u7684\u67d0\u4e2a\u65f6\u523b\uff0c\u5f53\u5b58\u50a8\u5c42\u5904\u7406\u5b8c\u8bf7\u6c42\u5e76\u8fd4\u56de\u54cd\u5e94\u540e\uff0c\u8fd9\u4e2a Future \u5c06\u4f1a\u5305\u542b PropRpcResponse \u7c7b\u578b\u7684\u7ed3\u679c\uff08\u6216\u8005\u4e00\u4e2a\u5f02\u5e38\uff0c\u5982\u679c\u51fa\u9519\u4e86\uff09\u3002</li> </ul> <ol> <li>.via(runner()): \u8fd9\u662f Folly Future \u7684\u4e00\u4e2a\u94fe\u5f0f\u64cd\u4f5c\u3002</li> </ol> <ul> <li>runner() \u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a folly::Executor* \u5b9e\u4f8b\u3002Executor \u5b9a\u4e49\u4e86\u540e\u7eed\u7684\u56de\u8c03\uff08\u5373 .thenValue \u4e2d\u7684 lambda\uff09\u5c06\u5728\u54ea\u4e2a\u7ebf\u7a0b\u6216\u7ebf\u7a0b\u6c60\u4e0a\u6267\u884c\u3002</li> <li>\u7ebf\u7a0b\u5207\u6362\uff1aRPC \u54cd\u5e94\u53ef\u80fd\u5728\u4e00\u4e2a I/O \u7ebf\u7a0b\uff08\u4f8b\u5982\u7f51\u7edc\u5e93\u7684\u7ebf\u7a0b\uff09\u4e0a\u5230\u8fbe\u3002.via(runner()) \u53ef\u4ee5\u5c06\u540e\u7eed\u7684\u5904\u7406\u903b\u8f91\u5207\u6362\u5230\u4e00\u4e2a\u4e13\u95e8\u7684\u5de5\u4f5c\u7ebf\u7a0b\u6c60\uff08\u7531 runner() \u63d0\u4f9b\uff09\uff0c\u907f\u514d\u963b\u585e I/O \u7ebf\u7a0b\u3002</li> <li>\u4e0a\u4e0b\u6587\u7ba1\u7406\uff1a\u786e\u4fdd\u56de\u8c03\u5728\u5177\u6709\u6b63\u786e\u4e0a\u4e0b\u6587\uff08\u5982\u7279\u5b9a\u7684 EventBase \u6216\u4e0e\u5f53\u524d\u8bf7\u6c42\u5173\u8054\u7684\u6267\u884c\u73af\u5883\uff09\u7684\u7ebf\u7a0b\u4e0a\u6267\u884c\u3002</li> </ul> <ol> <li>.thenValue(this { ... }): \u8fd9\u662f\u53e6\u4e00\u4e2a\u94fe\u5f0f\u64cd\u4f5c\uff0c\u7528\u4e8e\u6ce8\u518c\u4e00\u4e2a\u6210\u529f\u56de\u8c03\u3002</li> </ol> <ul> <li>\u5f53 storageClient-&gt;getProps(...) \u8fd4\u56de\u7684 Future \u6210\u529f\u5b8c\u6210\u65f6\uff08\u5373\u5b58\u50a8\u5c42\u6210\u529f\u8fd4\u56de\u4e86 PropRpcResponse\uff09\uff0c\u8fd9\u4e2a lambda \u51fd\u6570\u5c06\u88ab\u6267\u884c\u3002</li> <li>\u56de\u8c03\u7684\u8fd4\u56de\u503c\uff1a<ul> <li>handlePropResp(std::move(resp)) \u88ab\u8c03\u7528\u3002\u8fd9\u4e2a\u51fd\u6570\u672c\u8eab\u8fd4\u56de std::vector\u3002</li> <li>\u7531\u4e8e .thenValue \u7684\u56de\u8c03\u8fd4\u56de\u4e86\u4e00\u4e2a std::vector\uff0c\u6240\u4ee5\u6574\u4e2a storageClient-&gt;getProps(...).via(...).thenValue(...) \u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u65b0\u7684 folly::Future&gt;\u3002</li> <li>Folly \u6846\u67b6\u4f1a\u81ea\u52a8\u5c06 handlePropResp \u7684\u8fd4\u56de\u503c\u5305\u88c5\u8fdb\u4e00\u4e2a\u65b0\u7684 Future\u3002</li> </ul> </li> </ul> <ol> <li>\u51fd\u6570\u8fd4\u56de\u503c: getProps \u51fd\u6570\u6700\u7ec8\u8fd4\u56de\u7684\u5c31\u662f\u7531 .thenValue \u4ea7\u751f\u7684 folly::Future&gt;\u3002\u8c03\u7528\u8005\u5c06\u5f97\u5230\u8fd9\u4e2a Future\uff0c\u5e76\u53ef\u4ee5\u8fdb\u4e00\u6b65\u94fe\u63a5\u5176\u4ed6\u56de\u8c03\u6216\u7b49\u5f85\u5176\u5b8c\u6210\u3002</li> </ol>","tags":["Database"]},{"location":"notes/nebula/5.nGQL%20life/","title":"\u4e00\u6761nGQL\u8bed\u53e5\u7684\u524d\u4e16\u4eca\u751f","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/nebula/5.nGQL%20life/#ngql","title":"\u4e00\u6761 nGQL \u8bed\u53e5\u7684\u524d\u4e16\u4eca\u751f","text":"<p> \u7ea6 810 \u4e2a\u5b57  204 \u884c\u4ee3\u7801  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <ol> <li>\u7528\u6237\u5728 console \u6216\u8005\u901a\u8fc7 sdk \u8f93\u5165 Query \u8bed\u53e5\u5230 Graph Service\uff0c\u8fd4\u56de\u7ed9\u7528\u6237 Future\uff0c\u7136\u540e\u5f00\u59cb\u6267\u884c\u56de\u8c03\uff0c\u5373\u4e0b\u9762\u7684\u6574\u4e2a\u6d41\u7a0b\u3002</li> <li>Graph Service \u5c06 Query\u3001Session\u3001Storage \u7b49\u6253\u5305\u6210 Request Context\uff0c\u968f\u540e\u5c06 Request Context \u6253\u5305\u6210 Query Instance \u968f\u540e\u5f00\u59cb\u6267\u884c parse\u3001validate\u3001optimize\u3001execute \u6574\u4e2a\u6d41\u7a0b\u3002    - \u5728 validate \u7ed3\u675f\u540e\uff0c\u9996\u5148\u5148\u83b7\u53d6 statement \u5bf9\u5e94\u7684 ast context\uff0c\u7136\u540e\u518d\u8f6c\u6362\u6210 plan node tree\u3002    - \u5728 Graph Service \u83b7\u53d6\u5230 query \u5e76\u542f\u52a8\u6574\u4e2a\u5f02\u6b65\u6267\u884c\u6d41\u7a0b\u540e\uff0c\u8fd4\u56de Future \u7ed9 client\u3002</li> <li>\u7136\u540e\u5c06 Request Context \u4f20\u5165 Scheduler\uff0c\u7528 Scheduler \u7684\u5185\u5b58\u6c60\u6309\u7167\u7b97\u5b50\u6811\u4f9d\u6b21\u6267\u884c\u6bcf\u4e2a\u7269\u7406\u8282\u70b9\u8ba1\u5212\u3002</li> <li>\u6bcf\u4e2a\u7269\u7406\u8282\u70b9\u8ba1\u5212\u5728 graphd \u4e2d\u5b58\u5728\u4e00\u4e2a executor\uff0c\u5b9e\u9645\u4e0a\u91cc\u9762\u8c03\u7528\u4e86 storaged \u7684 processor\u3002</li> <li>\u6bcf\u4e2a processor \u5185\u90e8\u4ece RocksDB \u4e2d\u83b7\u53d6\u6216\u8005\u5b58\u50a8 KV \u5bf9\uff0c\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7 raft-wal \u8fdb\u884c\u96c6\u7fa4\u95f4\u7684\u540c\u6b65\uff0c\u7136\u540e\u7528\u7ed3\u679c\u53bb\u8bbe\u7f6e promise\uff0cgraphd \u7684 future \u63a5\u6536\u5230\u540e\u7ee7\u7eed\u5411\u4e0a\u4f20\u9012\u7ed3\u679c\uff0c\u76f4\u5230\u8fd4\u56de\u7ed9 client \u7684\u7ed3\u679c\u3002</li> </ol> <p></p>","tags":["Database"]},{"location":"notes/nebula/5.nGQL%20life/#client","title":"Client","text":"<p>client \u901a\u8fc7 tcp \u6765\u8fde\u63a5\u5230 graphd\uff0c\u901a\u8fc7 libevent \u6765\u4e0e graphd \u8fdb\u884c SQL \u8bed\u53e5\u548c\u67e5\u8be2\u7ed3\u679c\u7684\u4f20\u8f93\u3002</p> <ul> <li>\u5148\u6784\u9020 host address(ip address, port)</li> <li>\u901a\u8fc7\u914d\u7f6e\u53c2\u6570\u521d\u59cb\u5316\u8fde\u63a5\u6c60</li> <li>\u901a\u8fc7\u8fde\u63a5\u6c60\u4e0e graphd \u5efa\u7acb Session\uff0c\u6700\u540e\u901a\u8fc7 Session \u6765\u8fdb\u884c query \u7684\u6267\u884c\u4ee5\u53ca\u8fd4\u56de\u7ed3\u679c\u3002</li> </ul>","tags":["Database"]},{"location":"notes/nebula/5.nGQL%20life/#basic-example","title":"basic example","text":"Go<pre><code>const (\n    address = \"127.0.0.1\"\n    // The default port of NebulaGraph 2.x is 9669.\n    // 3699 is only for testing.\n    port     = 3699\n    username = \"root\"\n    password = \"nebula\"\n    useHTTP2 = false\n)\n\n\nfunc main() {\n    hostAddress := nebula.HostAddress{Host: address, Port: port}\n    hostList := []nebula.HostAddress{hostAddress}\n    // Create configs for connection pool using default values\n    testPoolConfig := nebula.GetDefaultConf()\n    testPoolConfig.UseHTTP2 = useHTTP2\n    testPoolConfig.HandshakeKey = \"3.0.0\"\n\n    // Initialize connection pool\n    pool, err := nebula.NewConnectionPool(hostList, testPoolConfig, log)\n    if err != nil {\n        log.Fatal(fmt.Sprintf(\"Fail to initialize the connection pool, host: %s, port: %d, %s\", address, port, err.Error()))\n    }\n    // Close all connections in the pool\n    defer pool.Close()\n\n    // Create session\n    session, err := pool.GetSession(username, password)\n\n    // Release session and return connection back to connection pool\n    defer session.Release()\n\n    {\n        // Prepare the query\n        createSchema := \"CREATE SPACE IF NOT EXISTS basic_example_space(vid_type=FIXED_STRING(20)); \" +\n            \"USE basic_example_space;\" +\n            \"CREATE TAG IF NOT EXISTS person(name string, age int);\" +\n            \"CREATE EDGE IF NOT EXISTS like(likeness double)\"\n\n        // Execute a query\n        resultSet, err := session.Execute(createSchema)\n\n    }\n    // Drop space\n    {\n        query := \"DROP SPACE IF EXISTS basic_example_space\"\n        // Send query\n        resultSet, err := session.Execute(query)\n    }\n}\n</code></pre>","tags":["Database"]},{"location":"notes/nebula/5.nGQL%20life/#graphd","title":"Graphd","text":"<p>graphd \u5927\u4f53\u4e0a\u5206\u4e3a parse\uff0cvalidate\uff0cplanner\uff0coptimize\uff0cexecute \u8fd9\u51e0\u4e2a\u9636\u6bb5\u3002\u6240\u6709\u7684 statement\u3001execplan \u4ee5\u53ca\u6700\u540e\u7684 resultset \u5305\u62ec\u539f\u59cb\u7684 Query \u8bed\u53e5\uff0c\u90fd\u5b58\u50a8\u5728 RequestContext \u4e2d\u3002</p> <ul> <li>\u6784\u5efa RequestContext \u5e76\u628a Query \u8bed\u53e5\u4f20\u5165\uff0c\u6839\u636e RequestContext \u6784\u5efa Query Instance\u3002\u5f00\u542f\u6240\u6709\u7684\u5f02\u6b65\u6d41\u7a0b\u540e\uff0c\u8fd4\u56de\u7528\u6237\u4e00\u4e2a Future\u3002</li> <li>\u5728 Query Instance \u4e2d\u6267\u884c parse\uff0c\u5c06\u8bed\u53e5\u89e3\u6790\u6210 sentence(statement)\u3002</li> <li>\u5728 validate \u4e2d\u901a\u8fc7<code>validateimpl</code>\u65b9\u6cd5\u8fdb\u884c check\uff0c\u6821\u9a8c\u662f\u5426\u6ee1\u8db3 schema \u4ee5\u53ca\u662f\u5426\u6570\u636e\u672a\u8d85\u8303\u56f4\u3002</li> </ul> C++<pre><code>Status InsertVerticesValidator::validateImpl() {\n  spaceId_ = vctx_-&gt;whichSpace().id;\n  NG_RETURN_IF_ERROR(check());\n  NG_RETURN_IF_ERROR(prepareVertices());\n  return Status::OK();\n}\n</code></pre> <ul> <li>\u901a\u8fc7 validator \u7684<code>toplan</code>\u65b9\u6cd5\u5c06 sentence \u53d8\u6210 execution plan tree\u3002</li> </ul> C++<pre><code>Status InsertVerticesValidator::toPlan() {\n  auto doNode = InsertVertices::make(qctx_,\n                                    nullptr,\n                                    spaceId_,\n                                    std::move(vertices_),\n                                    std::move(tagPropNames_),\n                                    ifNotExists_,\n                                    ignoreExistedIndex_);\n  root_ = doNode;\n  tail_ = root_;\n  return Status::OK();\n}\n</code></pre> <ul> <li>\u5c06\u6267\u884c\u8ba1\u5212\u6811\u4ea4\u7ed9 Optimizer \u8fdb\u884c\u4f18\u5316\uff0cnebula \u73b0\u5728\u7684\u4f18\u5316\u662f Rule-based optimization\uff0c\u6bcf\u4e2a\u6267\u884c\u8ba1\u5212\u9700\u8981\u904d\u5386\u6240\u6709\u7684 rules\uff0c\u5f97\u5230\u6700\u4f18\u7684\u6267\u884c\u8ba1\u5212\u3002</li> <li>\u7136\u540e\u5c06\u6574\u4e2a\u8ba1\u5212\u4ea4\u7ed9 Scheduler \u8fdb\u884c\u6267\u884c\uff0c\u5728 Scheduler \u4e2d\u6309\u7167\u8ba1\u5212\u6811\u7684\u7236\u5b50\u5173\u7cfb\uff0c\u4ece\u4e0b\u4e4b\u4e0a\u4f9d\u6b64\u6267\u884c\u8ba1\u5212\uff0c\u6240\u6709\u7684\u8ba1\u5212\u90fd\u662f\u7528 Future \u5f02\u6b65\u6267\u884c\u3002parent plan \u8282\u70b9\u9700\u8981\u6240\u6709\u7684 children plan \u8282\u70b9\u90fd\u6267\u884c\u5b8c\u540e\u624d\u5f00\u59cb\u6267\u884c\u3002</li> </ul> C++<pre><code>folly::Future&lt;Status&gt; AsyncMsgNotifyBasedScheduler::scheduleExecutor(\nstd::vector&lt;folly::Future&lt;Status&gt;&gt;&amp;&amp; futures, Executor* exe, folly::Executor* runner) const {\nswitch (exe-&gt;node()-&gt;kind()) {\n  // ...\n  case PlanNode::Kind::kArgument: {\n    return runExecutor(std::move(futures), exe, runner);\n  }\n  default: {\n    if (exe-&gt;depends().empty()) {\n      return runLeafExecutor(exe, runner);\n    } else {\n      return runExecutor(std::move(futures), exe, runner);\n    }\n  }\n}\n}\nfolly::Future&lt;Status&gt; AsyncMsgNotifyBasedScheduler::runExecutor(\n  std::vector&lt;folly::Future&lt;Status&gt;&gt;&amp;&amp; futures, Executor* exe, folly::Executor* runner) const {\nreturn folly::collect(futures).via(runner).thenValue(\n    [exe, this](auto&amp;&amp; t) mutable -&gt; folly::Future&lt;Status&gt; {\n      NG_RETURN_IF_ERROR(checkStatus(std::move(t)));\n      // Execute in current thread.\n      return execute(exe);\n    });\n}\n\nfolly::Future&lt;Status&gt; AsyncMsgNotifyBasedScheduler::runLeafExecutor(Executor* exe,\n                                                                  folly::Executor* runner) const {\n  return std::move(execute(exe)).via(runner);\n}\n</code></pre> <ul> <li>\u5728 runExecutor \u65b9\u6cd5\u4e2d\u4f1a\u8c03\u7528 graphd \u4e2d\u7684 executor\uff0c\u8fdb\u884c\u7269\u7406\u8ba1\u5212\u7684\u6267\u884c\u3002\u91cc\u9762\u6d89\u53ca\u5230\u5b58\u50a8\u5c42\u7684\u5185\u5bb9\u65f6\u4f1a\u901a\u8fc7 RPC \u5411 Storaged \u8bf7\u6c42\u670d\u52a1\u3002</li> </ul>","tags":["Database"]},{"location":"notes/nebula/5.nGQL%20life/#storaged","title":"Storaged","text":"<p>Storaged \u63a5\u6536\u5230 graphd \u53d1\u9001\u7684 executor \u8bf7\u6c42\uff0c\u542f\u52a8\u5bf9\u5e94\u7684 Processor\uff0c\u6267\u884c<code>process</code>\u65b9\u6cd5\uff0c\u5b9e\u9645\u4e0a\u6267\u884c<code>doProcess</code>\u65b9\u6cd5\u3002</p> <p></p> <ul> <li>\u5728\u6267\u884c\u5b8c\u903b\u8f91\u540e\uff0c\u5c06\u6240\u6709\u7684\u66f4\u6539\u5199\u5165\u96c6\u7fa4\uff0c\u6700\u540e\u5728\u56de\u8c03\u4e2d\u6267\u884c<code>handleAsync</code>\u65b9\u6cd5\uff0c\u5b9e\u9645\u4e0a\u662f\u6267\u884c<code>onFinished</code>\u65b9\u6cd5\uff0c<code>onFinished</code>\u65b9\u6cd5\u4e2d\u8bbe\u7f6e promise \u7684 value \u4e3a RESP\uff0cRESP \u4e2d\u5305\u542b\u67e5\u8be2\u7684\u7ed3\u679c\uff0c\u4e00\u5c42\u5c42\u8fd4\u56de\u76f4\u5230\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ul> C++<pre><code>template &lt;typename RESP&gt;\nvoid BaseProcessor&lt;RESP&gt;::doPut(GraphSpaceID spaceId,\n                                PartitionID partId,\n                                std::vector&lt;kvstore::KV&gt;&amp;&amp; data) {\n  this-&gt;env_-&gt;kvstore_-&gt;asyncMultiPut(\n      spaceId, partId, std::move(data), [spaceId, partId, this](nebula::cpp2::ErrorCode code) {\n        handleAsync(spaceId, partId, code);\n      });\n}\n\ntemplate &lt;typename RESP&gt;\nvoid BaseProcessor&lt;RESP&gt;::handleAsync(GraphSpaceID spaceId,\n                                    PartitionID partId,\n                                    nebula::cpp2::ErrorCode code) {\n  VLOG(3) &lt;&lt; \"partId:\" &lt;&lt; partId &lt;&lt; \", code: \" &lt;&lt; static_cast&lt;int32_t&gt;(code);\n\n  bool finished = false;\n  {\n    std::lock_guard&lt;std::mutex&gt; lg(this-&gt;lock_);\n    handleErrorCode(code, spaceId, partId);\n    this-&gt;callingNum_--;\n    if (this-&gt;callingNum_ == 0) {\n      finished = true;\n    }\n  }\n\n  if (finished) {\n    this-&gt;onFinished();\n  }\n}\n\nvirtual void onFinished() {\n  memory::MemoryCheckOffGuard guard;\n  if (counters_) {\n    stats::StatsManager::addValue(counters_-&gt;numCalls_);\n    if (!this-&gt;codes_.empty()) {\n      stats::StatsManager::addValue(counters_-&gt;numErrors_);\n    }\n  }\n\n  this-&gt;result_.latency_in_us_ref() = this-&gt;duration_.elapsedInUSec();\n  if (!profileDetail_.empty()) {\n    this-&gt;result_.latency_detail_us_ref() = std::move(profileDetail_);\n  }\n  this-&gt;result_.failed_parts_ref() = this-&gt;codes_;\n  this-&gt;resp_.result_ref() = std::move(this-&gt;result_);\n  this-&gt;promise_.setValue(std::move(this-&gt;resp_));\n\n  if (counters_) {\n    stats::StatsManager::addValue(counters_-&gt;latency_, this-&gt;duration_.elapsedInUSec());\n  }\n\n  delete this;\n}\n</code></pre> <ul> <li>\u5199\u5165\u66f4\u6539\u662f doPut \u64cd\u4f5c\uff0c\u8be5\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u5bf9 raft \u63d0\u4ea4\u65e5\u5fd7\uff0c\u9a71\u52a8 raft \u72b6\u6001\u673a\u5c06\u8be5\u64cd\u4f5c\u540c\u6b65\u5230\u96c6\u7fa4\u4e2d\u3002</li> </ul> <p></p> <ol> <li>\u6240\u6709\u64cd\u4f5c\u90fd\u662f write wal first\u3002</li> <li>sync logs to followers</li> </ol> C++<pre><code>void Part::asyncMultiPut(const std::vector&lt;KV&gt;&amp; keyValues, KVCallback cb) {\n  std::string log = encodeMultiValues(OP_MULTI_PUT, keyValues);\n\n  appendAsync(FLAGS_cluster_id, std::move(log))\n      .thenValue(\n          [callback = std::move(cb)](nebula::cpp2::ErrorCode code) mutable { callback(code); });\n}\n// \u7ecf\u8fc7 Part::appendAsync -&gt; RaftPart::appendLogAsync -&gt; RaftPart::appendLogsInternal\nvoid RaftPart::appendLogsInternal(AppendLogsIterator iter, TermID termId) {\n  TermID currTerm = 0;\n  LogID prevLogId = 0;\n  TermID prevLogTerm = 0;\n  LogID committed = 0;\n  LogID lastId = 0;\n  nebula::cpp2::ErrorCode res = nebula::cpp2::ErrorCode::SUCCEEDED;\n  do {\n    std::lock_guard&lt;std::mutex&gt; g(raftLock_);\n    res = canAppendLogs(termId);\n    if (res != nebula::cpp2::ErrorCode::SUCCEEDED) {\n      break;\n    }\n    currTerm = term_;\n    prevLogId = lastLogId_;\n    prevLogTerm = lastLogTerm_;\n    committed = committedLogId_;\n    // Step 1: Write WAL\n    {\n      SCOPED_TIMER(\n          [](uint64_t execTime) { stats::StatsManager::addValue(kAppendWalLatencyUs, execTime); });\n      if (!wal_-&gt;appendLogs(iter)) {\n        VLOG_EVERY_N(2, 1000) &lt;&lt; idStr_ &lt;&lt; \"Failed to write into WAL\";\n        res = nebula::cpp2::ErrorCode::E_RAFT_WAL_FAIL;\n        lastLogId_ = wal_-&gt;lastLogId();\n        lastLogTerm_ = wal_-&gt;lastLogTerm();\n        break;\n      }\n    }\n    lastId = wal_-&gt;lastLogId();\n    VLOG(4) &lt;&lt; idStr_ &lt;&lt; \"Succeeded writing logs [\" &lt;&lt; iter.firstLogId() &lt;&lt; \", \" &lt;&lt; lastId\n            &lt;&lt; \"] to WAL\";\n  } while (false);\n\n  if (!checkAppendLogResult(res)) {\n    iter.commit(res);\n    return;\n  }\n  // Step 2: Replicate to followers\n  auto* eb = ioThreadPool_-&gt;getEventBase();\n  replicateLogs(eb, std::move(iter), currTerm, lastId, committed, prevLogTerm, prevLogId);\n  return;\n}\n</code></pre>","tags":["Database"]},{"location":"notes/nebula/6.raft-wal/","title":"Raft Wal","text":"<code>#Database</code>","tags":["Database"]},{"location":"notes/nebula/6.raft-wal/#nebula-raft-wal","title":"nebula \u4e2d\u7684 Raft Wal","text":"<p> \u7ea6 35 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p>","tags":["Database"]},{"location":"notes/rcore/BatchOS/","title":"BatchOS","text":"<code>#Operator System</code> <code>#rust</code>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#batchos","title":"BatchOS","text":"<p> \u7ea6 1426 \u4e2a\u5b57  394 \u884c\u4ee3\u7801  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p></p> <ul> <li>\u5b9e\u73b0\u6279\u5904\u7406\u7a0b\u5e8f\u529f\u80fd\u7684 OS</li> <li>APP \u4e0e OS \u9694\u79bb</li> <li>\u81ea\u52a8\u52a0\u8f7d\u5e76\u8fd0\u884c\u591a\u4e2a\u7a0b\u5e8f</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#_1","title":"\u7279\u6743\u7ea7\u673a\u5236","text":"<ul> <li><code>ecall</code> \u5177\u6709\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u6267\u884c\u73af\u5883\u5207\u6362\u80fd\u529b\u7684\u51fd\u6570\u8c03\u7528\u6307\u4ee4\uff1b</li> <li><code>sret</code> \uff1a\u5177\u6709\u5185\u6838\u6001\u5230\u7528\u6237\u6001\u7684\u6267\u884c\u73af\u5883\u5207\u6362\u80fd\u529b\u7684\u51fd\u6570\u8fd4\u56de\u6307\u4ee4\u3002</li> <li>\u9996\u5148\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u63d0\u4f9b\u76f8\u5e94\u7684\u529f\u80fd\u4ee3\u7801\uff0c\u80fd\u5728\u6267\u884c <code>sret</code> \u524d\u51c6\u5907\u548c\u6062\u590d\u7528\u6237\u6001\u6267\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u4e0a\u4e0b\u6587\u3002\u5176\u6b21\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u8c03\u7528 <code>ecall</code> \u6307\u4ee4\u540e\uff0c\u80fd\u591f\u68c0\u67e5\u5e94\u7528\u7a0b\u5e8f\u7684\u7cfb\u7edf\u8c03\u7528\u53c2\u6570\uff0c\u786e\u4fdd\u53c2\u6570\u4e0d\u4f1a\u7834\u574f\u64cd\u4f5c\u7cfb\u7edf\u3002</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#risc-v","title":"RISC-V \u5f02\u5e38","text":"","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#risc-v-s","title":"RISC-V S \u6a21\u5f0f\u7279\u6743\u6307\u4ee4","text":"<ul> <li>sert\uff1a\u4ece S \u6a21\u5f0f\u8fd4\u56de U \u6a21\u5f0f</li> <li>wfi\uff1a\u5904\u7406\u5668\u5728\u7a7a\u95f2\u65f6\u8fdb\u5165\u4f4e\u529f\u8017\u72b6\u6001\u7b49\u5f85\u7ec8\u7aef</li> <li>sfence.vma\uff1a\u5237\u65b0 TLB \u7f13\u5b58</li> <li>\u8bbf\u95ee S \u6a21\u5f0f CSR \u6307\u4ee4\uff1a\u6539\u53d8\u7cfb\u7edf\u72b6\u6001</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#_2","title":"\u63a7\u5236\u72b6\u6001\u5bc4\u5b58\u5668","text":"<ul> <li>sstatus\uff1aSPP \u5b57\u6bb5\u7ed9\u51fa Trap \u53d1\u751f\u524d CPU \u7684\u7279\u6743\u7ea7</li> <li>sepc\uff1a\u8bb0\u5f55\u5f02\u5e38\u53d1\u751f\u524d\u6267\u884c\u7684\u6700\u540e\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740</li> <li>scause\uff1a\u63cf\u8ff0 Trap \u7684\u539f\u56e0</li> <li>stval\uff1a\u7ed9\u51fa Trap \u7684\u9644\u52a0\u4fe1\u606f</li> <li>stvec\uff1a\u63a7\u5236 Trap \u5904\u7406\u4ee3\u7801\u7684\u5165\u53e3\u5730\u5740</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#_3","title":"\u786c\u4ef6\u5207\u6362\u7684\u786c\u4ef6\u63a7\u5236\u673a\u5236","text":"<p>ecall</p> <ul> <li><code>sstatus</code>\u4e2d\u7684<code>SPP</code>\u5b57\u6bb5\u5207\u6362\u5230 CPU \u5f53\u524d\u7279\u6743\u7ea7</li> <li><code>sepc</code>\u4fee\u6539\u4e3a Trap \u5904\u7406\u5b8c\u6210\u540e\u9ed8\u8ba4\u6267\u884c\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740</li> <li><code>scause\\stval</code>\u4fee\u6539\u6210 Trap \u539f\u56e0\u548c Trap \u989d\u5916\u4fe1\u606f</li> <li>CPU \u8df3\u8f6c\u5230<code>stvec</code>\u8bbe\u7f6e\u7684 Trap \u5904\u7406\u5165\u53e3\u51fd\u6570\uff0c\u8bbe\u7f6e\u7279\u6743\u7ea7\u4e3a S</li> </ul> <p>sret</p> <ul> <li>CPU \u6309\u7167<code>sstatus</code>\u8bbe\u7f6e\u7279\u6743\u7ea7</li> <li>CPU \u8df3\u8f6c\u5230<code>sepc</code>\u6307\u5411\u7684\u5730\u5740\uff0c\u7136\u540e\u7ee7\u7eed\u6267\u884c</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#_4","title":"\u7528\u6237\u5e93","text":"<ul> <li>\u4f7f\u7528 Rust \u7684\u5b8f\u5c06\u5176\u51fd\u6570\u7b26\u53f7 <code>main</code> \u6807\u5fd7\u4e3a\u5f31\u94fe\u63a5\u3002\u8fd9\u6837\u5728\u6700\u540e\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u867d\u7136\u5728 <code>lib.rs</code> \u548c <code>bin</code> \u76ee\u5f55\u4e0b\u7684\u67d0\u4e2a\u5e94\u7528\u7a0b\u5e8f\u90fd\u6709 <code>main</code> \u7b26\u53f7\uff0c\u4f46\u7531\u4e8e <code>lib.rs</code> \u4e2d\u7684 <code>main</code> \u7b26\u53f7\u662f\u5f31\u94fe\u63a5\uff0c\u94fe\u63a5\u5668\u4f1a\u4f7f\u7528 <code>bin</code> \u76ee\u5f55\u4e0b\u7684\u5e94\u7528\u4e3b\u903b\u8f91\u4f5c\u4e3a <code>main</code></li> <li>\u8fd9\u91cc\u6211\u4eec\u4e3b\u8981\u662f\u8fdb\u884c\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u7684\u4fdd\u62a4\uff0c\u5982\u679c\u5728 <code>bin</code> \u76ee\u5f55\u4e0b\u627e\u4e0d\u5230\u4efb\u4f55 <code>main</code> \uff0c\u90a3\u4e48\u7f16\u8bd1\u4e5f\u80fd\u591f\u901a\u8fc7\uff0c\u4f46\u4f1a\u5728\u8fd0\u884c\u65f6\u62a5\u9519\u3002</li> </ul> Rust<pre><code>#[linkage=\"weak\"]\n#[no_mangle]\nfn main()-&gt;i32 {\n    panic!(\"Cannot find main!\");\n}\n</code></pre> <ul> <li><code>#![feature(linkage)]</code>\u652f\u6301\u94fe\u63a5\u64cd\u4f5c</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#_5","title":"\u7cfb\u7edf\u8c03\u7528","text":"<ul> <li><code>&amp;[u8]</code> \u5207\u7247\u7c7b\u578b\u6765\u63cf\u8ff0\u7f13\u51b2\u533a\uff0c\u8fd9\u662f\u4e00\u4e2a \u80d6\u6307\u9488 (Fat Pointer)\uff0c\u91cc\u9762\u65e2\u5305\u542b\u7f13\u51b2\u533a\u7684\u8d77\u59cb\u5730\u5740\uff0c\u8fd8 \u5305\u542b\u7f13\u51b2\u533a\u7684\u957f\u5ea6\u3002</li> </ul> Rust<pre><code>// user/src/syscall.rs\nuse core::arch::asm;\nfn syscall(id: usize, args: [usize; 3]) -&gt; isize {\n    let mut ret: isize;\n    unsafe {\n        asm!(\n            \"ecall\",\n            inlateout(\"x10\") args[0] =&gt; ret,\n            in(\"x11\") args[1],\n            in(\"x12\") args[2],\n            in(\"x17\") id\n        );\n    }\n    ret\n}\nconst SYSCALL_WRITE: usize = 64;\nconst SYSCALL_EXIT: usize = 93;\n\npub fn sys_write(fd: usize, buffer: &amp;[u8]) -&gt; isize {\n    syscall(SYSCALL_WRITE, [fd, buffer.as_ptr() as usize, buffer.len()])\n}\n\npub fn sys_exit(xstate: i32) -&gt; isize {\n    syscall(SYSCALL_EXIT, [xstate as usize, 0, 0])\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#app","title":"\u52a0\u8f7d\u4e0d\u540c\u7684 APP","text":"","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#appmanager","title":"AppManager","text":"<ul> <li>\u5728 <code>RefCell</code> \u7684\u57fa\u7840\u4e0a\u518d\u5c01\u88c5\u4e00\u4e2a <code>UPSafeCell</code> \uff0c\u5b83\u540d\u5b57\u7684\u542b\u4e49\u662f\uff1a\u5141\u8bb8\u6211\u4eec\u5728 \u5355\u6838 \u4e0a\u5b89\u5168\u4f7f\u7528\u53ef\u53d8\u5168\u5c40\u53d8\u91cf\u3002</li> <li>\u5f53\u6211\u4eec\u8981\u8bbf\u95ee\u6570\u636e\u65f6\uff08\u65e0\u8bba\u8bfb\u8fd8\u662f\u5199\uff09\uff0c\u9700\u8981\u9996\u5148\u8c03\u7528 <code>exclusive_access</code> \u83b7\u5f97\u6570\u636e\u7684\u53ef\u53d8\u501f\u7528\u6807\u8bb0\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u5b8c\u6210\u6570\u636e\u7684\u8bfb\u5199\uff0c\u5728\u64cd\u4f5c\u5b8c\u6210\u4e4b\u540e\u6211\u4eec\u9700\u8981\u9500\u6bc1\u8fd9\u4e2a\u6807\u8bb0\uff0c\u6b64\u540e\u624d\u80fd\u5f00\u59cb\u5bf9\u8be5\u6570\u636e\u7684\u4e0b\u4e00\u6b21\u8bbf\u95ee</li> </ul> Rust<pre><code>// os/src/sync/up.rs\n\npub struct UPSafeCell&lt;T&gt; {\n    /// inner data\n    inner: RefCell&lt;T&gt;,\n}\n\n// unsafe\u5411\u7f16\u8bd1\u5668\u4fdd\u8bc1\u53ea\u5728\u5355\u6838\u4e0a\u8fdb\u884c\u64cd\u4f5c\nunsafe impl&lt;T&gt; Sync for UPSafeCell&lt;T&gt; {}\n\nimpl&lt;T&gt; UPSafeCell&lt;T&gt; {\n    /// User is responsible to guarantee that inner struct is only used in\n    /// uniprocessor.\n    pub unsafe fn new(value: T) -&gt; Self {\n        Self { inner: RefCell::new(value) }\n    }\n    /// Panic if the data has been borrowed.\n    pub fn exclusive_access(&amp;self) -&gt; RefMut&lt;'_, T&gt; {\n        self.inner.borrow_mut()\n    }\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#new","title":"New","text":"<ul> <li>\u4f7f\u7528<code>core::slice::from_raw_parts</code>\u5c06\u6307\u9488\u89e3\u91ca\u4e3a<code>&amp;[usize]</code>\u5207\u7247\uff1b</li> <li>\u4f7f\u7528<code>copy_from_slice</code>\u5c06\u5207\u7247\u4e0a\u7684\u5143\u7d20\u590d\u5236\u5230<code>app_start</code>\u4e0a</li> </ul> Rust<pre><code>static ref APP_MANAGER: UPSafeCell&lt;AppManager&gt; = unsafe {\n    UPSafeCell::new({\n        extern \"C\" {\n            fn _num_app();\n        }\n        let num_app_ptr = _num_app as usize as *const usize;\n        let num_app = num_app_ptr.read_volatile();\n        let mut app_start: [usize; MAX_APP_NUM + 1] = [0; MAX_APP_NUM + 1];\n        let app_start_raw: &amp;[usize] =\n            core::slice::from_raw_parts(num_app_ptr.add(1), num_app + 1);\n        app_start[..=num_app].copy_from_slice(app_start_raw);\n        AppManager {\n            num_app,\n            current_app: 0,\n            app_start,\n        }\n    })\n};\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#load_app","title":"load_app","text":"<ul> <li> <p>CPU \u7528\u5b58\u5728\u6307\u4ee4\u7f13\u5b58\uff0c\u4f7f\u7528 load_app \u52a0\u8f7d\u65b0\u7684\u7a0b\u5e8f\uff0c\u9700\u8981\u8ba9 OS \u77e5\u9053\u53d6\u6307\u5185\u5b58\u7684\u53d8\u5316</p> </li> <li> <p>OS \u5728\u8fd9\u91cc\u5fc5\u987b\u4f7f\u7528\u53d6\u6307\u5c4f\u969c\u6307\u4ee4 <code>fence.i</code> \uff0c\u5b83\u7684\u529f\u80fd\u662f\u4fdd\u8bc1 \u5728\u5b83\u4e4b\u540e\u7684\u53d6\u6307\u8fc7\u7a0b\u5fc5\u987b\u80fd\u591f\u770b\u5230\u5728\u5b83\u4e4b\u524d\u7684\u6240\u6709\u5bf9\u4e8e\u53d6\u6307\u5185\u5b58\u533a\u57df\u7684\u4fee\u6539</p> </li> </ul> Rust<pre><code>unsafe fn load_app(&amp;self, app_id: usize) {\n    if app_id &gt;= self.num_app {\n        println!(\"All applications completed!\");\n        shutdown(false);\n    }\n    println!(\"[kernel] Loading app_{}\", app_id);\n    // clear app area\n    core::slice::from_raw_parts_mut(APP_BASE_ADDRESS as *mut u8, APP_SIZE_LIMIT).fill(0);\n    // \u5c06\u6307\u9488\u770b\u4f5c\u5207\u7247\uff0c\u4f7f\u7528\u62f7\u8d1d\u5b9e\u73b0App\u5207\u6362\n    let app_src = core::slice::from_raw_parts(\n        self.app_start[app_id] as *const u8,\n        self.app_start[app_id + 1] - self.app_start[app_id],\n    );\n    let app_dst = core::slice::from_raw_parts_mut(APP_BASE_ADDRESS as *mut u8, app_src.len());\n    app_dst.copy_from_slice(app_src);\n    // Memory fence about fetching the instruction memory\n    // It is guaranteed that a subsequent instruction fetch must\n    // observes all previous writes to the instruction memory.\n    // Therefore, fence.i must be executed after we have loaded\n    // the code of the next app into the instruction memory.\n    // See also: riscv non-priv spec chapter 3, 'Zifencei' extension.\n    asm!(\"fence.i\");\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#run_next_app","title":"run_next_app","text":"<ul> <li>\u5148\u5c06\u4e00\u4e2a\u4e0a\u4e0b\u6587\u538b\u5165\u5185\u6838\u6808\u4e2d\uff1b\u5728<code>__restore</code>\u4e2d\u66f4\u65b0<code>sscrath</code>\u6307\u9488\u6307\u5411\u5185\u6838\u6808\u6808\u9876</li> <li>\u5982\u679c\u53d1\u751f\u7cfb\u7edf\u8c03\u7528\uff0c\u4ece<code>__alltraps</code>\u5f00\u59cb\u6267\u884c</li> </ul> Rust<pre><code>/// run next app\npub fn run_next_app() -&gt; ! {\n    let mut app_manager = APP_MANAGER.exclusive_access();\n    let current_app = app_manager.get_current_app();\n    unsafe {\n        app_manager.load_app(current_app);\n    }\n    app_manager.move_to_next_app();\n    drop(app_manager);\n    // before this we have to drop local variables related to resources manually\n    // and release the resources\n    extern \"C\" {\n        fn __restore(cx_addr: usize);\n    }\n    unsafe {\n        __restore(KERNEL_STACK.push_context(TrapContext::app_init_context(\n            APP_BASE_ADDRESS,\n            USER_STACK.get_sp(),\n        )) as *const _ as usize);\n    }\n    panic!(\"Unreachable in batch::run_current_app!\");\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#trap","title":"Trap \u7ba1\u7406","text":"","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#trapcontext","title":"TrapContext","text":"<ul> <li>Trap \u53d1\u751f\u65f6\u9700\u8981\u4fdd\u5b58\u7684\u7269\u7406\u8d44\u6e90\u5185\u5bb9\uff0c\u5305\u62ec 32 \u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u3001sstatus \u4ee5\u53ca sepc</li> <li>\u5bf9\u4e8e CSR \u800c\u8a00\uff0c\u6211\u4eec\u77e5\u9053\u8fdb\u5165 Trap \u7684\u65f6\u5019\uff0c\u786c\u4ef6\u4f1a\u7acb\u5373\u8986\u76d6\u6389 <code>scause/stval/sstatus/sepc</code> \u7684\u5168\u90e8\u6216\u662f\u5176\u4e2d\u4e00\u90e8\u5206\u3002</li> <li><code>scause/stval</code> \u7684\u60c5\u51b5\u662f\uff1a\u5b83\u603b\u662f\u5728 Trap \u5904\u7406\u7684\u7b2c\u4e00\u65f6\u95f4\u5c31\u88ab\u4f7f\u7528\u6216\u8005\u662f\u5728\u5176\u4ed6\u5730\u65b9\u4fdd\u5b58\u4e0b\u6765\u4e86\uff0c\u56e0\u6b64\u5b83\u6ca1\u6709\u88ab\u4fee\u6539\u5e76\u9020\u6210\u4e0d\u826f\u5f71\u54cd\u7684\u98ce\u9669\u3002</li> <li>\u800c\u5bf9\u4e8e <code>sstatus/sepc</code> \u800c\u8a00\uff0c\u5b83\u4eec\u4f1a\u5728 Trap \u5904\u7406\u7684\u5168\u7a0b\u6709\u610f\u4e49\uff08\u5728 Trap \u63a7\u5236\u6d41\u6700\u540e <code>sret</code> \u7684\u65f6\u5019\u8fd8\u7528\u5230\u4e86\u5b83\u4eec\uff09\uff0c\u800c\u4e14\u786e\u5b9e\u4f1a\u51fa\u73b0 Trap \u5d4c\u5957\u7684\u60c5\u51b5\u4f7f\u5f97\u5b83\u4eec\u7684\u503c\u88ab\u8986\u76d6\u6389\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c06\u5b83\u4eec\u4e5f\u4e00\u8d77\u4fdd\u5b58\u4e0b\u6765\uff0c\u5e76\u5728 <code>sret</code> \u4e4b\u524d\u6062\u590d\u539f\u6837\u3002</li> </ul> Rust<pre><code>// os/src/trap/context.rs\n\n#[repr(C)]\npub struct TrapContext {\n    pub x: [usize; 32],\n    pub sstatus: Sstatus,\n    pub sepc: usize,\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#trapcontext_1","title":"TrapContext \u7684\u4fdd\u5b58\u4e0e\u6062\u590d","text":"<ul> <li>\u9996\u5148\u901a\u8fc7 <code>__alltraps</code> \u5c06 Trap \u4e0a\u4e0b\u6587\u4fdd\u5b58\u5728\u5185\u6838\u6808\u4e0a\uff0c\u7136\u540e\u8df3\u8f6c\u5230\u4f7f\u7528 Rust \u7f16\u5199\u7684 <code>trap_handler</code> \u51fd\u6570\u5b8c\u6210 Trap \u5206\u53d1\u53ca\u5904\u7406\u3002\u5f53 <code>trap_handler</code> \u8fd4\u56de\u4e4b\u540e\uff0c\u4f7f\u7528 <code>__restore</code> \u4ece\u4fdd\u5b58\u5728\u5185\u6838\u6808\u4e0a\u7684 Trap \u4e0a\u4e0b\u6587\u6062\u590d\u5bc4\u5b58\u5668\u3002\u6700\u540e\u901a\u8fc7\u4e00\u6761 <code>sret</code> \u6307\u4ee4\u56de\u5230\u5e94\u7528\u7a0b\u5e8f\u6267\u884c\u3002</li> </ul> Rust<pre><code>// os/src/trap/mod.rs\n\nglobal_asm!(include_str!(\"trap.S\"));\n\npub fn init() {\n    extern \"C\" { fn __alltraps(); }\n    unsafe {\n        stvec::write(__alltraps as usize, TrapMode::Direct);\n    }\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#__alltraps","title":"__alltraps","text":"<ul> <li><code>sscratch</code>\u5728<code>__restore</code>\u4e2d\u8bbe\u7f6e\u4e3a\u5185\u6838\u6808\u6808\u9876\uff0c<code>run_next_app</code>\u4ece<code>__restore</code>\u5148\u6267\u884c</li> </ul> Text Only<pre><code># os/src/trap/trap.S\n\n.macro SAVE_GP n\n    sd x\\n, \\n*8(sp)\n.endm\n\n.align 2\n__alltraps:\n    csrrw sp, sscratch, sp # exchange sp and sscratch(point to kernel stack)\n    # now sp-&gt;kernel stack, sscratch-&gt;user stack\n    # allocate a TrapContext on kernel stack\n    addi sp, sp, -34*8\n    # save general-purpose registers\n    sd x1, 1*8(sp)\n    # skip sp(x2), we will save it later\n    sd x3, 3*8(sp)\n    # skip tp(x4), application does not use it\n    # save x5~x31\n    .set n, 5\n    .rept 27\n        SAVE_GP %n\n        .set n, n+1\n    .endr\n    # we can use t0/t1/t2 freely, because they were saved on kernel stack\n    csrr t0, sstatus\n    csrr t1, sepc\n    sd t0, 32*8(sp)\n    sd t1, 33*8(sp)\n    # read user stack from sscratch and save it on the kernel stack\n    csrr t2, sscratch\n    sd t2, 2*8(sp)\n    # set input argument of trap_handler(cx: &amp;mut TrapContext)\n    mv a0, sp # a0 point to trap context and as arguement of trap_handler\n    call trap_handler\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#__restore","title":"__restore","text":"<ul> <li>\u5148\u6062\u590d CSR \u5bc4\u5b58\u5668\u518d\u6062\u590d\u901a\u7528\u5bc4\u5b58\u5668</li> <li><code>csrrw sp, sscratch, sp</code>\u6b64\u65f6 sscratch \u8bbe\u7f6e\u4e3a\u5185\u6838\u6808\u6808\u9876(\u7531\u5e94\u7528\u7a0b\u5e8f\u5728\u6267\u884c\u524d\u538b\u5165\u5185\u6838\u6808)</li> </ul> Text Only<pre><code># os/src/trap/trap.S\n\n.macro LOAD_GP n\n    ld x\\n, \\n*8(sp)\n.endm\n\n__restore:\n    # case1: start running app by __restore\n    # case2: back to U after handling trap\n    mv sp, a0\n    # now sp-&gt;kernel stack(after allocated), sscratch-&gt;user stack\n    # restore sstatus/sepc\n    ld t0, 32*8(sp)\n    ld t1, 33*8(sp)\n    ld t2, 2*8(sp)\n    csrw sstatus, t0\n    csrw sepc, t1\n    csrw sscratch, t2\n    # restore general-purpuse registers except sp/tp\n    ld x1, 1*8(sp)\n    ld x3, 3*8(sp)\n    .set n, 5\n    .rept 27\n        LOAD_GP %n\n        .set n, n+1\n    .endr\n    # release TrapContext on kernel stack\n    addi sp, sp, 34*8\n    # now sp-&gt;kernel stack, sscratch-&gt;user stack\n    csrrw sp, sscratch, sp # \u73b0\u5728 sp \u91cd\u65b0\u6307\u5411\u7528\u6237\u6808\u6808\u9876\uff0csscratch \u4e5f\u4f9d\u7136\u4fdd\u5b58\u8fdb\u5165 Trap \u4e4b\u524d\u7684\u72b6\u6001\u5e76\u6307\u5411\u5185\u6838\u6808\u6808\u9876\u3002\n    sret\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#trap_handler","title":"trap_handler","text":"Rust<pre><code>// os/src/trap/mod.rs\n\n#[no_mangle]\npub fn trap_handler(cx: &amp;mut TrapContext) -&gt; &amp;mut TrapContext {\n    let scause = scause::read();\n    let stval = stval::read();\n    match scause.cause() {\n        Trap::Exception(Exception::UserEnvCall) =&gt; {\n            cx.sepc += 4;\n            cx.x[10] = syscall(cx.x[17], [cx.x[10], cx.x[11], cx.x[12]]) as usize;\n        }\n        Trap::Exception(Exception::StoreFault) |\n        Trap::Exception(Exception::StorePageFault) =&gt; {\n            println!(\"[kernel] PageFault in application, kernel killed it.\");\n            run_next_app();\n        }\n        Trap::Exception(Exception::IllegalInstruction) =&gt; {\n            println!(\"[kernel] IllegalInstruction in application, kernel killed it.\");\n            run_next_app();\n        }\n        _ =&gt; {\n            panic!(\"Unsupported trap {:?}, stval = {:#x}!\", scause.cause(), stval);\n        }\n    }\n    cx\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#practice","title":"Practice","text":"","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#_6","title":"\u6269\u5c55\u5185\u6838\uff0c\u80fd\u591f\u7edf\u8ba1\u591a\u4e2a\u5e94\u7528\u7684\u6267\u884c\u8fc7\u7a0b\u4e2d\u7cfb\u7edf\u8c03\u7528\u7f16\u53f7\u548c\u8bbf\u95ee\u6b64\u7cfb\u7edf\u8c03\u7528\u7684\u6b21\u6570","text":"<ul> <li>\u589e\u52a0\u4e00\u4e2a SyscallNum \u7684\u7ed3\u6784\u4f53\u8bb0\u5f55\u53d1\u751f\u7cfb\u7edf\u8c03\u7528\u7684\u6b21\u6570</li> </ul> Rust<pre><code>// batch.rs\n/**\n * syscall num\n */\npub struct SyscallNum {\n    num: [usize; SYSCALL_NUM],\n}\n\nimpl SyscallNum {\n    /**\n     * get syscall num\n     */\n    pub fn get_syscall_num(&amp;self, syscall_id: usize) -&gt; usize {\n        self.num[syscall_id]\n    }\n    /**\n     * inc syscall num\n     */\n    pub fn inc_syscall_num(&amp;mut self, syscall_id: usize) {\n        self.num[syscall_id] += 1;\n    }\n}\n\nlazy_static!{\n     // ch2 add begin\n    /**\n     * syscall use syscall num\n     */\n    pub static ref NUM: UPSafeCell&lt;SyscallNum&gt; = unsafe {\n        UPSafeCell::new({\n            SyscallNum {\n                num: [0; SYSCALL_NUM],\n            }\n        })\n    };\n}\n\n// run_next_app\nif current_app == APP_MANAGER.exclusive_access().num_app - 1 || current_app == 0 {\n        println!(\n            \"sys_write num: {}\",\n            NUM.exclusive_access().get_syscall_num(0)\n        );\n        println!(\n            \"sys_exit num: {}\",\n            NUM.exclusive_access().get_syscall_num(1)\n        );\n    }\n</code></pre> Rust<pre><code>// syscall/mod.rs\nuse crate::batch::NUM;\n/// handle syscall exception with `syscall_id` and other arguments\npub fn syscall(syscall_id: usize, args: [usize; 3]) -&gt; isize {\n    match syscall_id {\n        SYSCALL_WRITE =&gt; {\n            let ret = sys_write(args[0], args[1] as *const u8, args[2]);\n            NUM.exclusive_access().inc_syscall_num(0);\n            ret\n        }\n        SYSCALL_EXIT =&gt; {\n            NUM.exclusive_access().inc_syscall_num(1);\n            sys_exit(args[0] as i32)\n        }\n        _ =&gt; panic!(\"Unsupported syscall_id: {}\", syscall_id),\n    }\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#_7","title":"\u6269\u5c55\u5185\u6838\uff0c\u80fd\u591f\u7edf\u8ba1\u6bcf\u4e2a\u5e94\u7528\u6267\u884c\u540e\u7684\u5b8c\u6210\u65f6\u95f4","text":"<ul> <li>\u5728<code>AppManager</code>\u4e2d\u589e\u52a0\u5e94\u7528\u6267\u884c\u65f6\u957f\u5b57\u6bb5\uff1b\u5728<code>run_next_app</code>\u4e2d\u83b7\u53d6\u7cfb\u7edf\u65f6\u949f\uff0c\u8bb0\u5f55\u5e94\u7528\u65f6\u95f4</li> </ul> Rust<pre><code>// batch.rs\n/**\n * AppManager\n */\nstruct AppManager {\n    num_app: usize,\n    current_app: usize,\n    app_start: [usize; MAX_APP_NUM + 1],\n    // ch2 add begin\n    app_runtime: [u64; MAX_APP_NUM],\n    // ch2 add end\n}\n\n// run_next_app\n// ch2 add begin\n\nlet time: u64;\nunsafe {\n    asm!(\"rdtime {0}\", out(reg) time);\n}\nif current_app &gt; 0 {\n    let runtime = time - APP_MANAGER.exclusive_access().app_runtime[current_app - 1];\n    APP_MANAGER\n        .exclusive_access()\n        .set_app_runtime(current_app - 1, runtime);\n    println!(\n        \"[kernel] app_{} runs {} cycles\",\n        current_app - 1,\n        APP_MANAGER\n            .exclusive_access()\n            .get_app_runtime(current_app - 1)\n    );\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/BatchOS/#sys_write","title":"sys_write \u4ec5\u80fd\u8f93\u51fa\u4f4d\u4e8e\u7a0b\u5e8f\u672c\u8eab\u5185\u5b58\u7a7a\u95f4\u5185\u7684\u6570\u636e\uff0c\u5426\u5219\u62a5\u9519","text":"<ul> <li>\u6784\u5efa ReliableAddr \u7ed3\u6784\u4f53\u8bb0\u5f55\u5e94\u7528\u7a0b\u5e8f\u8d77\u59cb\u548c\u7ec8\u6b62\u5730\u5740</li> </ul> Rust<pre><code>// batch.rs\n/**\n * Reliable address of program\n */\npub struct ReliableAddr {\n    start: usize,\n    end: usize,\n}\n\nimpl ReliableAddr {\n    /**\n     * get reliable start addr\n     */\n    pub fn get_reliable_start(&amp;self) -&gt; usize {\n        self.start\n    }\n    /**\n     * get reliable end addr\n     */\n    pub fn get_reliable_end(&amp;self) -&gt; usize {\n        self.end\n    }\n}\n\nlazy_static!{\n    /**\n     * reliable addr init\n     */\n    pub static ref RE_ADDR:UPSafeCell&lt;ReliableAddr&gt; = unsafe {\n        UPSafeCell::new({\n            ReliableAddr {\n                start: APP_BASE_ADDRESS,\n                end: APP_BASE_ADDRESS + APP_SIZE_LIMIT,\n            }\n        })\n    };\n}\n\n// run_next_app\n// \u6ce8\u610f\u6570\u636e\u9700\u8981\u4f7f\u7528clone()\nlet mut reliable_addr = RE_ADDR.exclusive_access();\nreliable_addr.start = app_manager.app_start[current_app].clone();\nreliable_addr.end = app_manager.app_start[current_app + 1].clone();\ndrop(reliable_addr);\n</code></pre> Rust<pre><code>// syscall/mod.rs\nuse crate::batch::RE_ADDR;\n\n/// handle syscall exception with `syscall_id` and other arguments\npub fn syscall(syscall_id: usize, args: [usize; 3]) -&gt; isize {\n    match syscall_id {\n        SYSCALL_WRITE =&gt; {\n            let start_addr = RE_ADDR.exclusive_access().get_reliable_start();\n            let end_addr = RE_ADDR.exclusive_access().get_reliable_end();\n            if args[1] &lt; start_addr {\n                return -1;\n            }\n            if args[1] &gt;= end_addr {\n                return -1;\n            }\n            if args[1] + args[2] &gt;= end_addr {\n                return -1;\n            }\n            let ret = sys_write(args[0], args[1] as *const u8, args[2]);\n            NUM.exclusive_access().inc_syscall_num(0);\n            ret\n        }\n        SYSCALL_EXIT =&gt; {\n            NUM.exclusive_access().inc_syscall_num(1);\n            sys_exit(args[0] as i32)\n        }\n        _ =&gt; panic!(\"Unsupported syscall_id: {}\", syscall_id),\n    }\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/LibOS/","title":"LibOS","text":"<code>#Operator System</code> <code>#rust</code>","tags":["Operator System","rust"]},{"location":"notes/rcore/LibOS/#libos","title":"LibOS","text":"<p> \u7ea6 88 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p> <p></p> <ul> <li>\u5b9e\u73b0\u4e0e OS \u65e0\u5173\u7684 OS \u7c7b\u578b\u7684\u7a0b\u5e8f</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/LibOS/#_1","title":"\u7ed3\u6784","text":"<ul> <li>OS \u5728 APP \u8fd0\u884c\u524d\u8fdb\u884c\u521d\u59cb\u5316\uff1a\u5efa\u7acb\u6808\u7a7a\u95f4 + .bss \u6bb5\u6e05\u96f6</li> <li>Bootloader \u5728 0x80000000 \u5904\u52a0\u8f7d\uff0c\u6240\u4ee5 OS \u53ea\u80fd\u5728 0x80200000 \u5904\u52a0\u8f7d</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/LibOS/#_2","title":"\u5185\u5b58\u5e03\u5c40","text":"","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/","title":"TimesharingOS","text":"<code>#Operator System</code> <code>#rust</code>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#timesharingos","title":"TimesharingOS","text":"<p> \u7ea6 2089 \u4e2a\u5b57  314 \u884c\u4ee3\u7801  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 14 \u5206\u949f</p>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#multiprogos","title":"MultiprogOS","text":"<ul> <li>Qemu \u628a\u5305\u542b\u591a\u4e2a app \u7684\u5217\u8868\u548c MultiprogOS \u7684 image \u955c\u50cf\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0cRustSBI\uff08bootloader\uff09\u5b8c\u6210\u57fa\u672c\u7684\u786c\u4ef6\u521d\u59cb\u5316\u540e\uff0c\u8df3\u8f6c\u5230 MultiprogOS \u8d77\u59cb\u4f4d\u7f6e</li> <li>MultiprogOS \u9996\u5148\u8fdb\u884c\u6b63\u5e38\u8fd0\u884c\u524d\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u5373\u5efa\u7acb\u6808\u7a7a\u95f4\u548c\u6e05\u96f6 bss \u6bb5\uff0c\u7136\u540e\u901a\u8fc7\u6539\u8fdb\u7684 AppManager \u5185\u6838\u6a21\u5757\u4ece app \u5217\u8868\u4e2d\u628a\u6240\u6709 app \u90fd\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5e76\u6309\u6307\u5b9a\u987a\u5e8f\u8ba9 app \u5728\u7528\u6237\u6001\u4e00\u4e2a\u63a5\u4e00\u4e2a\u5730\u6267\u884c\u3002</li> <li>app \u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7684\u65b9\u5f0f\u5f97\u5230 MultiprogOS \u63d0\u4f9b\u7684 OS \u670d\u52a1\uff0c\u5982\u8f93\u51fa\u5b57\u7b26\u4e32\u7b49\u3002</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#coopos","title":"CoopOS","text":"<ul> <li>CoopOS \u8fdb\u4e00\u6b65\u6539\u8fdb\u4e86 AppManager \u5185\u6838\u6a21\u5757\uff0c\u628a\u5b83\u62c6\u5206\u4e3a\u8d1f\u8d23\u52a0\u8f7d\u5e94\u7528\u7684 Loader \u5185\u6838\u6a21\u5757\u548c\u7ba1\u7406\u5e94\u7528\u8fd0\u884c\u8fc7\u7a0b\u7684 TaskManager \u5185\u6838\u6a21\u5757\u3002</li> <li>TaskManager \u901a\u8fc7 task \u4efb\u52a1\u63a7\u5236\u5757\u6765\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u652f\u6301\u5e94\u7528\u7a0b\u5e8f\u4e3b\u52a8\u653e\u5f03 CPU \u5e76\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u5e94\u7528\u7ee7\u7eed\u6267\u884c\uff0c\u4ece\u800c\u63d0\u9ad8\u7cfb\u7edf\u6574\u4f53\u6267\u884c\u6548\u7387\u3002</li> <li>\u5e94\u7528\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u6709\u81ea\u5df1\u6240\u5728\u7684\u5185\u5b58\u7a7a\u95f4\u548c\u6808\uff0c\u786e\u4fdd\u88ab\u5207\u6362\u65f6\u76f8\u5173\u4fe1\u606f\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5e94\u7528\u7834\u574f\u3002\u5982\u679c\u5f53\u524d\u5e94\u7528\u7a0b\u5e8f\u6b63\u5728\u8fd0\u884c\uff0c\u5219\u8be5\u5e94\u7528\u5bf9\u5e94\u7684\u4efb\u52a1\u5904\u4e8e\u8fd0\u884c\uff08Running\uff09\u72b6\u6001\uff1b\u5982\u679c\u8be5\u5e94\u7528\u4e3b\u52a8\u653e\u5f03\u5904\u7406\u5668\uff0c\u5219\u8be5\u5e94\u7528\u5bf9\u5e94\u7684\u4efb\u52a1\u5904\u4e8e\u5c31\u7eea\uff08Ready\uff09\u72b6\u6001\u3002</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u4efb\u52a1\u5207\u6362\u65f6\uff0c\u9700\u8981\u628a\u8981\u6682\u505c\u4efb\u52a1\u7684\u4e0a\u4e0b\u6587\uff08\u5373\u4efb\u52a1\u7528\u5230\u7684\u901a\u7528\u5bc4\u5b58\u5668\uff09\u4fdd\u5b58\u8d77\u6765\uff0c\u628a\u8981\u7ee7\u7eed\u6267\u884c\u7684\u4efb\u52a1\u7684\u4e0a\u4e0b\u6587\u6062\u590d\u4e3a\u6682\u505c\u524d\u7684\u5185\u5bb9\uff0c\u8fd9\u6837\u5c31\u80fd\u8ba9\u4e0d\u540c\u7684\u5e94\u7528\u534f\u540c\u4f7f\u7528\u5904\u7406\u5668\u4e86\u3002</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#timersharingos","title":"TimersharingOS","text":"<ul> <li>TimesharingOS \u6700\u5927\u7684\u53d8\u5316\u662f\u6539\u8fdb\u4e86 Trap_handler \u5185\u6838\u6a21\u5757\uff0c\u652f\u6301\u65f6\u949f\u4e2d\u65ad\uff0c\u4ece\u800c\u53ef\u4ee5\u62a2\u5360\u5e94\u7528\u7684\u6267\u884c\u3002</li> <li>\u5e76\u901a\u8fc7\u8fdb\u4e00\u6b65\u6539\u8fdb TaskManager \u5185\u6838\u6a21\u5757\uff0c\u63d0\u4f9b\u4efb\u52a1\u8c03\u5ea6\u529f\u80fd\uff0c\u8fd9\u6837\u53ef\u4ee5\u5728\u6536\u5230\u65f6\u949f\u4e2d\u65ad\u540e\u7edf\u8ba1\u4efb\u52a1\u7684\u4f7f\u7528\u65f6\u95f4\u7247\uff0c\u5982\u679c\u4efb\u52a1\u7684\u65f6\u95f4\u7247\u7528\u5b8c\u540e\uff0c\u5219\u5207\u6362\u4efb\u52a1\u3002\u4ece\u800c\u53ef\u4ee5\u516c\u5e73\u548c\u9ad8\u6548\u5730\u5206\u65f6\u6267\u884c\u591a\u4e2a\u5e94\u7528\uff0c\u63d0\u9ad8\u7cfb\u7edf\u7684\u6574\u4f53\u6548\u7387\u3002</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#_1","title":"\u591a\u9053\u7a0b\u5e8f\u653e\u7f6e\u4e0e\u52a0\u8f7d","text":"","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#_2","title":"\u653e\u7f6e","text":"<ul> <li>\u6bcf\u4e2a app \u7684\u8d77\u59cb\u5730\u5740\u4e3a<code>hex(base_address+step*app_id)</code>\uff0c\u5b9e\u73b0\u8d77\u59cb\u5730\u5740\u7684\u4e0d\u540c</li> </ul> Python<pre><code> # user/build.py\n\n import os\n\n base_address = 0x80400000\n step = 0x20000\n linker = 'src/linker.ld'\n\n app_id = 0\n apps = os.listdir('src/bin')\n apps.sort()\n for app in apps:\n     app = app[:app.find('.')]\n     lines = []\n     lines_before = []\n     with open(linker, 'r') as f:\n         for line in f.readlines():\n             lines_before.append(line)\n             line = line.replace(hex(base_address), hex(base_address+step*app_id))\n             lines.append(line)\n     with open(linker, 'w+') as f:\n         f.writelines(lines)\n     os.system('cargo build --bin %s --release' % app)\n     print('[build.py] application %s start with address %s' %(app, hex(base_address+step*app_id)))\n     with open(linker, 'w+') as f:\n         f.writelines(lines_before)\n     app_id = app_id + 1\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#_3","title":"\u52a0\u8f7d","text":"<ul> <li>\u7b2c i \u4e2a\u5e94\u7528\u52a0\u8f7d\u5230\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740\u4e0a<code>APP_BASE_ADDRESS + i * APP_SIZE_LIMIT</code></li> </ul> Rust<pre><code> // os/src/loader.rs\n\n fn get_base_i(app_id: usize) -&gt; usize {\n     APP_BASE_ADDRESS + app_id * APP_SIZE_LIMIT\n }\n\n pub fn load_apps() {\n     extern \"C\" { fn _num_app(); }\n     let num_app_ptr = _num_app as usize as *const usize;\n     let num_app = get_num_app();\n     let app_start = unsafe {\n         core::slice::from_raw_parts(num_app_ptr.add(1), num_app + 1)\n     };\n     // load apps\n     for i in 0..num_app {\n         let base_i = get_base_i(i);\n         // clear region\n         (base_i..base_i + APP_SIZE_LIMIT).for_each(|addr| unsafe {\n             (addr as *mut u8).write_volatile(0)\n         });\n         // load app from data section to memory\n         let src = unsafe {\n             core::slice::from_raw_parts(\n                 app_start[i] as *const u8,\n                 app_start[i + 1] - app_start[i]\n             )\n         };\n         let dst = unsafe {\n             core::slice::from_raw_parts_mut(base_i as *mut u8, src.len())\n         };\n         dst.copy_from_slice(src);\n     }\n     unsafe {\n         asm!(\"fence.i\");\n     }\n }\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#_4","title":"\u4efb\u52a1\u5207\u6362","text":"<ul> <li> <p>\u5728\u5185\u6838\u4e2d\u8fd9\u79cd\u673a\u5236\u662f\u5728 <code>__switch</code> \u51fd\u6570\u4e2d\u5b9e\u73b0\u7684\u3002 \u4efb\u52a1\u5207\u6362\u652f\u6301\u7684\u573a\u666f\u662f\uff1a\u4e00\u4e2a\u5e94\u7528\u5728\u8fd0\u884c\u9014\u4e2d\u4fbf\u4f1a\u4e3b\u52a8\u6216\u88ab\u52a8\u4ea4\u51fa CPU \u7684\u4f7f\u7528\u6743\uff0c\u6b64\u65f6\u5b83\u53ea\u80fd\u6682\u505c\u6267\u884c\uff0c\u7b49\u5230\u5185\u6838\u91cd\u65b0\u7ed9\u5b83\u5206\u914d\u5904\u7406\u5668\u8d44\u6e90\u4e4b\u540e\u624d\u80fd\u6062\u590d\u5e76\u7ee7\u7eed\u6267\u884c\u3002</p> </li> <li> <p>\u4efb\u52a1\u5207\u6362\u662f\u6765\u81ea\u4e24\u4e2a\u4e0d\u540c\u5e94\u7528\u5728\u5185\u6838\u4e2d\u7684 Trap \u63a7\u5236\u6d41\u4e4b\u95f4\u7684\u5207\u6362\u3002\u5f53\u4e00\u4e2a\u5e94\u7528 Trap \u5230 S \u6a21\u5f0f\u7684\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4e2d\u8fdb\u884c\u8fdb\u4e00\u6b65\u5904\u7406\uff08\u5373\u8fdb\u5165\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684 Trap \u63a7\u5236\u6d41\uff09\u7684\u65f6\u5019\uff0c\u5176 Trap \u63a7\u5236\u6d41\u53ef\u4ee5\u8c03\u7528\u4e00\u4e2a\u7279\u6b8a\u7684 <code>__switch</code> \u51fd\u6570\u3002</p> </li> <li>\u8fd9\u4e2a\u51fd\u6570\u8868\u9762\u4e0a\u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684\u51fd\u6570\u8c03\u7528\uff1a\u5728 <code>__switch</code> \u8fd4\u56de\u4e4b\u540e\uff0c\u5c06\u7ee7\u7eed\u4ece\u8c03\u7528\u8be5\u51fd\u6570\u7684\u4f4d\u7f6e\u7ee7\u7eed\u5411\u4e0b\u6267\u884c\u3002\u4f46\u662f\u5176\u95f4\u5374\u9690\u85cf\u7740\u590d\u6742\u7684\u63a7\u5236\u6d41\u5207\u6362\u8fc7\u7a0b\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u8c03\u7528 <code>__switch</code> \u4e4b\u540e\u76f4\u5230\u5b83\u8fd4\u56de\u524d\u7684\u8fd9\u6bb5\u65f6\u95f4\uff0c</li> <li>\u539f Trap \u63a7\u5236\u6d41 A \u4f1a\u5148\u88ab\u6682\u505c\u5e76\u88ab\u5207\u6362\u51fa\u53bb\uff0c CPU \u8f6c\u800c\u8fd0\u884c\u53e6\u4e00\u4e2a\u5e94\u7528\u5728\u5185\u6838\u4e2d\u7684 Trap \u63a7\u5236\u6d41 B \u3002</li> <li>\u7136\u540e\u5728\u67d0\u4e2a\u5408\u9002\u7684\u65f6\u673a\uff0c\u539f Trap \u63a7\u5236\u6d41 A \u624d\u4f1a\u4ece\u67d0\u4e00\u6761 Trap \u63a7\u5236\u6d41 C \uff08\u5f88\u6709\u53ef\u80fd\u4e0d\u662f\u5b83\u4e4b\u524d\u5207\u6362\u5230\u7684 B \uff09\u5207\u6362\u56de\u6765\u7ee7\u7eed\u6267\u884c\u5e76\u6700\u7ec8\u8fd4\u56de\u3002</li> <li>\u4e0d\u8fc7\uff0c\u4ece\u5b9e\u73b0\u7684\u89d2\u5ea6\u8bb2\uff0c <code>__switch</code> \u51fd\u6570\u548c\u4e00\u4e2a\u666e\u901a\u7684\u51fd\u6570\u4e4b\u95f4\u7684\u6838\u5fc3\u5dee\u522b\u4ec5\u4ec5\u662f\u5b83\u4f1a \u6362\u6808 \u3002</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#_5","title":"\u8bbe\u8ba1\u4e0e\u5b9e\u73b0","text":"<ul> <li>\u5bf9\u4e8e\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\u7684 Trap \u63a7\u5236\u6d41\uff0c\u6211\u4eec\u7528\u4e00\u4e2a\u540d\u4e3a <code>current_task_cx_ptr</code> \u7684\u53d8\u91cf\u6765\u4fdd\u5b58\u653e\u7f6e\u5f53\u524d\u4efb\u52a1\u4e0a\u4e0b\u6587\u7684\u5730\u5740\uff1b\u800c\u7528 <code>next_task_cx_ptr</code> \u7684\u53d8\u91cf\u6765\u4fdd\u5b58\u653e\u7f6e\u4e0b\u4e00\u4e2a\u8981\u6267\u884c\u4efb\u52a1\u7684\u4e0a\u4e0b\u6587\u7684\u5730\u5740\u3002\u5229\u7528 C \u8bed\u8a00\u7684\u5f15\u7528\u6765\u63cf\u8ff0\u7684\u8bdd\u5c31\u662f\uff1a</li> </ul> C<pre><code>TaskContext *current_task_cx_ptr = &amp;tasks[current].task_cx;\nTaskContext *next_task_cx_ptr    = &amp;tasks[next].task_cx;\n</code></pre> <ul> <li>\u4efb\u52a1\u5207\u6362\u5305\u542b 4 \u4e2a\u9636\u6bb5   1. \u5728 Trap \u63a7\u5236\u6d41 A \u8c03\u7528 <code>__switch</code> \u4e4b\u524d\uff0cA \u7684\u5185\u6838\u6808\u4e0a\u53ea\u6709 Trap \u4e0a\u4e0b\u6587\u548c Trap \u5904\u7406\u51fd\u6570\u7684\u8c03\u7528\u6808\u4fe1\u606f\uff0c\u800c B \u662f\u4e4b\u524d\u88ab\u5207\u6362\u51fa\u53bb\u7684\uff1b   2. A \u5728 A \u4efb\u52a1\u4e0a\u4e0b\u6587\u7a7a\u95f4\u5728\u91cc\u9762\u4fdd\u5b58 CPU \u5f53\u524d\u7684\u5bc4\u5b58\u5668\u5feb\u7167\uff1b   3. \u8bfb\u53d6 <code>next_task_cx_ptr</code> \u6307\u5411\u7684 B \u4efb\u52a1\u4e0a\u4e0b\u6587\uff0c\u6839\u636e B \u4efb\u52a1\u4e0a\u4e0b\u6587\u4fdd\u5b58\u7684\u5185\u5bb9\u6765\u6062\u590d <code>ra</code> \u5bc4\u5b58\u5668\u3001<code>s0~s11</code> \u5bc4\u5b58\u5668\u4ee5\u53ca <code>sp</code> \u5bc4\u5b58\u5668\u3002\u53ea\u6709\u8fd9\u4e00\u6b65\u505a\u5b8c\u540e\uff0c <code>__switch</code> \u624d\u80fd\u505a\u5230\u4e00\u4e2a\u51fd\u6570\u8de8\u4e24\u6761\u63a7\u5236\u6d41\u6267\u884c\uff0c\u5373 \u901a\u8fc7\u6362\u6808\u4e5f\u5c31\u5b9e\u73b0\u4e86\u63a7\u5236\u6d41\u7684\u5207\u6362 \u3002   4. \u4e0a\u4e00\u6b65\u5bc4\u5b58\u5668\u6062\u590d\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u901a\u8fc7\u6062\u590d <code>sp</code> \u5bc4\u5b58\u5668\u6362\u5230\u4e86\u4efb\u52a1 B \u7684\u5185\u6838\u6808\u4e0a\uff0c\u8fdb\u800c\u5b9e\u73b0\u4e86\u63a7\u5236\u6d41\u7684\u5207\u6362\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48 <code>__switch</code> \u80fd\u505a\u5230\u4e00\u4e2a\u51fd\u6570\u8de8\u4e24\u6761\u63a7\u5236\u6d41\u6267\u884c\u3002\u6b64\u540e\uff0c\u5f53 CPU \u6267\u884c <code>ret</code> \u6c47\u7f16\u4f2a\u6307\u4ee4\u5b8c\u6210 <code>__switch</code> \u51fd\u6570\u8fd4\u56de\u540e\uff0c\u4efb\u52a1 B \u53ef\u4ee5\u4ece\u8c03\u7528 <code>__switch</code> \u7684\u4f4d\u7f6e\u7ee7\u7eed\u5411\u4e0b\u6267\u884c\u3002</li> <li>\u4ece\u7ed3\u679c\u6765\u770b\uff0c\u6211\u4eec\u770b\u5230 A \u63a7\u5236\u6d41 \u548c B \u63a7\u5236\u6d41\u7684\u72b6\u6001\u53d1\u751f\u4e86\u4e92\u6362\uff0c A \u5728\u4fdd\u5b58\u4efb\u52a1\u4e0a\u4e0b\u6587\u4e4b\u540e\u8fdb\u5165\u6682\u505c\u72b6\u6001\uff0c\u800c B \u5219\u6062\u590d\u4e86\u4e0a\u4e0b\u6587\u5e76\u5728 CPU \u4e0a\u7ee7\u7eed\u6267\u884c\u3002</li> </ul>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#__switch","title":"__switch \u5b9e\u73b0","text":"Rust<pre><code>// os/src/task/switch.rs\n\nglobal_asm!(include_str!(\"switch.S\"));\n\nuse super::TaskContext;\n\nextern \"C\" {\n    pub fn __switch(\n        current_task_cx_ptr: *mut TaskContext,\n        next_task_cx_ptr: *const TaskContext\n    );\n}\n</code></pre> Text Only<pre><code># os/src/task/switch.S\n\n.altmacro\n.macro SAVE_SN n\n    sd s\\n, (\\n+2)*8(a0)\n.endm\n.macro LOAD_SN n\n    ld s\\n, (\\n+2)*8(a1)\n.endm\n    .section .text\n    .globl __switch\n__switch:\n    # \u9636\u6bb5 [1]\n    # __switch(\n    #     current_task_cx_ptr: *mut TaskContext,\n    #     next_task_cx_ptr: *const TaskContext\n    # )\n    # \u9636\u6bb5 [2]\n    # save kernel stack of current task\n    sd sp, 8(a0)\n    # save ra &amp; s0~s11 of current execution\n    sd ra, 0(a0)\n    .set n, 0\n    .rept 12\n        SAVE_SN %n\n        .set n, n + 1\n    .endr\n    # \u9636\u6bb5 [3]\n    # restore ra &amp; s0~s11 of next execution\n    ld ra, 0(a1)\n    .set n, 0\n    .rept 12\n        LOAD_SN %n\n        .set n, n + 1\n    .endr\n    # restore kernel stack of next task\n    ld sp, 8(a1)\n    # \u9636\u6bb5 [4]\n    ret\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#taskcontext","title":"TaskContext","text":"Rust<pre><code>// os/src/task/context.rs\n\npub struct TaskContext {\n    ra: usize,\n    sp: usize,\n    s: [usize; 12],\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#_6","title":"\u4efb\u52a1\u7ba1\u7406\u5668","text":"","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#tcb","title":"\u4efb\u52a1\u63a7\u5236\u5757(TCB)","text":"Rust<pre><code>// os/src/task/task.rs\n\n#[derive(Copy, Clone)]\npub struct TaskControlBlock {\n    pub task_status: TaskStatus,\n    pub task_cx: TaskContext,\n}\n</code></pre> <ul> <li><code>TaskContext::goto_restore</code>\u5c06<code>ra</code>\u8bbe\u7f6e\u4e3a<code>__restore</code>\uff1b\u56e0\u4e3a\u5207\u6362\u4efb\u52a1\u65f6\u6211\u4eec\u8bbe\u5b9a\u5185\u6838\u6808\u6808\u4e2d\u5305\u542b<code>__alltraps</code>\u548c<code>trap_handler</code>\u7684\u6808\u5e27</li> <li>\u5f53\u6267\u884c\u7b2c\u4e00\u4e2a\u7a0b\u5e8f\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5411\u5185\u6838\u6808\u4e2d\u538b\u5165\u4e00\u4e2a<code>TrapContext</code></li> </ul> Rust<pre><code>// os/src/loader.rs\n\npub fn init_app_cx(app_id: usize) -&gt; usize {\n    KERNEL_STACK[app_id].push_context(\n        TrapContext::app_init_context(get_base_i(app_id), USER_STACK[app_id].get_sp()),\n    )\n}\n// os/src/task/mod.rs\n\npub struct TaskManager {\n    num_app: usize,\n    inner: UPSafeCell&lt;TaskManagerInner&gt;,\n}\n\nstruct TaskManagerInner {\n    tasks: [TaskControlBlock; MAX_APP_NUM],\n    current_task: usize,\n}\n\nlazy_static! {\n    pub static ref TASK_MANAGER: TaskManager = {\n        let num_app = get_num_app();\n        let mut tasks = [\n            TaskControlBlock {\n                task_cx: TaskContext::zero_init(),\n                task_status: TaskStatus::UnInit\n            };\n            MAX_APP_NUM\n        ];\n        for i in 0..num_app {\n            tasks[i].task_cx = TaskContext::goto_restore(init_app_cx(i));\n            tasks[i].task_status = TaskStatus::Ready;\n        }\n        TaskManager {\n            num_app,\n            inner: unsafe { UPSafeCell::new(TaskManagerInner {\n                tasks,\n                current_task: 0,\n            })},\n        }\n    };\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#sys_yield-sys_exit","title":"sys_yield \u548c sys_exit \u7cfb\u7edf\u8c03\u7528","text":"Rust<pre><code>// os/src/syscall/process.rs\n\nuse crate::task::suspend_current_and_run_next;\n\npub fn sys_yield() -&gt; isize {\n    suspend_current_and_run_next();\n    0\n}\n// os/src/syscall/process.rs\n\nuse crate::task::exit_current_and_run_next;\n\npub fn sys_exit(exit_code: i32) -&gt; ! {\n    println!(\"[kernel] Application exited with code {}\", exit_code);\n    exit_current_and_run_next();\n    panic!(\"Unreachable in sys_exit!\");\n}\n</code></pre> <ul> <li><code>suspend_current_and_run_next</code>\u548c<code>exit_current_and_run_next</code>\u5747\u662f\u5207\u6362\u5f53\u524d Task \u7684\u8fd0\u884c\u72b6\u6001\uff0c\u5207\u6362\u5230\u4e0b\u4e00\u4e2a\u5e94\u7528</li> </ul> Rust<pre><code>// os/src/task/mod.rs\n\nfn mark_current_suspended() {\n    TASK_MANAGER.mark_current_suspended();\n}\n\nfn mark_current_exited() {\n    TASK_MANAGER.mark_current_exited();\n}\n\nimpl TaskManager {\n    fn mark_current_suspended(&amp;self) {\n        let mut inner = self.inner.borrow_mut();\n        let current = inner.current_task;\n        inner.tasks[current].task_status = TaskStatus::Ready;\n    }\n\n    fn mark_current_exited(&amp;self) {\n        let mut inner = self.inner.borrow_mut();\n        let current = inner.current_task;\n        inner.tasks[current].task_status = TaskStatus::Exited;\n    }\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#run_next_task","title":"run_next_task","text":"Rust<pre><code>// os/src/task/mod.rs\n\nfn run_next_task() {\n    TASK_MANAGER.run_next_task();\n}\n\nimpl TaskManager {\n    fn run_next_task(&amp;self) {\n        if let Some(next) = self.find_next_task() {\n            let mut inner = self.inner.exclusive_access();\n            let current = inner.current_task;\n            inner.tasks[next].task_status = TaskStatus::Running;\n            inner.current_task = next;\n            let current_task_cx_ptr = &amp;mut inner.tasks[current].task_cx as *mut TaskContext;\n            let next_task_cx_ptr = &amp;inner.tasks[next].task_cx as *const TaskContext;\n            drop(inner);\n            // before this, we should drop local variables that must be dropped manually\n            unsafe {\n                __switch(\n                    current_task_cx_ptr,\n                    next_task_cx_ptr,\n                );\n            }\n            // go back to user mode\n        } else {\n            panic!(\"All applications completed!\");\n        }\n    }\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#round-robin","title":"\u65f6\u95f4\u7247\u8f6e\u8f6c\u8c03\u5ea6(Round-Robin)","text":"","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#_7","title":"\u65f6\u949f\u4e2d\u65ad\u4e0e\u8ba1\u65f6\u5668","text":"<ul> <li>\u5728 RISC-V 64 \u67b6\u6784\u4e0a\uff0c\u8be5\u8ba1\u6570\u5668\u4fdd\u5b58\u5728\u4e00\u4e2a 64 \u4f4d\u7684 CSR <code>mtime</code> \u4e2d\uff0c\u6211\u4eec\u65e0\u9700\u62c5\u5fc3\u5b83\u7684\u6ea2\u51fa\u95ee\u9898\uff0c\u5728\u5185\u6838\u8fd0\u884c\u5168\u7a0b\u53ef\u4ee5\u8ba4\u4e3a\u5b83\u662f\u4e00\u76f4\u9012\u589e\u7684\u3002</li> <li>\u53e6\u5916\u4e00\u4e2a 64 \u4f4d\u7684 CSR <code>mtimecmp</code> \u7684\u4f5c\u7528\u662f\uff1a\u4e00\u65e6\u8ba1\u6570\u5668 <code>mtime</code> \u7684\u503c\u8d85\u8fc7\u4e86 <code>mtimecmp</code>\uff0c\u5c31\u4f1a\u89e6\u53d1\u4e00\u6b21\u65f6\u949f\u4e2d\u65ad\u3002\u8fd9\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u65b9\u4fbf\u7684\u901a\u8fc7\u8bbe\u7f6e <code>mtimecmp</code> \u7684\u503c\u6765\u51b3\u5b9a\u4e0b\u4e00\u6b21\u65f6\u949f\u4e2d\u65ad\u4f55\u65f6\u89e6\u53d1\u3002</li> <li>\u53ef\u60dc\u7684\u662f\uff0c\u5b83\u4eec\u90fd\u662f M \u7279\u6743\u7ea7\u7684 CSR \uff0c\u800c\u6211\u4eec\u7684\u5185\u6838\u5904\u5728 S \u7279\u6743\u7ea7\uff0c\u662f\u4e0d\u88ab\u5141\u8bb8\u76f4\u63a5\u8bbf\u95ee\u5b83\u4eec\u7684\u3002\u597d\u5728\u8fd0\u884c\u5728 M \u7279\u6743\u7ea7\u7684 SEE \uff08\u8fd9\u91cc\u662f RustSBI\uff09\u5df2\u7ecf\u9884\u7559\u4e86\u76f8\u5e94\u7684\u63a5\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u7528\u5b83\u4eec\u6765\u95f4\u63a5\u5b9e\u73b0\u8ba1\u65f6\u5668\u7684\u63a7\u5236</li> <li>\u5e38\u6570 <code>CLOCK_FREQ</code> \u662f\u4e00\u4e2a\u9884\u5148\u83b7\u53d6\u5230\u7684\u5404\u5e73\u53f0\u4e0d\u540c\u7684\u65f6\u949f\u9891\u7387\uff0c\u5355\u4f4d\u4e3a\u8d6b\u5179\uff0c\u4e5f\u5c31\u662f\u4e00\u79d2\u949f\u4e4b\u5185\u8ba1\u6570\u5668\u7684\u589e\u91cf\u3002</li> </ul> Rust<pre><code>// os/src/timer.rs\n\nuse riscv::register::time;\n\npub fn get_time() -&gt; usize {\n    time::read()\n}\n// os/src/sbi.rs\n\nconst SBI_SET_TIMER: usize = 0;\n\npub fn set_timer(timer: usize) {\n    sbi_call(SBI_SET_TIMER, timer, 0, 0);\n}\n</code></pre> <ul> <li><code>set_next_trigger</code>\u8bbe\u7f6e\u4e0b\u4e00\u4e2a\u65f6\u949f\u4e2d\u65ad</li> <li><code>get_time_us</code> \u4ee5\u5fae\u79d2\u4e3a\u5355\u4f4d\u8fd4\u56de\u5f53\u524d\u8ba1\u6570\u5668\u7684\u503c</li> </ul> Rust<pre><code>// os/src/timer.rs\n\nuse crate::config::CLOCK_FREQ;\nconst TICKS_PER_SEC: usize = 100;\n\npub fn set_next_trigger() {\n    set_timer(get_time() + CLOCK_FREQ / TICKS_PER_SEC);\n}\n\n// os/src/timer.rs\n\nconst MICRO_PER_SEC: usize = 1_000_000;\n\npub fn get_time_us() -&gt; usize {\n    time::read() / (CLOCK_FREQ / MICRO_PER_SEC)\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#_8","title":"\u62a2\u5360\u5f0f\u8c03\u5ea6","text":"Rust<pre><code>// os/src/trap/mod.rs\n\nmatch scause.cause() {\n    Trap::Interrupt(Interrupt::SupervisorTimer) =&gt; {\n        set_next_trigger();\n        suspend_current_and_run_next();\n    }\n}\n</code></pre> <ul> <li>\u6211\u4eec\u53ea\u9700\u5728 <code>trap_handler</code> \u51fd\u6570\u4e0b\u65b0\u589e\u4e00\u4e2a\u6761\u4ef6\u5206\u652f\u8df3\u8f6c\uff0c\u5f53\u53d1\u73b0\u89e6\u53d1\u4e86\u4e00\u4e2a S \u7279\u6743\u7ea7\u65f6\u949f\u4e2d\u65ad\u7684\u65f6\u5019\uff0c\u9996\u5148\u91cd\u65b0\u8bbe\u7f6e\u4e00\u4e2a 10ms \u7684\u8ba1\u65f6\u5668\uff0c\u7136\u540e\u8c03\u7528\u4e0a\u4e00\u5c0f\u8282\u63d0\u5230\u7684 <code>suspend_current_and_run_next</code> \u51fd\u6570\u6682\u505c\u5f53\u524d\u5e94\u7528\u5e76\u5207\u6362\u5230\u4e0b\u4e00\u4e2a\u3002</li> <li>\u521d\u59cb\u5316\u8bbe\u7f6e</li> </ul> Rust<pre><code>// os/src/main.rs\n\n#[no_mangle]\npub fn rust_main() -&gt; ! {\n    clear_bss();\n    println!(\"[kernel] Hello, world!\");\n    trap::init();\n    loader::load_apps();\n\n    trap::enable_timer_interrupt();\n    timer::set_next_trigger();\n\n    task::run_first_task();\n    panic!(\"Unreachable in rust_main!\");\n}\n\n// os/src/trap/mod.rs\n\nuse riscv::register::sie;\n\npub fn enable_timer_interrupt() {\n    unsafe { sie::set_stimer(); }\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/TimeSharingOS/#sleep","title":"sleep","text":"<ul> <li>\u76ee\u524d\u5728\u7b49\u5f85\u67d0\u4e9b\u4e8b\u4ef6\u7684\u65f6\u5019\u4ecd\u7136\u9700\u8981<code>yield</code> \uff0c\u5176\u4e2d\u4e00\u4e2a\u539f\u56e0\u662f\u4e3a\u4e86\u8282\u7ea6 CPU \u8ba1\u7b97\u8d44\u6e90\uff0c\u53e6\u4e00\u4e2a\u539f\u56e0\u662f\u5f53\u4e8b\u4ef6\u4f9d\u8d56\u4e8e\u5176\u4ed6\u7684\u5e94\u7528\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u53ea\u6709\u4e00\u4e2a CPU\uff0c\u5f53\u524d\u5e94\u7528\u7684\u7b49\u5f85\u53ef\u80fd\u6c38\u8fdc\u4e0d\u4f1a\u7ed3\u675f\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u9700\u8981\u5148\u5c06\u5b83\u5207\u6362\u51fa\u53bb\uff0c\u4f7f\u5f97\u5176\u4ed6\u7684\u5e94\u7528\u5230\u8fbe\u5b83\u6240\u671f\u5f85\u7684\u72b6\u6001\u5e76\u6ee1\u8db3\u4e8b\u4ef6\u7684\u751f\u6210\u6761\u4ef6\uff0c\u518d\u5207\u6362\u56de\u6765\u3002</li> <li>\u8fd9\u91cc\u6211\u4eec\u5148\u901a\u8fc7 yield \u6765\u4f18\u5316 \u8f6e\u8be2 (Busy Loop) \u8fc7\u7a0b\u5e26\u6765\u7684 CPU \u8d44\u6e90\u6d6a\u8d39\u3002\u5728 <code>03sleep</code> \u8fd9\u4e2a\u5e94\u7528\u4e2d\uff1a</li> </ul> Rust<pre><code>// user/src/bin/03sleep.rs\n\n#[no_mangle]\nfn main() -&gt; i32 {\n    let current_timer = get_time();\n    let wait_for = current_timer + 3000;\n    while get_time() &lt; wait_for {\n        yield_();\n    }\n    println!(\"Test sleep OK!\");\n    0\n}\n</code></pre>","tags":["Operator System","rust"]},{"location":"notes/rcore/rustlings/","title":"rustlings","text":"<code>#rust</code>","tags":["rust"]},{"location":"notes/rcore/rustlings/#rustlings","title":"Rustlings","text":"<p> \u7ea6 837 \u4e2a\u5b57  142 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p>","tags":["rust"]},{"location":"notes/rcore/rustlings/#option2","title":"Option2","text":"<ul> <li>\u8c03\u7528\u00b7<code>vec</code>\u7684<code>pop</code> \u65b9\u6cd5\u65f6\uff0c\u5b83\u4f1a\u4ece\u6570\u7ec4\u7684\u672b\u5c3e\u79fb\u9664\u4e00\u4e2a\u5143\u7d20\uff0c\u5e76\u8fd4\u56de\u88ab\u79fb\u9664\u7684\u5143\u7d20\u4f5c\u4e3a <code>Option&lt;T&gt;</code>\u3002\u56e0\u6b64\uff0c\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u7531\u4e8e\u6570\u7ec4\u7684\u7c7b\u578b\u662f <code>Vec&lt;Option&lt;i8&gt;&gt;</code>\uff0c\u6240\u4ee5 <code>pop</code> \u65b9\u6cd5\u8fd4\u56de\u7684\u7c7b\u578b\u662f <code>Option&lt;Option&lt;i8&gt;&gt;</code></li> </ul>","tags":["rust"]},{"location":"notes/rcore/rustlings/#_1","title":"\u9519\u8bef\u5904\u7406","text":"<ul> <li><code>Result&lt;String, String&gt;</code>\uff1a\u7b2c\u4e00\u4e2a\u7c7b\u578b\u662f<code>Ok()</code>\u4e2d\u7684\u6570\u636e\u7c7b\u578b\uff0c\u7b2c\u4e8c\u4e2a\u7c7b\u578b\u662f<code>Err()</code>\u4e2d\u7684\u7c7b\u578b</li> </ul> Rust<pre><code>use std::fmt::Error;\n\npub fn generate_nametag_text(name: String) -&gt; Result&lt;String, String&gt; {\n    if name.is_empty() {\n        // Empty names aren't allowed.\n        Err(\"`name` was empty; it must be nonempty.\".into())\n    } else {\n        Ok(format!(\"Hi! My name is {}\", name))\n    }\n}\n</code></pre> <ul> <li><code>?</code>\u76f8\u5f53\u4e8e\u5982\u4e0b<code>match</code>\u5339\u914d\u4ee3\u7801\uff1b\u8c03\u7528<code>?</code>\u7684\u51fd\u6570\u8fd4\u56de\u503c\u5fc5\u987b\u4e3a<code>Result</code>\u6216<code>Option</code>\u7c7b\u578b\uff0c\u6709\u65f6\u5019\u9700\u8981\u6539\u5199<code>main</code>\u51fd\u6570\u8fd4\u56de\u503c\u7c7b\u578b</li> </ul> Rust<pre><code>let x = match qty {\n    Ok(x) =&gt; x * cost_per_item + processing_fee,\n    Err(e) =&gt; return Err(e),\n};\n\nOk(x)\n\nfn main() -&gt; Result&lt;(), ParseIntError&gt; {\n    let mut tokens = 100;\n    let pretend_user_input = \"8\";\n\n    let cost = total_cost(pretend_user_input)?;\n\n    if cost &gt; tokens {\n        println!(\"You can't afford that many!\");\n    } else {\n        tokens -= cost;\n        println!(\"You now have {} tokens.\", tokens);\n    }\n    Ok(())\n}\n</code></pre>","tags":["rust"]},{"location":"notes/rcore/rustlings/#test","title":"Test","text":"<ul> <li><code>#[should_panic]</code>\u7279\u6027\uff0c\u5141\u8bb8\u6d4b\u8bd5\u4ee3\u7801\u51fa\u73b0Panic\u800c\u4e0d\u7ec8\u6b62\u8fd0\u884c\u3002</li> </ul>","tags":["rust"]},{"location":"notes/rcore/rustlings/#_2","title":"\u8fed\u4ee3\u5668","text":"<ul> <li>\u6d88\u8d39\u8005\u9002\u914d\u5668\u662f\u6d88\u8d39\u6389\u8fed\u4ee3\u5668\uff0c\u7136\u540e\u8fd4\u56de\u4e00\u4e2a\u503c\u3002\u90a3\u4e48\u8fed\u4ee3\u5668\u9002\u914d\u5668\uff0c\u987e\u540d\u601d\u4e49\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u8fed\u4ee3\u5668\uff0c\u8fd9\u662f\u5b9e\u73b0\u94fe\u5f0f\u65b9\u6cd5\u8c03\u7528\u7684\u5173\u952e\uff1a<code>v.iter().map().filter()...</code>\u3002</li> <li>\u4e0e\u6d88\u8d39\u8005\u9002\u914d\u5668\u4e0d\u540c\uff0c\u8fed\u4ee3\u5668\u9002\u914d\u5668\u662f\u60f0\u6027\u7684\uff0c\u610f\u5473\u7740\u4f60\u9700\u8981\u4e00\u4e2a\u6d88\u8d39\u8005\u9002\u914d\u5668\u6765\u6536\u5c3e\uff0c\u6700\u7ec8\u5c06\u8fed\u4ee3\u5668\u8f6c\u6362\u6210\u4e00\u4e2a\u5177\u4f53\u7684\u503c</li> </ul> Rust<pre><code>let v1: Vec&lt;i32&gt; = vec![1, 2, 3];\n\nlet v2: Vec&lt;_&gt; = v1.iter().map(|x| x + 1).collect();\n\nassert_eq!(v2, vec![2, 3, 4]);\n</code></pre> <ul> <li><code>collect</code>\u4f1a\u81ea\u52a8\u6839\u636e\u6307\u5b9a\u7c7b\u578b\u5bf9\u6570\u636e\u8fdb\u884c\u6536\u96c6</li> </ul> Rust<pre><code>// Complete the function and return a value of the correct type so the test\n// passes.\n// Desired output: Ok([1, 11, 1426, 3])\nfn result_with_list() -&gt; Result&lt;Vec&lt;i32&gt;, DivisionError&gt; {\n    let numbers = vec![27, 297, 38502, 81];\n    let division_results = numbers.into_iter().map(|n| divide(n, 27)).collect();\n    division_results\n}\n\n// Complete the function and return a value of the correct type so the test\n// passes.\n// Desired output: [Ok(1), Ok(11), Ok(1426), Ok(3)]\nfn list_of_results() -&gt; Vec&lt;Result&lt;i32, DivisionError&gt;&gt; {\n    let numbers = vec![27, 297, 38502, 81];\n    let division_results = numbers.into_iter().map(|n| divide(n, 27)).collect();\n    division_results\n}\n</code></pre> <ul> <li><code>product</code>\u76f4\u63a5\u5c06\u8fed\u4ee3\u5668\u5143\u7d20\u76f8\u4e58\uff0c\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668</li> </ul> Rust<pre><code>pub fn factorial(num: u64) -&gt; u64 {\n    // Complete this function to return the factorial of num\n    // Do not use:\n    // - return\n    // Try not to use:\n    // - imperative style loops (for, while)\n    // - additional variables\n    // For an extra challenge, don't use:\n    // - recursion\n    // Execute `rustlings hint iterators4` for hints.\n    (1..num + 1).product()\n}// \u5b9e\u73b0\u9636\u4e58\n</code></pre> <ul> <li><code>flat_map</code>\u5c06\u5bf9\u5e94\u7684\u5143\u7d20\u5c55\u5e73\u6210\u4e3a\u65b0\u7684\u8fed\u4ee3\u5668</li> </ul> Rust<pre><code>fn count_collection_iterator(collection: &amp;[HashMap&lt;String, Progress&gt;], value: Progress) -&gt; usize {\n    // collection is a slice of hashmaps.\n    // collection = [{ \"variables1\": Complete, \"from_str\": None, ... },\n    //     { \"variables2\": Complete, ... }, ... ]\n    collection\n        .into_iter()\n        .flat_map(|x| x.values()) // \u8fd9\u91cc\u662fVec&lt;&amp;Progress&gt;\n        .filter(|&amp;progress| *progress == value)\n        .count()\n}\n</code></pre>","tags":["rust"]},{"location":"notes/rcore/rustlings/#threads","title":"Threads","text":"","tags":["rust"]},{"location":"notes/rcore/rustlings/#channel","title":"Channel","text":"<ul> <li>\u53d1\u9001\u8005\u4f1a\u83b7\u53d6tx\u6240\u6709\u6743\uff0c\u591a\u53d1\u9001\u8005\u7684\u7ebf\u7a0b\u9700\u8981\u62f7\u8d1dtx</li> </ul> Rust<pre><code>fn send_tx(q: Queue, tx: mpsc::Sender&lt;u32&gt;) -&gt; () {\n    let qc = Arc::new(q);\n    let qc1 = Arc::clone(&amp;qc);\n    let qc2 = Arc::clone(&amp;qc);\n    let tx1 = tx.clone();\n    thread::spawn(move || {\n        for val in &amp;qc1.first_half {\n            println!(\"sending {:?}\", val);\n            tx.send(*val).unwrap();\n            thread::sleep(Duration::from_secs(1));\n        }\n    });\n\n    thread::spawn(move || {\n        for val in &amp;qc2.second_half {\n            println!(\"sending {:?}\", val);\n            tx1.send(*val).unwrap();\n            thread::sleep(Duration::from_secs(1));\n        }\n    });\n}\n</code></pre>","tags":["rust"]},{"location":"notes/rcore/rustlings/#as_ref_mut","title":"as_ref_mut","text":"<ul> <li>AsRef \u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5141\u8bb8\u6211\u4eec\u4ee5\u7edf\u4e00\u7684\u65b9\u5f0f\u5904\u7406\u4e0d\u540c\u7c7b\u578b\u4e4b\u95f4\u7684\u8f6c\u6362\u3002\u901a\u8fc7\u5b9e\u73b0 AsRef trait\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u7c7b\u578b\u8f6c\u6362\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u5c06\u4e00\u4e2a\u7c7b\u578b\u8f6c\u6362\u4e3a\u53e6\u4e00\u4e2a\u7c7b\u578b\u7684\u5f15\u7528\uff0c\u800c\u4e0d\u662f\u62e5\u6709\u65b0\u7684\u6240\u6709\u6743\u3002</li> <li>\u5177\u4f53\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u6709\u4e00\u4e2a\u7c7b\u578b T\uff0c\u5e76\u4e14\u5e0c\u671b\u5c06\u5176\u8f6c\u6362\u4e3a\u7c7b\u578b U \u7684\u5f15\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0 AsRef <code>&lt;U&gt;</code> trait \u6765\u5b8c\u6210\u8fd9\u4e2a\u8f6c\u6362\u3002\u5728\u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u540d\u4e3a as_ref \u7684\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u8fd4\u56de\u7c7b\u578b &amp;U\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 as_ref \u65b9\u6cd5\u6765\u5c06 T \u8f6c\u6362\u4e3a U \u7684\u5f15\u7528\u3002</li> </ul> Rust<pre><code>// Obtain the number of bytes (not characters) in the given argument.\n// TODO: Add the AsRef trait appropriately as a trait bound.\nfn byte_counter&lt;T: AsRef&lt;str&gt;&gt;(arg: T) -&gt; usize {\n    arg.as_ref().as_bytes().len()\n}\n\n// Obtain the number of characters (not bytes) in the given argument.\n// TODO: Add the AsRef trait appropriately as a trait bound.\nfn char_counter&lt;T: AsRef&lt;str&gt;&gt;(arg: T) -&gt; usize {\n    arg.as_ref().chars().count()\n}\n</code></pre> <ul> <li>\u5f53\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u9700\u8981\u5c06\u4e00\u4e2a\u7c7b\u578b\u8f6c\u6362\u4e3a\u53e6\u4e00\u4e2a\u7c7b\u578b\u7684\u5f15\u7528\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 as_ref \u65b9\u6cd5\u6765\u8fdb\u884c\u8f6c\u6362\u3002\u8fd9\u5bf9\u4e8e\u63a5\u53d7\u4e0d\u540c\u7c7b\u578b\u5f15\u7528\u53c2\u6570\u7684\u51fd\u6570\u6216\u65b9\u6cd5\u975e\u5e38\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u4ee3\u7801\u6765\u5904\u7406\u4e0d\u540c\u7684\u7c7b\u578b\u3002</li> <li>AsMut <code>&lt;T&gt;</code> \u662f\u4e00\u4e2a\u6807\u51c6\u5e93\u4e2d\u5b9a\u4e49\u7684 trait\uff0c\u5b83\u5c06\u7c7b\u578b T \u8f6c\u6362\u4e3a\u4e00\u4e2a\u6307\u5411\u5176\u5185\u90e8\u503c\u7684\u53ef\u53d8\u5f15\u7528\u3002\u5f53\u6211\u4eec\u5728\u6cdb\u578b\u51fd\u6570\u4e2d\u4f7f\u7528 T: AsMut <code>&lt;u32&gt;</code> \u8fd9\u4e2a trait bound \u65f6\uff0c\u6211\u4eec\u544a\u8bc9\u7f16\u8bd1\u5668\u8981\u6c42 T \u7c7b\u578b\u5fc5\u987b\u5177\u5907\u5c06\u5176\u5185\u90e8\u503c\u4f5c\u4e3a u32 \u7c7b\u578b\u7684\u53ef\u53d8\u5f15\u7528\u7684\u80fd\u529b</li> </ul> Rust<pre><code>// Squares a number using as_mut().\n// TODO: Add the appropriate trait bound.\nfn num_sq&lt;T: AsMut&lt;u32&gt;&gt;(arg: &amp;mut T) {\n    // TODO: Implement the function body.\n    *arg.as_mut()*=*arg.as_mut()\n}\n</code></pre>","tags":["rust"]},{"location":"notes/rcore/rustlings/#_3","title":"\u7f16\u8bd1\u6210\u5e93","text":"<ul> <li><code>#[no_mangle]</code>\u4fdd\u8bc1rust\u7f16\u8bd1\u65f6\u51fd\u6570\u540d\u4e0d\u6539\u53d8</li> <li><code>#[link_name=\"str\"]</code>\u5728\u5916\u90e8\u5757\u5185\uff0c\u901a\u8fc7\u5c5e\u6027link_name\uff0c\u6307\u5b9a\u539f\u751f\u5e93\u4e2d\u51fd\u6570\u6216\u9759\u6001\u5bf9\u8c61\u7684\u540d\u79f0\uff0c\u7f16\u8bd1\u5668\u6839\u636e\u5b83\u53ef\u4ee5\u4e3a\u5916\u90e8\u5757\u94fe\u63a5\u539f\u751f\u5e93\u5e76\u5bfc\u5165\u8be5\u540d\u79f0\u5b9a\u4e49\u7684\u51fd\u6570\u6216\u9759\u6001\u5bf9\u8c61</li> </ul> Rust<pre><code>// \u6807\u51c6\u5e93&lt;stdlib.h&gt;\u5185\u7f6e\u7684abs\u51fd\u6570\nextern \"C\" {\n    #[link_name = \"abs\"]\n    fn abs_in_rust(input: i32) -&gt; i32;\n}\n\nextern \"Rust\" {\n    fn my_demo_function(a: u32) -&gt; u32;\n    #[link_name = \"my_demo_function\"]\n    fn my_demo_function_alias(a: u32) -&gt; u32;\n}\n\nmod Foo {\n    // No `extern` equals `extern \"Rust\"`.\n    #[no_mangle]\n    pub fn my_demo_function(a: u32) -&gt; u32 {\n        a\n    }\n}\n</code></pre>","tags":["rust"]},{"location":"notes/rcore/rustlings/#_4","title":"\u53cd\u8f6c\u53cc\u5411\u94fe\u8868","text":"<ul> <li>\u4ece\u5934\u5f00\u59cb\u904d\u5386\u7ed3\u70b9\uff0c\u5bf9\u6bcf\u4e2a\u7ed3\u70b9\u4ea4\u6362<code>prev</code>\u548c<code>next</code>\u6307\u9488</li> <li>\u6700\u540e\u5bf9\u6574\u4e2a\u94fe\u8868\u4ea4\u6362<code>start</code>\u548c<code>end</code></li> </ul> Rust<pre><code>pub fn reverse(&amp;mut self) {\n    // TODO\n    let mut current_ptr = self.start;\n    while let Some(node_ptr) = current_ptr {\n        let mut node = unsafe { *node_ptr.as_ptr().as_mut().unwrap() };\n        std::mem::swap(&amp;mut node.prev, &amp;mut node.next);\n        current_ptr = node.prev;\n    }\n    std::mem::swap(&amp;mut self.start, &amp;mut self.end);\n}\n</code></pre>","tags":["rust"]},{"location":"summary/","title":"index","text":""},{"location":"summary/#summaries","title":"Summaries \ud83d\uddd3\ufe0f","text":"\u300e \u0915\u093f\u0928\u094d\u0928\u0930\u093f\u092f \u092e\u092e \u0924\u0923\u094d\u0939\u093e \u300f"},{"location":"summary/2025/semester-plan/","title":"\u7814\u4e00\u4e0b\u5b66\u671f\u89c4\u5212","text":"<p> \u7ea6 138 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <code>#plan</code> <p>\u7814\u4e00\u4e0b\u5b66\u4e60\u89c4\u5212\uff0c\u5fc5\u987b\u81f3\u5c11\u5b8c\u6210\u4e24\u4e2a\u9879\u76ee\uff0c\u540e\u7eed\u6709\u65b0\u7684\u9879\u76ee\u53ef\u4ee5\u8003\u8651\u66ff\u6362\u6389</p>","tags":["plan"]},{"location":"summary/2025/semester-plan/#project","title":"Project","text":"<ul> <li>bustub</li> <li>tinykv</li> <li>miniLSM (\u53c2\u8003 leveldb)</li> <li>\u81ea\u5df1\u5199\u4e00\u4e2a\u7c7b\u4f3c milvus \u7684 Distributed Vector DB\uff0c\u878d\u5408\u4e4b\u524d\u770b\u7684\u5411\u91cf\u641c\u7d22\u4f18\u5316\u7b97\u6cd5</li> <li>\u57fa\u4e8e\u5411\u91cf\u6570\u636e\u5e93\u642d\u5efa\u4e00\u4e2a agentic rag</li> </ul>","tags":["plan"]},{"location":"summary/2025/semester-plan/#ps","title":"\u8bba\u6587\u9605\u8bfb(PS: \u987a\u4fbf\u63d0\u5347\u82f1\u8bed)","text":"<ul> <li>\u4e00\u5468 1-2 \u7bc7\u611f\u5174\u8da3\u7684\u8bba\u6587(\u5206\u5e03\u5f0f\u6216\u8005\u6570\u636e\u5e93\u9886\u57df)</li> </ul>","tags":["plan"]},{"location":"tags/","title":"Tags","text":""},{"location":"tags/#tags","title":"Tags","text":"<p>{{ tag_content }}</p>"}]}