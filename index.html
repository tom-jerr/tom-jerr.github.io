<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>LZY的Code生活 - 桃花坞里桃花庵，桃花庵里桃花仙；桃花仙人中桃树，又摘桃花换酒钱</title><meta name="author" content="LZY"><meta name="copyright" content="LZY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="LZY的Code生活">
<meta property="og:url" content="http://tom-jerr.github.io/index.html">
<meta property="og:site_name" content="LZY的Code生活">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://tom-jerr.github.io/img/avatar.jpg">
<meta property="article:author" content="LZY">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tom-jerr.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://tom-jerr.github.io/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'LZY的Code生活',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-11-21 21:45:17'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><nav id="nav"><span id="blog-info"><a href="/" title="LZY的Code生活"><span class="site-name">LZY的Code生活</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">LZY的Code生活</h1><div id="site_social_icons"><a class="social-icon" href="https://github.com/tom-jerr" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/2584074296@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2024/10/31/6.s081/xv6/" title="无题"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/6.s081/xv6/" title="无题">无题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-31T02:45:44.569Z" title="发表于 2024-10-31 10:45:44">2024-10-31</time></span></div><div class="content">xv6链接脚本OUTPUT_ARCH( &quot;riscv&quot; )ENTRY( _entry )SECTIONS&#123;  /*   * ensure that entry.S / _entry is at 0x80000000,   * where qemu&#x27;s -kernel jumps.   */  . = 0x80000000;  .text : &#123;    *(.text .text.*)    . = ALIGN(0x1000);    _trampoline = .;    *(trampsec)    . = ALIGN(0x1000);		// trampoline不超过一页    ASSERT(. - _trampoline == 0x1000, &quot;error: trampoline larger than one page&quot;);    PROVIDE(etext = .);		// 可以在c中进行引用，text段的结尾  &#125;  .rodata : &#123;    . = ALIGN(16);    ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/10/31/CMU15445/lab/lab1_buffer_pool/" title="无题"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/CMU15445/lab/lab1_buffer_pool/" title="无题">无题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-30T16:37:18.218Z" title="发表于 2024-10-31 00:37:18">2024-10-31</time></span></div><div class="content">Buffer PoolTask 1 Extendible Hash Table基本概念
全局深度（global depth），局部深度（local depth）以及桶（bucket）。
桶就是存记录（records）的地方，我可以往桶里放一条，两条，三条。但要规定好最多能装几条。这个例子里我们规定最多能装2条。在图里你能看到bucket 1只有两行。下图这个就是可拓展哈希的初始状态。


插入数据。
插入Comp.Sci和Finance这两条。现在还不涉及全局深度和局部深度的改变。两条新记录（record）就直接往里放就行。



插入Music。这时一个桶的条数大于它的上限（2条），所以要开始分裂。如何分裂是根据哈希值（hash value）决定的。取哈希值第一位。哈希值是二进制数，第一位只有两种可能，0和1。Comp.Sci是1，Finance是1，Music是0。很简单的把是1的放在一个桶（bucket）里，是0的放在另一个桶（bucket）里。由于我们用了哈希值的第一位，所以全局深度（global depth）变成1。这里做一下全局深度和局部深度的区分。两个都表示用了几位哈希值 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/10/31/CMU15445/10-Join%20Algorithm/" title="10-Join Algorithm"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="10-Join Algorithm"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/CMU15445/10-Join%20Algorithm/" title="10-Join Algorithm">10-Join Algorithm</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">10-Join Algorithm10.1 join algorithms
尽可能选择较小的表作为外围表


10.2 Join opetatorsOutputdata

Cost Analysis CriteriaNested Loop JoinNested Loop Join
已知表非常小的情况下，可以使用 nested loop join，可以适配 L3 缓存



Index Nested Loop Join
Block Nested loop join


Nested Loop Join SummaryKey Takeaways

选择更小的表作为 Outer table尽可能在 bufferpool 中缓存 outer table使用索引快速访问 inner table

Algorithms

NaiveBlockIndex

Sort-Merge Join
Sort



Merge



此时 R 中 id 为 200；S 的 id 比 200 大，需要回溯，但是由于表是有序的，不必像 nested loop join 回溯到开头只需要回溯到上一个不大于 R.id  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/10/31/CMU15445/11-Query_Execution/" title="11 Query Execution"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="11 Query Execution"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/CMU15445/11-Query_Execution/" title="11 Query Execution">11 Query Execution</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">11. Query ExecutionProcessing ModelsIterator Model迭代器模型，也叫做火山或者流水线模型

大量函数调用，指令缓存会很快失效


Materialization Model生成所有数据然后返回给上层

对于 OLTP 表现不错，因为没有很大的表需要传递


Vectorized&#x2F;Batch MOdel
在物化模型和火山模型间是一个良好的平衡可以使用 SIMD 指令加速


Plan Processing Direction
自上而下对于上面的模型来说更加自然


Access MethodsSequential Scan
Optimization
Prefetching
Buffer Pool Bypass
Parallelization
Heap Clustering
只是取回 RID，最后才取回真正的数据


Late Materialization
Data Skipping

Data Sipping
ZONE MAPS
one zone map in one zone，zone 的大小取决于我们的实现，一般为页当 zo ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/10/31/CMU15445/13-Concurrency_Control_Theory/" title="13 Concurrency Control Theory"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="13 Concurrency Control Theory"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/CMU15445/13-Concurrency_Control_Theory/" title="13 Concurrency Control Theory">13 Concurrency Control Theory</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">Concurrency Control TheoryTransaction in sql
ACID
Mechanisms for ensuring atomicityLogging
LSM tree 是针对单个表文件配置的；而 logging 是针对全局跨文件设置的


Shadow Paging
即使改变几字节，也会复制整个页


Consistency
很多系统采用最终一致性，但在过程中可能出现不一致的情况


Mechanisms for ensuring isolation

Formal Properties of schedules
Unreaptable Read
读写冲突的情况下，同一事务在两次读取同一个值时读到两个不同的值


Dirty Read
写读冲突下，另一个事务读取了其他事务并未提交的值并提交


Lost Update
写写冲突导致事务更新值消失


Dependency Graph &amp; Confict Serializable
大多数 DBMS 实现冲突可串行化如果图中出现环路，说明这个调度是 bad schedule


Transaction ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/10/31/CMU15445/14-Two_Phase_Lock/" title="14 Two Phase Lock"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="14 Two Phase Lock"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/CMU15445/14-Two_Phase_Lock/" title="14 Two Phase Lock">14 Two Phase Lock</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">Two Phase Lock Concurrency ControlExecuting with locks
事务需要锁(upgrade)锁管理器为请求申请锁事务释放锁锁管理器更新内部的 lock tablelock table 跟踪每个事务持有什么锁，并正在等待什么锁


Locks vs. Latcheslocks 保护数据库磁盘上的对象；lock manager 是内存数据结构，该结构使用 latch 进行保护

Basic Lock Types
S-LOCK: shared locks for reads
X-LOCK: Exclusive lock for writes


Two-Phase locking(2PL)

是一种并发控制协议该协议不需要知道事务将要执行的所有查询**两阶段锁协议可能会发生死锁**，但可以通过适当的策略（如死锁检测和预防）来处理和避免。


Growing

每个事务向 DBMS 的锁管理器请求它所需要的锁锁管理器同意或拒绝锁请求


Shrinking

事务在该阶段仅仅释放或者对锁降级不可以再次申请锁



Executing with 2P ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/10/31/CMU15445/12-Query_Plan&amp;Optimization/" title="12 Query Planning and Optimization"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="12 Query Planning and Optimization"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/CMU15445/12-Query_Plan&amp;Optimization/" title="12 Query Planning and Optimization">12 Query Planning and Optimization</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">Query Planning and Optimization
catalog 是一个记录元数据信息的文件


The Physical Plan
Query Optimization(QO)
Heuristics&#x2F;Rules
重写查询来去除那些无效的条件
这些技巧需要访问 catalog，但是它们不需要访问数据

Predicate Pushdown
Replace Cartesian Product
Projection Pushdown
Equivalence
Architecture Overview
Cost-based Search
使用一个模型来预测执行一个计划的成本
遍历多种计划，选择一个成本最小的计划来执行

Bottom-up Optimization
使用动态规划，自底向上构建查询计划成本最低的计划



single-relation query palnning



system R optimization 将逻辑计划构建为左深树


Top-Down Optimization
自顶向下的优化控制权更多，我们可以从一个计划开始逐步细化过程


N ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/10/31/CMU15445/15-Timestamp_Ordering_Concurrency/" title="15 Timestamp Ordering Concurrency Control"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="15 Timestamp Ordering Concurrency Control"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/CMU15445/15-Timestamp_Ordering_Concurrency/" title="15 Timestamp Ordering Concurrency Control">15 Timestamp Ordering Concurrency Control</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">Timestamp Ordering Concurrency Control
2PL 和时间戳排序算法是悲观并发控制算法还有乐观并发控制算法


T&#x2F;O Concurrency Control
使用时间戳来确保事务执行的顺序如果 TS($T_I$) &lt; TS($T_j$)，DBMS 需要确保执行的调度必须和$T_i$发生在$T_j$前的串行化调度相同

Timestamp allocation
System&#x2F;Wall Clock
Logical Counter
Hybrid

Basic T&#x2F;O
事务读取和写入对象不需要锁


W-TS(X)：是最后成功写入的事务的时间戳


R-TS(X)：是最后成功读取的事务的时间戳


如果事务尝试获取时间戳在自己之后的对象，会 abort 然后 restart


为每个事务保存数据副本开销很大；长时间运行的事务很可能会被饿死，新事务可能会使得长时间运行的事务 abort 并 restart

Reads
会为 X 创建一个本地副本来确保$T_i$可重复读


Writes


Optimistic Conc ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/10/31/CMU15445/16-Mult-Version_Concurrency/" title="16 Multi-Version Concurrency"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="16 Multi-Version Concurrency"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/CMU15445/16-Mult-Version_Concurrency/" title="16 Multi-Version Concurrency">16 Multi-Version Concurrency</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">Mutli-Version Concurrency
DBMS 有多个物理版本和一个逻辑版本


一个事务写入时会创建一个新版本；读取时会读取该事务开始时最新的版本

MVCC 实际上是维护多个版本的机制；而版本之间的并发正确性仍然需要并发控制协议来维护


writers do not block readers and readers do not block writers


只读事务可以不获取锁读取一个一致性的快照

MVCC example
Write Skew Anomaly
快照隔离并不能确保可串行性；可能出现这种写偏斜问题


Version Storage
Append-Only Storage
可以看作是一个多版本的单链表


Oldest to Newest(O2N)
Newest to Oldest(N2O)

Time-Travel Storage
为本来没有做 MVCC 的系统提供的一种 MVCC 机制


Delta Storage
增量存储：只存储更改后的列


Garbage Collection
Tuple-level GC
后台清理：只扫描被修改的 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/10/31/CMU15445/17-Database_Logging/" title="17 Database Logging"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="17 Database Logging"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/31/CMU15445/17-Database_Logging/" title="17 Database Logging">17 Database Logging</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">Database LoggingCrash Recovery
Actions during normal txn processing to ensure that the DBMS can recover from a failure
Actions after a failure to recovver the database to a state that ensures atomicity, consistency, and durability

Failure ClassificationTransaction Failures
Logical Errors: 事务因为一些内部原因没有完成（完整性约束失效）
Internal State Errors: DBMS 必须终止一个活跃的事务因为一个错误的条件（死锁）

System Failures
Software Failure: OS 或者 DBMS 实现的错误
Hardware Failure:
the computer hosting the DBMS crahsed(电源线被拉了)Fail-stop Assumpt ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/#content-inner">8</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">LZY</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/tom-jerr"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/tom-jerr" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/2584074296@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Stay hungry, Stay foolish</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/6.s081/xv6/" title="无题"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/10/31/6.s081/xv6/" title="无题">无题</a><time datetime="2024-10-31T02:45:44.569Z" title="发表于 2024-10-31 10:45:44">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/lab/lab1_buffer_pool/" title="无题"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/lab/lab1_buffer_pool/" title="无题">无题</a><time datetime="2024-10-30T16:37:18.218Z" title="发表于 2024-10-31 00:37:18">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/10-Join%20Algorithm/" title="10-Join Algorithm"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="10-Join Algorithm"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/10-Join%20Algorithm/" title="10-Join Algorithm">10-Join Algorithm</a><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/11-Query_Execution/" title="11 Query Execution"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="11 Query Execution"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/11-Query_Execution/" title="11 Query Execution">11 Query Execution</a><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/13-Concurrency_Control_Theory/" title="13 Concurrency Control Theory"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="13 Concurrency Control Theory"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/13-Concurrency_Control_Theory/" title="13 Concurrency Control Theory">13 Concurrency Control Theory</a><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CS-COURSE/"><span class="card-category-list-name">CS_COURSE</span><span class="card-category-list-count">22</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CV/"><span class="card-category-list-name">CV</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/DB/"><span class="card-category-list-name">DB</span><span class="card-category-list-count">17</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Knowledge/"><span class="card-category-list-name">Knowledge</span><span class="card-category-list-count">25</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Lab/"><span class="card-category-list-name">Lab</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/OS/"><span class="card-category-list-name">OS</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Project/"><span class="card-category-list-name">Project</span><span class="card-category-list-count">5</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/CS61C/" style="font-size: 1.4em; color: #99a5b6">CS61C</a> <a href="/tags/rust/" style="font-size: 1.3em; color: #99a1ac">rust</a> <a href="/tags/CSAPP/" style="font-size: 1.3em; color: #99a1ac">CSAPP</a> <a href="/tags/xv6/" style="font-size: 1.3em; color: #99a1ac">xv6</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.2em; color: #999da3">并发</a> <a href="/tags/linux/" style="font-size: 1.1em; color: #999">linux</a> <a href="/tags/C/" style="font-size: 1.5em; color: #99a9bf">C++</a> <a href="/tags/%E5%8D%8F%E7%A8%8B/" style="font-size: 1.2em; color: #999da3">协程</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><span class="card-archive-list-count">17</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><span class="card-archive-list-count">31</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">80</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-11-21T13:45:17.025Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By LZY</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">盲僧，你发现了华点</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>