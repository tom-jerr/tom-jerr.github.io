<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>LZY的Code生活 - 桃花坞里桃花庵，桃花庵里桃花仙；桃花仙人中桃树，又摘桃花换酒钱</title><meta name="author" content="LZY"><meta name="copyright" content="LZY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="LZY的Code生活">
<meta property="og:url" content="http://tom-jerr.github.io/page/6/index.html">
<meta property="og:site_name" content="LZY的Code生活">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://tom-jerr.github.io/img/avatar.jpg">
<meta property="article:author" content="LZY">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tom-jerr.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://tom-jerr.github.io/page/6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'LZY的Code生活',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-11-21 21:36:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><nav id="nav"><span id="blog-info"><a href="/" title="LZY的Code生活"><span class="site-name">LZY的Code生活</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">LZY的Code生活</h1><div id="site_social_icons"><a class="social-icon" href="https://github.com/tom-jerr" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/2584074296@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/18/CSAPP/7-%E9%93%BE%E6%8E%A5/" title="csapp-7-链接"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="csapp-7-链接"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/18/CSAPP/7-%E9%93%BE%E6%8E%A5/" title="csapp-7-链接">csapp-7-链接</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-18T14:17:49.000Z" title="发表于 2023-09-18 22:17:49">2023-09-18</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15-213/">CMU15-213</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CSAPP/">CSAPP</a></span></div><div class="content">Chapter 7 链接静态链接
符号解析
重定位
编译器和汇编器生成.text和.data
链接器通过把每个符号定义和一个内存位置关联，对这些节进行重定位；修改引用，让符号指向这个内存位置



可重定位目标文件
.rel.*：不同节的重定位信息
.line：原始C程序和.text节中机器指令的映射，”-g”得到



.bss：未初始化的静态变量，以及初始化为0的全局或静态变量
COMMON：未初始化的全局变量

解析多重定义符号
不允许有多个同名的强符号（定义并初始化）
强弱同在，选强符号
只有弱符号，随便选一个弱符号

重定位
重定位节和符号定义
将相同类型的节合并为同一类型的新的聚合节
每条指令和全局变量有唯一的运行时内存地址


重定位节的符号引用
修改代码节和数据节中的对符号的引用，指向正确的运行时地址



重定位算法// relocation entrytypedef struct &#123;    long offset;	// 重定位的偏移    long type:32,	// 重定位类型    	symbol:32;	// 符号表索引    long add ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/18/CSAPP/8-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/" title="csapp-8-异常控制流"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="csapp-8-异常控制流"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/18/CSAPP/8-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/" title="csapp-8-异常控制流">csapp-8-异常控制流</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-18T14:17:49.000Z" title="发表于 2023-09-18 22:17:49">2023-09-18</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15-213/">CMU15-213</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CSAPP/">CSAPP</a></span></div><div class="content">Chapter 8 异常控制流</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/16/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/" title="8-Coordination"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="8-Coordination"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/16/6.s081/8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E5%94%A4%E9%86%92/" title="8-Coordination">8-Coordination</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-16T14:17:49.000Z" title="发表于 2023-09-16 22:17:49">2023-09-16</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/6-s081/">6.s081</a></span></div><div class="content">Coordination1 进程切换过程
一个进程出于某种原因想要进入休眠状态，比如说出让 CPU 或者等待数据，它会先获取自己的锁；
之后进程将自己的状态从 RUNNING 设置为 RUNNABLE；
之后进程调用 switch 函数，其实是调用 sched 函数在 sched 函数中再调用的 switch 函数；
switch 函数将当前的线程切换到调度器线程；
调度器线程之前也调用了 switch 函数，现在恢复执行会从自己的 switch 函数返回；
返回之后，调度器线程会释放刚刚出让了 CPU 的进程的锁

// 需要切换的进程acquire(&amp;p-&gt;lock);p-&gt;state = RUNNABLE;swtch();// 调度器进程swtch();release(&amp;p-&gt;lock);


在进程切换的最开始，进程先获取自己的锁，并且直到调用 swtch 函数时也不释放锁。而另一个线程，也就是调度器线程会在进程的线程完全停止使用自己的栈之后，再释放进程的锁。

如果在 swtch()前释放锁，可能有另一个 CPU 核心运行同样的进程；会造成程 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/16/CMU15445/5-Buffer%20Pool/" title="5_Database_Storage"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="5_Database_Storage"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/16/CMU15445/5-Buffer%20Pool/" title="5_Database_Storage">5_Database_Storage</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-16T14:17:49.000Z" title="发表于 2023-09-16 22:17:49">2023-09-16</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">5 Buffer Pool
在磁盘中将文件切成一个个页
在内存中开辟一个缓存池；加快对页的访问

5.1 Buffer PoolOrganization
是一个有着固定页数的数组；每个数组元素叫 frame (帧)

通过 page table 去索引内存池中的页

page table 可以 pin 某个页，也可以锁住某个索引


Mete-Data
页表跟踪现在在内存中的页

Dirty flag

Pin&#x2F;Reference Counter


locks vs latches
locks
保护事务中的内容
在事务期间持有锁
需要回滚


latches
保护临界区数据结构
在操作期间持有锁
不必回滚改变



page dictionary vs. page table
page dic
在磁盘中，标记每个页在那个文件中


page table
在内存中，标记页在 Buffer Pool 的什么位置



5.2 Allocation Policies
全局：同一安排空间
局部：为某个线程分配帧不考虑并发的其他线程

5.3 Buffer Pool Optimiza ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/15/6.s081/labs/lab1-util/" title="util lab"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="util lab"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/15/6.s081/labs/lab1-util/" title="util lab">util lab</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-15T15:57:49.000Z" title="发表于 2023-09-15 23:57:49">2023-09-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Lab/">Lab</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/6-s081/">6.s081</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/C/">C</a></span></div><div class="content">Lab1 Util1 sleep2Results== Test sleep, no arguments == $ make qemu-gdbsleep, no arguments: OK (5.1s) == Test sleep, returns == $ make qemu-gdbsleep, returns: OK (0.8s) == Test sleep, makes syscall == $ make qemu-gdbsleep, makes syscall: OK (1.0s) == Test pingpong == $ make qemu-gdbpingpong: OK (1.0s) == Test primes == $ make qemu-gdbprimes: OK (1.1s) == Test find, in current directory == $ make qemu-gdbfind, in current directory: OK (1.0s) == Test find, recursive == $ make qemu-gdbfind, recursiv ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/15/CMU15445/4-Database_Storage_II/" title="4_Database_Storage II"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="4_Database_Storage II"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/15/CMU15445/4-Database_Storage_II/" title="4_Database_Storage II">4_Database_Storage II</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-15T15:49:49.000Z" title="发表于 2023-09-15 23:49:49">2023-09-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">4 Database Storage II
数据库负责将非易失性存储中的数据和内存进行交互

4.1 problem with slotted page design
Fragmentation (碎片)
Useless Disk I&#x2F;O
Random Disk I&#x2F;O (update 20 tuples on 20 pages)

4.2 Log-structed storage更多使用 KV 数据库上，只有一个键一个值

不存数据，存放数据的操作（insert, delete, update）

直接在后面加上新操作，不检查前面的所有操作是否正确




读取一个记录，从后向前进行扫描记录；找到需要的数据



考虑对相同 id 的 log record 进行索引



因为 Log 数据会非常大，需要周期性对页内进行压缩


Log-Structured Compaction
Level Compaction

将不同的块中记录连接起来，将压缩后的结果存入下一层
从 level0 开始向下读，一直到最后一层



Universal Compaction

尽 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/15/6.s081/7-%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2/" title="7-进程切换"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="7-进程切换"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/15/6.s081/7-%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2/" title="7-进程切换">7-进程切换</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-15T14:17:49.000Z" title="发表于 2023-09-15 22:17:49">2023-09-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/6-s081/">6.s081</a></span></div><div class="content">进程切换
P1 进入内核，切换到调度器进程，调度器进程切换到 P2

核心函数为 swtch()函数；该函数保存并加载部分寄存器的值（RISC-V 中存在调用者保存并恢复的寄存器（caller-saved registers），不需要保存全部寄存器）


切换过程
yield 调用了 sched 函数

sched 函数进行合理性检查，最后调用 swtch 函数交换当前进程的上下文和 CPU 调度线程的上下文，返回地址为切换后上下文的 ra 寄存器存的值；实际上是 scheduler 函数
voidsched(void)&#123;  int intena;  struct proc *p = myproc();  if(!holding(&amp;p-&gt;lock))    panic(&quot;sched p-&gt;lock&quot;);  if(mycpu()-&gt;noff != 1)    panic(&quot;sched locks&quot;);  if(p-&gt;state == RUNNING)    panic(&quot;sched running ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/12/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/" title="csapp-6-存储器层次结构"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="csapp-6-存储器层次结构"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/12/CSAPP/6-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/" title="csapp-6-存储器层次结构">csapp-6-存储器层次结构</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-12T14:17:49.000Z" title="发表于 2023-09-12 22:17:49">2023-09-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15-213/">CMU15-213</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CSAPP/">CSAPP</a></span></div><div class="content">Chapter 6 存储器层次结构RAM（随机访问存储器）
SRAM：快但贵；作为高速缓存
DRAM：作为主存
分时复用地址线；减少引脚数量，增加访问时间
首先将一整行复制到一个内部行缓冲区；接着再从行缓冲区中复制出一个单元



非易失性存储器
主要是 ROM，但是 ROM 中有的类型实际上既可以读也可以写


固态硬盘
Solid State Disk (SSD)，是基于闪存的存储技术
闪存芯片替代传统旋转磁盘中的机械驱动器
闪存翻译层是一个硬件&#x2F;固件设备，将对逻辑块的请求翻译成对底层物理设备的访问
SSD以页为读写单位
将擦除平均分布到所有的块上





随机写很慢的原因
擦除块需要相对较长的时间
如果需要修改数据，需要把所有带有用数据的页复制到一个新的块上后；重新进行读写



存储器存储结构
cache
在CPU寄存器和主存中插入了一个小的SRAM高速缓存存储器，称为L1 cache；4 clock
在L1 cache和 main memory中插入L2 cache，10 clock
在L2 cache和L3 cache中插入L3 cache，50 clock

 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/12/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/" title="csapp-5-优化程序性能"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="csapp-5-优化程序性能"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/12/CSAPP/5-%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD/" title="csapp-5-优化程序性能">csapp-5-优化程序性能</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-12T11:49:49.000Z" title="发表于 2023-09-12 19:49:49">2023-09-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15-213/">CMU15-213</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CSAPP/">CSAPP</a></span></div><div class="content">Chapter 5 优化程序性能编译器的能力和局限性
内存别名使用：两个指针可能指向同一个内存位置
可能出现这种问题，编译器必须进行检查和处理，这限制了可能的优化
restrict 关键字，可以告知编译器两个指针不能指向同一块内存，编译器可以进行进一步的优化

内联函数替换（inline substitution）
将函数调用替换成函数体；减轻调用的深度

消除循环中的低效率
比如将复杂的函数加入循环；此时考虑设置局部变量
消除循环中的过程调用；考虑返回值来优化

void combine3(vec_ptr v, data_t* dest) &#123;  long i;  long length = vec_length(v);  // 消除过程调用  data_t* data = get_vec_start(v);  *dest = IDENT;  for(int i = 0; i &lt; length; ++i) &#123;    *dest = *dest OP data[i];  &#125;&#125;


上述过程汇编是会发现，每次累积变量的数值都要读入内存再写回内存 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/11/6.s081/1-OS%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7/" title="1-OS的隔离性"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="1-OS的隔离性"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/6.s081/1-OS%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7/" title="1-OS的隔离性">1-OS的隔离性</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/6-s081/">6.s081</a></span></div><div class="content">OS 的隔离性
需要不同的应用程序之间有强隔离性
需要 OS 与应用程序间也有强隔离性

OS 隔离保证 multiplexing 和内存隔离

multiplexing（CPU 在多进程同分时复用）：不论应用程序在执行什么操作，multiplexing 都会迫使应用程序时不时的释放 CPU，这样其他的应用程序才能运行。
不同应用程序之间的内存是隔离的，应用程序之间不会相互覆盖

硬件支持强隔离
uer&#x2F;kernel mode
在处理器里面有一个 flag。在处理器的一个 bit，当它为 1 的时候是 user mode，当它为 0 时是 kernel mode。当处理器在解析指令时，如果指令是特殊权限指令，并且该 bit 被设置为 1


virtual memory
处理器包含了 page table，而 page table 将虚拟内存地址与物理内存地址做了对应
每一个进程只能访问出现在自己 page table 中的物理内存


内核：Trusted Computing Base (TCB)
宏内核：所有操作系统服务都在 kernel mode
微内核：将大部分的操作 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/5/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/#content-inner">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/#content-inner">7</a><a class="page-number" href="/page/8/#content-inner">8</a><a class="extend next" rel="next" href="/page/7/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">LZY</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/tom-jerr"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/tom-jerr" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/2584074296@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Stay hungry, Stay foolish</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/6.s081/xv6/" title="无题"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/10/31/6.s081/xv6/" title="无题">无题</a><time datetime="2024-10-31T02:45:44.569Z" title="发表于 2024-10-31 10:45:44">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/lab/lab1_buffer_pool/" title="无题"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/lab/lab1_buffer_pool/" title="无题">无题</a><time datetime="2024-10-30T16:37:18.218Z" title="发表于 2024-10-31 00:37:18">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/10-Join%20Algorithm/" title="10-Join Algorithm"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="10-Join Algorithm"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/10-Join%20Algorithm/" title="10-Join Algorithm">10-Join Algorithm</a><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/11-Query_Execution/" title="11 Query Execution"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="11 Query Execution"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/11-Query_Execution/" title="11 Query Execution">11 Query Execution</a><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/13-Concurrency_Control_Theory/" title="13 Concurrency Control Theory"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="13 Concurrency Control Theory"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/13-Concurrency_Control_Theory/" title="13 Concurrency Control Theory">13 Concurrency Control Theory</a><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CS-COURSE/"><span class="card-category-list-name">CS_COURSE</span><span class="card-category-list-count">22</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CV/"><span class="card-category-list-name">CV</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/DB/"><span class="card-category-list-name">DB</span><span class="card-category-list-count">17</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Knowledge/"><span class="card-category-list-name">Knowledge</span><span class="card-category-list-count">25</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Lab/"><span class="card-category-list-name">Lab</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/OS/"><span class="card-category-list-name">OS</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Project/"><span class="card-category-list-name">Project</span><span class="card-category-list-count">5</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/CS144/" style="font-size: 1.1em; color: #999">CS144</a> <a href="/tags/C/" style="font-size: 1.5em; color: #99a9bf">C++</a> <a href="/tags/CSAPP/" style="font-size: 1.23em; color: #999ea6">CSAPP</a> <a href="/tags/MESI/" style="font-size: 1.1em; color: #999">MESI</a> <a href="/tags/zero-copy/" style="font-size: 1.1em; color: #999">zero copy</a> <a href="/tags/Hardware/" style="font-size: 1.1em; color: #999">Hardware</a> <a href="/tags/CS61C/" style="font-size: 1.37em; color: #99a4b2">CS61C</a> <a href="/tags/CMU15-213/" style="font-size: 1.23em; color: #999ea6">CMU15-213</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><span class="card-archive-list-count">17</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><span class="card-archive-list-count">31</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">80</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-11-21T13:36:34.371Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By LZY</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">盲僧，你发现了华点</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>