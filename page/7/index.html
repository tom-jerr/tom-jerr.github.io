<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>LZY的Code生活 - 桃花坞里桃花庵，桃花庵里桃花仙；桃花仙人中桃树，又摘桃花换酒钱</title><meta name="author" content="LZY"><meta name="copyright" content="LZY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="LZY的Code生活">
<meta property="og:url" content="http://tom-jerr.github.io/page/7/index.html">
<meta property="og:site_name" content="LZY的Code生活">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://tom-jerr.github.io/img/avatar.jpg">
<meta property="article:author" content="LZY">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tom-jerr.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://tom-jerr.github.io/page/7/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'LZY的Code生活',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-11-21 21:36:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><nav id="nav"><span id="blog-info"><a href="/" title="LZY的Code生活"><span class="site-name">LZY的Code生活</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">LZY的Code生活</h1><div id="site_social_icons"><a class="social-icon" href="https://github.com/tom-jerr" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/2584074296@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/11/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/" title="2-虚拟内存的实现"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2-虚拟内存的实现"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/6.s081/2-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0/" title="2-虚拟内存的实现">2-虚拟内存的实现</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/6-s081/">6.s081</a></span></div><div class="content">虚拟内存实现页表
硬件通过处理器和 MMU（Memory Management Unit）实现

任何一条地址应该认为是虚拟内存地址；该地址会转到 MMU，MMU 翻译为物理地址，从物理地址加载

MMU 只是去查看 page table，page table 存在于内存中

虚拟内存地址只使用了低 39bit；低 12bit 作为页内地址偏移（offset），高 27bit 是索引页的 index，实际上是由 3 个 9bit 的数字组成（L2，L1，L0）。前 9 个 bit 被用来索引最高级的 page directory（注：通常 page directory 是用来索引 page table 或者其他 page directory 物理地址的表单

用 44bit 的 PPN，再加上 12bit 的 0，这样就得到了下一级 page directory 的 56bit 物理地址。这里要求每个 page directory 都与物理 page 对齐




3 级页表由硬件实现的，所以 3 级 page table 的查找都发生在硬件中。MMU 是硬件的一部分而不是操作系统的一 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/11/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/" title="5-硬件中断"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="5-硬件中断"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/6.s081/5-%E7%A1%AC%E4%BB%B6%E4%B8%AD%E6%96%AD/" title="5-硬件中断">5-硬件中断</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/6-s081/">6.s081</a></span></div><div class="content">Interrupts
中断与系统调用区别
asynchronous，异步，与当前运行在 CPU 的进程无关
concurrency，CPU 和产生中断的设备并行运行
program device，需要关注外部设备



中断处理——硬件
PLIC 会通知当前有一个待处理的中断
其中一个 CPU 核会 Claim 接收中断，这样 PLIC 就不会把中断发给其他的 CPU 处理
CPU 核处理完中断之后，CPU 会通知 PLIC
PLIC 将不再保存中断的信息

中断处理——软件使用驱动管理设备

bottom：通常是 Interrupt handler。当一个中断送到了 CPU，并且 CPU 设置接收这个中断，CPU 会调用相应的 Interrupt handler。Interrupt handler 并不运行在任何特定进程的 context 中，它只是处理中断。

top：是用户进程，或者内核的其他部分调用的接口。对于 UART 来说，这里有 read&#x2F;write 接口，这些接口可以被更高层级的代码调用。

驱动中会有一些队列（或者说 buffer），top 部分的代码会从队 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/11/6.s081/3-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%92%8C%E9%99%B7%E5%85%A5/" title="3-系统调用和陷入"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3-系统调用和陷入"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/6.s081/3-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%92%8C%E9%99%B7%E5%85%A5/" title="3-系统调用和陷入">3-系统调用和陷入</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/6-s081/">6.s081</a></span></div><div class="content">System calls and Trap
用户态和内核态的切换（trap）
程序执行系统调用（System call）
程序出现了类似 page fault、除 0 等异常（软件中断）
硬件中断（IO 设备）


RISC-V 寄存器
32 个通用寄存器
PC（程序计数器）
Mode（表明位于何种状态 user or supervisor）
SATP（指向页表的物理地址）
SEPC（指向 trap 指令的起始地址）
STVEC （也就是处理 trap 的内核指令地址）
SSRATCH（交换页表和 a0 地址）


内核态权限
读写控制寄存器：SATP、STVEC、SEPC
它可以使用 PTE_U 标志位为 0 的 PTE
supervisor mode 中的代码并不能读写任意物理地址，通过 page table 访问内存


用户态跳入内核态前
保存用户态 32 个寄存器
保存 PC
改变 Mode 为 Supervisor
改变 SATP 寄存器指向内核页表
将堆栈寄存器指向内核的地址



Trap 执行流程
在从用户空间进入到内核空间之前，内核会设置好 STVEC 寄存器指向  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/11/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/" title="6-多核和锁"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="6-多核和锁"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/6.s081/6-%E5%A4%9A%E6%A0%B8%E5%92%8C%E9%94%81/" title="6-多核和锁">6-多核和锁</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/6-s081/">6.s081</a></span></div><div class="content">Multiprocessor and Lock
锁就是一个对象，就像其他在内核中的对象一样。有一个结构体叫做 lock，它包含了一些字段，这些字段中维护了锁的状态。锁有非常直观的 API：

acquire，接收指向 lock 的指针作为参数。acquire 确保了在任何时间，只会有一个进程能够成功的获取锁。
release，也接收指向 lock 的指针作为参数。在同一时间尝试获取锁的其他进程需要等待，直到持有锁的进程对锁调用 release。


锁应该与操作而不是数据关联，所以自动加锁在某些场景下会出问题

想要程序简单点，可以通过 coarse-grain locking（注，也就是大锁），但是这时你就失去了性能


锁的特性
避免丢失更新
锁可以打包多个操作，使它们具有原子性
可以维护共享数据结构的不变性

challenge
死锁

破坏了程序的模块化

通常来说，开发的流程是：

先以 coarse-grained lock（注，也就是大锁）开始。
再对程序进行测试，来看一下程序是否能使用多核。
如果可以的话，那么工作就结束了，你对于锁的设计足够好了；如果不可以的话，那意味 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/11/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/" title="4-缺页中断"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="4-缺页中断"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/6.s081/4-%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD/" title="4-缺页中断">4-缺页中断</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/6-s081/">6.s081</a></span></div><div class="content">Page Fault
通过 page fault 可以实现的一系列虚拟内存功能

lazy allocation
copy-on-write fork
demand paging
memory mapped files


虚拟内存好处

isolation，隔离性；虚拟内存使得操作系统可以为每个应用程序提供属于它们自己的地址空间
level of indirection，提供了一层抽象，处理器和所有的指令都可以使用虚拟地址，内核会定义从虚拟地址到物理地址的映射关系


page fault 得到的信息

引起 page fault 的内存地址（STVAL 寄存器）
引起 page fault 的原因类型（SCAUSE 寄存器）
引起 page fault 时的程序计数器值，这表明了 page fault 在用户空间发生的位置（SEPC 寄存器中，trapframe-&gt;epc）



sbrk
当 sbrk 实际发生或者被调用的时候，内核会分配一些物理内存，并将这些内存映射到用户应用程序的地址空间，然后将内存内容初始化为 0，再返回 sbrk 系统调用。这样，应用程序可以通过多次 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/11/CMU15445/3-Database%20Storage/" title="3_Database_Storage I"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3_Database_Storage I"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/CMU15445/3-Database%20Storage/" title="3_Database_Storage I">3_Database_Storage I</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/DB/">DB</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CMU15445/">CMU15445</a></span></div><div class="content">3-Database Storage I1 DISK-BASED ARCHITECTURE
易失性存储和非易失性存储相结合
Volatile：Random Access Byte-Addressable （DRAM 之上）
Non-Volatile：Sequential Access Block-Addressable（SSD 之下 ）
SSD 以下只能按块来存取


顺序访问和随机访问
非易失性存储中顺序访问比随机访问快得多
一般数据存储在连续的块中，同时分配多个物理页叫区

2 DBMS 设计目标
允许管理比可用内存大的数据库
读写磁盘代价高昂，尽可能避免大的停顿和性能下降
DBMS 希望最大化顺序读写


3 为什么不使用 OS
The DBMS can use memory mapping (mmap) to store the contents of a file into the address space of a program.

The OS is responsible for moving the pages of the file in and out of  ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/11/cs61c/lecture10_Combinational%20Logic/" title="lecture10_Combinational_Logic"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="lecture10_Combinational_Logic"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/cs61c/lecture10_Combinational%20Logic/" title="lecture10_Combinational_Logic">lecture10_Combinational_Logic</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CS61C/">CS61C</a></span></div><div class="content">Combinational LogicCMOS
Boolean algebra
Arithmetic Logic Unit (ALU)

</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/11/cs61c/lecture11_FSMs/" title="lecture11_FSMs"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="lecture11_FSMs"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/cs61c/lecture11_FSMs/" title="lecture11_FSMs">lecture11_FSMs</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CS61C/">CS61C</a></span></div><div class="content">FSMs, Synchronous Digital SystemsFSM: Finite State Machinestate transition diagram

s0 初始状态；input&#x2F;output；箭头指向是 next state

clock and registersFlip-Flop
时钟上升沿；Q &#x3D; D，其余时刻什么也不做


register delay
clk-to-q delay
Registers can’t transfer the D input to Q output instantly
clk-to-q delay: Time it takes after the rising edge for the Q output to change



register constraintssetup time
Setup time: Time before rising edge when the D input must be stable


hold time
D input cannot change before thi ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/09/11/cs61c/lecture14_Datapath/" title="lecture14_DataPath_Hazards"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="lecture14_DataPath_Hazards"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/cs61c/lecture14_Datapath/" title="lecture14_DataPath_Hazards">lecture14_DataPath_Hazards</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CS61C/">CS61C</a></span></div><div class="content">HazardsStructural Hazards
两条或更多指令在流水线需要访问同一个物理单元

Solutions
指令轮流使用物理资源
增加额外的硬件资源
设计指令集避免结构冒险

Data Hazards
Some regfiles support writing a new value to a register, then reading the new value, in the same cycle.
a register being written to is read from later.

Solutions
Stalling

Wait for the first instruction to write its result before the second instruction reads thevalue



Forwarding

Add hardware to send the result back to earlier stages before the result is written
Requires extra connection ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/09/11/cs61c/lecture15_Data-LevelParallelism/" title="lecture15_Data_Level_Parallelism"><img class="post-bg" src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="lecture15_Data_Level_Parallelism"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/09/11/cs61c/lecture15_Data-LevelParallelism/" title="lecture15_Data_Level_Parallelism">lecture15_Data_Level_Parallelism</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-11T14:17:49.000Z" title="发表于 2023-09-11 22:17:49">2023-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CS-COURSE/">CS_COURSE</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CS61C/">CS61C</a></span></div><div class="content">Data-Level ParallelismSIMD
single instruction, multiple data or vector instructions


SIMD 实现矩阵乘法
common mistake
直接使用 32-bit 的 SIMD vector（寄存器与内存不同）
使用_mm_load or _mm_store 时采用未对齐的内存
忘记处理尾部特殊情况
使用太多的 vector

</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/6/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/#content-inner">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/#content-inner">8</a><a class="extend next" rel="next" href="/page/8/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">LZY</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/tom-jerr"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/tom-jerr" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/2584074296@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Stay hungry, Stay foolish</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/6.s081/xv6/" title="无题"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/10/31/6.s081/xv6/" title="无题">无题</a><time datetime="2024-10-31T02:45:44.569Z" title="发表于 2024-10-31 10:45:44">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/lab/lab1_buffer_pool/" title="无题"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/lab/lab1_buffer_pool/" title="无题">无题</a><time datetime="2024-10-30T16:37:18.218Z" title="发表于 2024-10-31 00:37:18">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/10-Join%20Algorithm/" title="10-Join Algorithm"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="10-Join Algorithm"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/10-Join%20Algorithm/" title="10-Join Algorithm">10-Join Algorithm</a><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/11-Query_Execution/" title="11 Query Execution"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="11 Query Execution"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/11-Query_Execution/" title="11 Query Execution">11 Query Execution</a><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/31/CMU15445/13-Concurrency_Control_Theory/" title="13 Concurrency Control Theory"><img src="/img/Stay_Hungry_Stay_Foolish.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="13 Concurrency Control Theory"/></a><div class="content"><a class="title" href="/2024/10/31/CMU15445/13-Concurrency_Control_Theory/" title="13 Concurrency Control Theory">13 Concurrency Control Theory</a><time datetime="2024-10-30T16:00:00.000Z" title="发表于 2024-10-31 00:00:00">2024-10-31</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CS-COURSE/"><span class="card-category-list-name">CS_COURSE</span><span class="card-category-list-count">22</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CV/"><span class="card-category-list-name">CV</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/DB/"><span class="card-category-list-name">DB</span><span class="card-category-list-count">17</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Knowledge/"><span class="card-category-list-name">Knowledge</span><span class="card-category-list-count">25</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Lab/"><span class="card-category-list-name">Lab</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/OS/"><span class="card-category-list-name">OS</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Project/"><span class="card-category-list-name">Project</span><span class="card-category-list-count">5</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/CS144/" style="font-size: 1.1em; color: #999">CS144</a> <a href="/tags/C/" style="font-size: 1.5em; color: #99a9bf">C++</a> <a href="/tags/CSAPP/" style="font-size: 1.23em; color: #999ea6">CSAPP</a> <a href="/tags/MESI/" style="font-size: 1.1em; color: #999">MESI</a> <a href="/tags/zero-copy/" style="font-size: 1.1em; color: #999">zero copy</a> <a href="/tags/Hardware/" style="font-size: 1.1em; color: #999">Hardware</a> <a href="/tags/CS61C/" style="font-size: 1.37em; color: #99a4b2">CS61C</a> <a href="/tags/CMU15-213/" style="font-size: 1.23em; color: #999ea6">CMU15-213</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><span class="card-archive-list-count">17</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><span class="card-archive-list-count">31</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">80</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-11-21T13:36:34.371Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By LZY</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">盲僧，你发现了华点</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>